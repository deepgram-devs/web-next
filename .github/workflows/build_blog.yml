name: "Blog: CI/CD"

on:
  workflow_dispatch:
  push:
  pull_request:

jobs:
  blog:
    name: Build Blog
    runs-on: ubuntu-latest
    env:
      PRODUCTION_DOMAIN: blog.deepgram.com
      STAGING_DOMAIN: sweet-pie-c52a63-blog.netlify.app
      BUILD_PATH: ./blog
      IS_PRODUCTION: ${{ github.ref == 'refs/heads/main' && github.event_name == 'push' }}
      DEPLOY_PREFIX: blog
    steps:
      - name: Check out repository
        uses: actions/checkout@v2
      - name: Configure dynamic environment variables
        if: ${{ env.IS_PRODUCTION == true }}
        env:
          URL: https://${{ env.PRODUCTION_DOMAIN }}
          ENVIRONMENT_NAME: ${{ env.DEPLOY_PREFIX }}-production
          BUILD_ALIAS: null
      - if: ${{ env.IS_PRODUCTION != true }}
        env:
          URL: https://${{ env.PRODUCTION_DOMAIN }}
          ENVIRONMENT_NAME: ${{ env.DEPLOY_PREFIX }}-production
          BUILD_ALIAS: deploy-preview
      - run: echo $URL