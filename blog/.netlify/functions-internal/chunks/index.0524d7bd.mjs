import { c as createAstro, a as createComponent, r as renderTemplate, b as renderHead } from '../entry.mjs';
import Slugger from 'github-slugger';
import '@astrojs/netlify/netlify-functions.js';
import 'preact';
import 'preact-render-to-string';
import 'vue';
import 'vue/server-renderer';
import 'html-escaper';
import 'node-html-parser';
import 'axios';
/* empty css                           *//* empty css                           *//* empty css                           */import '@storyblok/js';
/* empty css                          *//* empty css                              */import 'clone-deep';
import 'slugify';
import 'shiki';
/* empty css                           */import 'camelcase';
/* empty css                              */import '@astrojs/rss';
/* empty css                           */import 'mime';
import 'cookie';
import 'kleur/colors';
import 'string-width';
import 'path-browserify';
import 'path-to-regexp';

const metadata = { "headings": [{ "depth": 2, "slug": "scopes-and-roles", "text": "Scopes and Roles" }, { "depth": 2, "slug": "approach-1-create-and-delete-keys-on-demand", "text": "Approach 1: Create and Delete Keys On-Demand" }, { "depth": 2, "slug": "approach-2-automatically-expiring-keys", "text": "Approach 2: Automatically-Expiring Keys" }, { "depth": 2, "slug": "approach-3-create-a-server-proxy-to-deepgram", "text": "Approach 3: Create a Server Proxy to Deepgram" }, { "depth": 2, "slug": "in-summary", "text": "In Summary" }], "source": "\r\nWe love how little code is needed to get live transcripts directly from a web browser with Deepgram, but doing so may leave your API Key vulnerable in a user-accessible client. Any user with access to your key can access the Deepgram APIs, which, in turn, may provide full account access.\r\n\r\nThis post will cover three approaches to live transcription from the browser while protecting your account. Before reading this guide, you should understand how to open a WebSocket connection and send data to Deepgram in the browser - if not, we cover it in this [blog post](https://blog.deepgram.com/live-transcription-mic-browser/).\r\n\r\n## Scopes and Roles\r\n\r\nEach project in your Deepgram console can have multiple API Keys. Each key has several 'scopes' that describe the key's permissions. For example, one key may provide access to manage a project's team members, while others may not.\r\n\r\nTo make working with scopes easier, we also provide some 'roles' which provide a defined list of scopes for you. Instead of providing six common scopes, you can use `member`, and it will apply them all for you when creating a key. We'll be creating keys with specific scopes in this guide, and if you want to learn more about roles, we have a [Working with Roles](https://developers.deepgram.com/documentation/getting-started/roles/) guide in our documentation.\r\n\r\n![One project can have multiple keys. The first key in this diagram has permissions to create new keys, alter project settings, and use transcription APIs. The second key only has access to transcription APIs.](https://res.cloudinary.com/deepgram/image/upload/v1639592303/blog/2022/01/protecting-api-key/project-keys-scopes.png)\r\n\r\n## Approach 1: Create and Delete Keys On-Demand\r\n\r\nDeepgram provides a set of API endpoints to manage project keys. In this approach, we will create a key when required and then delete it when finished.\r\n\r\nTo create and delete additional keys with the API, the key used for this operation must have the `keys:write` scope. This key will not be sent to the browser - its whole purpose is to manage sharable keys on our behalf. If you created the initial key in our web console, you would have assigned a role that will include the `keys:write` permission.\r\n\r\n![Clicking the start transcription button in the browser sends a request to the server which creates a usage-only key with Deepgram. Clicking the end transcription button deletes it.](https://res.cloudinary.com/deepgram/image/upload/v1639592303/blog/2022/01/protecting-api-key/create-destroy-key.png)\r\n\r\nAn abbreviated version of this with code with the [Deepgram Node.js SDK](https://developers.deepgram.com/sdks-tools/sdks/node-sdk/) may look like this:\r\n\r\n```html\r\n{/*<!-- public/index.html -->*/}\r\n<!DOCTYPE html>\r\n<html>\r\n  <body>\r\n    <button id=\"start\">Start transcription</button>\r\n    <button id=\"end\">End transcription</button>\r\n    <script>\r\n      let key, api_key_id, mediaRecorder, socket\r\n\r\n      document.querySelector('#start').addEventListener('click', async () => {\r\n        // Access key and key id from server\r\n        const result = await fetch('/key', { method: 'POST' }).then((r) =>\r\n          r.json()\r\n        )\r\n        key = result.key\r\n        api_key_id = result.api_key_id\r\n\r\n        // Standard logic utilizing fetched key\r\n        navigator.mediaDevices.getUserMedia({ audio: true }).then((stream) => {\r\n          mediaRecorder = new MediaRecorder(stream)\r\n          socket = new WebSocket('wss://api.deepgram.com/v1/listen', [ 'token', key ])\r\n          socket.onopen = () => {\r\n            mediaRecorder.addEventListener('dataavailable', async (event) =>\r\n              socket.send(event.data)\r\n            )\r\n            mediaRecorder.start(250)\r\n          }\r\n          socket.onmessage = (message) => console.log(JSON.parse(message))\r\n        })\r\n      })\r\n\r\n      document.querySelector('#end').addEventListener('click', async () => {\r\n        // Delete key\r\n        const result = await fetch('/key/' + api_key_id, {\r\n          method: 'DELETE',\r\n        }).then((r) => r.json())\r\n        console.log(result)\r\n\r\n        // Client logic for closing connection\r\n        socket.close()\r\n        mediaRecorder.stop()\r\n      })\r\n    <\/script>\r\n  </body>\r\n</html>\r\n```\r\n\r\n```js\r\n// index.js\r\nconst express = require('express')\r\nconst { Deepgram } = require('@deepgram/sdk')\r\nconst app = express()\r\nconst deepgram = new Deepgram('YOUR_DEEPGRAM_API_KEY')\r\napp.use(express.static('public'))\r\n\r\napp.post('/key', (req, res) => {\r\n  const { key, api_key_id } = await deepgram.keys.create(\r\n    'PROJECT_ID',\r\n    'Temporary user key',\r\n    ['usage:write']\r\n  )\r\n  res.json({ key, api_key_id })\r\n})\r\n\r\napp.delete('/key/:keyId', (req, res) => {\r\n  const result = await deepgram.keys.delete('PROJECT_ID', req.params.keyId)\r\n  res.json(result)\r\n})\r\n\r\napp.listen(3000)\r\n```\r\n\r\nIn this example, clicking the **start** button sends a request to our server, creating a brand-new Deepgram key with the only scope required to use transcription - `usage:write`. It then sends the API Key and key ID to the browser - we require the key ID to refer to this key when deleting it.\r\n\r\nWhen the user clicks the **end** button, a request is sent to our server, which, in turn, deletes the key so it is no longer usable.\r\n\r\n## Approach 2: Automatically-Expiring Keys\r\n\r\nWe recently released some additional properties you can provide when creating project keys via the API, which set an expiry time. After the provided time, the key is invalidated automatically. You may either provide `expiration_date` or `time_to_live_in_seconds`, so pick whatever is best for your use case.\r\n\r\nKeys are validated by Deepgram when a new live transcription session is started, so you can set a short `time_to_live_in_seconds` as it is only needed when initially connecting.\r\n\r\nYou can also do this with the Node.js SDK with an object containing either `expirationDate` or `timeToLive`:\r\n\r\n```js\r\napp.get('/deepgram-token', async (req, res) => {\r\n  const newKey = await deepgram.keys.create(\r\n    process.env.DG_PROJECT_ID,\r\n    'Temporary key - works for 10 secs',\r\n    ['usage:write'],\r\n    { timeToLive: 10 }\r\n  )\r\n\r\n  res.send(newKey)\r\n})\r\n```\r\n\r\n## Approach 3: Create a Server Proxy to Deepgram\r\n\r\nThe first two approaches in this guide are a good stop-gap, but you should avoid sending keys to the client wherever possible. The most common and recommended approach is to set up a signaling server that will proxy requests to and from your browser and Deepgram. This approach means that your server communicates with Deepgram, avoiding the need for a Deepgram API Key to be present in the browser.\r\n\r\nAn illustration for how this might work in code looks like this:\r\n\r\n```js\r\n// index.js\r\nconst express = require('express')\r\nconst app = express()\r\napp.use(express.static('public'))\r\n\r\nconst WebSocket = require('ws')\r\nconst wss = new WebSocket.Server({ port: 3001 })\r\n\r\nconst { Deepgram } = require('@deepgram/sdk')\r\nconst deepgram = new Deepgram(process.env.DG_KEY)\r\nconst deepgramLive = deepgram.transcription.live({ utterances: true })\r\n\r\ndeepgramLive.onopen = () => console.log('dg onopen')\r\n\r\nwss.on('connection', (ws) => {\r\n  ws.onmessage = (event) => deepgramLive.send(event.data)\r\n  deepgramLive.addListener('transcriptReceived', (data) => ws.send(data))\r\n})\r\n\r\napp.listen(3000)\r\n```\r\n\r\n```html\r\n{/*<!-- public/index.html -->*/}\r\n<!DOCTYPE html>\r\n<html>\r\n  <body>\r\n    <button id=\"start\">Start transcription</button>\r\n    <script>\r\n      document.querySelector('#start').addEventListener('click', async () => {\r\n        navigator.mediaDevices.getUserMedia({ audio: true }).then((stream) => {\r\n          const mediaRecorder = new MediaRecorder(stream)\r\n          const socket = new WebSocket(`ws://localhost:3001`)\r\n          socket.onopen = () => {\r\n            mediaRecorder.addEventListener('dataavailable', (event) =>\r\n              socket.send(event.data)\r\n            )\r\n            mediaRecorder.start(250)\r\n          }\r\n          socket.onmessage = (message) => console.log(JSON.parse(message.data))\r\n        })\r\n      })\r\n    <\/script>\r\n  </body>\r\n</html>\r\n```\r\n\r\nThis approach is very similar to opening a connection directly to Deepgram. In this example, however, we create a Node.js application that starts an express web application on port 3000 and a WebSocket server on port 3001, then connect to the WebSocket endpoint from our client. The server's main job is pushing data to and from the browser and Deepgram. These lines handle all of that logic:\r\n\r\n```js\r\nws.onmessage = (event) => deepgramLive.send(event.data)\r\ndeepgramLive.addListener('transcriptReceived', (data) => ws.send(data))\r\n```\r\n\r\n## In Summary\r\n\r\nAPI Keys created in the console with roles have more permissions than you would want users to have access to. Hopefully, this guide provides some useful strategies which allow you to protect your Deepgram account with minimal additional code in your project.\r\n\r\nIf you have any questions, please feel free to reach out on Twitter - we're [@DeepgramDevs](https://twitter.com/DeepgramDevs).\r\n\r\n        ", "html": '<p>We love how little code is needed to get live transcripts directly from a web browser with Deepgram, but doing so may leave your API Key vulnerable in a user-accessible client. Any user with access to your key can access the Deepgram APIs, which, in turn, may provide full account access.</p>\n<p>This post will cover three approaches to live transcription from the browser while protecting your account. Before reading this guide, you should understand how to open a WebSocket connection and send data to Deepgram in the browser - if not, we cover it in this <a href="https://blog.deepgram.com/live-transcription-mic-browser/">blog post</a>.</p>\n<h2 id="scopes-and-roles">Scopes and Roles</h2>\n<p>Each project in your Deepgram console can have multiple API Keys. Each key has several \u2018scopes\u2019 that describe the key\u2019s permissions. For example, one key may provide access to manage a project\u2019s team members, while others may not.</p>\n<p>To make working with scopes easier, we also provide some \u2018roles\u2019 which provide a defined list of scopes for you. Instead of providing six common scopes, you can use <code is:raw>member</code>, and it will apply them all for you when creating a key. We\u2019ll be creating keys with specific scopes in this guide, and if you want to learn more about roles, we have a <a href="https://developers.deepgram.com/documentation/getting-started/roles/">Working with Roles</a> guide in our documentation.</p>\n<p><img src="https://res.cloudinary.com/deepgram/image/upload/v1639592303/blog/2022/01/protecting-api-key/project-keys-scopes.png" alt="One project can have multiple keys. The first key in this diagram has permissions to create new keys, alter project settings, and use transcription APIs. The second key only has access to transcription APIs."></p>\n<h2 id="approach-1-create-and-delete-keys-on-demand">Approach 1: Create and Delete Keys On-Demand</h2>\n<p>Deepgram provides a set of API endpoints to manage project keys. In this approach, we will create a key when required and then delete it when finished.</p>\n<p>To create and delete additional keys with the API, the key used for this operation must have the <code is:raw>keys:write</code> scope. This key will not be sent to the browser - its whole purpose is to manage sharable keys on our behalf. If you created the initial key in our web console, you would have assigned a role that will include the <code is:raw>keys:write</code> permission.</p>\n<p><img src="https://res.cloudinary.com/deepgram/image/upload/v1639592303/blog/2022/01/protecting-api-key/create-destroy-key.png" alt="Clicking the start transcription button in the browser sends a request to the server which creates a usage-only key with Deepgram. Clicking the end transcription button deletes it."></p>\n<p>An abbreviated version of this with code with the <a href="https://developers.deepgram.com/sdks-tools/sdks/node-sdk/">Deepgram Node.js SDK</a> may look like this:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #8B949E">&lt;!-- public/index.html --&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">&lt;!</span><span style="color: #7EE787">DOCTYPE</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">html</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">html</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">body</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">button</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">id</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;start&quot;</span><span style="color: #C9D1D9">&gt;Start transcription&lt;/</span><span style="color: #7EE787">button</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">button</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">id</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;end&quot;</span><span style="color: #C9D1D9">&gt;End transcription&lt;/</span><span style="color: #7EE787">button</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">let</span><span style="color: #C9D1D9"> key, api_key_id, mediaRecorder, socket</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">      document.</span><span style="color: #D2A8FF">querySelector</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;#start&#39;</span><span style="color: #C9D1D9">).</span><span style="color: #D2A8FF">addEventListener</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;click&#39;</span><span style="color: #C9D1D9">, </span><span style="color: #FF7B72">async</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #8B949E">// Access key and key id from server</span></span>\n<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">result</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">await</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">fetch</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;/key&#39;</span><span style="color: #C9D1D9">, { method: </span><span style="color: #A5D6FF">&#39;POST&#39;</span><span style="color: #C9D1D9"> }).</span><span style="color: #D2A8FF">then</span><span style="color: #C9D1D9">((</span><span style="color: #FFA657">r</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">          r.</span><span style="color: #D2A8FF">json</span><span style="color: #C9D1D9">()</span></span>\n<span class="line"><span style="color: #C9D1D9">        )</span></span>\n<span class="line"><span style="color: #C9D1D9">        key </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> result.key</span></span>\n<span class="line"><span style="color: #C9D1D9">        api_key_id </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> result.api_key_id</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #8B949E">// Standard logic utilizing fetched key</span></span>\n<span class="line"><span style="color: #C9D1D9">        navigator.mediaDevices.</span><span style="color: #D2A8FF">getUserMedia</span><span style="color: #C9D1D9">({ audio: </span><span style="color: #79C0FF">true</span><span style="color: #C9D1D9"> }).</span><span style="color: #D2A8FF">then</span><span style="color: #C9D1D9">((</span><span style="color: #FFA657">stream</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">          mediaRecorder </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">MediaRecorder</span><span style="color: #C9D1D9">(stream)</span></span>\n<span class="line"><span style="color: #C9D1D9">          socket </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">WebSocket</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;wss://api.deepgram.com/v1/listen&#39;</span><span style="color: #C9D1D9">, [ </span><span style="color: #A5D6FF">&#39;token&#39;</span><span style="color: #C9D1D9">, key ])</span></span>\n<span class="line"><span style="color: #C9D1D9">          socket.</span><span style="color: #D2A8FF">onopen</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">            mediaRecorder.</span><span style="color: #D2A8FF">addEventListener</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;dataavailable&#39;</span><span style="color: #C9D1D9">, </span><span style="color: #FF7B72">async</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">event</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">              socket.</span><span style="color: #D2A8FF">send</span><span style="color: #C9D1D9">(event.data)</span></span>\n<span class="line"><span style="color: #C9D1D9">            )</span></span>\n<span class="line"><span style="color: #C9D1D9">            mediaRecorder.</span><span style="color: #D2A8FF">start</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">250</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #C9D1D9">          }</span></span>\n<span class="line"><span style="color: #C9D1D9">          socket.</span><span style="color: #D2A8FF">onmessage</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">message</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">JSON</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">parse</span><span style="color: #C9D1D9">(message))</span></span>\n<span class="line"><span style="color: #C9D1D9">        })</span></span>\n<span class="line"><span style="color: #C9D1D9">      })</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">      document.</span><span style="color: #D2A8FF">querySelector</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;#end&#39;</span><span style="color: #C9D1D9">).</span><span style="color: #D2A8FF">addEventListener</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;click&#39;</span><span style="color: #C9D1D9">, </span><span style="color: #FF7B72">async</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #8B949E">// Delete key</span></span>\n<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">result</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">await</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">fetch</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;/key/&#39;</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> api_key_id, {</span></span>\n<span class="line"><span style="color: #C9D1D9">          method: </span><span style="color: #A5D6FF">&#39;DELETE&#39;</span><span style="color: #C9D1D9">,</span></span>\n<span class="line"><span style="color: #C9D1D9">        }).</span><span style="color: #D2A8FF">then</span><span style="color: #C9D1D9">((</span><span style="color: #FFA657">r</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> r.</span><span style="color: #D2A8FF">json</span><span style="color: #C9D1D9">())</span></span>\n<span class="line"><span style="color: #C9D1D9">        console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(result)</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #8B949E">// Client logic for closing connection</span></span>\n<span class="line"><span style="color: #C9D1D9">        socket.</span><span style="color: #D2A8FF">close</span><span style="color: #C9D1D9">()</span></span>\n<span class="line"><span style="color: #C9D1D9">        mediaRecorder.</span><span style="color: #D2A8FF">stop</span><span style="color: #C9D1D9">()</span></span>\n<span class="line"><span style="color: #C9D1D9">      })</span></span>\n<span class="line"><span style="color: #C9D1D9">    &lt;/</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;/</span><span style="color: #7EE787">body</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">&lt;/</span><span style="color: #7EE787">html</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #8B949E">// index.js</span></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">express</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">require</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;express&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> { </span><span style="color: #79C0FF">Deepgram</span><span style="color: #C9D1D9"> } </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">require</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;@deepgram/sdk&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">app</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">express</span><span style="color: #C9D1D9">()</span></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">deepgram</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">Deepgram</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;YOUR_DEEPGRAM_API_KEY&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">use</span><span style="color: #C9D1D9">(express.</span><span style="color: #D2A8FF">static</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;public&#39;</span><span style="color: #C9D1D9">))</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">post</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;/key&#39;</span><span style="color: #C9D1D9">, (</span><span style="color: #FFA657">req</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">res</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> { </span><span style="color: #79C0FF">key</span><span style="color: #C9D1D9">, </span><span style="color: #79C0FF">api_key_id</span><span style="color: #C9D1D9"> } </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">await</span><span style="color: #C9D1D9"> deepgram.keys.</span><span style="color: #D2A8FF">create</span><span style="color: #C9D1D9">(</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #A5D6FF">&#39;PROJECT_ID&#39;</span><span style="color: #C9D1D9">,</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #A5D6FF">&#39;Temporary user key&#39;</span><span style="color: #C9D1D9">,</span></span>\n<span class="line"><span style="color: #C9D1D9">    [</span><span style="color: #A5D6FF">&#39;usage:write&#39;</span><span style="color: #C9D1D9">]</span></span>\n<span class="line"><span style="color: #C9D1D9">  )</span></span>\n<span class="line"><span style="color: #C9D1D9">  res.</span><span style="color: #D2A8FF">json</span><span style="color: #C9D1D9">({ key, api_key_id })</span></span>\n<span class="line"><span style="color: #C9D1D9">})</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">delete</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;/key/:keyId&#39;</span><span style="color: #C9D1D9">, (</span><span style="color: #FFA657">req</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">res</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">result</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">await</span><span style="color: #C9D1D9"> deepgram.keys.</span><span style="color: #D2A8FF">delete</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;PROJECT_ID&#39;</span><span style="color: #C9D1D9">, req.params.keyId)</span></span>\n<span class="line"><span style="color: #C9D1D9">  res.</span><span style="color: #D2A8FF">json</span><span style="color: #C9D1D9">(result)</span></span>\n<span class="line"><span style="color: #C9D1D9">})</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">listen</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">3000</span><span style="color: #C9D1D9">)</span></span></code></pre>\n<p>In this example, clicking the <strong>start</strong> button sends a request to our server, creating a brand-new Deepgram key with the only scope required to use transcription - <code is:raw>usage:write</code>. It then sends the API Key and key ID to the browser - we require the key ID to refer to this key when deleting it.</p>\n<p>When the user clicks the <strong>end</strong> button, a request is sent to our server, which, in turn, deletes the key so it is no longer usable.</p>\n<h2 id="approach-2-automatically-expiring-keys">Approach 2: Automatically-Expiring Keys</h2>\n<p>We recently released some additional properties you can provide when creating project keys via the API, which set an expiry time. After the provided time, the key is invalidated automatically. You may either provide <code is:raw>expiration_date</code> or <code is:raw>time_to_live_in_seconds</code>, so pick whatever is best for your use case.</p>\n<p>Keys are validated by Deepgram when a new live transcription session is started, so you can set a short <code is:raw>time_to_live_in_seconds</code> as it is only needed when initially connecting.</p>\n<p>You can also do this with the Node.js SDK with an object containing either <code is:raw>expirationDate</code> or <code is:raw>timeToLive</code>:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">get</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;/deepgram-token&#39;</span><span style="color: #C9D1D9">, </span><span style="color: #FF7B72">async</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">req</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">res</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">newKey</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">await</span><span style="color: #C9D1D9"> deepgram.keys.</span><span style="color: #D2A8FF">create</span><span style="color: #C9D1D9">(</span></span>\n<span class="line"><span style="color: #C9D1D9">    process.env.</span><span style="color: #79C0FF">DG_PROJECT_ID</span><span style="color: #C9D1D9">,</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #A5D6FF">&#39;Temporary key - works for 10 secs&#39;</span><span style="color: #C9D1D9">,</span></span>\n<span class="line"><span style="color: #C9D1D9">    [</span><span style="color: #A5D6FF">&#39;usage:write&#39;</span><span style="color: #C9D1D9">],</span></span>\n<span class="line"><span style="color: #C9D1D9">    { timeToLive: </span><span style="color: #79C0FF">10</span><span style="color: #C9D1D9"> }</span></span>\n<span class="line"><span style="color: #C9D1D9">  )</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">  res.</span><span style="color: #D2A8FF">send</span><span style="color: #C9D1D9">(newKey)</span></span>\n<span class="line"><span style="color: #C9D1D9">})</span></span></code></pre>\n<h2 id="approach-3-create-a-server-proxy-to-deepgram">Approach 3: Create a Server Proxy to Deepgram</h2>\n<p>The first two approaches in this guide are a good stop-gap, but you should avoid sending keys to the client wherever possible. The most common and recommended approach is to set up a signaling server that will proxy requests to and from your browser and Deepgram. This approach means that your server communicates with Deepgram, avoiding the need for a Deepgram API Key to be present in the browser.</p>\n<p>An illustration for how this might work in code looks like this:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #8B949E">// index.js</span></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">express</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">require</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;express&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">app</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">express</span><span style="color: #C9D1D9">()</span></span>\n<span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">use</span><span style="color: #C9D1D9">(express.</span><span style="color: #D2A8FF">static</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;public&#39;</span><span style="color: #C9D1D9">))</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">WebSocket</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">require</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;ws&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">wss</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> WebSocket.</span><span style="color: #D2A8FF">Server</span><span style="color: #C9D1D9">({ port: </span><span style="color: #79C0FF">3001</span><span style="color: #C9D1D9"> })</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> { </span><span style="color: #79C0FF">Deepgram</span><span style="color: #C9D1D9"> } </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">require</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;@deepgram/sdk&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">deepgram</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">Deepgram</span><span style="color: #C9D1D9">(process.env.</span><span style="color: #79C0FF">DG_KEY</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">deepgramLive</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> deepgram.transcription.</span><span style="color: #D2A8FF">live</span><span style="color: #C9D1D9">({ utterances: </span><span style="color: #79C0FF">true</span><span style="color: #C9D1D9"> })</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">deepgramLive.</span><span style="color: #D2A8FF">onopen</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;dg onopen&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">wss.</span><span style="color: #D2A8FF">on</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;connection&#39;</span><span style="color: #C9D1D9">, (</span><span style="color: #FFA657">ws</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">  ws.</span><span style="color: #D2A8FF">onmessage</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">event</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> deepgramLive.</span><span style="color: #D2A8FF">send</span><span style="color: #C9D1D9">(event.data)</span></span>\n<span class="line"><span style="color: #C9D1D9">  deepgramLive.</span><span style="color: #D2A8FF">addListener</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;transcriptReceived&#39;</span><span style="color: #C9D1D9">, (</span><span style="color: #FFA657">data</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> ws.</span><span style="color: #D2A8FF">send</span><span style="color: #C9D1D9">(data))</span></span>\n<span class="line"><span style="color: #C9D1D9">})</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">listen</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">3000</span><span style="color: #C9D1D9">)</span></span></code></pre>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #8B949E">&lt;!-- public/index.html --&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">&lt;!</span><span style="color: #7EE787">DOCTYPE</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">html</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">html</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">body</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">button</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">id</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;start&quot;</span><span style="color: #C9D1D9">&gt;Start transcription&lt;/</span><span style="color: #7EE787">button</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">      document.</span><span style="color: #D2A8FF">querySelector</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;#start&#39;</span><span style="color: #C9D1D9">).</span><span style="color: #D2A8FF">addEventListener</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;click&#39;</span><span style="color: #C9D1D9">, </span><span style="color: #FF7B72">async</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">        navigator.mediaDevices.</span><span style="color: #D2A8FF">getUserMedia</span><span style="color: #C9D1D9">({ audio: </span><span style="color: #79C0FF">true</span><span style="color: #C9D1D9"> }).</span><span style="color: #D2A8FF">then</span><span style="color: #C9D1D9">((</span><span style="color: #FFA657">stream</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">          </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">mediaRecorder</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">MediaRecorder</span><span style="color: #C9D1D9">(stream)</span></span>\n<span class="line"><span style="color: #C9D1D9">          </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">socket</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">WebSocket</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">`ws://localhost:3001`</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #C9D1D9">          socket.</span><span style="color: #D2A8FF">onopen</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">            mediaRecorder.</span><span style="color: #D2A8FF">addEventListener</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;dataavailable&#39;</span><span style="color: #C9D1D9">, (</span><span style="color: #FFA657">event</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">              socket.</span><span style="color: #D2A8FF">send</span><span style="color: #C9D1D9">(event.data)</span></span>\n<span class="line"><span style="color: #C9D1D9">            )</span></span>\n<span class="line"><span style="color: #C9D1D9">            mediaRecorder.</span><span style="color: #D2A8FF">start</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">250</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #C9D1D9">          }</span></span>\n<span class="line"><span style="color: #C9D1D9">          socket.</span><span style="color: #D2A8FF">onmessage</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">message</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">JSON</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">parse</span><span style="color: #C9D1D9">(message.data))</span></span>\n<span class="line"><span style="color: #C9D1D9">        })</span></span>\n<span class="line"><span style="color: #C9D1D9">      })</span></span>\n<span class="line"><span style="color: #C9D1D9">    &lt;/</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;/</span><span style="color: #7EE787">body</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">&lt;/</span><span style="color: #7EE787">html</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>\n<p>This approach is very similar to opening a connection directly to Deepgram. In this example, however, we create a Node.js application that starts an express web application on port 3000 and a WebSocket server on port 3001, then connect to the WebSocket endpoint from our client. The server\u2019s main job is pushing data to and from the browser and Deepgram. These lines handle all of that logic:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">ws.</span><span style="color: #D2A8FF">onmessage</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">event</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> deepgramLive.</span><span style="color: #D2A8FF">send</span><span style="color: #C9D1D9">(event.data)</span></span>\n<span class="line"><span style="color: #C9D1D9">deepgramLive.</span><span style="color: #D2A8FF">addListener</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;transcriptReceived&#39;</span><span style="color: #C9D1D9">, (</span><span style="color: #FFA657">data</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> ws.</span><span style="color: #D2A8FF">send</span><span style="color: #C9D1D9">(data))</span></span></code></pre>\n<h2 id="in-summary">In Summary</h2>\n<p>API Keys created in the console with roles have more permissions than you would want users to have access to. Hopefully, this guide provides some useful strategies which allow you to protect your Deepgram account with minimal additional code in your project.</p>\n<p>If you have any questions, please feel free to reach out on Twitter - we\u2019re <a href="https://twitter.com/DeepgramDevs">@DeepgramDevs</a>.</p>' };
const frontmatter = { "title": "Browser Live Transcription - Protecting Your API Key", "description": "Protect your API Key from unauthorized use with these tips.", "date": "2022-01-17T00:00:00.000Z", "cover": "https://res.cloudinary.com/deepgram/image/upload/v1642183098/blog/2022/01/protecting-api-key/Browser-Live-Transcription-Protecting-Your-API-Key%402x.jpg", "authors": ["kevin-lewis"], "category": "best-practice", "tags": ["browser"], "seo": { "title": "Browser Live Transcription - Protecting Your API Key", "description": "Protect your API Key from unauthorized use with these tips." }, "shorturls": { "share": "https://dpgr.am/c14514d", "twitter": "https://dpgr.am/ceb2d19", "linkedin": "https://dpgr.am/86668f1", "reddit": "https://dpgr.am/801f139", "facebook": "https://dpgr.am/5a7bbeb" }, "og": { "image": "https://res.cloudinary.com/deepgram/image/upload/v1661453850/blog/protecting-api-key/ograph.png" }, "astro": { "headings": [{ "depth": 2, "slug": "scopes-and-roles", "text": "Scopes and Roles" }, { "depth": 2, "slug": "approach-1-create-and-delete-keys-on-demand", "text": "Approach 1: Create and Delete Keys On-Demand" }, { "depth": 2, "slug": "approach-2-automatically-expiring-keys", "text": "Approach 2: Automatically-Expiring Keys" }, { "depth": 2, "slug": "approach-3-create-a-server-proxy-to-deepgram", "text": "Approach 3: Create a Server Proxy to Deepgram" }, { "depth": 2, "slug": "in-summary", "text": "In Summary" }], "source": "\r\nWe love how little code is needed to get live transcripts directly from a web browser with Deepgram, but doing so may leave your API Key vulnerable in a user-accessible client. Any user with access to your key can access the Deepgram APIs, which, in turn, may provide full account access.\r\n\r\nThis post will cover three approaches to live transcription from the browser while protecting your account. Before reading this guide, you should understand how to open a WebSocket connection and send data to Deepgram in the browser - if not, we cover it in this [blog post](https://blog.deepgram.com/live-transcription-mic-browser/).\r\n\r\n## Scopes and Roles\r\n\r\nEach project in your Deepgram console can have multiple API Keys. Each key has several 'scopes' that describe the key's permissions. For example, one key may provide access to manage a project's team members, while others may not.\r\n\r\nTo make working with scopes easier, we also provide some 'roles' which provide a defined list of scopes for you. Instead of providing six common scopes, you can use `member`, and it will apply them all for you when creating a key. We'll be creating keys with specific scopes in this guide, and if you want to learn more about roles, we have a [Working with Roles](https://developers.deepgram.com/documentation/getting-started/roles/) guide in our documentation.\r\n\r\n![One project can have multiple keys. The first key in this diagram has permissions to create new keys, alter project settings, and use transcription APIs. The second key only has access to transcription APIs.](https://res.cloudinary.com/deepgram/image/upload/v1639592303/blog/2022/01/protecting-api-key/project-keys-scopes.png)\r\n\r\n## Approach 1: Create and Delete Keys On-Demand\r\n\r\nDeepgram provides a set of API endpoints to manage project keys. In this approach, we will create a key when required and then delete it when finished.\r\n\r\nTo create and delete additional keys with the API, the key used for this operation must have the `keys:write` scope. This key will not be sent to the browser - its whole purpose is to manage sharable keys on our behalf. If you created the initial key in our web console, you would have assigned a role that will include the `keys:write` permission.\r\n\r\n![Clicking the start transcription button in the browser sends a request to the server which creates a usage-only key with Deepgram. Clicking the end transcription button deletes it.](https://res.cloudinary.com/deepgram/image/upload/v1639592303/blog/2022/01/protecting-api-key/create-destroy-key.png)\r\n\r\nAn abbreviated version of this with code with the [Deepgram Node.js SDK](https://developers.deepgram.com/sdks-tools/sdks/node-sdk/) may look like this:\r\n\r\n```html\r\n{/*<!-- public/index.html -->*/}\r\n<!DOCTYPE html>\r\n<html>\r\n  <body>\r\n    <button id=\"start\">Start transcription</button>\r\n    <button id=\"end\">End transcription</button>\r\n    <script>\r\n      let key, api_key_id, mediaRecorder, socket\r\n\r\n      document.querySelector('#start').addEventListener('click', async () => {\r\n        // Access key and key id from server\r\n        const result = await fetch('/key', { method: 'POST' }).then((r) =>\r\n          r.json()\r\n        )\r\n        key = result.key\r\n        api_key_id = result.api_key_id\r\n\r\n        // Standard logic utilizing fetched key\r\n        navigator.mediaDevices.getUserMedia({ audio: true }).then((stream) => {\r\n          mediaRecorder = new MediaRecorder(stream)\r\n          socket = new WebSocket('wss://api.deepgram.com/v1/listen', [ 'token', key ])\r\n          socket.onopen = () => {\r\n            mediaRecorder.addEventListener('dataavailable', async (event) =>\r\n              socket.send(event.data)\r\n            )\r\n            mediaRecorder.start(250)\r\n          }\r\n          socket.onmessage = (message) => console.log(JSON.parse(message))\r\n        })\r\n      })\r\n\r\n      document.querySelector('#end').addEventListener('click', async () => {\r\n        // Delete key\r\n        const result = await fetch('/key/' + api_key_id, {\r\n          method: 'DELETE',\r\n        }).then((r) => r.json())\r\n        console.log(result)\r\n\r\n        // Client logic for closing connection\r\n        socket.close()\r\n        mediaRecorder.stop()\r\n      })\r\n    <\/script>\r\n  </body>\r\n</html>\r\n```\r\n\r\n```js\r\n// index.js\r\nconst express = require('express')\r\nconst { Deepgram } = require('@deepgram/sdk')\r\nconst app = express()\r\nconst deepgram = new Deepgram('YOUR_DEEPGRAM_API_KEY')\r\napp.use(express.static('public'))\r\n\r\napp.post('/key', (req, res) => {\r\n  const { key, api_key_id } = await deepgram.keys.create(\r\n    'PROJECT_ID',\r\n    'Temporary user key',\r\n    ['usage:write']\r\n  )\r\n  res.json({ key, api_key_id })\r\n})\r\n\r\napp.delete('/key/:keyId', (req, res) => {\r\n  const result = await deepgram.keys.delete('PROJECT_ID', req.params.keyId)\r\n  res.json(result)\r\n})\r\n\r\napp.listen(3000)\r\n```\r\n\r\nIn this example, clicking the **start** button sends a request to our server, creating a brand-new Deepgram key with the only scope required to use transcription - `usage:write`. It then sends the API Key and key ID to the browser - we require the key ID to refer to this key when deleting it.\r\n\r\nWhen the user clicks the **end** button, a request is sent to our server, which, in turn, deletes the key so it is no longer usable.\r\n\r\n## Approach 2: Automatically-Expiring Keys\r\n\r\nWe recently released some additional properties you can provide when creating project keys via the API, which set an expiry time. After the provided time, the key is invalidated automatically. You may either provide `expiration_date` or `time_to_live_in_seconds`, so pick whatever is best for your use case.\r\n\r\nKeys are validated by Deepgram when a new live transcription session is started, so you can set a short `time_to_live_in_seconds` as it is only needed when initially connecting.\r\n\r\nYou can also do this with the Node.js SDK with an object containing either `expirationDate` or `timeToLive`:\r\n\r\n```js\r\napp.get('/deepgram-token', async (req, res) => {\r\n  const newKey = await deepgram.keys.create(\r\n    process.env.DG_PROJECT_ID,\r\n    'Temporary key - works for 10 secs',\r\n    ['usage:write'],\r\n    { timeToLive: 10 }\r\n  )\r\n\r\n  res.send(newKey)\r\n})\r\n```\r\n\r\n## Approach 3: Create a Server Proxy to Deepgram\r\n\r\nThe first two approaches in this guide are a good stop-gap, but you should avoid sending keys to the client wherever possible. The most common and recommended approach is to set up a signaling server that will proxy requests to and from your browser and Deepgram. This approach means that your server communicates with Deepgram, avoiding the need for a Deepgram API Key to be present in the browser.\r\n\r\nAn illustration for how this might work in code looks like this:\r\n\r\n```js\r\n// index.js\r\nconst express = require('express')\r\nconst app = express()\r\napp.use(express.static('public'))\r\n\r\nconst WebSocket = require('ws')\r\nconst wss = new WebSocket.Server({ port: 3001 })\r\n\r\nconst { Deepgram } = require('@deepgram/sdk')\r\nconst deepgram = new Deepgram(process.env.DG_KEY)\r\nconst deepgramLive = deepgram.transcription.live({ utterances: true })\r\n\r\ndeepgramLive.onopen = () => console.log('dg onopen')\r\n\r\nwss.on('connection', (ws) => {\r\n  ws.onmessage = (event) => deepgramLive.send(event.data)\r\n  deepgramLive.addListener('transcriptReceived', (data) => ws.send(data))\r\n})\r\n\r\napp.listen(3000)\r\n```\r\n\r\n```html\r\n{/*<!-- public/index.html -->*/}\r\n<!DOCTYPE html>\r\n<html>\r\n  <body>\r\n    <button id=\"start\">Start transcription</button>\r\n    <script>\r\n      document.querySelector('#start').addEventListener('click', async () => {\r\n        navigator.mediaDevices.getUserMedia({ audio: true }).then((stream) => {\r\n          const mediaRecorder = new MediaRecorder(stream)\r\n          const socket = new WebSocket(`ws://localhost:3001`)\r\n          socket.onopen = () => {\r\n            mediaRecorder.addEventListener('dataavailable', (event) =>\r\n              socket.send(event.data)\r\n            )\r\n            mediaRecorder.start(250)\r\n          }\r\n          socket.onmessage = (message) => console.log(JSON.parse(message.data))\r\n        })\r\n      })\r\n    <\/script>\r\n  </body>\r\n</html>\r\n```\r\n\r\nThis approach is very similar to opening a connection directly to Deepgram. In this example, however, we create a Node.js application that starts an express web application on port 3000 and a WebSocket server on port 3001, then connect to the WebSocket endpoint from our client. The server's main job is pushing data to and from the browser and Deepgram. These lines handle all of that logic:\r\n\r\n```js\r\nws.onmessage = (event) => deepgramLive.send(event.data)\r\ndeepgramLive.addListener('transcriptReceived', (data) => ws.send(data))\r\n```\r\n\r\n## In Summary\r\n\r\nAPI Keys created in the console with roles have more permissions than you would want users to have access to. Hopefully, this guide provides some useful strategies which allow you to protect your Deepgram account with minimal additional code in your project.\r\n\r\nIf you have any questions, please feel free to reach out on Twitter - we're [@DeepgramDevs](https://twitter.com/DeepgramDevs).\r\n\r\n        ", "html": '<p>We love how little code is needed to get live transcripts directly from a web browser with Deepgram, but doing so may leave your API Key vulnerable in a user-accessible client. Any user with access to your key can access the Deepgram APIs, which, in turn, may provide full account access.</p>\n<p>This post will cover three approaches to live transcription from the browser while protecting your account. Before reading this guide, you should understand how to open a WebSocket connection and send data to Deepgram in the browser - if not, we cover it in this <a href="https://blog.deepgram.com/live-transcription-mic-browser/">blog post</a>.</p>\n<h2 id="scopes-and-roles">Scopes and Roles</h2>\n<p>Each project in your Deepgram console can have multiple API Keys. Each key has several \u2018scopes\u2019 that describe the key\u2019s permissions. For example, one key may provide access to manage a project\u2019s team members, while others may not.</p>\n<p>To make working with scopes easier, we also provide some \u2018roles\u2019 which provide a defined list of scopes for you. Instead of providing six common scopes, you can use <code is:raw>member</code>, and it will apply them all for you when creating a key. We\u2019ll be creating keys with specific scopes in this guide, and if you want to learn more about roles, we have a <a href="https://developers.deepgram.com/documentation/getting-started/roles/">Working with Roles</a> guide in our documentation.</p>\n<p><img src="https://res.cloudinary.com/deepgram/image/upload/v1639592303/blog/2022/01/protecting-api-key/project-keys-scopes.png" alt="One project can have multiple keys. The first key in this diagram has permissions to create new keys, alter project settings, and use transcription APIs. The second key only has access to transcription APIs."></p>\n<h2 id="approach-1-create-and-delete-keys-on-demand">Approach 1: Create and Delete Keys On-Demand</h2>\n<p>Deepgram provides a set of API endpoints to manage project keys. In this approach, we will create a key when required and then delete it when finished.</p>\n<p>To create and delete additional keys with the API, the key used for this operation must have the <code is:raw>keys:write</code> scope. This key will not be sent to the browser - its whole purpose is to manage sharable keys on our behalf. If you created the initial key in our web console, you would have assigned a role that will include the <code is:raw>keys:write</code> permission.</p>\n<p><img src="https://res.cloudinary.com/deepgram/image/upload/v1639592303/blog/2022/01/protecting-api-key/create-destroy-key.png" alt="Clicking the start transcription button in the browser sends a request to the server which creates a usage-only key with Deepgram. Clicking the end transcription button deletes it."></p>\n<p>An abbreviated version of this with code with the <a href="https://developers.deepgram.com/sdks-tools/sdks/node-sdk/">Deepgram Node.js SDK</a> may look like this:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #8B949E">&lt;!-- public/index.html --&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">&lt;!</span><span style="color: #7EE787">DOCTYPE</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">html</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">html</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">body</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">button</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">id</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;start&quot;</span><span style="color: #C9D1D9">&gt;Start transcription&lt;/</span><span style="color: #7EE787">button</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">button</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">id</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;end&quot;</span><span style="color: #C9D1D9">&gt;End transcription&lt;/</span><span style="color: #7EE787">button</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">let</span><span style="color: #C9D1D9"> key, api_key_id, mediaRecorder, socket</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">      document.</span><span style="color: #D2A8FF">querySelector</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;#start&#39;</span><span style="color: #C9D1D9">).</span><span style="color: #D2A8FF">addEventListener</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;click&#39;</span><span style="color: #C9D1D9">, </span><span style="color: #FF7B72">async</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #8B949E">// Access key and key id from server</span></span>\n<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">result</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">await</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">fetch</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;/key&#39;</span><span style="color: #C9D1D9">, { method: </span><span style="color: #A5D6FF">&#39;POST&#39;</span><span style="color: #C9D1D9"> }).</span><span style="color: #D2A8FF">then</span><span style="color: #C9D1D9">((</span><span style="color: #FFA657">r</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">          r.</span><span style="color: #D2A8FF">json</span><span style="color: #C9D1D9">()</span></span>\n<span class="line"><span style="color: #C9D1D9">        )</span></span>\n<span class="line"><span style="color: #C9D1D9">        key </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> result.key</span></span>\n<span class="line"><span style="color: #C9D1D9">        api_key_id </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> result.api_key_id</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #8B949E">// Standard logic utilizing fetched key</span></span>\n<span class="line"><span style="color: #C9D1D9">        navigator.mediaDevices.</span><span style="color: #D2A8FF">getUserMedia</span><span style="color: #C9D1D9">({ audio: </span><span style="color: #79C0FF">true</span><span style="color: #C9D1D9"> }).</span><span style="color: #D2A8FF">then</span><span style="color: #C9D1D9">((</span><span style="color: #FFA657">stream</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">          mediaRecorder </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">MediaRecorder</span><span style="color: #C9D1D9">(stream)</span></span>\n<span class="line"><span style="color: #C9D1D9">          socket </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">WebSocket</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;wss://api.deepgram.com/v1/listen&#39;</span><span style="color: #C9D1D9">, [ </span><span style="color: #A5D6FF">&#39;token&#39;</span><span style="color: #C9D1D9">, key ])</span></span>\n<span class="line"><span style="color: #C9D1D9">          socket.</span><span style="color: #D2A8FF">onopen</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">            mediaRecorder.</span><span style="color: #D2A8FF">addEventListener</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;dataavailable&#39;</span><span style="color: #C9D1D9">, </span><span style="color: #FF7B72">async</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">event</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">              socket.</span><span style="color: #D2A8FF">send</span><span style="color: #C9D1D9">(event.data)</span></span>\n<span class="line"><span style="color: #C9D1D9">            )</span></span>\n<span class="line"><span style="color: #C9D1D9">            mediaRecorder.</span><span style="color: #D2A8FF">start</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">250</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #C9D1D9">          }</span></span>\n<span class="line"><span style="color: #C9D1D9">          socket.</span><span style="color: #D2A8FF">onmessage</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">message</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">JSON</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">parse</span><span style="color: #C9D1D9">(message))</span></span>\n<span class="line"><span style="color: #C9D1D9">        })</span></span>\n<span class="line"><span style="color: #C9D1D9">      })</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">      document.</span><span style="color: #D2A8FF">querySelector</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;#end&#39;</span><span style="color: #C9D1D9">).</span><span style="color: #D2A8FF">addEventListener</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;click&#39;</span><span style="color: #C9D1D9">, </span><span style="color: #FF7B72">async</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #8B949E">// Delete key</span></span>\n<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">result</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">await</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">fetch</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;/key/&#39;</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> api_key_id, {</span></span>\n<span class="line"><span style="color: #C9D1D9">          method: </span><span style="color: #A5D6FF">&#39;DELETE&#39;</span><span style="color: #C9D1D9">,</span></span>\n<span class="line"><span style="color: #C9D1D9">        }).</span><span style="color: #D2A8FF">then</span><span style="color: #C9D1D9">((</span><span style="color: #FFA657">r</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> r.</span><span style="color: #D2A8FF">json</span><span style="color: #C9D1D9">())</span></span>\n<span class="line"><span style="color: #C9D1D9">        console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(result)</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #8B949E">// Client logic for closing connection</span></span>\n<span class="line"><span style="color: #C9D1D9">        socket.</span><span style="color: #D2A8FF">close</span><span style="color: #C9D1D9">()</span></span>\n<span class="line"><span style="color: #C9D1D9">        mediaRecorder.</span><span style="color: #D2A8FF">stop</span><span style="color: #C9D1D9">()</span></span>\n<span class="line"><span style="color: #C9D1D9">      })</span></span>\n<span class="line"><span style="color: #C9D1D9">    &lt;/</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;/</span><span style="color: #7EE787">body</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">&lt;/</span><span style="color: #7EE787">html</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #8B949E">// index.js</span></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">express</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">require</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;express&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> { </span><span style="color: #79C0FF">Deepgram</span><span style="color: #C9D1D9"> } </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">require</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;@deepgram/sdk&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">app</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">express</span><span style="color: #C9D1D9">()</span></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">deepgram</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">Deepgram</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;YOUR_DEEPGRAM_API_KEY&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">use</span><span style="color: #C9D1D9">(express.</span><span style="color: #D2A8FF">static</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;public&#39;</span><span style="color: #C9D1D9">))</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">post</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;/key&#39;</span><span style="color: #C9D1D9">, (</span><span style="color: #FFA657">req</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">res</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> { </span><span style="color: #79C0FF">key</span><span style="color: #C9D1D9">, </span><span style="color: #79C0FF">api_key_id</span><span style="color: #C9D1D9"> } </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">await</span><span style="color: #C9D1D9"> deepgram.keys.</span><span style="color: #D2A8FF">create</span><span style="color: #C9D1D9">(</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #A5D6FF">&#39;PROJECT_ID&#39;</span><span style="color: #C9D1D9">,</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #A5D6FF">&#39;Temporary user key&#39;</span><span style="color: #C9D1D9">,</span></span>\n<span class="line"><span style="color: #C9D1D9">    [</span><span style="color: #A5D6FF">&#39;usage:write&#39;</span><span style="color: #C9D1D9">]</span></span>\n<span class="line"><span style="color: #C9D1D9">  )</span></span>\n<span class="line"><span style="color: #C9D1D9">  res.</span><span style="color: #D2A8FF">json</span><span style="color: #C9D1D9">({ key, api_key_id })</span></span>\n<span class="line"><span style="color: #C9D1D9">})</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">delete</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;/key/:keyId&#39;</span><span style="color: #C9D1D9">, (</span><span style="color: #FFA657">req</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">res</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">result</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">await</span><span style="color: #C9D1D9"> deepgram.keys.</span><span style="color: #D2A8FF">delete</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;PROJECT_ID&#39;</span><span style="color: #C9D1D9">, req.params.keyId)</span></span>\n<span class="line"><span style="color: #C9D1D9">  res.</span><span style="color: #D2A8FF">json</span><span style="color: #C9D1D9">(result)</span></span>\n<span class="line"><span style="color: #C9D1D9">})</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">listen</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">3000</span><span style="color: #C9D1D9">)</span></span></code></pre>\n<p>In this example, clicking the <strong>start</strong> button sends a request to our server, creating a brand-new Deepgram key with the only scope required to use transcription - <code is:raw>usage:write</code>. It then sends the API Key and key ID to the browser - we require the key ID to refer to this key when deleting it.</p>\n<p>When the user clicks the <strong>end</strong> button, a request is sent to our server, which, in turn, deletes the key so it is no longer usable.</p>\n<h2 id="approach-2-automatically-expiring-keys">Approach 2: Automatically-Expiring Keys</h2>\n<p>We recently released some additional properties you can provide when creating project keys via the API, which set an expiry time. After the provided time, the key is invalidated automatically. You may either provide <code is:raw>expiration_date</code> or <code is:raw>time_to_live_in_seconds</code>, so pick whatever is best for your use case.</p>\n<p>Keys are validated by Deepgram when a new live transcription session is started, so you can set a short <code is:raw>time_to_live_in_seconds</code> as it is only needed when initially connecting.</p>\n<p>You can also do this with the Node.js SDK with an object containing either <code is:raw>expirationDate</code> or <code is:raw>timeToLive</code>:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">get</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;/deepgram-token&#39;</span><span style="color: #C9D1D9">, </span><span style="color: #FF7B72">async</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">req</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">res</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">newKey</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">await</span><span style="color: #C9D1D9"> deepgram.keys.</span><span style="color: #D2A8FF">create</span><span style="color: #C9D1D9">(</span></span>\n<span class="line"><span style="color: #C9D1D9">    process.env.</span><span style="color: #79C0FF">DG_PROJECT_ID</span><span style="color: #C9D1D9">,</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #A5D6FF">&#39;Temporary key - works for 10 secs&#39;</span><span style="color: #C9D1D9">,</span></span>\n<span class="line"><span style="color: #C9D1D9">    [</span><span style="color: #A5D6FF">&#39;usage:write&#39;</span><span style="color: #C9D1D9">],</span></span>\n<span class="line"><span style="color: #C9D1D9">    { timeToLive: </span><span style="color: #79C0FF">10</span><span style="color: #C9D1D9"> }</span></span>\n<span class="line"><span style="color: #C9D1D9">  )</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">  res.</span><span style="color: #D2A8FF">send</span><span style="color: #C9D1D9">(newKey)</span></span>\n<span class="line"><span style="color: #C9D1D9">})</span></span></code></pre>\n<h2 id="approach-3-create-a-server-proxy-to-deepgram">Approach 3: Create a Server Proxy to Deepgram</h2>\n<p>The first two approaches in this guide are a good stop-gap, but you should avoid sending keys to the client wherever possible. The most common and recommended approach is to set up a signaling server that will proxy requests to and from your browser and Deepgram. This approach means that your server communicates with Deepgram, avoiding the need for a Deepgram API Key to be present in the browser.</p>\n<p>An illustration for how this might work in code looks like this:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #8B949E">// index.js</span></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">express</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">require</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;express&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">app</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">express</span><span style="color: #C9D1D9">()</span></span>\n<span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">use</span><span style="color: #C9D1D9">(express.</span><span style="color: #D2A8FF">static</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;public&#39;</span><span style="color: #C9D1D9">))</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">WebSocket</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">require</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;ws&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">wss</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> WebSocket.</span><span style="color: #D2A8FF">Server</span><span style="color: #C9D1D9">({ port: </span><span style="color: #79C0FF">3001</span><span style="color: #C9D1D9"> })</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> { </span><span style="color: #79C0FF">Deepgram</span><span style="color: #C9D1D9"> } </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">require</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;@deepgram/sdk&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">deepgram</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">Deepgram</span><span style="color: #C9D1D9">(process.env.</span><span style="color: #79C0FF">DG_KEY</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">deepgramLive</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> deepgram.transcription.</span><span style="color: #D2A8FF">live</span><span style="color: #C9D1D9">({ utterances: </span><span style="color: #79C0FF">true</span><span style="color: #C9D1D9"> })</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">deepgramLive.</span><span style="color: #D2A8FF">onopen</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;dg onopen&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">wss.</span><span style="color: #D2A8FF">on</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;connection&#39;</span><span style="color: #C9D1D9">, (</span><span style="color: #FFA657">ws</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">  ws.</span><span style="color: #D2A8FF">onmessage</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">event</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> deepgramLive.</span><span style="color: #D2A8FF">send</span><span style="color: #C9D1D9">(event.data)</span></span>\n<span class="line"><span style="color: #C9D1D9">  deepgramLive.</span><span style="color: #D2A8FF">addListener</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;transcriptReceived&#39;</span><span style="color: #C9D1D9">, (</span><span style="color: #FFA657">data</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> ws.</span><span style="color: #D2A8FF">send</span><span style="color: #C9D1D9">(data))</span></span>\n<span class="line"><span style="color: #C9D1D9">})</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">listen</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">3000</span><span style="color: #C9D1D9">)</span></span></code></pre>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #8B949E">&lt;!-- public/index.html --&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">&lt;!</span><span style="color: #7EE787">DOCTYPE</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">html</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">html</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">body</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">button</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">id</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;start&quot;</span><span style="color: #C9D1D9">&gt;Start transcription&lt;/</span><span style="color: #7EE787">button</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">      document.</span><span style="color: #D2A8FF">querySelector</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;#start&#39;</span><span style="color: #C9D1D9">).</span><span style="color: #D2A8FF">addEventListener</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;click&#39;</span><span style="color: #C9D1D9">, </span><span style="color: #FF7B72">async</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">        navigator.mediaDevices.</span><span style="color: #D2A8FF">getUserMedia</span><span style="color: #C9D1D9">({ audio: </span><span style="color: #79C0FF">true</span><span style="color: #C9D1D9"> }).</span><span style="color: #D2A8FF">then</span><span style="color: #C9D1D9">((</span><span style="color: #FFA657">stream</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">          </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">mediaRecorder</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">MediaRecorder</span><span style="color: #C9D1D9">(stream)</span></span>\n<span class="line"><span style="color: #C9D1D9">          </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">socket</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">WebSocket</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">`ws://localhost:3001`</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #C9D1D9">          socket.</span><span style="color: #D2A8FF">onopen</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">            mediaRecorder.</span><span style="color: #D2A8FF">addEventListener</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;dataavailable&#39;</span><span style="color: #C9D1D9">, (</span><span style="color: #FFA657">event</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">              socket.</span><span style="color: #D2A8FF">send</span><span style="color: #C9D1D9">(event.data)</span></span>\n<span class="line"><span style="color: #C9D1D9">            )</span></span>\n<span class="line"><span style="color: #C9D1D9">            mediaRecorder.</span><span style="color: #D2A8FF">start</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">250</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #C9D1D9">          }</span></span>\n<span class="line"><span style="color: #C9D1D9">          socket.</span><span style="color: #D2A8FF">onmessage</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">message</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">JSON</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">parse</span><span style="color: #C9D1D9">(message.data))</span></span>\n<span class="line"><span style="color: #C9D1D9">        })</span></span>\n<span class="line"><span style="color: #C9D1D9">      })</span></span>\n<span class="line"><span style="color: #C9D1D9">    &lt;/</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;/</span><span style="color: #7EE787">body</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">&lt;/</span><span style="color: #7EE787">html</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>\n<p>This approach is very similar to opening a connection directly to Deepgram. In this example, however, we create a Node.js application that starts an express web application on port 3000 and a WebSocket server on port 3001, then connect to the WebSocket endpoint from our client. The server\u2019s main job is pushing data to and from the browser and Deepgram. These lines handle all of that logic:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">ws.</span><span style="color: #D2A8FF">onmessage</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">event</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> deepgramLive.</span><span style="color: #D2A8FF">send</span><span style="color: #C9D1D9">(event.data)</span></span>\n<span class="line"><span style="color: #C9D1D9">deepgramLive.</span><span style="color: #D2A8FF">addListener</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;transcriptReceived&#39;</span><span style="color: #C9D1D9">, (</span><span style="color: #FFA657">data</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> ws.</span><span style="color: #D2A8FF">send</span><span style="color: #C9D1D9">(data))</span></span></code></pre>\n<h2 id="in-summary">In Summary</h2>\n<p>API Keys created in the console with roles have more permissions than you would want users to have access to. Hopefully, this guide provides some useful strategies which allow you to protect your Deepgram account with minimal additional code in your project.</p>\n<p>If you have any questions, please feel free to reach out on Twitter - we\u2019re <a href="https://twitter.com/DeepgramDevs">@DeepgramDevs</a>.</p>' }, "file": "/Users/sandrarodgers/web-next/blog/src/content/blog/posts/protecting-api-key/index.md" };
function rawContent() {
  return "\r\nWe love how little code is needed to get live transcripts directly from a web browser with Deepgram, but doing so may leave your API Key vulnerable in a user-accessible client. Any user with access to your key can access the Deepgram APIs, which, in turn, may provide full account access.\r\n\r\nThis post will cover three approaches to live transcription from the browser while protecting your account. Before reading this guide, you should understand how to open a WebSocket connection and send data to Deepgram in the browser - if not, we cover it in this [blog post](https://blog.deepgram.com/live-transcription-mic-browser/).\r\n\r\n## Scopes and Roles\r\n\r\nEach project in your Deepgram console can have multiple API Keys. Each key has several 'scopes' that describe the key's permissions. For example, one key may provide access to manage a project's team members, while others may not.\r\n\r\nTo make working with scopes easier, we also provide some 'roles' which provide a defined list of scopes for you. Instead of providing six common scopes, you can use `member`, and it will apply them all for you when creating a key. We'll be creating keys with specific scopes in this guide, and if you want to learn more about roles, we have a [Working with Roles](https://developers.deepgram.com/documentation/getting-started/roles/) guide in our documentation.\r\n\r\n![One project can have multiple keys. The first key in this diagram has permissions to create new keys, alter project settings, and use transcription APIs. The second key only has access to transcription APIs.](https://res.cloudinary.com/deepgram/image/upload/v1639592303/blog/2022/01/protecting-api-key/project-keys-scopes.png)\r\n\r\n## Approach 1: Create and Delete Keys On-Demand\r\n\r\nDeepgram provides a set of API endpoints to manage project keys. In this approach, we will create a key when required and then delete it when finished.\r\n\r\nTo create and delete additional keys with the API, the key used for this operation must have the `keys:write` scope. This key will not be sent to the browser - its whole purpose is to manage sharable keys on our behalf. If you created the initial key in our web console, you would have assigned a role that will include the `keys:write` permission.\r\n\r\n![Clicking the start transcription button in the browser sends a request to the server which creates a usage-only key with Deepgram. Clicking the end transcription button deletes it.](https://res.cloudinary.com/deepgram/image/upload/v1639592303/blog/2022/01/protecting-api-key/create-destroy-key.png)\r\n\r\nAn abbreviated version of this with code with the [Deepgram Node.js SDK](https://developers.deepgram.com/sdks-tools/sdks/node-sdk/) may look like this:\r\n\r\n```html\r\n{/*<!-- public/index.html -->*/}\r\n<!DOCTYPE html>\r\n<html>\r\n  <body>\r\n    <button id=\"start\">Start transcription</button>\r\n    <button id=\"end\">End transcription</button>\r\n    <script>\r\n      let key, api_key_id, mediaRecorder, socket\r\n\r\n      document.querySelector('#start').addEventListener('click', async () => {\r\n        // Access key and key id from server\r\n        const result = await fetch('/key', { method: 'POST' }).then((r) =>\r\n          r.json()\r\n        )\r\n        key = result.key\r\n        api_key_id = result.api_key_id\r\n\r\n        // Standard logic utilizing fetched key\r\n        navigator.mediaDevices.getUserMedia({ audio: true }).then((stream) => {\r\n          mediaRecorder = new MediaRecorder(stream)\r\n          socket = new WebSocket('wss://api.deepgram.com/v1/listen', [ 'token', key ])\r\n          socket.onopen = () => {\r\n            mediaRecorder.addEventListener('dataavailable', async (event) =>\r\n              socket.send(event.data)\r\n            )\r\n            mediaRecorder.start(250)\r\n          }\r\n          socket.onmessage = (message) => console.log(JSON.parse(message))\r\n        })\r\n      })\r\n\r\n      document.querySelector('#end').addEventListener('click', async () => {\r\n        // Delete key\r\n        const result = await fetch('/key/' + api_key_id, {\r\n          method: 'DELETE',\r\n        }).then((r) => r.json())\r\n        console.log(result)\r\n\r\n        // Client logic for closing connection\r\n        socket.close()\r\n        mediaRecorder.stop()\r\n      })\r\n    <\/script>\r\n  </body>\r\n</html>\r\n```\r\n\r\n```js\r\n// index.js\r\nconst express = require('express')\r\nconst { Deepgram } = require('@deepgram/sdk')\r\nconst app = express()\r\nconst deepgram = new Deepgram('YOUR_DEEPGRAM_API_KEY')\r\napp.use(express.static('public'))\r\n\r\napp.post('/key', (req, res) => {\r\n  const { key, api_key_id } = await deepgram.keys.create(\r\n    'PROJECT_ID',\r\n    'Temporary user key',\r\n    ['usage:write']\r\n  )\r\n  res.json({ key, api_key_id })\r\n})\r\n\r\napp.delete('/key/:keyId', (req, res) => {\r\n  const result = await deepgram.keys.delete('PROJECT_ID', req.params.keyId)\r\n  res.json(result)\r\n})\r\n\r\napp.listen(3000)\r\n```\r\n\r\nIn this example, clicking the **start** button sends a request to our server, creating a brand-new Deepgram key with the only scope required to use transcription - `usage:write`. It then sends the API Key and key ID to the browser - we require the key ID to refer to this key when deleting it.\r\n\r\nWhen the user clicks the **end** button, a request is sent to our server, which, in turn, deletes the key so it is no longer usable.\r\n\r\n## Approach 2: Automatically-Expiring Keys\r\n\r\nWe recently released some additional properties you can provide when creating project keys via the API, which set an expiry time. After the provided time, the key is invalidated automatically. You may either provide `expiration_date` or `time_to_live_in_seconds`, so pick whatever is best for your use case.\r\n\r\nKeys are validated by Deepgram when a new live transcription session is started, so you can set a short `time_to_live_in_seconds` as it is only needed when initially connecting.\r\n\r\nYou can also do this with the Node.js SDK with an object containing either `expirationDate` or `timeToLive`:\r\n\r\n```js\r\napp.get('/deepgram-token', async (req, res) => {\r\n  const newKey = await deepgram.keys.create(\r\n    process.env.DG_PROJECT_ID,\r\n    'Temporary key - works for 10 secs',\r\n    ['usage:write'],\r\n    { timeToLive: 10 }\r\n  )\r\n\r\n  res.send(newKey)\r\n})\r\n```\r\n\r\n## Approach 3: Create a Server Proxy to Deepgram\r\n\r\nThe first two approaches in this guide are a good stop-gap, but you should avoid sending keys to the client wherever possible. The most common and recommended approach is to set up a signaling server that will proxy requests to and from your browser and Deepgram. This approach means that your server communicates with Deepgram, avoiding the need for a Deepgram API Key to be present in the browser.\r\n\r\nAn illustration for how this might work in code looks like this:\r\n\r\n```js\r\n// index.js\r\nconst express = require('express')\r\nconst app = express()\r\napp.use(express.static('public'))\r\n\r\nconst WebSocket = require('ws')\r\nconst wss = new WebSocket.Server({ port: 3001 })\r\n\r\nconst { Deepgram } = require('@deepgram/sdk')\r\nconst deepgram = new Deepgram(process.env.DG_KEY)\r\nconst deepgramLive = deepgram.transcription.live({ utterances: true })\r\n\r\ndeepgramLive.onopen = () => console.log('dg onopen')\r\n\r\nwss.on('connection', (ws) => {\r\n  ws.onmessage = (event) => deepgramLive.send(event.data)\r\n  deepgramLive.addListener('transcriptReceived', (data) => ws.send(data))\r\n})\r\n\r\napp.listen(3000)\r\n```\r\n\r\n```html\r\n{/*<!-- public/index.html -->*/}\r\n<!DOCTYPE html>\r\n<html>\r\n  <body>\r\n    <button id=\"start\">Start transcription</button>\r\n    <script>\r\n      document.querySelector('#start').addEventListener('click', async () => {\r\n        navigator.mediaDevices.getUserMedia({ audio: true }).then((stream) => {\r\n          const mediaRecorder = new MediaRecorder(stream)\r\n          const socket = new WebSocket(`ws://localhost:3001`)\r\n          socket.onopen = () => {\r\n            mediaRecorder.addEventListener('dataavailable', (event) =>\r\n              socket.send(event.data)\r\n            )\r\n            mediaRecorder.start(250)\r\n          }\r\n          socket.onmessage = (message) => console.log(JSON.parse(message.data))\r\n        })\r\n      })\r\n    <\/script>\r\n  </body>\r\n</html>\r\n```\r\n\r\nThis approach is very similar to opening a connection directly to Deepgram. In this example, however, we create a Node.js application that starts an express web application on port 3000 and a WebSocket server on port 3001, then connect to the WebSocket endpoint from our client. The server's main job is pushing data to and from the browser and Deepgram. These lines handle all of that logic:\r\n\r\n```js\r\nws.onmessage = (event) => deepgramLive.send(event.data)\r\ndeepgramLive.addListener('transcriptReceived', (data) => ws.send(data))\r\n```\r\n\r\n## In Summary\r\n\r\nAPI Keys created in the console with roles have more permissions than you would want users to have access to. Hopefully, this guide provides some useful strategies which allow you to protect your Deepgram account with minimal additional code in your project.\r\n\r\nIf you have any questions, please feel free to reach out on Twitter - we're [@DeepgramDevs](https://twitter.com/DeepgramDevs).\r\n\r\n        ";
}
function compiledContent() {
  return '<p>We love how little code is needed to get live transcripts directly from a web browser with Deepgram, but doing so may leave your API Key vulnerable in a user-accessible client. Any user with access to your key can access the Deepgram APIs, which, in turn, may provide full account access.</p>\n<p>This post will cover three approaches to live transcription from the browser while protecting your account. Before reading this guide, you should understand how to open a WebSocket connection and send data to Deepgram in the browser - if not, we cover it in this <a href="https://blog.deepgram.com/live-transcription-mic-browser/">blog post</a>.</p>\n<h2 id="scopes-and-roles">Scopes and Roles</h2>\n<p>Each project in your Deepgram console can have multiple API Keys. Each key has several \u2018scopes\u2019 that describe the key\u2019s permissions. For example, one key may provide access to manage a project\u2019s team members, while others may not.</p>\n<p>To make working with scopes easier, we also provide some \u2018roles\u2019 which provide a defined list of scopes for you. Instead of providing six common scopes, you can use <code is:raw>member</code>, and it will apply them all for you when creating a key. We\u2019ll be creating keys with specific scopes in this guide, and if you want to learn more about roles, we have a <a href="https://developers.deepgram.com/documentation/getting-started/roles/">Working with Roles</a> guide in our documentation.</p>\n<p><img src="https://res.cloudinary.com/deepgram/image/upload/v1639592303/blog/2022/01/protecting-api-key/project-keys-scopes.png" alt="One project can have multiple keys. The first key in this diagram has permissions to create new keys, alter project settings, and use transcription APIs. The second key only has access to transcription APIs."></p>\n<h2 id="approach-1-create-and-delete-keys-on-demand">Approach 1: Create and Delete Keys On-Demand</h2>\n<p>Deepgram provides a set of API endpoints to manage project keys. In this approach, we will create a key when required and then delete it when finished.</p>\n<p>To create and delete additional keys with the API, the key used for this operation must have the <code is:raw>keys:write</code> scope. This key will not be sent to the browser - its whole purpose is to manage sharable keys on our behalf. If you created the initial key in our web console, you would have assigned a role that will include the <code is:raw>keys:write</code> permission.</p>\n<p><img src="https://res.cloudinary.com/deepgram/image/upload/v1639592303/blog/2022/01/protecting-api-key/create-destroy-key.png" alt="Clicking the start transcription button in the browser sends a request to the server which creates a usage-only key with Deepgram. Clicking the end transcription button deletes it."></p>\n<p>An abbreviated version of this with code with the <a href="https://developers.deepgram.com/sdks-tools/sdks/node-sdk/">Deepgram Node.js SDK</a> may look like this:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #8B949E">&lt;!-- public/index.html --&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">&lt;!</span><span style="color: #7EE787">DOCTYPE</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">html</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">html</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">body</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">button</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">id</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;start&quot;</span><span style="color: #C9D1D9">&gt;Start transcription&lt;/</span><span style="color: #7EE787">button</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">button</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">id</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;end&quot;</span><span style="color: #C9D1D9">&gt;End transcription&lt;/</span><span style="color: #7EE787">button</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">let</span><span style="color: #C9D1D9"> key, api_key_id, mediaRecorder, socket</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">      document.</span><span style="color: #D2A8FF">querySelector</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;#start&#39;</span><span style="color: #C9D1D9">).</span><span style="color: #D2A8FF">addEventListener</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;click&#39;</span><span style="color: #C9D1D9">, </span><span style="color: #FF7B72">async</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #8B949E">// Access key and key id from server</span></span>\n<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">result</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">await</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">fetch</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;/key&#39;</span><span style="color: #C9D1D9">, { method: </span><span style="color: #A5D6FF">&#39;POST&#39;</span><span style="color: #C9D1D9"> }).</span><span style="color: #D2A8FF">then</span><span style="color: #C9D1D9">((</span><span style="color: #FFA657">r</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">          r.</span><span style="color: #D2A8FF">json</span><span style="color: #C9D1D9">()</span></span>\n<span class="line"><span style="color: #C9D1D9">        )</span></span>\n<span class="line"><span style="color: #C9D1D9">        key </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> result.key</span></span>\n<span class="line"><span style="color: #C9D1D9">        api_key_id </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> result.api_key_id</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #8B949E">// Standard logic utilizing fetched key</span></span>\n<span class="line"><span style="color: #C9D1D9">        navigator.mediaDevices.</span><span style="color: #D2A8FF">getUserMedia</span><span style="color: #C9D1D9">({ audio: </span><span style="color: #79C0FF">true</span><span style="color: #C9D1D9"> }).</span><span style="color: #D2A8FF">then</span><span style="color: #C9D1D9">((</span><span style="color: #FFA657">stream</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">          mediaRecorder </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">MediaRecorder</span><span style="color: #C9D1D9">(stream)</span></span>\n<span class="line"><span style="color: #C9D1D9">          socket </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">WebSocket</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;wss://api.deepgram.com/v1/listen&#39;</span><span style="color: #C9D1D9">, [ </span><span style="color: #A5D6FF">&#39;token&#39;</span><span style="color: #C9D1D9">, key ])</span></span>\n<span class="line"><span style="color: #C9D1D9">          socket.</span><span style="color: #D2A8FF">onopen</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">            mediaRecorder.</span><span style="color: #D2A8FF">addEventListener</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;dataavailable&#39;</span><span style="color: #C9D1D9">, </span><span style="color: #FF7B72">async</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">event</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">              socket.</span><span style="color: #D2A8FF">send</span><span style="color: #C9D1D9">(event.data)</span></span>\n<span class="line"><span style="color: #C9D1D9">            )</span></span>\n<span class="line"><span style="color: #C9D1D9">            mediaRecorder.</span><span style="color: #D2A8FF">start</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">250</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #C9D1D9">          }</span></span>\n<span class="line"><span style="color: #C9D1D9">          socket.</span><span style="color: #D2A8FF">onmessage</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">message</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">JSON</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">parse</span><span style="color: #C9D1D9">(message))</span></span>\n<span class="line"><span style="color: #C9D1D9">        })</span></span>\n<span class="line"><span style="color: #C9D1D9">      })</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">      document.</span><span style="color: #D2A8FF">querySelector</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;#end&#39;</span><span style="color: #C9D1D9">).</span><span style="color: #D2A8FF">addEventListener</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;click&#39;</span><span style="color: #C9D1D9">, </span><span style="color: #FF7B72">async</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #8B949E">// Delete key</span></span>\n<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">result</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">await</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">fetch</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;/key/&#39;</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> api_key_id, {</span></span>\n<span class="line"><span style="color: #C9D1D9">          method: </span><span style="color: #A5D6FF">&#39;DELETE&#39;</span><span style="color: #C9D1D9">,</span></span>\n<span class="line"><span style="color: #C9D1D9">        }).</span><span style="color: #D2A8FF">then</span><span style="color: #C9D1D9">((</span><span style="color: #FFA657">r</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> r.</span><span style="color: #D2A8FF">json</span><span style="color: #C9D1D9">())</span></span>\n<span class="line"><span style="color: #C9D1D9">        console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(result)</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #8B949E">// Client logic for closing connection</span></span>\n<span class="line"><span style="color: #C9D1D9">        socket.</span><span style="color: #D2A8FF">close</span><span style="color: #C9D1D9">()</span></span>\n<span class="line"><span style="color: #C9D1D9">        mediaRecorder.</span><span style="color: #D2A8FF">stop</span><span style="color: #C9D1D9">()</span></span>\n<span class="line"><span style="color: #C9D1D9">      })</span></span>\n<span class="line"><span style="color: #C9D1D9">    &lt;/</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;/</span><span style="color: #7EE787">body</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">&lt;/</span><span style="color: #7EE787">html</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #8B949E">// index.js</span></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">express</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">require</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;express&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> { </span><span style="color: #79C0FF">Deepgram</span><span style="color: #C9D1D9"> } </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">require</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;@deepgram/sdk&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">app</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">express</span><span style="color: #C9D1D9">()</span></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">deepgram</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">Deepgram</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;YOUR_DEEPGRAM_API_KEY&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">use</span><span style="color: #C9D1D9">(express.</span><span style="color: #D2A8FF">static</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;public&#39;</span><span style="color: #C9D1D9">))</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">post</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;/key&#39;</span><span style="color: #C9D1D9">, (</span><span style="color: #FFA657">req</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">res</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> { </span><span style="color: #79C0FF">key</span><span style="color: #C9D1D9">, </span><span style="color: #79C0FF">api_key_id</span><span style="color: #C9D1D9"> } </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">await</span><span style="color: #C9D1D9"> deepgram.keys.</span><span style="color: #D2A8FF">create</span><span style="color: #C9D1D9">(</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #A5D6FF">&#39;PROJECT_ID&#39;</span><span style="color: #C9D1D9">,</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #A5D6FF">&#39;Temporary user key&#39;</span><span style="color: #C9D1D9">,</span></span>\n<span class="line"><span style="color: #C9D1D9">    [</span><span style="color: #A5D6FF">&#39;usage:write&#39;</span><span style="color: #C9D1D9">]</span></span>\n<span class="line"><span style="color: #C9D1D9">  )</span></span>\n<span class="line"><span style="color: #C9D1D9">  res.</span><span style="color: #D2A8FF">json</span><span style="color: #C9D1D9">({ key, api_key_id })</span></span>\n<span class="line"><span style="color: #C9D1D9">})</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">delete</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;/key/:keyId&#39;</span><span style="color: #C9D1D9">, (</span><span style="color: #FFA657">req</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">res</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">result</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">await</span><span style="color: #C9D1D9"> deepgram.keys.</span><span style="color: #D2A8FF">delete</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;PROJECT_ID&#39;</span><span style="color: #C9D1D9">, req.params.keyId)</span></span>\n<span class="line"><span style="color: #C9D1D9">  res.</span><span style="color: #D2A8FF">json</span><span style="color: #C9D1D9">(result)</span></span>\n<span class="line"><span style="color: #C9D1D9">})</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">listen</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">3000</span><span style="color: #C9D1D9">)</span></span></code></pre>\n<p>In this example, clicking the <strong>start</strong> button sends a request to our server, creating a brand-new Deepgram key with the only scope required to use transcription - <code is:raw>usage:write</code>. It then sends the API Key and key ID to the browser - we require the key ID to refer to this key when deleting it.</p>\n<p>When the user clicks the <strong>end</strong> button, a request is sent to our server, which, in turn, deletes the key so it is no longer usable.</p>\n<h2 id="approach-2-automatically-expiring-keys">Approach 2: Automatically-Expiring Keys</h2>\n<p>We recently released some additional properties you can provide when creating project keys via the API, which set an expiry time. After the provided time, the key is invalidated automatically. You may either provide <code is:raw>expiration_date</code> or <code is:raw>time_to_live_in_seconds</code>, so pick whatever is best for your use case.</p>\n<p>Keys are validated by Deepgram when a new live transcription session is started, so you can set a short <code is:raw>time_to_live_in_seconds</code> as it is only needed when initially connecting.</p>\n<p>You can also do this with the Node.js SDK with an object containing either <code is:raw>expirationDate</code> or <code is:raw>timeToLive</code>:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">get</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;/deepgram-token&#39;</span><span style="color: #C9D1D9">, </span><span style="color: #FF7B72">async</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">req</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">res</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">newKey</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">await</span><span style="color: #C9D1D9"> deepgram.keys.</span><span style="color: #D2A8FF">create</span><span style="color: #C9D1D9">(</span></span>\n<span class="line"><span style="color: #C9D1D9">    process.env.</span><span style="color: #79C0FF">DG_PROJECT_ID</span><span style="color: #C9D1D9">,</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #A5D6FF">&#39;Temporary key - works for 10 secs&#39;</span><span style="color: #C9D1D9">,</span></span>\n<span class="line"><span style="color: #C9D1D9">    [</span><span style="color: #A5D6FF">&#39;usage:write&#39;</span><span style="color: #C9D1D9">],</span></span>\n<span class="line"><span style="color: #C9D1D9">    { timeToLive: </span><span style="color: #79C0FF">10</span><span style="color: #C9D1D9"> }</span></span>\n<span class="line"><span style="color: #C9D1D9">  )</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">  res.</span><span style="color: #D2A8FF">send</span><span style="color: #C9D1D9">(newKey)</span></span>\n<span class="line"><span style="color: #C9D1D9">})</span></span></code></pre>\n<h2 id="approach-3-create-a-server-proxy-to-deepgram">Approach 3: Create a Server Proxy to Deepgram</h2>\n<p>The first two approaches in this guide are a good stop-gap, but you should avoid sending keys to the client wherever possible. The most common and recommended approach is to set up a signaling server that will proxy requests to and from your browser and Deepgram. This approach means that your server communicates with Deepgram, avoiding the need for a Deepgram API Key to be present in the browser.</p>\n<p>An illustration for how this might work in code looks like this:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #8B949E">// index.js</span></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">express</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">require</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;express&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">app</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">express</span><span style="color: #C9D1D9">()</span></span>\n<span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">use</span><span style="color: #C9D1D9">(express.</span><span style="color: #D2A8FF">static</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;public&#39;</span><span style="color: #C9D1D9">))</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">WebSocket</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">require</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;ws&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">wss</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> WebSocket.</span><span style="color: #D2A8FF">Server</span><span style="color: #C9D1D9">({ port: </span><span style="color: #79C0FF">3001</span><span style="color: #C9D1D9"> })</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> { </span><span style="color: #79C0FF">Deepgram</span><span style="color: #C9D1D9"> } </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">require</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;@deepgram/sdk&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">deepgram</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">Deepgram</span><span style="color: #C9D1D9">(process.env.</span><span style="color: #79C0FF">DG_KEY</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">deepgramLive</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> deepgram.transcription.</span><span style="color: #D2A8FF">live</span><span style="color: #C9D1D9">({ utterances: </span><span style="color: #79C0FF">true</span><span style="color: #C9D1D9"> })</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">deepgramLive.</span><span style="color: #D2A8FF">onopen</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;dg onopen&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">wss.</span><span style="color: #D2A8FF">on</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;connection&#39;</span><span style="color: #C9D1D9">, (</span><span style="color: #FFA657">ws</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">  ws.</span><span style="color: #D2A8FF">onmessage</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">event</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> deepgramLive.</span><span style="color: #D2A8FF">send</span><span style="color: #C9D1D9">(event.data)</span></span>\n<span class="line"><span style="color: #C9D1D9">  deepgramLive.</span><span style="color: #D2A8FF">addListener</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;transcriptReceived&#39;</span><span style="color: #C9D1D9">, (</span><span style="color: #FFA657">data</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> ws.</span><span style="color: #D2A8FF">send</span><span style="color: #C9D1D9">(data))</span></span>\n<span class="line"><span style="color: #C9D1D9">})</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">listen</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">3000</span><span style="color: #C9D1D9">)</span></span></code></pre>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #8B949E">&lt;!-- public/index.html --&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">&lt;!</span><span style="color: #7EE787">DOCTYPE</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">html</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">html</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">body</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">button</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">id</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;start&quot;</span><span style="color: #C9D1D9">&gt;Start transcription&lt;/</span><span style="color: #7EE787">button</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">      document.</span><span style="color: #D2A8FF">querySelector</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;#start&#39;</span><span style="color: #C9D1D9">).</span><span style="color: #D2A8FF">addEventListener</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;click&#39;</span><span style="color: #C9D1D9">, </span><span style="color: #FF7B72">async</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">        navigator.mediaDevices.</span><span style="color: #D2A8FF">getUserMedia</span><span style="color: #C9D1D9">({ audio: </span><span style="color: #79C0FF">true</span><span style="color: #C9D1D9"> }).</span><span style="color: #D2A8FF">then</span><span style="color: #C9D1D9">((</span><span style="color: #FFA657">stream</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">          </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">mediaRecorder</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">MediaRecorder</span><span style="color: #C9D1D9">(stream)</span></span>\n<span class="line"><span style="color: #C9D1D9">          </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">socket</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">WebSocket</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">`ws://localhost:3001`</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #C9D1D9">          socket.</span><span style="color: #D2A8FF">onopen</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">            mediaRecorder.</span><span style="color: #D2A8FF">addEventListener</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;dataavailable&#39;</span><span style="color: #C9D1D9">, (</span><span style="color: #FFA657">event</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">              socket.</span><span style="color: #D2A8FF">send</span><span style="color: #C9D1D9">(event.data)</span></span>\n<span class="line"><span style="color: #C9D1D9">            )</span></span>\n<span class="line"><span style="color: #C9D1D9">            mediaRecorder.</span><span style="color: #D2A8FF">start</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">250</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #C9D1D9">          }</span></span>\n<span class="line"><span style="color: #C9D1D9">          socket.</span><span style="color: #D2A8FF">onmessage</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">message</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">JSON</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">parse</span><span style="color: #C9D1D9">(message.data))</span></span>\n<span class="line"><span style="color: #C9D1D9">        })</span></span>\n<span class="line"><span style="color: #C9D1D9">      })</span></span>\n<span class="line"><span style="color: #C9D1D9">    &lt;/</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;/</span><span style="color: #7EE787">body</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">&lt;/</span><span style="color: #7EE787">html</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>\n<p>This approach is very similar to opening a connection directly to Deepgram. In this example, however, we create a Node.js application that starts an express web application on port 3000 and a WebSocket server on port 3001, then connect to the WebSocket endpoint from our client. The server\u2019s main job is pushing data to and from the browser and Deepgram. These lines handle all of that logic:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">ws.</span><span style="color: #D2A8FF">onmessage</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">event</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> deepgramLive.</span><span style="color: #D2A8FF">send</span><span style="color: #C9D1D9">(event.data)</span></span>\n<span class="line"><span style="color: #C9D1D9">deepgramLive.</span><span style="color: #D2A8FF">addListener</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;transcriptReceived&#39;</span><span style="color: #C9D1D9">, (</span><span style="color: #FFA657">data</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> ws.</span><span style="color: #D2A8FF">send</span><span style="color: #C9D1D9">(data))</span></span></code></pre>\n<h2 id="in-summary">In Summary</h2>\n<p>API Keys created in the console with roles have more permissions than you would want users to have access to. Hopefully, this guide provides some useful strategies which allow you to protect your Deepgram account with minimal additional code in your project.</p>\n<p>If you have any questions, please feel free to reach out on Twitter - we\u2019re <a href="https://twitter.com/DeepgramDevs">@DeepgramDevs</a>.</p>';
}
const $$Astro = createAstro("/Users/sandrarodgers/web-next/blog/src/content/blog/posts/protecting-api-key/index.md", "", "file:///Users/sandrarodgers/web-next/blog/");
const $$Index = createComponent(async ($$result, $$props, $$slots) => {
  const Astro2 = $$result.createAstro($$Astro, $$props, $$slots);
  Astro2.self = $$Index;
  new Slugger();
  return renderTemplate`<head>${renderHead($$result)}</head><p>We love how little code is needed to get live transcripts directly from a web browser with Deepgram, but doing so may leave your API Key vulnerable in a user-accessible client. Any user with access to your key can access the Deepgram APIs, which, in turn, may provide full account access.</p>
<p>This post will cover three approaches to live transcription from the browser while protecting your account. Before reading this guide, you should understand how to open a WebSocket connection and send data to Deepgram in the browser - if not, we cover it in this <a href="https://blog.deepgram.com/live-transcription-mic-browser/">blog post</a>.</p>
<h2 id="scopes-and-roles">Scopes and Roles</h2>
<p>Each project in your Deepgram console can have multiple API Keys. Each key has several ‘scopes’ that describe the key’s permissions. For example, one key may provide access to manage a project’s team members, while others may not.</p>
<p>To make working with scopes easier, we also provide some ‘roles’ which provide a defined list of scopes for you. Instead of providing six common scopes, you can use <code>member</code>, and it will apply them all for you when creating a key. We’ll be creating keys with specific scopes in this guide, and if you want to learn more about roles, we have a <a href="https://developers.deepgram.com/documentation/getting-started/roles/">Working with Roles</a> guide in our documentation.</p>
<p><img src="https://res.cloudinary.com/deepgram/image/upload/v1639592303/blog/2022/01/protecting-api-key/project-keys-scopes.png" alt="One project can have multiple keys. The first key in this diagram has permissions to create new keys, alter project settings, and use transcription APIs. The second key only has access to transcription APIs."></p>
<h2 id="approach-1-create-and-delete-keys-on-demand">Approach 1: Create and Delete Keys On-Demand</h2>
<p>Deepgram provides a set of API endpoints to manage project keys. In this approach, we will create a key when required and then delete it when finished.</p>
<p>To create and delete additional keys with the API, the key used for this operation must have the <code>keys:write</code> scope. This key will not be sent to the browser - its whole purpose is to manage sharable keys on our behalf. If you created the initial key in our web console, you would have assigned a role that will include the <code>keys:write</code> permission.</p>
<p><img src="https://res.cloudinary.com/deepgram/image/upload/v1639592303/blog/2022/01/protecting-api-key/create-destroy-key.png" alt="Clicking the start transcription button in the browser sends a request to the server which creates a usage-only key with Deepgram. Clicking the end transcription button deletes it."></p>
<p>An abbreviated version of this with code with the <a href="https://developers.deepgram.com/sdks-tools/sdks/node-sdk/">Deepgram Node.js SDK</a> may look like this:</p>
<pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #8B949E">&lt;!-- public/index.html --&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">&lt;!</span><span style="color: #7EE787">DOCTYPE</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">html</span><span style="color: #C9D1D9">&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">html</span><span style="color: #C9D1D9">&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">body</span><span style="color: #C9D1D9">&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">button</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">id</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;start&quot;</span><span style="color: #C9D1D9">&gt;Start transcription&lt;/</span><span style="color: #7EE787">button</span><span style="color: #C9D1D9">&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">button</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">id</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;end&quot;</span><span style="color: #C9D1D9">&gt;End transcription&lt;/</span><span style="color: #7EE787">button</span><span style="color: #C9D1D9">&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">let</span><span style="color: #C9D1D9"> key, api_key_id, mediaRecorder, socket</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">      document.</span><span style="color: #D2A8FF">querySelector</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;#start&#39;</span><span style="color: #C9D1D9">).</span><span style="color: #D2A8FF">addEventListener</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;click&#39;</span><span style="color: #C9D1D9">, </span><span style="color: #FF7B72">async</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #8B949E">// Access key and key id from server</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">result</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">await</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">fetch</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;/key&#39;</span><span style="color: #C9D1D9">, { method: </span><span style="color: #A5D6FF">&#39;POST&#39;</span><span style="color: #C9D1D9"> }).</span><span style="color: #D2A8FF">then</span><span style="color: #C9D1D9">((</span><span style="color: #FFA657">r</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">          r.</span><span style="color: #D2A8FF">json</span><span style="color: #C9D1D9">()</span></span>
<span class="line"><span style="color: #C9D1D9">        )</span></span>
<span class="line"><span style="color: #C9D1D9">        key </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> result.key</span></span>
<span class="line"><span style="color: #C9D1D9">        api_key_id </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> result.api_key_id</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #8B949E">// Standard logic utilizing fetched key</span></span>
<span class="line"><span style="color: #C9D1D9">        navigator.mediaDevices.</span><span style="color: #D2A8FF">getUserMedia</span><span style="color: #C9D1D9">({ audio: </span><span style="color: #79C0FF">true</span><span style="color: #C9D1D9"> }).</span><span style="color: #D2A8FF">then</span><span style="color: #C9D1D9">((</span><span style="color: #FFA657">stream</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">          mediaRecorder </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">MediaRecorder</span><span style="color: #C9D1D9">(stream)</span></span>
<span class="line"><span style="color: #C9D1D9">          socket </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">WebSocket</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;wss://api.deepgram.com/v1/listen&#39;</span><span style="color: #C9D1D9">, [ </span><span style="color: #A5D6FF">&#39;token&#39;</span><span style="color: #C9D1D9">, key ])</span></span>
<span class="line"><span style="color: #C9D1D9">          socket.</span><span style="color: #D2A8FF">onopen</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">            mediaRecorder.</span><span style="color: #D2A8FF">addEventListener</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;dataavailable&#39;</span><span style="color: #C9D1D9">, </span><span style="color: #FF7B72">async</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">event</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">              socket.</span><span style="color: #D2A8FF">send</span><span style="color: #C9D1D9">(event.data)</span></span>
<span class="line"><span style="color: #C9D1D9">            )</span></span>
<span class="line"><span style="color: #C9D1D9">            mediaRecorder.</span><span style="color: #D2A8FF">start</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">250</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #C9D1D9">          }</span></span>
<span class="line"><span style="color: #C9D1D9">          socket.</span><span style="color: #D2A8FF">onmessage</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">message</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">JSON</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">parse</span><span style="color: #C9D1D9">(message))</span></span>
<span class="line"><span style="color: #C9D1D9">        })</span></span>
<span class="line"><span style="color: #C9D1D9">      })</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">      document.</span><span style="color: #D2A8FF">querySelector</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;#end&#39;</span><span style="color: #C9D1D9">).</span><span style="color: #D2A8FF">addEventListener</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;click&#39;</span><span style="color: #C9D1D9">, </span><span style="color: #FF7B72">async</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #8B949E">// Delete key</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">result</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">await</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">fetch</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;/key/&#39;</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> api_key_id, {</span></span>
<span class="line"><span style="color: #C9D1D9">          method: </span><span style="color: #A5D6FF">&#39;DELETE&#39;</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">        }).</span><span style="color: #D2A8FF">then</span><span style="color: #C9D1D9">((</span><span style="color: #FFA657">r</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> r.</span><span style="color: #D2A8FF">json</span><span style="color: #C9D1D9">())</span></span>
<span class="line"><span style="color: #C9D1D9">        console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(result)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #8B949E">// Client logic for closing connection</span></span>
<span class="line"><span style="color: #C9D1D9">        socket.</span><span style="color: #D2A8FF">close</span><span style="color: #C9D1D9">()</span></span>
<span class="line"><span style="color: #C9D1D9">        mediaRecorder.</span><span style="color: #D2A8FF">stop</span><span style="color: #C9D1D9">()</span></span>
<span class="line"><span style="color: #C9D1D9">      })</span></span>
<span class="line"><span style="color: #C9D1D9">    &lt;/</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">  &lt;/</span><span style="color: #7EE787">body</span><span style="color: #C9D1D9">&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">&lt;/</span><span style="color: #7EE787">html</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>
<pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #8B949E">// index.js</span></span>
<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">express</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">require</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;express&#39;</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> { </span><span style="color: #79C0FF">Deepgram</span><span style="color: #C9D1D9"> } </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">require</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;@deepgram/sdk&#39;</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">app</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">express</span><span style="color: #C9D1D9">()</span></span>
<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">deepgram</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">Deepgram</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;YOUR_DEEPGRAM_API_KEY&#39;</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">use</span><span style="color: #C9D1D9">(express.</span><span style="color: #D2A8FF">static</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;public&#39;</span><span style="color: #C9D1D9">))</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">post</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;/key&#39;</span><span style="color: #C9D1D9">, (</span><span style="color: #FFA657">req</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">res</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> { </span><span style="color: #79C0FF">key</span><span style="color: #C9D1D9">, </span><span style="color: #79C0FF">api_key_id</span><span style="color: #C9D1D9"> } </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">await</span><span style="color: #C9D1D9"> deepgram.keys.</span><span style="color: #D2A8FF">create</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #A5D6FF">&#39;PROJECT_ID&#39;</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #A5D6FF">&#39;Temporary user key&#39;</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">    [</span><span style="color: #A5D6FF">&#39;usage:write&#39;</span><span style="color: #C9D1D9">]</span></span>
<span class="line"><span style="color: #C9D1D9">  )</span></span>
<span class="line"><span style="color: #C9D1D9">  res.</span><span style="color: #D2A8FF">json</span><span style="color: #C9D1D9">({ key, api_key_id })</span></span>
<span class="line"><span style="color: #C9D1D9">})</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">delete</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;/key/:keyId&#39;</span><span style="color: #C9D1D9">, (</span><span style="color: #FFA657">req</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">res</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">result</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">await</span><span style="color: #C9D1D9"> deepgram.keys.</span><span style="color: #D2A8FF">delete</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;PROJECT_ID&#39;</span><span style="color: #C9D1D9">, req.params.keyId)</span></span>
<span class="line"><span style="color: #C9D1D9">  res.</span><span style="color: #D2A8FF">json</span><span style="color: #C9D1D9">(result)</span></span>
<span class="line"><span style="color: #C9D1D9">})</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">listen</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">3000</span><span style="color: #C9D1D9">)</span></span></code></pre>
<p>In this example, clicking the <strong>start</strong> button sends a request to our server, creating a brand-new Deepgram key with the only scope required to use transcription - <code>usage:write</code>. It then sends the API Key and key ID to the browser - we require the key ID to refer to this key when deleting it.</p>
<p>When the user clicks the <strong>end</strong> button, a request is sent to our server, which, in turn, deletes the key so it is no longer usable.</p>
<h2 id="approach-2-automatically-expiring-keys">Approach 2: Automatically-Expiring Keys</h2>
<p>We recently released some additional properties you can provide when creating project keys via the API, which set an expiry time. After the provided time, the key is invalidated automatically. You may either provide <code>expiration_date</code> or <code>time_to_live_in_seconds</code>, so pick whatever is best for your use case.</p>
<p>Keys are validated by Deepgram when a new live transcription session is started, so you can set a short <code>time_to_live_in_seconds</code> as it is only needed when initially connecting.</p>
<p>You can also do this with the Node.js SDK with an object containing either <code>expirationDate</code> or <code>timeToLive</code>:</p>
<pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">get</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;/deepgram-token&#39;</span><span style="color: #C9D1D9">, </span><span style="color: #FF7B72">async</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">req</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">res</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">newKey</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">await</span><span style="color: #C9D1D9"> deepgram.keys.</span><span style="color: #D2A8FF">create</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">    process.env.</span><span style="color: #79C0FF">DG_PROJECT_ID</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #A5D6FF">&#39;Temporary key - works for 10 secs&#39;</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">    [</span><span style="color: #A5D6FF">&#39;usage:write&#39;</span><span style="color: #C9D1D9">],</span></span>
<span class="line"><span style="color: #C9D1D9">    { timeToLive: </span><span style="color: #79C0FF">10</span><span style="color: #C9D1D9"> }</span></span>
<span class="line"><span style="color: #C9D1D9">  )</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  res.</span><span style="color: #D2A8FF">send</span><span style="color: #C9D1D9">(newKey)</span></span>
<span class="line"><span style="color: #C9D1D9">})</span></span></code></pre>
<h2 id="approach-3-create-a-server-proxy-to-deepgram">Approach 3: Create a Server Proxy to Deepgram</h2>
<p>The first two approaches in this guide are a good stop-gap, but you should avoid sending keys to the client wherever possible. The most common and recommended approach is to set up a signaling server that will proxy requests to and from your browser and Deepgram. This approach means that your server communicates with Deepgram, avoiding the need for a Deepgram API Key to be present in the browser.</p>
<p>An illustration for how this might work in code looks like this:</p>
<pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #8B949E">// index.js</span></span>
<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">express</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">require</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;express&#39;</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">app</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">express</span><span style="color: #C9D1D9">()</span></span>
<span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">use</span><span style="color: #C9D1D9">(express.</span><span style="color: #D2A8FF">static</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;public&#39;</span><span style="color: #C9D1D9">))</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">WebSocket</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">require</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;ws&#39;</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">wss</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> WebSocket.</span><span style="color: #D2A8FF">Server</span><span style="color: #C9D1D9">({ port: </span><span style="color: #79C0FF">3001</span><span style="color: #C9D1D9"> })</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> { </span><span style="color: #79C0FF">Deepgram</span><span style="color: #C9D1D9"> } </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">require</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;@deepgram/sdk&#39;</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">deepgram</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">Deepgram</span><span style="color: #C9D1D9">(process.env.</span><span style="color: #79C0FF">DG_KEY</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">deepgramLive</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> deepgram.transcription.</span><span style="color: #D2A8FF">live</span><span style="color: #C9D1D9">({ utterances: </span><span style="color: #79C0FF">true</span><span style="color: #C9D1D9"> })</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">deepgramLive.</span><span style="color: #D2A8FF">onopen</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;dg onopen&#39;</span><span style="color: #C9D1D9">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">wss.</span><span style="color: #D2A8FF">on</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;connection&#39;</span><span style="color: #C9D1D9">, (</span><span style="color: #FFA657">ws</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">  ws.</span><span style="color: #D2A8FF">onmessage</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">event</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> deepgramLive.</span><span style="color: #D2A8FF">send</span><span style="color: #C9D1D9">(event.data)</span></span>
<span class="line"><span style="color: #C9D1D9">  deepgramLive.</span><span style="color: #D2A8FF">addListener</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;transcriptReceived&#39;</span><span style="color: #C9D1D9">, (</span><span style="color: #FFA657">data</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> ws.</span><span style="color: #D2A8FF">send</span><span style="color: #C9D1D9">(data))</span></span>
<span class="line"><span style="color: #C9D1D9">})</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">listen</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">3000</span><span style="color: #C9D1D9">)</span></span></code></pre>
<pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #8B949E">&lt;!-- public/index.html --&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">&lt;!</span><span style="color: #7EE787">DOCTYPE</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">html</span><span style="color: #C9D1D9">&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">html</span><span style="color: #C9D1D9">&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">body</span><span style="color: #C9D1D9">&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">button</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">id</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;start&quot;</span><span style="color: #C9D1D9">&gt;Start transcription&lt;/</span><span style="color: #7EE787">button</span><span style="color: #C9D1D9">&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">      document.</span><span style="color: #D2A8FF">querySelector</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;#start&#39;</span><span style="color: #C9D1D9">).</span><span style="color: #D2A8FF">addEventListener</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;click&#39;</span><span style="color: #C9D1D9">, </span><span style="color: #FF7B72">async</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">        navigator.mediaDevices.</span><span style="color: #D2A8FF">getUserMedia</span><span style="color: #C9D1D9">({ audio: </span><span style="color: #79C0FF">true</span><span style="color: #C9D1D9"> }).</span><span style="color: #D2A8FF">then</span><span style="color: #C9D1D9">((</span><span style="color: #FFA657">stream</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">          </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">mediaRecorder</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">MediaRecorder</span><span style="color: #C9D1D9">(stream)</span></span>
<span class="line"><span style="color: #C9D1D9">          </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">socket</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">WebSocket</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">\`ws://localhost:3001\`</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #C9D1D9">          socket.</span><span style="color: #D2A8FF">onopen</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">            mediaRecorder.</span><span style="color: #D2A8FF">addEventListener</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;dataavailable&#39;</span><span style="color: #C9D1D9">, (</span><span style="color: #FFA657">event</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">              socket.</span><span style="color: #D2A8FF">send</span><span style="color: #C9D1D9">(event.data)</span></span>
<span class="line"><span style="color: #C9D1D9">            )</span></span>
<span class="line"><span style="color: #C9D1D9">            mediaRecorder.</span><span style="color: #D2A8FF">start</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">250</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #C9D1D9">          }</span></span>
<span class="line"><span style="color: #C9D1D9">          socket.</span><span style="color: #D2A8FF">onmessage</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">message</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">JSON</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">parse</span><span style="color: #C9D1D9">(message.data))</span></span>
<span class="line"><span style="color: #C9D1D9">        })</span></span>
<span class="line"><span style="color: #C9D1D9">      })</span></span>
<span class="line"><span style="color: #C9D1D9">    &lt;/</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">  &lt;/</span><span style="color: #7EE787">body</span><span style="color: #C9D1D9">&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">&lt;/</span><span style="color: #7EE787">html</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>
<p>This approach is very similar to opening a connection directly to Deepgram. In this example, however, we create a Node.js application that starts an express web application on port 3000 and a WebSocket server on port 3001, then connect to the WebSocket endpoint from our client. The server’s main job is pushing data to and from the browser and Deepgram. These lines handle all of that logic:</p>
<pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">ws.</span><span style="color: #D2A8FF">onmessage</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">event</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> deepgramLive.</span><span style="color: #D2A8FF">send</span><span style="color: #C9D1D9">(event.data)</span></span>
<span class="line"><span style="color: #C9D1D9">deepgramLive.</span><span style="color: #D2A8FF">addListener</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;transcriptReceived&#39;</span><span style="color: #C9D1D9">, (</span><span style="color: #FFA657">data</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> ws.</span><span style="color: #D2A8FF">send</span><span style="color: #C9D1D9">(data))</span></span></code></pre>
<h2 id="in-summary">In Summary</h2>
<p>API Keys created in the console with roles have more permissions than you would want users to have access to. Hopefully, this guide provides some useful strategies which allow you to protect your Deepgram account with minimal additional code in your project.</p>
<p>If you have any questions, please feel free to reach out on Twitter - we’re <a href="https://twitter.com/DeepgramDevs">@DeepgramDevs</a>.</p>`;
}, "/Users/sandrarodgers/web-next/blog/src/content/blog/posts/protecting-api-key/index.md");

export { compiledContent, $$Index as default, frontmatter, metadata, rawContent };
