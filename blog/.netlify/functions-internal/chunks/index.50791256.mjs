import { c as createAstro, a as createComponent, r as renderTemplate, b as renderHead, d as renderComponent } from '../entry.mjs';
import Slugger from 'github-slugger';
import '@astrojs/netlify/netlify-functions.js';
import 'preact';
import 'preact-render-to-string';
import 'vue';
import 'vue/server-renderer';
import 'html-escaper';
import 'node-html-parser';
import 'axios';
/* empty css                           *//* empty css                           *//* empty css                           */import '@storyblok/js';
/* empty css                           *//* empty css                          */import 'clone-deep';
import 'slugify';
import 'shiki';
/* empty css                           */import 'camelcase';
import '@astrojs/rss';
/* empty css                           */import 'mime';
import 'cookie';
import 'kleur/colors';
import 'string-width';
import 'path-browserify';
import 'path-to-regexp';

const metadata = { "headings": [{ "depth": 2, "slug": "project-one-vanilla-video-stream-player", "text": "Project One: Vanilla Video Stream Player" }, { "depth": 2, "slug": "setting-up-open-broadcast-software", "text": "Setting up Open Broadcast Software" }, { "depth": 3, "slug": "what-is-obs", "text": "What is OBS?" }, { "depth": 3, "slug": "set-up-live-streaming-with-obs", "text": "Set up Live Streaming with OBS" }, { "depth": 2, "slug": "setting-up-amazon-ivs", "text": "Setting up Amazon IVS" }, { "depth": 3, "slug": "what-is-amazon-ivs", "text": "What is Amazon IVS?" }, { "depth": 3, "slug": "set-up-amazon-ivs", "text": "Set up Amazon IVS" }, { "depth": 3, "slug": "connect-front-end-video-player-to-amazon-ivs", "text": "Connect Front-end Video Player to Amazon IVS" }, { "depth": 3, "slug": "use-deepgram-to-create-text-captions", "text": "Use Deepgram to Create Text Captions" }, { "depth": 3, "slug": "what-is-the-media-streams-api", "text": "What is the Media Streams API?" }, { "depth": 3, "slug": "get-audio-with-media-streams-api", "text": "Get Audio with Media Streams API" }, { "depth": 2, "slug": "create-text-captions-with-deepgram-api", "text": "Create Text Captions with Deepgram API" }, { "depth": 3, "slug": "what-is-deepgram", "text": "What is Deepgram?" }, { "depth": 3, "slug": "connect-to-deepgram-to-get-transcription", "text": "Connect to Deepgram to Get Transcription" }, { "depth": 2, "slug": "conclusion", "text": "Conclusion" }], "source": '\nIn this series, I will build a live streaming web application with text captions. Companies such as Twitch, StreamYard, Facebook Live, and many others provide live streaming on the web as a product, so I got curious about how I might go about building my own version.\n\n<Panel type="info" title="Build a Live Streaming Web Application with Amazon IVS and Deepgram (SERIES)">\n<ol>\n<li><a href="https://blog.deepgram.com/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/">How to Build a Live Streaming Web Application with Amazon IVS and Deepgram</a></li>\n<li><a href="https://blog.deepgram.com/build-a-livestream-web-application-vue-and-express-setup/"> Build a Live Streaming Web Application: Vue and Express Setup</a></li>\n<li><a href="https://blog.deepgram.com/how-to-write-vue-3-composables-for-a-third-party-API-integration/"> How to Write Vue 3 Composables for a Third-Party API Integration</a></li>\n\n<li><a href="https://blog.deepgram.com/asynchronous-logic-to-write-a-vue-3-and-deepgram-captions-component/"> Asynchronous Logic to Write a Vue 3 and Deepgram Captions Component</a></li>\n</ol>\n</Panel>\n\nThe main technologies I will use to build the live stream and text captions functionality are:\n\n*   **Open Broadcast Software** - an open-source software used to capture video streams\n*   **Amazon IVS** - an AWS service that can receive a video stream from OBS and put that stream into the browser, optimizing the entire process\n*   **Deepgram** - a speech-to-text API that can receive an audio stream and return a text-transcript\n\nI will build two versions of this project. I\'ll use the following to build each project:\n\n1.  **HTML/Javascript** - The first version I build (the **vanilla version**) will be focused on creating a **front-end** with a very limited back-end, emphasizing the most barebones approach to getting the application working.\n\n2.  **Vue.js/Node.js** - For the second version (the **framework version**), I will use Vue.js, a Javascript framework that gives me the tools I need to more easily include important features for security like routing and navigation guards. I will build a **full-stack** video streaming application with a **node.js** server to help me add a layer of security for some of the data I need to protect.\n\nHere is a gif to demonstrate the final project:\n\n<img src="https://res.cloudinary.com/deepgram/image/upload/v1646946089/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/VideoExample.gif" alt="demo of final project" style="width: 75%; margin:auto;">\n\n## Project One: Vanilla Video Stream Player\n\nNow I\'ll start by building the first version of the project. I\'ll build a \'vanilla\' video streaming player in the sense that I will only use HTML and Javascript on the front-end, and the only back-end will be the work I do to get Amazon IVS set up to receive the OBS stream.\n\nI want to keep it as simple as possible, focusing on how to build a **video streaming player in the browser that includes text captions**. This means I will not take into account real-world requirements such as hiding API keys or creating an entry page to restrict access to the video stream. Later, in the Vue.js version I build, I\'ll add those pieces, but to start, I just want to get the video player working - I want it to play my live stream and display text captions for what I\'m saying as I stream to viewers.\n\nHere is a diagram to demonstrate the core technology for the **video streaming part** of the project:\n\n<img src="https://res.cloudinary.com/deepgram/image/upload/v1646946508/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/VideoStream.png" alt="Video stream diagram" style="width: 75%; margin:auto;">\n\nThe diagram presents this flow: the webcam takes in the video stream --> OBS captures that video stream so it can be sent along to Amazon IVS --> Amazon IVS provides a service to take in the stream, optimize it, and send it in a format to the browser so that it can be used in an HTML video player --> the HTML video element plays the optimized video stream.\n\nHere is a diagram to demonstrate the core technology for the **text captions part** of the project:\n\n<img src="https://res.cloudinary.com/deepgram/image/upload/v1646946508/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/AudioTranscription.png" alt="Audio transcription diagram" style="width: 75%; margin:auto;">\n\nThe general flow for the text captions technology will be something like this:\n\nThe browser Media Streams API gets permission to use the browser microphone --> the microphone takes in an audio stream of the audio that plays from the live stream --> The Deepgram API opens a web socket channel in the browser to send the audio stream to Deepgram --> the browser receives the JSON object in return that contains the text-transcript --> Javascript puts the text onto the page as captions as the video is playing.\n\nNow that I have a high-level picture of how this project will be built, I am ready to build the barebones front-end video stream application. (In the next post in this series, I will build the Vue.js/Node.js full-stack application with added functionality.)\n\n## Setting up Open Broadcast Software\n\nThe first thing I need is software to capture my video stream on my computer. I\'ll use the [Open Broadcast Software](https://obsproject.com/).\n\n### What is OBS?\n\nFor anyone serious about streaming, OBS is a powerful tool. It is a free open source software that gives many configuration options for capturing and editing a stream. I can edit every aspect of my stream and create scenes made up of multiple sources such as images, text, etc. I can mix audio, switch between scenes with transitions, adjust the layouts, and so much more.\n\nThe stream I capture in OBS can be connected to a streaming platform such as Twitch, YouTube, or others, and it will deliver my stream to that platform; however, for this project, my goal is to stream to a web application that I make myself.\n\nOBS takes some effort to learn, but I only need to familiarize myself with a few parts of it if I\'m going to set it up to capture a stream and connect to Amazon IVS (Amazon IVS is not a streaming platform - it is more like an SDK that helps make the stream easier to handle when I build my front-end).\n\n### Set up Live Streaming with OBS\n\nTo set up OBS for my project, I will:\n\n1.  Go to [obsproject.com](https://obsproject.com/) and choose the operating system I use. I\'ll download the software.\n\n2.  Run the OBS software. In the **Sources** panel, I\'ll click the **plus** sign to add a new source. I\'ll select **Video Capture Device**, and in the window that pops up, I\'ll select the camera I want to use to capture my stream (my computer camera or webcam).\n\n<img src="https://res.cloudinary.com/deepgram/image/upload/v1646946718/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/VideoCaptureDevice.png" alt="Select Video Capture Device to add source from computer camera" style="width: 80%; margin:auto;">\n\n3.  Make sure the source is selected in the sources panel (I may have other sources that I have set up), then I\'ll click on **Settings** in the far-right **Controls** panel.\n\n4.  Select **Stream** in the left column of the window that opens up. The **Service** will remain **Custom**, but I notice that I could select a streaming platform such as Twitch or YouTube if I weren\'t planning to build my own streaming application.\n\n5.  There is nothing more to do until I create the Amazon IVS channel. But I know that later I will take the **Server** and the **Stream Key** information from Amazon IVS for the specific channel I create in the AWS console.\n\n![Stream settings](https://res.cloudinary.com/deepgram/image/upload/v1646946718/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/StreamSettings.png)\n\n## Setting up Amazon IVS\n\nIn this step, I will create an Amazon IVS channel, which is where my video stream from OBS will feed into once I connect them.\n\n### What is Amazon IVS?\n\nThe \'IVS\' in Amazon IVS stands for Interactive Video Service. The website for [Amazon IVS](https://aws.amazon.com/ivs/) describes it as a "managed live streaming solution" that I can use to send "live streams to Amazon IVS using streaming software" and "make low-latency live video available to any viewer around the world." In addition, I "can easily customize and enhance the audience experience through the Amazon IVS player SDK."\n\nSo what does this mean?\n\nThe fact is, building a video player browser can be very complicated. Amazon IVS takes away much of the challenge, allowing me to focus on the design of my front-end rather than the nitty-gritty of the video player. If I did it all without Amazon IVS, I could use the HTML native [video tag](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/video#usage_notes), but then there would be much to do to optimize the video stream that comes through (there\'s an interesting article about this [here](https://medium.com/canal-tech/how-video-streaming-works-on-the-web-an-introduction-7919739f7e1)). A developer could dedicate their entire career to getting good at building stuff that manages audio and video streams in the browser.\n\nAmazon IVS will optimize the stream to make it work for viewers watching it in my web application anywhere in the world. It also provides an SDK for the video player, which I can bring into the browser by adding a script. That script will take control of the video element in my HTML and add all the magic that Amazon IVS does under the hood. The Amazon IVS video player is built for the purpose of streaming live video, so I don\'t have to build my own complicated video player.\n\nOne important thing to consider is cost. AWS is not free, and while it is very cost-effective for a bigger streaming platform like Twitch (the Twitch streaming technology is powered by Amazon IVS), an individual developer like myself building a small project for fun might not find it to be the best option.\n\nThe good news is a new user of Amazon IVS can enjoy the free tier, which gives the following:\n\n*   Five hours of live video input for a basic channel per month\n*   100 hours of SD live video output per month\n\nThis is enough to build this project and not be charged, as long as I am careful about turning off my stream in OBS when I\'m not using it. (Yes, I did forget to do this one time and clocked several hours in Amazon IVS.) Be sure to read through the [pricing details](https://aws.amazon.com/ivs/pricing/) and be vigilant about turning off the stream when you don\'t need it to be on.\n\n### Set up Amazon IVS\n\nNow I\'ll set up a channel in Amazon IVS. The channel will take my video stream from the OBS software on my computer and make that stream available in a video player that I will bring into the browser with the Amazon IVS SDK (so many acronyms!).\n\nIn order to do this, I\'ll need to [create an AWS account](https://portal.aws.amazon.com/billing/signup). This will require billing information.\n\nIn addition, I\'ll need to set up AWS Identity and Access Management (IAM), which adds a \'policy\' to my account that allows me to create an AWS IVS channel. This is standard for doing anything in AWS - the first step is to configure IAM so that users of the AWS console have specific permissions. I am the only user of my console, so I\'m not worried about restricting any permissions in my account.\n\n[This guide](https://docs.aws.amazon.com/ivs/latest/userguide/getting-started-iam-permissions.html) walks through how to set up the IAM permissions so that a user can create an AWS IVS channel.\n\nNow I can navigate to IVS to create a channel. In the top search bar, I can type \'IVS\' to find Amazon Interactive Video Service.\n\n![AWS search bar](https://res.cloudinary.com/deepgram/image/upload/v1646946745/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/SearchBar.png)\n\nThis takes me to the Amazon IVS console. I will click the **Create channel** button to create my channel.\n\n![Click button to create IVS channel](https://res.cloudinary.com/deepgram/image/upload/v1646946808/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/CreateChannel.png)\n\nI can name my stream and stick with the **Default** configuration. Then I\'ll scroll down and click **Create channel**.\n\n![Set up IVS with default configuration](https://res.cloudinary.com/deepgram/image/upload/v1646946808/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/IVSSetup.png)\n\nThis will create the channel and then put me on that channel\'s page in the console. This is where I can configure the channel and get the information I need to connect my video stream in OBS to this channel. I need to find this section of the page:\n\n![Info about channel for OBS and video player](https://res.cloudinary.com/deepgram/image/upload/v1646946838/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/ChannelInfo.png)\n\nThere are three pieces of information I am going to need for my project. Two are to connect OBS to Amazon IVS, and one is to bring the stream from Amazon IVS (with all its optimizations) into the browser video player:\n\n*   **Ingest server** - put this in OBS settings for my stream\n*   **Stream key** - put this in OBS settings for my stream\n*   **Playback URL** - use this as the src for my script that I put in the video player\n\nI have already set up OBS, so I can just go back to the settings for my stream and add the **Ingest server** and **Stream key**. The **Playback URL** will be used later.\n\n![Stream settings](https://res.cloudinary.com/deepgram/image/upload/v1646946718/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/StreamSettings.png)\n\nNow, if I go back to the OBS controls and click on **Start Streaming**, my stream should be fed to Amazon IVS, and I am able to see it in the Amazon IVS channel page where it says **Live stream**:\n\n![Live stream in channel page](https://res.cloudinary.com/deepgram/image/upload/v1646946953/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/LiveStream.png)\n\n### Connect Front-end Video Player to Amazon IVS\n\nThe back-end is done (AWS takes care of most of the work). Now I can build the front-end, which I will do using vanilla Javascript and HTML.\n\nIn the `<head>` tag of my HTML document, I will include the script for the Amazon IVS player. Amazon IVS explains how to do this setup [here](https://docs.aws.amazon.com/ivs/latest/userguide/player-web.html), for those who want to go straight to the source.\n\n```html\n<head>\n  <meta charset="UTF-8" />\n  <title>Video Stream Demo</title>\n  <script src="https://player.live-video.net/1.6.1/amazon-ivs-player.min.js"><\/script>\n</head>\n```\n\nThis will load the IVS Player, and I will have access to the `IVSPlayer` variable in the global context. I can type that variable into the console to take a look at the module that has been loaded. There are quite a few properties that could be of use to me, depending on my project\'s needs.\n\n<img src="https://res.cloudinary.com/deepgram/image/upload/v1646946972/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/ConsoleIVSPlayer.png" alt="IVSPlayer in console" style="width: 50%; margin:auto;">\n\nIn the `<body>` tag, I will include a `<video>` player that has an `id` of `video-player` (this id can be renamed, as long as the javascript I write to find this element looks for that specific id).\n\n```html\n<body>\n  <video\n    width="520"\n    height="440"\n    id="video-player"\n    controls\n    playsinline\n  ></video>\n</body>\n```\n\nIn the browser, I see the video player, but there is no stream coming through. That is because I have only brought in the Amazon IVS player; I have not yet connected the player to my stream channel.\n\nI will use javascript to put my stream channel into the player.\n\n```js\n<script>\nif (IVSPlayer.isPlayerSupported) {\n  const player = IVSPlayer.create();\n  player.attachHTMLVideoElement(document.getElementById("video-player"));\n  player.load("PLAYBACK_URL");\n  player.play();\n}\n<\/script>\n```\n\nWhere it says `PLAYBACK_URL` in the code example, I need to put the string for my playback URL, which I can find in the Amazon IVS console for my channel.\n\n![Playback URL](https://res.cloudinary.com/deepgram/image/upload/v1646946995/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/PlaybackConfiguration.png)\n\nThen I can turn on my stream in OBS, and I should see my stream in the browser!\n\n<img src="https://res.cloudinary.com/deepgram/image/upload/v1646947012/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/StartStream.png" alt="OBS Start stream" style="width: 50%; margin:auto;">\n\n### Use Deepgram to Create Text Captions\n\nThe second part of this project, after getting the live stream video player working, is creating text captions. The captions will display what is being said in the live stream as I am streaming.\n\nI will need to do two things: use my computer\'s microphone to listen to the audio that is being outputted from the live stream, and then send that audio stream to Deepgram to turn it into a text transcription.\n\n### What is the Media Streams API?\n\nThe browser contains several APIs for working with audio and video. I need to use one that lets me **gain access to the user\'s microphone**. If I can gain that access, I can record the audio from the live stream and send it on to Deepgram to get the text transcript.\n\nThe **Media Streams API** contains many interfaces and methods for working with **audio and video data**. There is already a really great guide for how it works [here](https://blog.deepgram.com/getting-started-with-mediastream-api/), so I won\'t go over all the details. I just need to understand that the Media Streams API has so much that I can use when I\'m working with audio or video data in the browser. In fact, I\'m pretty sure the Amazon IVS SDK uses it under the hood as part of their video player.\n\n### Get Audio with Media Streams API\n\nI will use the `getUserMedia` method from this API. To get access to the user\'s microphone, I can write this javascript:\n\n```js\n<script>\n//Get access to user\'s microphone\nnavigator.mediaDevices.getUserMedia({ audio: true }).then((res) => {\n  mediaRecorder = new MediaRecorder(res, {\n    audio: true,\n  });\n});\n<\/script>\n```\n\nThis will cause the browser to ask for permission to use the microphone.\n\n<img src="https://res.cloudinary.com/deepgram/image/upload/v1646947043/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/GetMicrophone.png" alt="Request permission to use microphone" style="width: 50%; margin:auto;">\n\nIf the user gives permission, then I\'ll have access to the live stream audio to send to Deepgram.\n\n## Create Text Captions with Deepgram API\n\nIn the next step, I will use the Deepgram API to take the audio data and turn it into text.\n\n### What is Deepgram?\n\nDeepgram is an ASR technology (ASR stands for Automatic Speech Recognition). It uses pretty advanced AI and deep learning technology to take speech from audio files or streams and turn it into text. There are probably a million ways to use this technology in a project. It\'s a fun API to get comfortable with for this reason.\n\nIf I\'m going to use Deepgram in my project, I need to create an account [here](https://console.deepgram.com/signup?jump=keys). This will give me an API key and $150 in free credit, so I won\'t need to enter billing information just to get started (unlike AWS).\n\nNow I can connect to the Deepgram socket with my API key.\n\n### Connect to Deepgram to Get Transcription\n\nI want to get the transcription and display it under the video player, so I will create an HTML element for that transcript. I\'ll give it the **id** of `captions`.\n\n```html\n<p id="captions"></p>\n```\n\nI\'m going to follow the tutorial my colleague Kevin Lewis wrote about [getting live speech transcriptions in the browser](https://blog.deepgram.com/live-transcription-mic-browser/). He explains that I need to connect to Deepgram with a WebSocket. I have to make sure I have access to the microphone before I open the WebSocket, so I will put the logic to connect to Deepgram inside the `.then()` that is attached to the `getUserMedia` function call.\n\n```js\nnavigator.mediaDevices.getUserMedia({ audio: true }).then((stream) => {\n  ...\n  const socket = new WebSocket("wss://api.deepgram.com/v1/listen", [\n    "token",\n    "YOUR_KEY_HERE",\n  ]);\n});\n\n```\n\nI will put my API key where it says "YOUR\\_KEY\\_HERE".\n\nOnce the socket is open, I can add an event listener that listens for when there is audio data that has come through the microphone. When that happens, I can take that audio data and send it through the Deepgram socket to Deepgram.\n\n```js\nsocket.onopen = () => {\n  mediaRecorder.addEventListener(\'dataavailable\', async (event) => {\n    if (event.data.size > 0 && socket.readyState == 1) {\n      socket.send(event.data)\n    }\n  })\n  mediaRecorder.start(1000)\n}\n```\n\nDeepgram will send the transcribed audio back to me as text. It will come in the form of a JSON object, so I need to drill down to the `transcript` property using dot notation. I will use `document.querySelector(#captions)` to put the transcript onto the screen under the video element.\n\n```js\nsocket.onmessage = (message) => {\n  const received = JSON.parse(message.data)\n  const transcript = received.channel.alternatives[0].transcript\n  if (transcript && received.is_final) {\n    document.querySelector(\'#captions\').textContent += transcript + \' \'\n  }\n}\n```\n\nHere is all the Javascript code for building the text captions feature:\n\n```js\n    <script>\n    // Get access to user\'s microphone\n    navigator.mediaDevices.getUserMedia({ audio: true }).then((stream) => {\n      const mediaRecorder = new MediaRecorder(stream);\n\n      // Open connection to Deepgram\n      const socket = new WebSocket("wss://api.deepgram.com/v1/listen", [\n        "token",\n        "YOUR_KEY_HERE",\n      ]);\n\n      // Listen for audio data coming from microphone and send it to Deepgram\n      socket.onopen = () => {\n        mediaRecorder.addEventListener("dataavailable", async (event) => {\n          if (event.data.size > 0 && socket.readyState == 1) {\n            socket.send(event.data);\n          }\n        });\n        mediaRecorder.start(1000);\n      };\n\n      // Put the transcript onto the screen in the #captions element\n      socket.onmessage = (message) => {\n        const received = JSON.parse(message.data);\n        const transcript = received.channel.alternatives[0].transcript;\n        if (transcript && received.is_final) {\n          document.querySelector("#captions").textContent += transcript + " ";\n        }\n      };\n\n      socket.onclose = () => {\n        console.log({ event: "onclose" });\n      };\n\n      socket.onerror = (error) => {\n        console.log({ event: "onerror", error });\n      };\n    });\n    <\/script>\n```\n\nAnd here is the HTML:\n\n```html\n<html lang="en">\n  <head>\n    <meta charset="UTF-8" />\n    <title>Video Stream Demo</title>\n    {/*<!-- Amazon IVS SDK video player -->*/}\n    <script src="https://player.live-video.net/1.6.1/amazon-ivs-player.min.js"><\/script>\n  </head>\n  <body>\n    <video\n      width="520"\n      height="440"\n      id="video-player"\n      controls\n      playsinline\n    ></video>\n    <p id="captions"></p>\n    {/*<!-- scripts -->*/}\n  </body>\n</html>\n```\n\nNow I can start my live stream, and the text captions will be displayed under the video player!\n\n## Conclusion\n\nIn this tutorial, I built a \'vanilla\' live stream player with text captions. I demonstrated how to use the technologies Amazon IVS and Deepgram using fundamentals of web development - HTML and Javascript. You can find the repo for this vanilla Javascript project [here](https://github.com/deepgram-devs/deepgram-livestream-javascript).\n\nBut most front-end developers rely on frameworks to build projects like these. And there are other considerations I need to make in regards to keeping my Deepgram API key secure and limiting who has access to this website.\n\nIn the next part of the series, **I will improve this project by building it using Vue.js (specifically Vue 3) for the front-end, and node.js for the back-end**. I will include some of the real-world practices for building a full-stack application. I\'ll need a server file so I can incorporate more security, which I\'ll build with node.js, and I\'ll build an entry page with VueRouter navigation guards so that users must enter a code to see my live stream.\n\nVue.js is my favorite Javascript framework, and I have written a series on [Diving Into Vue 3](https://blog.deepgram.com/diving-into-vue-3-setup-function/), which is worth checking out if you want to come along with me for the rest of this series to build a full-stack live stream application in Vue.js.\n\nPlease follow me on [Twitter](https://twitter.com/sandra_rodgers_) if you find my tutorials useful!\n\n        ', "html": '<p>In this series, I will build a live streaming web application with text captions. Companies such as Twitch, StreamYard, Facebook Live, and many others provide live streaming on the web as a product, so I got curious about how I might go about building my own version.</p>\n<Panel type="info" title="Build a Live Streaming Web Application with Amazon IVS and Deepgram (SERIES)"><ol><li><a href="https://blog.deepgram.com/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/">How to Build a Live Streaming Web Application with Amazon IVS and Deepgram</a></li>\n<li><a href="https://blog.deepgram.com/build-a-livestream-web-application-vue-and-express-setup/"> Build a Live Streaming Web Application: Vue and Express Setup</a></li>\n<li><a href="https://blog.deepgram.com/how-to-write-vue-3-composables-for-a-third-party-API-integration/"> How to Write Vue 3 Composables for a Third-Party API Integration</a></li><li><a href="https://blog.deepgram.com/asynchronous-logic-to-write-a-vue-3-and-deepgram-captions-component/"> Asynchronous Logic to Write a Vue 3 and Deepgram Captions Component</a></li></ol></Panel>\n<p>The main technologies I will use to build the live stream and text captions functionality are:</p>\n<ul>\n<li><strong>Open Broadcast Software</strong> - an open-source software used to capture video streams</li>\n<li><strong>Amazon IVS</strong> - an AWS service that can receive a video stream from OBS and put that stream into the browser, optimizing the entire process</li>\n<li><strong>Deepgram</strong> - a speech-to-text API that can receive an audio stream and return a text-transcript</li>\n</ul>\n<p>I will build two versions of this project. I\u2019ll use the following to build each project:</p>\n<ol>\n<li>\n<p><strong>HTML/Javascript</strong> - The first version I build (the <strong>vanilla version</strong>) will be focused on creating a <strong>front-end</strong> with a very limited back-end, emphasizing the most barebones approach to getting the application working.</p>\n</li>\n<li>\n<p><strong>Vue.js/Node.js</strong> - For the second version (the <strong>framework version</strong>), I will use Vue.js, a Javascript framework that gives me the tools I need to more easily include important features for security like routing and navigation guards. I will build a <strong>full-stack</strong> video streaming application with a <strong>node.js</strong> server to help me add a layer of security for some of the data I need to protect.</p>\n</li>\n</ol>\n<p>Here is a gif to demonstrate the final project:</p>\n<img src="https://res.cloudinary.com/deepgram/image/upload/v1646946089/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/VideoExample.gif" alt="demo of final project" style="width: 75%; margin:auto;" />\n<h2 id="project-one-vanilla-video-stream-player">Project One: Vanilla Video Stream Player</h2>\n<p>Now I\u2019ll start by building the first version of the project. I\u2019ll build a \u2018vanilla\u2019 video streaming player in the sense that I will only use HTML and Javascript on the front-end, and the only back-end will be the work I do to get Amazon IVS set up to receive the OBS stream.</p>\n<p>I want to keep it as simple as possible, focusing on how to build a <strong>video streaming player in the browser that includes text captions</strong>. This means I will not take into account real-world requirements such as hiding API keys or creating an entry page to restrict access to the video stream. Later, in the Vue.js version I build, I\u2019ll add those pieces, but to start, I just want to get the video player working - I want it to play my live stream and display text captions for what I\u2019m saying as I stream to viewers.</p>\n<p>Here is a diagram to demonstrate the core technology for the <strong>video streaming part</strong> of the project:</p>\n<img src="https://res.cloudinary.com/deepgram/image/upload/v1646946508/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/VideoStream.png" alt="Video stream diagram" style="width: 75%; margin:auto;" />\n<p>The diagram presents this flow: the webcam takes in the video stream \u2014> OBS captures that video stream so it can be sent along to Amazon IVS \u2014> Amazon IVS provides a service to take in the stream, optimize it, and send it in a format to the browser so that it can be used in an HTML video player \u2014> the HTML video element plays the optimized video stream.</p>\n<p>Here is a diagram to demonstrate the core technology for the <strong>text captions part</strong> of the project:</p>\n<img src="https://res.cloudinary.com/deepgram/image/upload/v1646946508/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/AudioTranscription.png" alt="Audio transcription diagram" style="width: 75%; margin:auto;" />\n<p>The general flow for the text captions technology will be something like this:</p>\n<p>The browser Media Streams API gets permission to use the browser microphone \u2014> the microphone takes in an audio stream of the audio that plays from the live stream \u2014> The Deepgram API opens a web socket channel in the browser to send the audio stream to Deepgram \u2014> the browser receives the JSON object in return that contains the text-transcript \u2014> Javascript puts the text onto the page as captions as the video is playing.</p>\n<p>Now that I have a high-level picture of how this project will be built, I am ready to build the barebones front-end video stream application. (In the next post in this series, I will build the Vue.js/Node.js full-stack application with added functionality.)</p>\n<h2 id="setting-up-open-broadcast-software">Setting up Open Broadcast Software</h2>\n<p>The first thing I need is software to capture my video stream on my computer. I\u2019ll use the <a href="https://obsproject.com/">Open Broadcast Software</a>.</p>\n<h3 id="what-is-obs">What is OBS?</h3>\n<p>For anyone serious about streaming, OBS is a powerful tool. It is a free open source software that gives many configuration options for capturing and editing a stream. I can edit every aspect of my stream and create scenes made up of multiple sources such as images, text, etc. I can mix audio, switch between scenes with transitions, adjust the layouts, and so much more.</p>\n<p>The stream I capture in OBS can be connected to a streaming platform such as Twitch, YouTube, or others, and it will deliver my stream to that platform; however, for this project, my goal is to stream to a web application that I make myself.</p>\n<p>OBS takes some effort to learn, but I only need to familiarize myself with a few parts of it if I\u2019m going to set it up to capture a stream and connect to Amazon IVS (Amazon IVS is not a streaming platform - it is more like an SDK that helps make the stream easier to handle when I build my front-end).</p>\n<h3 id="set-up-live-streaming-with-obs">Set up Live Streaming with OBS</h3>\n<p>To set up OBS for my project, I will:</p>\n<ol>\n<li>\n<p>Go to <a href="https://obsproject.com/">obsproject.com</a> and choose the operating system I use. I\u2019ll download the software.</p>\n</li>\n<li>\n<p>Run the OBS software. In the <strong>Sources</strong> panel, I\u2019ll click the <strong>plus</strong> sign to add a new source. I\u2019ll select <strong>Video Capture Device</strong>, and in the window that pops up, I\u2019ll select the camera I want to use to capture my stream (my computer camera or webcam).</p>\n</li>\n</ol>\n<img src="https://res.cloudinary.com/deepgram/image/upload/v1646946718/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/VideoCaptureDevice.png" alt="Select Video Capture Device to add source from computer camera" style="width: 80%; margin:auto;" />\n<ol start="3">\n<li>\n<p>Make sure the source is selected in the sources panel (I may have other sources that I have set up), then I\u2019ll click on <strong>Settings</strong> in the far-right <strong>Controls</strong> panel.</p>\n</li>\n<li>\n<p>Select <strong>Stream</strong> in the left column of the window that opens up. The <strong>Service</strong> will remain <strong>Custom</strong>, but I notice that I could select a streaming platform such as Twitch or YouTube if I weren\u2019t planning to build my own streaming application.</p>\n</li>\n<li>\n<p>There is nothing more to do until I create the Amazon IVS channel. But I know that later I will take the <strong>Server</strong> and the <strong>Stream Key</strong> information from Amazon IVS for the specific channel I create in the AWS console.</p>\n</li>\n</ol>\n<p><img src="https://res.cloudinary.com/deepgram/image/upload/v1646946718/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/StreamSettings.png" alt="Stream settings"></p>\n<h2 id="setting-up-amazon-ivs">Setting up Amazon IVS</h2>\n<p>In this step, I will create an Amazon IVS channel, which is where my video stream from OBS will feed into once I connect them.</p>\n<h3 id="what-is-amazon-ivs">What is Amazon IVS?</h3>\n<p>The \u2018IVS\u2019 in Amazon IVS stands for Interactive Video Service. The website for <a href="https://aws.amazon.com/ivs/">Amazon IVS</a> describes it as a \u201Cmanaged live streaming solution\u201D that I can use to send \u201Clive streams to Amazon IVS using streaming software\u201D and \u201Cmake low-latency live video available to any viewer around the world.\u201D In addition, I \u201Ccan easily customize and enhance the audience experience through the Amazon IVS player SDK.\u201D</p>\n<p>So what does this mean?</p>\n<p>The fact is, building a video player browser can be very complicated. Amazon IVS takes away much of the challenge, allowing me to focus on the design of my front-end rather than the nitty-gritty of the video player. If I did it all without Amazon IVS, I could use the HTML native <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/video#usage_notes">video tag</a>, but then there would be much to do to optimize the video stream that comes through (there\u2019s an interesting article about this <a href="https://medium.com/canal-tech/how-video-streaming-works-on-the-web-an-introduction-7919739f7e1">here</a>). A developer could dedicate their entire career to getting good at building stuff that manages audio and video streams in the browser.</p>\n<p>Amazon IVS will optimize the stream to make it work for viewers watching it in my web application anywhere in the world. It also provides an SDK for the video player, which I can bring into the browser by adding a script. That script will take control of the video element in my HTML and add all the magic that Amazon IVS does under the hood. The Amazon IVS video player is built for the purpose of streaming live video, so I don\u2019t have to build my own complicated video player.</p>\n<p>One important thing to consider is cost. AWS is not free, and while it is very cost-effective for a bigger streaming platform like Twitch (the Twitch streaming technology is powered by Amazon IVS), an individual developer like myself building a small project for fun might not find it to be the best option.</p>\n<p>The good news is a new user of Amazon IVS can enjoy the free tier, which gives the following:</p>\n<ul>\n<li>Five hours of live video input for a basic channel per month</li>\n<li>100 hours of SD live video output per month</li>\n</ul>\n<p>This is enough to build this project and not be charged, as long as I am careful about turning off my stream in OBS when I\u2019m not using it. (Yes, I did forget to do this one time and clocked several hours in Amazon IVS.) Be sure to read through the <a href="https://aws.amazon.com/ivs/pricing/">pricing details</a> and be vigilant about turning off the stream when you don\u2019t need it to be on.</p>\n<h3 id="set-up-amazon-ivs">Set up Amazon IVS</h3>\n<p>Now I\u2019ll set up a channel in Amazon IVS. The channel will take my video stream from the OBS software on my computer and make that stream available in a video player that I will bring into the browser with the Amazon IVS SDK (so many acronyms!).</p>\n<p>In order to do this, I\u2019ll need to <a href="https://portal.aws.amazon.com/billing/signup">create an AWS account</a>. This will require billing information.</p>\n<p>In addition, I\u2019ll need to set up AWS Identity and Access Management (IAM), which adds a \u2018policy\u2019 to my account that allows me to create an AWS IVS channel. This is standard for doing anything in AWS - the first step is to configure IAM so that users of the AWS console have specific permissions. I am the only user of my console, so I\u2019m not worried about restricting any permissions in my account.</p>\n<p><a href="https://docs.aws.amazon.com/ivs/latest/userguide/getting-started-iam-permissions.html">This guide</a> walks through how to set up the IAM permissions so that a user can create an AWS IVS channel.</p>\n<p>Now I can navigate to IVS to create a channel. In the top search bar, I can type \u2018IVS\u2019 to find Amazon Interactive Video Service.</p>\n<p><img src="https://res.cloudinary.com/deepgram/image/upload/v1646946745/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/SearchBar.png" alt="AWS search bar"></p>\n<p>This takes me to the Amazon IVS console. I will click the <strong>Create channel</strong> button to create my channel.</p>\n<p><img src="https://res.cloudinary.com/deepgram/image/upload/v1646946808/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/CreateChannel.png" alt="Click button to create IVS channel"></p>\n<p>I can name my stream and stick with the <strong>Default</strong> configuration. Then I\u2019ll scroll down and click <strong>Create channel</strong>.</p>\n<p><img src="https://res.cloudinary.com/deepgram/image/upload/v1646946808/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/IVSSetup.png" alt="Set up IVS with default configuration"></p>\n<p>This will create the channel and then put me on that channel\u2019s page in the console. This is where I can configure the channel and get the information I need to connect my video stream in OBS to this channel. I need to find this section of the page:</p>\n<p><img src="https://res.cloudinary.com/deepgram/image/upload/v1646946838/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/ChannelInfo.png" alt="Info about channel for OBS and video player"></p>\n<p>There are three pieces of information I am going to need for my project. Two are to connect OBS to Amazon IVS, and one is to bring the stream from Amazon IVS (with all its optimizations) into the browser video player:</p>\n<ul>\n<li><strong>Ingest server</strong> - put this in OBS settings for my stream</li>\n<li><strong>Stream key</strong> - put this in OBS settings for my stream</li>\n<li><strong>Playback URL</strong> - use this as the src for my script that I put in the video player</li>\n</ul>\n<p>I have already set up OBS, so I can just go back to the settings for my stream and add the <strong>Ingest server</strong> and <strong>Stream key</strong>. The <strong>Playback URL</strong> will be used later.</p>\n<p><img src="https://res.cloudinary.com/deepgram/image/upload/v1646946718/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/StreamSettings.png" alt="Stream settings"></p>\n<p>Now, if I go back to the OBS controls and click on <strong>Start Streaming</strong>, my stream should be fed to Amazon IVS, and I am able to see it in the Amazon IVS channel page where it says <strong>Live stream</strong>:</p>\n<p><img src="https://res.cloudinary.com/deepgram/image/upload/v1646946953/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/LiveStream.png" alt="Live stream in channel page"></p>\n<h3 id="connect-front-end-video-player-to-amazon-ivs">Connect Front-end Video Player to Amazon IVS</h3>\n<p>The back-end is done (AWS takes care of most of the work). Now I can build the front-end, which I will do using vanilla Javascript and HTML.</p>\n<p>In the <code is:raw>&lt;head&gt;</code> tag of my HTML document, I will include the script for the Amazon IVS player. Amazon IVS explains how to do this setup <a href="https://docs.aws.amazon.com/ivs/latest/userguide/player-web.html">here</a>, for those who want to go straight to the source.</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">head</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">meta</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">charset</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;UTF-8&quot;</span><span style="color: #C9D1D9"> /&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">title</span><span style="color: #C9D1D9">&gt;Video Stream Demo&lt;/</span><span style="color: #7EE787">title</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">src</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;https://player.live-video.net/1.6.1/amazon-ivs-player.min.js&quot;</span><span style="color: #C9D1D9">&gt;&lt;/</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">&lt;/</span><span style="color: #7EE787">head</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>\n<p>This will load the IVS Player, and I will have access to the <code is:raw>IVSPlayer</code> variable in the global context. I can type that variable into the console to take a look at the module that has been loaded. There are quite a few properties that could be of use to me, depending on my project\u2019s needs.</p>\n<img src="https://res.cloudinary.com/deepgram/image/upload/v1646946972/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/ConsoleIVSPlayer.png" alt="IVSPlayer in console" style="width: 50%; margin:auto;" />\n<p>In the <code is:raw>&lt;body&gt;</code> tag, I will include a <code is:raw>&lt;video&gt;</code> player that has an <code is:raw>id</code> of <code is:raw>video-player</code> (this id can be renamed, as long as the javascript I write to find this element looks for that specific id).</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">body</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">video</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">width</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;520&quot;</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">height</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;440&quot;</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">id</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;video-player&quot;</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">controls</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">playsinline</span></span>\n<span class="line"><span style="color: #C9D1D9">  &gt;&lt;/</span><span style="color: #7EE787">video</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">&lt;/</span><span style="color: #7EE787">body</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>\n<p>In the browser, I see the video player, but there is no stream coming through. That is because I have only brought in the Amazon IVS player; I have not yet connected the player to my stream channel.</p>\n<p>I will use javascript to put my stream channel into the player.</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">if (IVSPlayer.isPlayerSupported) </span><span style="color: #FF7B72">{</span></span>\n<span class="line"><span style="color: #C9D1D9">  const player </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> IVSPlayer.</span><span style="color: #D2A8FF">create</span><span style="color: #C9D1D9">();</span></span>\n<span class="line"><span style="color: #C9D1D9">  player.</span><span style="color: #D2A8FF">attachHTMLVideoElement</span><span style="color: #C9D1D9">(document.</span><span style="color: #D2A8FF">getElementById</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&quot;video-player&quot;</span><span style="color: #C9D1D9">));</span></span>\n<span class="line"><span style="color: #C9D1D9">  player.</span><span style="color: #D2A8FF">load</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&quot;PLAYBACK_URL&quot;</span><span style="color: #C9D1D9">);</span></span>\n<span class="line"><span style="color: #C9D1D9">  player.</span><span style="color: #D2A8FF">play</span><span style="color: #C9D1D9">();</span></span>\n<span class="line"><span style="color: #FF7B72">}</span></span>\n<span class="line"><span style="color: #C9D1D9">&lt;/</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>\n<p>Where it says <code is:raw>PLAYBACK_URL</code> in the code example, I need to put the string for my playback URL, which I can find in the Amazon IVS console for my channel.</p>\n<p><img src="https://res.cloudinary.com/deepgram/image/upload/v1646946995/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/PlaybackConfiguration.png" alt="Playback URL"></p>\n<p>Then I can turn on my stream in OBS, and I should see my stream in the browser!</p>\n<img src="https://res.cloudinary.com/deepgram/image/upload/v1646947012/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/StartStream.png" alt="OBS Start stream" style="width: 50%; margin:auto;" />\n<h3 id="use-deepgram-to-create-text-captions">Use Deepgram to Create Text Captions</h3>\n<p>The second part of this project, after getting the live stream video player working, is creating text captions. The captions will display what is being said in the live stream as I am streaming.</p>\n<p>I will need to do two things: use my computer\u2019s microphone to listen to the audio that is being outputted from the live stream, and then send that audio stream to Deepgram to turn it into a text transcription.</p>\n<h3 id="what-is-the-media-streams-api">What is the Media Streams API?</h3>\n<p>The browser contains several APIs for working with audio and video. I need to use one that lets me <strong>gain access to the user\u2019s microphone</strong>. If I can gain that access, I can record the audio from the live stream and send it on to Deepgram to get the text transcript.</p>\n<p>The <strong>Media Streams API</strong> contains many interfaces and methods for working with <strong>audio and video data</strong>. There is already a really great guide for how it works <a href="https://blog.deepgram.com/getting-started-with-mediastream-api/">here</a>, so I won\u2019t go over all the details. I just need to understand that the Media Streams API has so much that I can use when I\u2019m working with audio or video data in the browser. In fact, I\u2019m pretty sure the Amazon IVS SDK uses it under the hood as part of their video player.</p>\n<h3 id="get-audio-with-media-streams-api">Get Audio with Media Streams API</h3>\n<p>I will use the <code is:raw>getUserMedia</code> method from this API. To get access to the user\u2019s microphone, I can write this javascript:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">//Get access to user&#39;s microphone</span></span>\n<span class="line"><span style="color: #C9D1D9">navigator.mediaDevices.getUserMedia(</span><span style="color: #FF7B72">{</span><span style="color: #C9D1D9"> audio: </span><span style="color: #79C0FF">true</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">}</span><span style="color: #C9D1D9">).then((res) =&gt; </span><span style="color: #FF7B72">{</span></span>\n<span class="line"><span style="color: #C9D1D9">  mediaRecorder </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">MediaRecorder</span><span style="color: #C9D1D9">(res, {</span></span>\n<span class="line"><span style="color: #C9D1D9">    audio: </span><span style="color: #79C0FF">true</span><span style="color: #C9D1D9">,</span></span>\n<span class="line"><span style="color: #C9D1D9">  });</span></span>\n<span class="line"><span style="color: #FF7B72">}</span><span style="color: #C9D1D9">);</span></span>\n<span class="line"><span style="color: #C9D1D9">&lt;/</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>\n<p>This will cause the browser to ask for permission to use the microphone.</p>\n<img src="https://res.cloudinary.com/deepgram/image/upload/v1646947043/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/GetMicrophone.png" alt="Request permission to use microphone" style="width: 50%; margin:auto;" />\n<p>If the user gives permission, then I\u2019ll have access to the live stream audio to send to Deepgram.</p>\n<h2 id="create-text-captions-with-deepgram-api">Create Text Captions with Deepgram API</h2>\n<p>In the next step, I will use the Deepgram API to take the audio data and turn it into text.</p>\n<h3 id="what-is-deepgram">What is Deepgram?</h3>\n<p>Deepgram is an ASR technology (ASR stands for Automatic Speech Recognition). It uses pretty advanced AI and deep learning technology to take speech from audio files or streams and turn it into text. There are probably a million ways to use this technology in a project. It\u2019s a fun API to get comfortable with for this reason.</p>\n<p>If I\u2019m going to use Deepgram in my project, I need to create an account <a href="https://console.deepgram.com/signup?jump=keys">here</a>. This will give me an API key and $150 in free credit, so I won\u2019t need to enter billing information just to get started (unlike AWS).</p>\n<p>Now I can connect to the Deepgram socket with my API key.</p>\n<h3 id="connect-to-deepgram-to-get-transcription">Connect to Deepgram to Get Transcription</h3>\n<p>I want to get the transcription and display it under the video player, so I will create an HTML element for that transcript. I\u2019ll give it the <strong>id</strong> of <code is:raw>captions</code>.</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">p</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">id</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;captions&quot;</span><span style="color: #C9D1D9">&gt;&lt;/</span><span style="color: #7EE787">p</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>\n<p>I\u2019m going to follow the tutorial my colleague Kevin Lewis wrote about <a href="https://blog.deepgram.com/live-transcription-mic-browser/">getting live speech transcriptions in the browser</a>. He explains that I need to connect to Deepgram with a WebSocket. I have to make sure I have access to the microphone before I open the WebSocket, so I will put the logic to connect to Deepgram inside the <code is:raw>.then()</code> that is attached to the <code is:raw>getUserMedia</code> function call.</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">navigator.mediaDevices.</span><span style="color: #D2A8FF">getUserMedia</span><span style="color: #C9D1D9">({ audio: </span><span style="color: #79C0FF">true</span><span style="color: #C9D1D9"> }).</span><span style="color: #D2A8FF">then</span><span style="color: #C9D1D9">((</span><span style="color: #FFA657">stream</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">...</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">socket</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">WebSocket</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&quot;wss://api.deepgram.com/v1/listen&quot;</span><span style="color: #C9D1D9">, [</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #A5D6FF">&quot;token&quot;</span><span style="color: #C9D1D9">,</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #A5D6FF">&quot;YOUR_KEY_HERE&quot;</span><span style="color: #C9D1D9">,</span></span>\n<span class="line"><span style="color: #C9D1D9">  ]);</span></span>\n<span class="line"><span style="color: #C9D1D9">});</span></span>\n<span class="line"></span></code></pre>\n<p>I will put my API key where it says \u201CYOUR_KEY_HERE\u201D.</p>\n<p>Once the socket is open, I can add an event listener that listens for when there is audio data that has come through the microphone. When that happens, I can take that audio data and send it through the Deepgram socket to Deepgram.</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">socket.</span><span style="color: #D2A8FF">onopen</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">  mediaRecorder.</span><span style="color: #D2A8FF">addEventListener</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;dataavailable&#39;</span><span style="color: #C9D1D9">, </span><span style="color: #FF7B72">async</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">event</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (event.data.size </span><span style="color: #FF7B72">&gt;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">&amp;&amp;</span><span style="color: #C9D1D9"> socket.readyState </span><span style="color: #FF7B72">==</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">1</span><span style="color: #C9D1D9">) {</span></span>\n<span class="line"><span style="color: #C9D1D9">      socket.</span><span style="color: #D2A8FF">send</span><span style="color: #C9D1D9">(event.data)</span></span>\n<span class="line"><span style="color: #C9D1D9">    }</span></span>\n<span class="line"><span style="color: #C9D1D9">  })</span></span>\n<span class="line"><span style="color: #C9D1D9">  mediaRecorder.</span><span style="color: #D2A8FF">start</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">1000</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #C9D1D9">}</span></span></code></pre>\n<p>Deepgram will send the transcribed audio back to me as text. It will come in the form of a JSON object, so I need to drill down to the <code is:raw>transcript</code> property using dot notation. I will use <code is:raw>document.querySelector(#captions)</code> to put the transcript onto the screen under the video element.</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">socket.</span><span style="color: #D2A8FF">onmessage</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">message</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">received</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">JSON</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">parse</span><span style="color: #C9D1D9">(message.data)</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">transcript</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> received.channel.alternatives[</span><span style="color: #79C0FF">0</span><span style="color: #C9D1D9">].transcript</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (transcript </span><span style="color: #FF7B72">&amp;&amp;</span><span style="color: #C9D1D9"> received.is_final) {</span></span>\n<span class="line"><span style="color: #C9D1D9">    document.</span><span style="color: #D2A8FF">querySelector</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;#captions&#39;</span><span style="color: #C9D1D9">).textContent </span><span style="color: #FF7B72">+=</span><span style="color: #C9D1D9"> transcript </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39; &#39;</span></span>\n<span class="line"><span style="color: #C9D1D9">  }</span></span>\n<span class="line"><span style="color: #C9D1D9">}</span></span></code></pre>\n<p>Here is all the Javascript code for building the text captions feature:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">    // Get access to user&#39;s microphone</span></span>\n<span class="line"><span style="color: #C9D1D9">    navigator.mediaDevices.getUserMedia(</span><span style="color: #FF7B72">{</span><span style="color: #C9D1D9"> audio: </span><span style="color: #79C0FF">true</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">}</span><span style="color: #C9D1D9">).then((stream) =&gt; </span><span style="color: #FF7B72">{</span></span>\n<span class="line"><span style="color: #C9D1D9">      const mediaRecorder </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">MediaRecorder</span><span style="color: #C9D1D9">(stream);</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #8B949E">// Open connection to Deepgram</span></span>\n<span class="line"><span style="color: #C9D1D9">      const socket </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">WebSocket</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&quot;wss://api.deepgram.com/v1/listen&quot;</span><span style="color: #C9D1D9">, [</span></span>\n<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #A5D6FF">&quot;token&quot;</span><span style="color: #C9D1D9">,</span></span>\n<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #A5D6FF">&quot;YOUR_KEY_HERE&quot;</span><span style="color: #C9D1D9">,</span></span>\n<span class="line"><span style="color: #C9D1D9">      ]);</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #8B949E">// Listen for audio data coming from microphone and send it to Deepgram</span></span>\n<span class="line"><span style="color: #C9D1D9">      socket.</span><span style="color: #D2A8FF">onopen</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">        mediaRecorder.</span><span style="color: #D2A8FF">addEventListener</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&quot;dataavailable&quot;</span><span style="color: #C9D1D9">, </span><span style="color: #FF7B72">async</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">event</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">          </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (event.data.size </span><span style="color: #FF7B72">&gt;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">&amp;&amp;</span><span style="color: #C9D1D9"> socket.readyState </span><span style="color: #FF7B72">==</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">1</span><span style="color: #C9D1D9">) {</span></span>\n<span class="line"><span style="color: #C9D1D9">            socket.</span><span style="color: #D2A8FF">send</span><span style="color: #C9D1D9">(event.data);</span></span>\n<span class="line"><span style="color: #C9D1D9">          }</span></span>\n<span class="line"><span style="color: #C9D1D9">        });</span></span>\n<span class="line"><span style="color: #C9D1D9">        mediaRecorder.</span><span style="color: #D2A8FF">start</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">1000</span><span style="color: #C9D1D9">);</span></span>\n<span class="line"><span style="color: #C9D1D9">      };</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #8B949E">// Put the transcript onto the screen in the #captions element</span></span>\n<span class="line"><span style="color: #C9D1D9">      socket.</span><span style="color: #D2A8FF">onmessage</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">message</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">received</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">JSON</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">parse</span><span style="color: #C9D1D9">(message.data);</span></span>\n<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">transcript</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> received.channel.alternatives[</span><span style="color: #79C0FF">0</span><span style="color: #C9D1D9">].transcript;</span></span>\n<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (transcript </span><span style="color: #FF7B72">&amp;&amp;</span><span style="color: #C9D1D9"> received.is_final) {</span></span>\n<span class="line"><span style="color: #C9D1D9">          document.</span><span style="color: #D2A8FF">querySelector</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&quot;#captions&quot;</span><span style="color: #C9D1D9">).textContent </span><span style="color: #FF7B72">+=</span><span style="color: #C9D1D9"> transcript </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&quot; &quot;</span><span style="color: #C9D1D9">;</span></span>\n<span class="line"><span style="color: #C9D1D9">        }</span></span>\n<span class="line"><span style="color: #C9D1D9">      };</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">      socket.</span><span style="color: #D2A8FF">onclose</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">        console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">({ event: </span><span style="color: #A5D6FF">&quot;onclose&quot;</span><span style="color: #C9D1D9"> });</span></span>\n<span class="line"><span style="color: #C9D1D9">      };</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">      socket.</span><span style="color: #D2A8FF">onerror</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">error</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">        console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">({ event: </span><span style="color: #A5D6FF">&quot;onerror&quot;</span><span style="color: #C9D1D9">, error });</span></span>\n<span class="line"><span style="color: #C9D1D9">      };</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">}</span><span style="color: #C9D1D9">);</span></span>\n<span class="line"><span style="color: #C9D1D9">    &lt;/</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>\n<p>And here is the HTML:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">html</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">lang</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;en&quot;</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">head</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">meta</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">charset</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;UTF-8&quot;</span><span style="color: #C9D1D9"> /&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">title</span><span style="color: #C9D1D9">&gt;Video Stream Demo&lt;/</span><span style="color: #7EE787">title</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #8B949E">&lt;!-- Amazon IVS SDK video player --&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">src</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;https://player.live-video.net/1.6.1/amazon-ivs-player.min.js&quot;</span><span style="color: #C9D1D9">&gt;&lt;/</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;/</span><span style="color: #7EE787">head</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">body</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">video</span></span>\n<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">width</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;520&quot;</span></span>\n<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">height</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;440&quot;</span></span>\n<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">id</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;video-player&quot;</span></span>\n<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">controls</span></span>\n<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">playsinline</span></span>\n<span class="line"><span style="color: #C9D1D9">    &gt;&lt;/</span><span style="color: #7EE787">video</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">p</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">id</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;captions&quot;</span><span style="color: #C9D1D9">&gt;&lt;/</span><span style="color: #7EE787">p</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #8B949E">&lt;!-- scripts --&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;/</span><span style="color: #7EE787">body</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">&lt;/</span><span style="color: #7EE787">html</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>\n<p>Now I can start my live stream, and the text captions will be displayed under the video player!</p>\n<h2 id="conclusion">Conclusion</h2>\n<p>In this tutorial, I built a \u2018vanilla\u2019 live stream player with text captions. I demonstrated how to use the technologies Amazon IVS and Deepgram using fundamentals of web development - HTML and Javascript. You can find the repo for this vanilla Javascript project <a href="https://github.com/deepgram-devs/deepgram-livestream-javascript">here</a>.</p>\n<p>But most front-end developers rely on frameworks to build projects like these. And there are other considerations I need to make in regards to keeping my Deepgram API key secure and limiting who has access to this website.</p>\n<p>In the next part of the series, <strong>I will improve this project by building it using Vue.js (specifically Vue 3) for the front-end, and node.js for the back-end</strong>. I will include some of the real-world practices for building a full-stack application. I\u2019ll need a server file so I can incorporate more security, which I\u2019ll build with node.js, and I\u2019ll build an entry page with VueRouter navigation guards so that users must enter a code to see my live stream.</p>\n<p>Vue.js is my favorite Javascript framework, and I have written a series on <a href="https://blog.deepgram.com/diving-into-vue-3-setup-function/">Diving Into Vue 3</a>, which is worth checking out if you want to come along with me for the rest of this series to build a full-stack live stream application in Vue.js.</p>\n<p>Please follow me on <a href="https://twitter.com/sandra_rodgers_">Twitter</a> if you find my tutorials useful!</p>' };
const frontmatter = { "title": "How to Build a Live Streaming Web Application with Amazon IVS and Deepgram", "description": "In this series, learn how to build a live streaming web application using Deepgram's speech-to-text API and Amazon Interactive Video Service.", "date": "2022-03-11T00:00:00.000Z", "cover": "https://res.cloudinary.com/deepgram/image/upload/v1646946075/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/Building-Livestreaming-w-AmazonIVS.jpg", "authors": ["sandra-rodgers"], "category": "tutorial", "tags": ["aws", "javascript", "serverless"], "seo": { "title": "How to Build a Live Streaming Web Application with Amazon IVS and Deepgram", "description": "In this series, learn how to build a live streaming web application using Deepgram's speech-to-text API and Amazon Interactive Video Service." }, "shorturls": { "share": "https://dpgr.am/3f16a52", "twitter": "https://dpgr.am/bca64b1", "linkedin": "https://dpgr.am/d95369c", "reddit": "https://dpgr.am/4ad64e5", "facebook": "https://dpgr.am/347b3d4" }, "og": { "image": "https://res.cloudinary.com/deepgram/image/upload/v1661454013/blog/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/ograph.png" }, "astro": { "headings": [{ "depth": 2, "slug": "project-one-vanilla-video-stream-player", "text": "Project One: Vanilla Video Stream Player" }, { "depth": 2, "slug": "setting-up-open-broadcast-software", "text": "Setting up Open Broadcast Software" }, { "depth": 3, "slug": "what-is-obs", "text": "What is OBS?" }, { "depth": 3, "slug": "set-up-live-streaming-with-obs", "text": "Set up Live Streaming with OBS" }, { "depth": 2, "slug": "setting-up-amazon-ivs", "text": "Setting up Amazon IVS" }, { "depth": 3, "slug": "what-is-amazon-ivs", "text": "What is Amazon IVS?" }, { "depth": 3, "slug": "set-up-amazon-ivs", "text": "Set up Amazon IVS" }, { "depth": 3, "slug": "connect-front-end-video-player-to-amazon-ivs", "text": "Connect Front-end Video Player to Amazon IVS" }, { "depth": 3, "slug": "use-deepgram-to-create-text-captions", "text": "Use Deepgram to Create Text Captions" }, { "depth": 3, "slug": "what-is-the-media-streams-api", "text": "What is the Media Streams API?" }, { "depth": 3, "slug": "get-audio-with-media-streams-api", "text": "Get Audio with Media Streams API" }, { "depth": 2, "slug": "create-text-captions-with-deepgram-api", "text": "Create Text Captions with Deepgram API" }, { "depth": 3, "slug": "what-is-deepgram", "text": "What is Deepgram?" }, { "depth": 3, "slug": "connect-to-deepgram-to-get-transcription", "text": "Connect to Deepgram to Get Transcription" }, { "depth": 2, "slug": "conclusion", "text": "Conclusion" }], "source": '\nIn this series, I will build a live streaming web application with text captions. Companies such as Twitch, StreamYard, Facebook Live, and many others provide live streaming on the web as a product, so I got curious about how I might go about building my own version.\n\n<Panel type="info" title="Build a Live Streaming Web Application with Amazon IVS and Deepgram (SERIES)">\n<ol>\n<li><a href="https://blog.deepgram.com/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/">How to Build a Live Streaming Web Application with Amazon IVS and Deepgram</a></li>\n<li><a href="https://blog.deepgram.com/build-a-livestream-web-application-vue-and-express-setup/"> Build a Live Streaming Web Application: Vue and Express Setup</a></li>\n<li><a href="https://blog.deepgram.com/how-to-write-vue-3-composables-for-a-third-party-API-integration/"> How to Write Vue 3 Composables for a Third-Party API Integration</a></li>\n\n<li><a href="https://blog.deepgram.com/asynchronous-logic-to-write-a-vue-3-and-deepgram-captions-component/"> Asynchronous Logic to Write a Vue 3 and Deepgram Captions Component</a></li>\n</ol>\n</Panel>\n\nThe main technologies I will use to build the live stream and text captions functionality are:\n\n*   **Open Broadcast Software** - an open-source software used to capture video streams\n*   **Amazon IVS** - an AWS service that can receive a video stream from OBS and put that stream into the browser, optimizing the entire process\n*   **Deepgram** - a speech-to-text API that can receive an audio stream and return a text-transcript\n\nI will build two versions of this project. I\'ll use the following to build each project:\n\n1.  **HTML/Javascript** - The first version I build (the **vanilla version**) will be focused on creating a **front-end** with a very limited back-end, emphasizing the most barebones approach to getting the application working.\n\n2.  **Vue.js/Node.js** - For the second version (the **framework version**), I will use Vue.js, a Javascript framework that gives me the tools I need to more easily include important features for security like routing and navigation guards. I will build a **full-stack** video streaming application with a **node.js** server to help me add a layer of security for some of the data I need to protect.\n\nHere is a gif to demonstrate the final project:\n\n<img src="https://res.cloudinary.com/deepgram/image/upload/v1646946089/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/VideoExample.gif" alt="demo of final project" style="width: 75%; margin:auto;">\n\n## Project One: Vanilla Video Stream Player\n\nNow I\'ll start by building the first version of the project. I\'ll build a \'vanilla\' video streaming player in the sense that I will only use HTML and Javascript on the front-end, and the only back-end will be the work I do to get Amazon IVS set up to receive the OBS stream.\n\nI want to keep it as simple as possible, focusing on how to build a **video streaming player in the browser that includes text captions**. This means I will not take into account real-world requirements such as hiding API keys or creating an entry page to restrict access to the video stream. Later, in the Vue.js version I build, I\'ll add those pieces, but to start, I just want to get the video player working - I want it to play my live stream and display text captions for what I\'m saying as I stream to viewers.\n\nHere is a diagram to demonstrate the core technology for the **video streaming part** of the project:\n\n<img src="https://res.cloudinary.com/deepgram/image/upload/v1646946508/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/VideoStream.png" alt="Video stream diagram" style="width: 75%; margin:auto;">\n\nThe diagram presents this flow: the webcam takes in the video stream --> OBS captures that video stream so it can be sent along to Amazon IVS --> Amazon IVS provides a service to take in the stream, optimize it, and send it in a format to the browser so that it can be used in an HTML video player --> the HTML video element plays the optimized video stream.\n\nHere is a diagram to demonstrate the core technology for the **text captions part** of the project:\n\n<img src="https://res.cloudinary.com/deepgram/image/upload/v1646946508/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/AudioTranscription.png" alt="Audio transcription diagram" style="width: 75%; margin:auto;">\n\nThe general flow for the text captions technology will be something like this:\n\nThe browser Media Streams API gets permission to use the browser microphone --> the microphone takes in an audio stream of the audio that plays from the live stream --> The Deepgram API opens a web socket channel in the browser to send the audio stream to Deepgram --> the browser receives the JSON object in return that contains the text-transcript --> Javascript puts the text onto the page as captions as the video is playing.\n\nNow that I have a high-level picture of how this project will be built, I am ready to build the barebones front-end video stream application. (In the next post in this series, I will build the Vue.js/Node.js full-stack application with added functionality.)\n\n## Setting up Open Broadcast Software\n\nThe first thing I need is software to capture my video stream on my computer. I\'ll use the [Open Broadcast Software](https://obsproject.com/).\n\n### What is OBS?\n\nFor anyone serious about streaming, OBS is a powerful tool. It is a free open source software that gives many configuration options for capturing and editing a stream. I can edit every aspect of my stream and create scenes made up of multiple sources such as images, text, etc. I can mix audio, switch between scenes with transitions, adjust the layouts, and so much more.\n\nThe stream I capture in OBS can be connected to a streaming platform such as Twitch, YouTube, or others, and it will deliver my stream to that platform; however, for this project, my goal is to stream to a web application that I make myself.\n\nOBS takes some effort to learn, but I only need to familiarize myself with a few parts of it if I\'m going to set it up to capture a stream and connect to Amazon IVS (Amazon IVS is not a streaming platform - it is more like an SDK that helps make the stream easier to handle when I build my front-end).\n\n### Set up Live Streaming with OBS\n\nTo set up OBS for my project, I will:\n\n1.  Go to [obsproject.com](https://obsproject.com/) and choose the operating system I use. I\'ll download the software.\n\n2.  Run the OBS software. In the **Sources** panel, I\'ll click the **plus** sign to add a new source. I\'ll select **Video Capture Device**, and in the window that pops up, I\'ll select the camera I want to use to capture my stream (my computer camera or webcam).\n\n<img src="https://res.cloudinary.com/deepgram/image/upload/v1646946718/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/VideoCaptureDevice.png" alt="Select Video Capture Device to add source from computer camera" style="width: 80%; margin:auto;">\n\n3.  Make sure the source is selected in the sources panel (I may have other sources that I have set up), then I\'ll click on **Settings** in the far-right **Controls** panel.\n\n4.  Select **Stream** in the left column of the window that opens up. The **Service** will remain **Custom**, but I notice that I could select a streaming platform such as Twitch or YouTube if I weren\'t planning to build my own streaming application.\n\n5.  There is nothing more to do until I create the Amazon IVS channel. But I know that later I will take the **Server** and the **Stream Key** information from Amazon IVS for the specific channel I create in the AWS console.\n\n![Stream settings](https://res.cloudinary.com/deepgram/image/upload/v1646946718/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/StreamSettings.png)\n\n## Setting up Amazon IVS\n\nIn this step, I will create an Amazon IVS channel, which is where my video stream from OBS will feed into once I connect them.\n\n### What is Amazon IVS?\n\nThe \'IVS\' in Amazon IVS stands for Interactive Video Service. The website for [Amazon IVS](https://aws.amazon.com/ivs/) describes it as a "managed live streaming solution" that I can use to send "live streams to Amazon IVS using streaming software" and "make low-latency live video available to any viewer around the world." In addition, I "can easily customize and enhance the audience experience through the Amazon IVS player SDK."\n\nSo what does this mean?\n\nThe fact is, building a video player browser can be very complicated. Amazon IVS takes away much of the challenge, allowing me to focus on the design of my front-end rather than the nitty-gritty of the video player. If I did it all without Amazon IVS, I could use the HTML native [video tag](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/video#usage_notes), but then there would be much to do to optimize the video stream that comes through (there\'s an interesting article about this [here](https://medium.com/canal-tech/how-video-streaming-works-on-the-web-an-introduction-7919739f7e1)). A developer could dedicate their entire career to getting good at building stuff that manages audio and video streams in the browser.\n\nAmazon IVS will optimize the stream to make it work for viewers watching it in my web application anywhere in the world. It also provides an SDK for the video player, which I can bring into the browser by adding a script. That script will take control of the video element in my HTML and add all the magic that Amazon IVS does under the hood. The Amazon IVS video player is built for the purpose of streaming live video, so I don\'t have to build my own complicated video player.\n\nOne important thing to consider is cost. AWS is not free, and while it is very cost-effective for a bigger streaming platform like Twitch (the Twitch streaming technology is powered by Amazon IVS), an individual developer like myself building a small project for fun might not find it to be the best option.\n\nThe good news is a new user of Amazon IVS can enjoy the free tier, which gives the following:\n\n*   Five hours of live video input for a basic channel per month\n*   100 hours of SD live video output per month\n\nThis is enough to build this project and not be charged, as long as I am careful about turning off my stream in OBS when I\'m not using it. (Yes, I did forget to do this one time and clocked several hours in Amazon IVS.) Be sure to read through the [pricing details](https://aws.amazon.com/ivs/pricing/) and be vigilant about turning off the stream when you don\'t need it to be on.\n\n### Set up Amazon IVS\n\nNow I\'ll set up a channel in Amazon IVS. The channel will take my video stream from the OBS software on my computer and make that stream available in a video player that I will bring into the browser with the Amazon IVS SDK (so many acronyms!).\n\nIn order to do this, I\'ll need to [create an AWS account](https://portal.aws.amazon.com/billing/signup). This will require billing information.\n\nIn addition, I\'ll need to set up AWS Identity and Access Management (IAM), which adds a \'policy\' to my account that allows me to create an AWS IVS channel. This is standard for doing anything in AWS - the first step is to configure IAM so that users of the AWS console have specific permissions. I am the only user of my console, so I\'m not worried about restricting any permissions in my account.\n\n[This guide](https://docs.aws.amazon.com/ivs/latest/userguide/getting-started-iam-permissions.html) walks through how to set up the IAM permissions so that a user can create an AWS IVS channel.\n\nNow I can navigate to IVS to create a channel. In the top search bar, I can type \'IVS\' to find Amazon Interactive Video Service.\n\n![AWS search bar](https://res.cloudinary.com/deepgram/image/upload/v1646946745/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/SearchBar.png)\n\nThis takes me to the Amazon IVS console. I will click the **Create channel** button to create my channel.\n\n![Click button to create IVS channel](https://res.cloudinary.com/deepgram/image/upload/v1646946808/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/CreateChannel.png)\n\nI can name my stream and stick with the **Default** configuration. Then I\'ll scroll down and click **Create channel**.\n\n![Set up IVS with default configuration](https://res.cloudinary.com/deepgram/image/upload/v1646946808/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/IVSSetup.png)\n\nThis will create the channel and then put me on that channel\'s page in the console. This is where I can configure the channel and get the information I need to connect my video stream in OBS to this channel. I need to find this section of the page:\n\n![Info about channel for OBS and video player](https://res.cloudinary.com/deepgram/image/upload/v1646946838/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/ChannelInfo.png)\n\nThere are three pieces of information I am going to need for my project. Two are to connect OBS to Amazon IVS, and one is to bring the stream from Amazon IVS (with all its optimizations) into the browser video player:\n\n*   **Ingest server** - put this in OBS settings for my stream\n*   **Stream key** - put this in OBS settings for my stream\n*   **Playback URL** - use this as the src for my script that I put in the video player\n\nI have already set up OBS, so I can just go back to the settings for my stream and add the **Ingest server** and **Stream key**. The **Playback URL** will be used later.\n\n![Stream settings](https://res.cloudinary.com/deepgram/image/upload/v1646946718/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/StreamSettings.png)\n\nNow, if I go back to the OBS controls and click on **Start Streaming**, my stream should be fed to Amazon IVS, and I am able to see it in the Amazon IVS channel page where it says **Live stream**:\n\n![Live stream in channel page](https://res.cloudinary.com/deepgram/image/upload/v1646946953/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/LiveStream.png)\n\n### Connect Front-end Video Player to Amazon IVS\n\nThe back-end is done (AWS takes care of most of the work). Now I can build the front-end, which I will do using vanilla Javascript and HTML.\n\nIn the `<head>` tag of my HTML document, I will include the script for the Amazon IVS player. Amazon IVS explains how to do this setup [here](https://docs.aws.amazon.com/ivs/latest/userguide/player-web.html), for those who want to go straight to the source.\n\n```html\n<head>\n  <meta charset="UTF-8" />\n  <title>Video Stream Demo</title>\n  <script src="https://player.live-video.net/1.6.1/amazon-ivs-player.min.js"><\/script>\n</head>\n```\n\nThis will load the IVS Player, and I will have access to the `IVSPlayer` variable in the global context. I can type that variable into the console to take a look at the module that has been loaded. There are quite a few properties that could be of use to me, depending on my project\'s needs.\n\n<img src="https://res.cloudinary.com/deepgram/image/upload/v1646946972/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/ConsoleIVSPlayer.png" alt="IVSPlayer in console" style="width: 50%; margin:auto;">\n\nIn the `<body>` tag, I will include a `<video>` player that has an `id` of `video-player` (this id can be renamed, as long as the javascript I write to find this element looks for that specific id).\n\n```html\n<body>\n  <video\n    width="520"\n    height="440"\n    id="video-player"\n    controls\n    playsinline\n  ></video>\n</body>\n```\n\nIn the browser, I see the video player, but there is no stream coming through. That is because I have only brought in the Amazon IVS player; I have not yet connected the player to my stream channel.\n\nI will use javascript to put my stream channel into the player.\n\n```js\n<script>\nif (IVSPlayer.isPlayerSupported) {\n  const player = IVSPlayer.create();\n  player.attachHTMLVideoElement(document.getElementById("video-player"));\n  player.load("PLAYBACK_URL");\n  player.play();\n}\n<\/script>\n```\n\nWhere it says `PLAYBACK_URL` in the code example, I need to put the string for my playback URL, which I can find in the Amazon IVS console for my channel.\n\n![Playback URL](https://res.cloudinary.com/deepgram/image/upload/v1646946995/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/PlaybackConfiguration.png)\n\nThen I can turn on my stream in OBS, and I should see my stream in the browser!\n\n<img src="https://res.cloudinary.com/deepgram/image/upload/v1646947012/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/StartStream.png" alt="OBS Start stream" style="width: 50%; margin:auto;">\n\n### Use Deepgram to Create Text Captions\n\nThe second part of this project, after getting the live stream video player working, is creating text captions. The captions will display what is being said in the live stream as I am streaming.\n\nI will need to do two things: use my computer\'s microphone to listen to the audio that is being outputted from the live stream, and then send that audio stream to Deepgram to turn it into a text transcription.\n\n### What is the Media Streams API?\n\nThe browser contains several APIs for working with audio and video. I need to use one that lets me **gain access to the user\'s microphone**. If I can gain that access, I can record the audio from the live stream and send it on to Deepgram to get the text transcript.\n\nThe **Media Streams API** contains many interfaces and methods for working with **audio and video data**. There is already a really great guide for how it works [here](https://blog.deepgram.com/getting-started-with-mediastream-api/), so I won\'t go over all the details. I just need to understand that the Media Streams API has so much that I can use when I\'m working with audio or video data in the browser. In fact, I\'m pretty sure the Amazon IVS SDK uses it under the hood as part of their video player.\n\n### Get Audio with Media Streams API\n\nI will use the `getUserMedia` method from this API. To get access to the user\'s microphone, I can write this javascript:\n\n```js\n<script>\n//Get access to user\'s microphone\nnavigator.mediaDevices.getUserMedia({ audio: true }).then((res) => {\n  mediaRecorder = new MediaRecorder(res, {\n    audio: true,\n  });\n});\n<\/script>\n```\n\nThis will cause the browser to ask for permission to use the microphone.\n\n<img src="https://res.cloudinary.com/deepgram/image/upload/v1646947043/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/GetMicrophone.png" alt="Request permission to use microphone" style="width: 50%; margin:auto;">\n\nIf the user gives permission, then I\'ll have access to the live stream audio to send to Deepgram.\n\n## Create Text Captions with Deepgram API\n\nIn the next step, I will use the Deepgram API to take the audio data and turn it into text.\n\n### What is Deepgram?\n\nDeepgram is an ASR technology (ASR stands for Automatic Speech Recognition). It uses pretty advanced AI and deep learning technology to take speech from audio files or streams and turn it into text. There are probably a million ways to use this technology in a project. It\'s a fun API to get comfortable with for this reason.\n\nIf I\'m going to use Deepgram in my project, I need to create an account [here](https://console.deepgram.com/signup?jump=keys). This will give me an API key and $150 in free credit, so I won\'t need to enter billing information just to get started (unlike AWS).\n\nNow I can connect to the Deepgram socket with my API key.\n\n### Connect to Deepgram to Get Transcription\n\nI want to get the transcription and display it under the video player, so I will create an HTML element for that transcript. I\'ll give it the **id** of `captions`.\n\n```html\n<p id="captions"></p>\n```\n\nI\'m going to follow the tutorial my colleague Kevin Lewis wrote about [getting live speech transcriptions in the browser](https://blog.deepgram.com/live-transcription-mic-browser/). He explains that I need to connect to Deepgram with a WebSocket. I have to make sure I have access to the microphone before I open the WebSocket, so I will put the logic to connect to Deepgram inside the `.then()` that is attached to the `getUserMedia` function call.\n\n```js\nnavigator.mediaDevices.getUserMedia({ audio: true }).then((stream) => {\n  ...\n  const socket = new WebSocket("wss://api.deepgram.com/v1/listen", [\n    "token",\n    "YOUR_KEY_HERE",\n  ]);\n});\n\n```\n\nI will put my API key where it says "YOUR\\_KEY\\_HERE".\n\nOnce the socket is open, I can add an event listener that listens for when there is audio data that has come through the microphone. When that happens, I can take that audio data and send it through the Deepgram socket to Deepgram.\n\n```js\nsocket.onopen = () => {\n  mediaRecorder.addEventListener(\'dataavailable\', async (event) => {\n    if (event.data.size > 0 && socket.readyState == 1) {\n      socket.send(event.data)\n    }\n  })\n  mediaRecorder.start(1000)\n}\n```\n\nDeepgram will send the transcribed audio back to me as text. It will come in the form of a JSON object, so I need to drill down to the `transcript` property using dot notation. I will use `document.querySelector(#captions)` to put the transcript onto the screen under the video element.\n\n```js\nsocket.onmessage = (message) => {\n  const received = JSON.parse(message.data)\n  const transcript = received.channel.alternatives[0].transcript\n  if (transcript && received.is_final) {\n    document.querySelector(\'#captions\').textContent += transcript + \' \'\n  }\n}\n```\n\nHere is all the Javascript code for building the text captions feature:\n\n```js\n    <script>\n    // Get access to user\'s microphone\n    navigator.mediaDevices.getUserMedia({ audio: true }).then((stream) => {\n      const mediaRecorder = new MediaRecorder(stream);\n\n      // Open connection to Deepgram\n      const socket = new WebSocket("wss://api.deepgram.com/v1/listen", [\n        "token",\n        "YOUR_KEY_HERE",\n      ]);\n\n      // Listen for audio data coming from microphone and send it to Deepgram\n      socket.onopen = () => {\n        mediaRecorder.addEventListener("dataavailable", async (event) => {\n          if (event.data.size > 0 && socket.readyState == 1) {\n            socket.send(event.data);\n          }\n        });\n        mediaRecorder.start(1000);\n      };\n\n      // Put the transcript onto the screen in the #captions element\n      socket.onmessage = (message) => {\n        const received = JSON.parse(message.data);\n        const transcript = received.channel.alternatives[0].transcript;\n        if (transcript && received.is_final) {\n          document.querySelector("#captions").textContent += transcript + " ";\n        }\n      };\n\n      socket.onclose = () => {\n        console.log({ event: "onclose" });\n      };\n\n      socket.onerror = (error) => {\n        console.log({ event: "onerror", error });\n      };\n    });\n    <\/script>\n```\n\nAnd here is the HTML:\n\n```html\n<html lang="en">\n  <head>\n    <meta charset="UTF-8" />\n    <title>Video Stream Demo</title>\n    {/*<!-- Amazon IVS SDK video player -->*/}\n    <script src="https://player.live-video.net/1.6.1/amazon-ivs-player.min.js"><\/script>\n  </head>\n  <body>\n    <video\n      width="520"\n      height="440"\n      id="video-player"\n      controls\n      playsinline\n    ></video>\n    <p id="captions"></p>\n    {/*<!-- scripts -->*/}\n  </body>\n</html>\n```\n\nNow I can start my live stream, and the text captions will be displayed under the video player!\n\n## Conclusion\n\nIn this tutorial, I built a \'vanilla\' live stream player with text captions. I demonstrated how to use the technologies Amazon IVS and Deepgram using fundamentals of web development - HTML and Javascript. You can find the repo for this vanilla Javascript project [here](https://github.com/deepgram-devs/deepgram-livestream-javascript).\n\nBut most front-end developers rely on frameworks to build projects like these. And there are other considerations I need to make in regards to keeping my Deepgram API key secure and limiting who has access to this website.\n\nIn the next part of the series, **I will improve this project by building it using Vue.js (specifically Vue 3) for the front-end, and node.js for the back-end**. I will include some of the real-world practices for building a full-stack application. I\'ll need a server file so I can incorporate more security, which I\'ll build with node.js, and I\'ll build an entry page with VueRouter navigation guards so that users must enter a code to see my live stream.\n\nVue.js is my favorite Javascript framework, and I have written a series on [Diving Into Vue 3](https://blog.deepgram.com/diving-into-vue-3-setup-function/), which is worth checking out if you want to come along with me for the rest of this series to build a full-stack live stream application in Vue.js.\n\nPlease follow me on [Twitter](https://twitter.com/sandra_rodgers_) if you find my tutorials useful!\n\n        ', "html": '<p>In this series, I will build a live streaming web application with text captions. Companies such as Twitch, StreamYard, Facebook Live, and many others provide live streaming on the web as a product, so I got curious about how I might go about building my own version.</p>\n<Panel type="info" title="Build a Live Streaming Web Application with Amazon IVS and Deepgram (SERIES)"><ol><li><a href="https://blog.deepgram.com/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/">How to Build a Live Streaming Web Application with Amazon IVS and Deepgram</a></li>\n<li><a href="https://blog.deepgram.com/build-a-livestream-web-application-vue-and-express-setup/"> Build a Live Streaming Web Application: Vue and Express Setup</a></li>\n<li><a href="https://blog.deepgram.com/how-to-write-vue-3-composables-for-a-third-party-API-integration/"> How to Write Vue 3 Composables for a Third-Party API Integration</a></li><li><a href="https://blog.deepgram.com/asynchronous-logic-to-write-a-vue-3-and-deepgram-captions-component/"> Asynchronous Logic to Write a Vue 3 and Deepgram Captions Component</a></li></ol></Panel>\n<p>The main technologies I will use to build the live stream and text captions functionality are:</p>\n<ul>\n<li><strong>Open Broadcast Software</strong> - an open-source software used to capture video streams</li>\n<li><strong>Amazon IVS</strong> - an AWS service that can receive a video stream from OBS and put that stream into the browser, optimizing the entire process</li>\n<li><strong>Deepgram</strong> - a speech-to-text API that can receive an audio stream and return a text-transcript</li>\n</ul>\n<p>I will build two versions of this project. I\u2019ll use the following to build each project:</p>\n<ol>\n<li>\n<p><strong>HTML/Javascript</strong> - The first version I build (the <strong>vanilla version</strong>) will be focused on creating a <strong>front-end</strong> with a very limited back-end, emphasizing the most barebones approach to getting the application working.</p>\n</li>\n<li>\n<p><strong>Vue.js/Node.js</strong> - For the second version (the <strong>framework version</strong>), I will use Vue.js, a Javascript framework that gives me the tools I need to more easily include important features for security like routing and navigation guards. I will build a <strong>full-stack</strong> video streaming application with a <strong>node.js</strong> server to help me add a layer of security for some of the data I need to protect.</p>\n</li>\n</ol>\n<p>Here is a gif to demonstrate the final project:</p>\n<img src="https://res.cloudinary.com/deepgram/image/upload/v1646946089/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/VideoExample.gif" alt="demo of final project" style="width: 75%; margin:auto;" />\n<h2 id="project-one-vanilla-video-stream-player">Project One: Vanilla Video Stream Player</h2>\n<p>Now I\u2019ll start by building the first version of the project. I\u2019ll build a \u2018vanilla\u2019 video streaming player in the sense that I will only use HTML and Javascript on the front-end, and the only back-end will be the work I do to get Amazon IVS set up to receive the OBS stream.</p>\n<p>I want to keep it as simple as possible, focusing on how to build a <strong>video streaming player in the browser that includes text captions</strong>. This means I will not take into account real-world requirements such as hiding API keys or creating an entry page to restrict access to the video stream. Later, in the Vue.js version I build, I\u2019ll add those pieces, but to start, I just want to get the video player working - I want it to play my live stream and display text captions for what I\u2019m saying as I stream to viewers.</p>\n<p>Here is a diagram to demonstrate the core technology for the <strong>video streaming part</strong> of the project:</p>\n<img src="https://res.cloudinary.com/deepgram/image/upload/v1646946508/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/VideoStream.png" alt="Video stream diagram" style="width: 75%; margin:auto;" />\n<p>The diagram presents this flow: the webcam takes in the video stream \u2014> OBS captures that video stream so it can be sent along to Amazon IVS \u2014> Amazon IVS provides a service to take in the stream, optimize it, and send it in a format to the browser so that it can be used in an HTML video player \u2014> the HTML video element plays the optimized video stream.</p>\n<p>Here is a diagram to demonstrate the core technology for the <strong>text captions part</strong> of the project:</p>\n<img src="https://res.cloudinary.com/deepgram/image/upload/v1646946508/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/AudioTranscription.png" alt="Audio transcription diagram" style="width: 75%; margin:auto;" />\n<p>The general flow for the text captions technology will be something like this:</p>\n<p>The browser Media Streams API gets permission to use the browser microphone \u2014> the microphone takes in an audio stream of the audio that plays from the live stream \u2014> The Deepgram API opens a web socket channel in the browser to send the audio stream to Deepgram \u2014> the browser receives the JSON object in return that contains the text-transcript \u2014> Javascript puts the text onto the page as captions as the video is playing.</p>\n<p>Now that I have a high-level picture of how this project will be built, I am ready to build the barebones front-end video stream application. (In the next post in this series, I will build the Vue.js/Node.js full-stack application with added functionality.)</p>\n<h2 id="setting-up-open-broadcast-software">Setting up Open Broadcast Software</h2>\n<p>The first thing I need is software to capture my video stream on my computer. I\u2019ll use the <a href="https://obsproject.com/">Open Broadcast Software</a>.</p>\n<h3 id="what-is-obs">What is OBS?</h3>\n<p>For anyone serious about streaming, OBS is a powerful tool. It is a free open source software that gives many configuration options for capturing and editing a stream. I can edit every aspect of my stream and create scenes made up of multiple sources such as images, text, etc. I can mix audio, switch between scenes with transitions, adjust the layouts, and so much more.</p>\n<p>The stream I capture in OBS can be connected to a streaming platform such as Twitch, YouTube, or others, and it will deliver my stream to that platform; however, for this project, my goal is to stream to a web application that I make myself.</p>\n<p>OBS takes some effort to learn, but I only need to familiarize myself with a few parts of it if I\u2019m going to set it up to capture a stream and connect to Amazon IVS (Amazon IVS is not a streaming platform - it is more like an SDK that helps make the stream easier to handle when I build my front-end).</p>\n<h3 id="set-up-live-streaming-with-obs">Set up Live Streaming with OBS</h3>\n<p>To set up OBS for my project, I will:</p>\n<ol>\n<li>\n<p>Go to <a href="https://obsproject.com/">obsproject.com</a> and choose the operating system I use. I\u2019ll download the software.</p>\n</li>\n<li>\n<p>Run the OBS software. In the <strong>Sources</strong> panel, I\u2019ll click the <strong>plus</strong> sign to add a new source. I\u2019ll select <strong>Video Capture Device</strong>, and in the window that pops up, I\u2019ll select the camera I want to use to capture my stream (my computer camera or webcam).</p>\n</li>\n</ol>\n<img src="https://res.cloudinary.com/deepgram/image/upload/v1646946718/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/VideoCaptureDevice.png" alt="Select Video Capture Device to add source from computer camera" style="width: 80%; margin:auto;" />\n<ol start="3">\n<li>\n<p>Make sure the source is selected in the sources panel (I may have other sources that I have set up), then I\u2019ll click on <strong>Settings</strong> in the far-right <strong>Controls</strong> panel.</p>\n</li>\n<li>\n<p>Select <strong>Stream</strong> in the left column of the window that opens up. The <strong>Service</strong> will remain <strong>Custom</strong>, but I notice that I could select a streaming platform such as Twitch or YouTube if I weren\u2019t planning to build my own streaming application.</p>\n</li>\n<li>\n<p>There is nothing more to do until I create the Amazon IVS channel. But I know that later I will take the <strong>Server</strong> and the <strong>Stream Key</strong> information from Amazon IVS for the specific channel I create in the AWS console.</p>\n</li>\n</ol>\n<p><img src="https://res.cloudinary.com/deepgram/image/upload/v1646946718/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/StreamSettings.png" alt="Stream settings"></p>\n<h2 id="setting-up-amazon-ivs">Setting up Amazon IVS</h2>\n<p>In this step, I will create an Amazon IVS channel, which is where my video stream from OBS will feed into once I connect them.</p>\n<h3 id="what-is-amazon-ivs">What is Amazon IVS?</h3>\n<p>The \u2018IVS\u2019 in Amazon IVS stands for Interactive Video Service. The website for <a href="https://aws.amazon.com/ivs/">Amazon IVS</a> describes it as a \u201Cmanaged live streaming solution\u201D that I can use to send \u201Clive streams to Amazon IVS using streaming software\u201D and \u201Cmake low-latency live video available to any viewer around the world.\u201D In addition, I \u201Ccan easily customize and enhance the audience experience through the Amazon IVS player SDK.\u201D</p>\n<p>So what does this mean?</p>\n<p>The fact is, building a video player browser can be very complicated. Amazon IVS takes away much of the challenge, allowing me to focus on the design of my front-end rather than the nitty-gritty of the video player. If I did it all without Amazon IVS, I could use the HTML native <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/video#usage_notes">video tag</a>, but then there would be much to do to optimize the video stream that comes through (there\u2019s an interesting article about this <a href="https://medium.com/canal-tech/how-video-streaming-works-on-the-web-an-introduction-7919739f7e1">here</a>). A developer could dedicate their entire career to getting good at building stuff that manages audio and video streams in the browser.</p>\n<p>Amazon IVS will optimize the stream to make it work for viewers watching it in my web application anywhere in the world. It also provides an SDK for the video player, which I can bring into the browser by adding a script. That script will take control of the video element in my HTML and add all the magic that Amazon IVS does under the hood. The Amazon IVS video player is built for the purpose of streaming live video, so I don\u2019t have to build my own complicated video player.</p>\n<p>One important thing to consider is cost. AWS is not free, and while it is very cost-effective for a bigger streaming platform like Twitch (the Twitch streaming technology is powered by Amazon IVS), an individual developer like myself building a small project for fun might not find it to be the best option.</p>\n<p>The good news is a new user of Amazon IVS can enjoy the free tier, which gives the following:</p>\n<ul>\n<li>Five hours of live video input for a basic channel per month</li>\n<li>100 hours of SD live video output per month</li>\n</ul>\n<p>This is enough to build this project and not be charged, as long as I am careful about turning off my stream in OBS when I\u2019m not using it. (Yes, I did forget to do this one time and clocked several hours in Amazon IVS.) Be sure to read through the <a href="https://aws.amazon.com/ivs/pricing/">pricing details</a> and be vigilant about turning off the stream when you don\u2019t need it to be on.</p>\n<h3 id="set-up-amazon-ivs">Set up Amazon IVS</h3>\n<p>Now I\u2019ll set up a channel in Amazon IVS. The channel will take my video stream from the OBS software on my computer and make that stream available in a video player that I will bring into the browser with the Amazon IVS SDK (so many acronyms!).</p>\n<p>In order to do this, I\u2019ll need to <a href="https://portal.aws.amazon.com/billing/signup">create an AWS account</a>. This will require billing information.</p>\n<p>In addition, I\u2019ll need to set up AWS Identity and Access Management (IAM), which adds a \u2018policy\u2019 to my account that allows me to create an AWS IVS channel. This is standard for doing anything in AWS - the first step is to configure IAM so that users of the AWS console have specific permissions. I am the only user of my console, so I\u2019m not worried about restricting any permissions in my account.</p>\n<p><a href="https://docs.aws.amazon.com/ivs/latest/userguide/getting-started-iam-permissions.html">This guide</a> walks through how to set up the IAM permissions so that a user can create an AWS IVS channel.</p>\n<p>Now I can navigate to IVS to create a channel. In the top search bar, I can type \u2018IVS\u2019 to find Amazon Interactive Video Service.</p>\n<p><img src="https://res.cloudinary.com/deepgram/image/upload/v1646946745/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/SearchBar.png" alt="AWS search bar"></p>\n<p>This takes me to the Amazon IVS console. I will click the <strong>Create channel</strong> button to create my channel.</p>\n<p><img src="https://res.cloudinary.com/deepgram/image/upload/v1646946808/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/CreateChannel.png" alt="Click button to create IVS channel"></p>\n<p>I can name my stream and stick with the <strong>Default</strong> configuration. Then I\u2019ll scroll down and click <strong>Create channel</strong>.</p>\n<p><img src="https://res.cloudinary.com/deepgram/image/upload/v1646946808/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/IVSSetup.png" alt="Set up IVS with default configuration"></p>\n<p>This will create the channel and then put me on that channel\u2019s page in the console. This is where I can configure the channel and get the information I need to connect my video stream in OBS to this channel. I need to find this section of the page:</p>\n<p><img src="https://res.cloudinary.com/deepgram/image/upload/v1646946838/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/ChannelInfo.png" alt="Info about channel for OBS and video player"></p>\n<p>There are three pieces of information I am going to need for my project. Two are to connect OBS to Amazon IVS, and one is to bring the stream from Amazon IVS (with all its optimizations) into the browser video player:</p>\n<ul>\n<li><strong>Ingest server</strong> - put this in OBS settings for my stream</li>\n<li><strong>Stream key</strong> - put this in OBS settings for my stream</li>\n<li><strong>Playback URL</strong> - use this as the src for my script that I put in the video player</li>\n</ul>\n<p>I have already set up OBS, so I can just go back to the settings for my stream and add the <strong>Ingest server</strong> and <strong>Stream key</strong>. The <strong>Playback URL</strong> will be used later.</p>\n<p><img src="https://res.cloudinary.com/deepgram/image/upload/v1646946718/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/StreamSettings.png" alt="Stream settings"></p>\n<p>Now, if I go back to the OBS controls and click on <strong>Start Streaming</strong>, my stream should be fed to Amazon IVS, and I am able to see it in the Amazon IVS channel page where it says <strong>Live stream</strong>:</p>\n<p><img src="https://res.cloudinary.com/deepgram/image/upload/v1646946953/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/LiveStream.png" alt="Live stream in channel page"></p>\n<h3 id="connect-front-end-video-player-to-amazon-ivs">Connect Front-end Video Player to Amazon IVS</h3>\n<p>The back-end is done (AWS takes care of most of the work). Now I can build the front-end, which I will do using vanilla Javascript and HTML.</p>\n<p>In the <code is:raw>&lt;head&gt;</code> tag of my HTML document, I will include the script for the Amazon IVS player. Amazon IVS explains how to do this setup <a href="https://docs.aws.amazon.com/ivs/latest/userguide/player-web.html">here</a>, for those who want to go straight to the source.</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">head</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">meta</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">charset</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;UTF-8&quot;</span><span style="color: #C9D1D9"> /&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">title</span><span style="color: #C9D1D9">&gt;Video Stream Demo&lt;/</span><span style="color: #7EE787">title</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">src</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;https://player.live-video.net/1.6.1/amazon-ivs-player.min.js&quot;</span><span style="color: #C9D1D9">&gt;&lt;/</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">&lt;/</span><span style="color: #7EE787">head</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>\n<p>This will load the IVS Player, and I will have access to the <code is:raw>IVSPlayer</code> variable in the global context. I can type that variable into the console to take a look at the module that has been loaded. There are quite a few properties that could be of use to me, depending on my project\u2019s needs.</p>\n<img src="https://res.cloudinary.com/deepgram/image/upload/v1646946972/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/ConsoleIVSPlayer.png" alt="IVSPlayer in console" style="width: 50%; margin:auto;" />\n<p>In the <code is:raw>&lt;body&gt;</code> tag, I will include a <code is:raw>&lt;video&gt;</code> player that has an <code is:raw>id</code> of <code is:raw>video-player</code> (this id can be renamed, as long as the javascript I write to find this element looks for that specific id).</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">body</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">video</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">width</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;520&quot;</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">height</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;440&quot;</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">id</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;video-player&quot;</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">controls</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">playsinline</span></span>\n<span class="line"><span style="color: #C9D1D9">  &gt;&lt;/</span><span style="color: #7EE787">video</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">&lt;/</span><span style="color: #7EE787">body</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>\n<p>In the browser, I see the video player, but there is no stream coming through. That is because I have only brought in the Amazon IVS player; I have not yet connected the player to my stream channel.</p>\n<p>I will use javascript to put my stream channel into the player.</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">if (IVSPlayer.isPlayerSupported) </span><span style="color: #FF7B72">{</span></span>\n<span class="line"><span style="color: #C9D1D9">  const player </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> IVSPlayer.</span><span style="color: #D2A8FF">create</span><span style="color: #C9D1D9">();</span></span>\n<span class="line"><span style="color: #C9D1D9">  player.</span><span style="color: #D2A8FF">attachHTMLVideoElement</span><span style="color: #C9D1D9">(document.</span><span style="color: #D2A8FF">getElementById</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&quot;video-player&quot;</span><span style="color: #C9D1D9">));</span></span>\n<span class="line"><span style="color: #C9D1D9">  player.</span><span style="color: #D2A8FF">load</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&quot;PLAYBACK_URL&quot;</span><span style="color: #C9D1D9">);</span></span>\n<span class="line"><span style="color: #C9D1D9">  player.</span><span style="color: #D2A8FF">play</span><span style="color: #C9D1D9">();</span></span>\n<span class="line"><span style="color: #FF7B72">}</span></span>\n<span class="line"><span style="color: #C9D1D9">&lt;/</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>\n<p>Where it says <code is:raw>PLAYBACK_URL</code> in the code example, I need to put the string for my playback URL, which I can find in the Amazon IVS console for my channel.</p>\n<p><img src="https://res.cloudinary.com/deepgram/image/upload/v1646946995/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/PlaybackConfiguration.png" alt="Playback URL"></p>\n<p>Then I can turn on my stream in OBS, and I should see my stream in the browser!</p>\n<img src="https://res.cloudinary.com/deepgram/image/upload/v1646947012/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/StartStream.png" alt="OBS Start stream" style="width: 50%; margin:auto;" />\n<h3 id="use-deepgram-to-create-text-captions">Use Deepgram to Create Text Captions</h3>\n<p>The second part of this project, after getting the live stream video player working, is creating text captions. The captions will display what is being said in the live stream as I am streaming.</p>\n<p>I will need to do two things: use my computer\u2019s microphone to listen to the audio that is being outputted from the live stream, and then send that audio stream to Deepgram to turn it into a text transcription.</p>\n<h3 id="what-is-the-media-streams-api">What is the Media Streams API?</h3>\n<p>The browser contains several APIs for working with audio and video. I need to use one that lets me <strong>gain access to the user\u2019s microphone</strong>. If I can gain that access, I can record the audio from the live stream and send it on to Deepgram to get the text transcript.</p>\n<p>The <strong>Media Streams API</strong> contains many interfaces and methods for working with <strong>audio and video data</strong>. There is already a really great guide for how it works <a href="https://blog.deepgram.com/getting-started-with-mediastream-api/">here</a>, so I won\u2019t go over all the details. I just need to understand that the Media Streams API has so much that I can use when I\u2019m working with audio or video data in the browser. In fact, I\u2019m pretty sure the Amazon IVS SDK uses it under the hood as part of their video player.</p>\n<h3 id="get-audio-with-media-streams-api">Get Audio with Media Streams API</h3>\n<p>I will use the <code is:raw>getUserMedia</code> method from this API. To get access to the user\u2019s microphone, I can write this javascript:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">//Get access to user&#39;s microphone</span></span>\n<span class="line"><span style="color: #C9D1D9">navigator.mediaDevices.getUserMedia(</span><span style="color: #FF7B72">{</span><span style="color: #C9D1D9"> audio: </span><span style="color: #79C0FF">true</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">}</span><span style="color: #C9D1D9">).then((res) =&gt; </span><span style="color: #FF7B72">{</span></span>\n<span class="line"><span style="color: #C9D1D9">  mediaRecorder </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">MediaRecorder</span><span style="color: #C9D1D9">(res, {</span></span>\n<span class="line"><span style="color: #C9D1D9">    audio: </span><span style="color: #79C0FF">true</span><span style="color: #C9D1D9">,</span></span>\n<span class="line"><span style="color: #C9D1D9">  });</span></span>\n<span class="line"><span style="color: #FF7B72">}</span><span style="color: #C9D1D9">);</span></span>\n<span class="line"><span style="color: #C9D1D9">&lt;/</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>\n<p>This will cause the browser to ask for permission to use the microphone.</p>\n<img src="https://res.cloudinary.com/deepgram/image/upload/v1646947043/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/GetMicrophone.png" alt="Request permission to use microphone" style="width: 50%; margin:auto;" />\n<p>If the user gives permission, then I\u2019ll have access to the live stream audio to send to Deepgram.</p>\n<h2 id="create-text-captions-with-deepgram-api">Create Text Captions with Deepgram API</h2>\n<p>In the next step, I will use the Deepgram API to take the audio data and turn it into text.</p>\n<h3 id="what-is-deepgram">What is Deepgram?</h3>\n<p>Deepgram is an ASR technology (ASR stands for Automatic Speech Recognition). It uses pretty advanced AI and deep learning technology to take speech from audio files or streams and turn it into text. There are probably a million ways to use this technology in a project. It\u2019s a fun API to get comfortable with for this reason.</p>\n<p>If I\u2019m going to use Deepgram in my project, I need to create an account <a href="https://console.deepgram.com/signup?jump=keys">here</a>. This will give me an API key and $150 in free credit, so I won\u2019t need to enter billing information just to get started (unlike AWS).</p>\n<p>Now I can connect to the Deepgram socket with my API key.</p>\n<h3 id="connect-to-deepgram-to-get-transcription">Connect to Deepgram to Get Transcription</h3>\n<p>I want to get the transcription and display it under the video player, so I will create an HTML element for that transcript. I\u2019ll give it the <strong>id</strong> of <code is:raw>captions</code>.</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">p</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">id</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;captions&quot;</span><span style="color: #C9D1D9">&gt;&lt;/</span><span style="color: #7EE787">p</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>\n<p>I\u2019m going to follow the tutorial my colleague Kevin Lewis wrote about <a href="https://blog.deepgram.com/live-transcription-mic-browser/">getting live speech transcriptions in the browser</a>. He explains that I need to connect to Deepgram with a WebSocket. I have to make sure I have access to the microphone before I open the WebSocket, so I will put the logic to connect to Deepgram inside the <code is:raw>.then()</code> that is attached to the <code is:raw>getUserMedia</code> function call.</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">navigator.mediaDevices.</span><span style="color: #D2A8FF">getUserMedia</span><span style="color: #C9D1D9">({ audio: </span><span style="color: #79C0FF">true</span><span style="color: #C9D1D9"> }).</span><span style="color: #D2A8FF">then</span><span style="color: #C9D1D9">((</span><span style="color: #FFA657">stream</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">...</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">socket</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">WebSocket</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&quot;wss://api.deepgram.com/v1/listen&quot;</span><span style="color: #C9D1D9">, [</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #A5D6FF">&quot;token&quot;</span><span style="color: #C9D1D9">,</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #A5D6FF">&quot;YOUR_KEY_HERE&quot;</span><span style="color: #C9D1D9">,</span></span>\n<span class="line"><span style="color: #C9D1D9">  ]);</span></span>\n<span class="line"><span style="color: #C9D1D9">});</span></span>\n<span class="line"></span></code></pre>\n<p>I will put my API key where it says \u201CYOUR_KEY_HERE\u201D.</p>\n<p>Once the socket is open, I can add an event listener that listens for when there is audio data that has come through the microphone. When that happens, I can take that audio data and send it through the Deepgram socket to Deepgram.</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">socket.</span><span style="color: #D2A8FF">onopen</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">  mediaRecorder.</span><span style="color: #D2A8FF">addEventListener</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;dataavailable&#39;</span><span style="color: #C9D1D9">, </span><span style="color: #FF7B72">async</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">event</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (event.data.size </span><span style="color: #FF7B72">&gt;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">&amp;&amp;</span><span style="color: #C9D1D9"> socket.readyState </span><span style="color: #FF7B72">==</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">1</span><span style="color: #C9D1D9">) {</span></span>\n<span class="line"><span style="color: #C9D1D9">      socket.</span><span style="color: #D2A8FF">send</span><span style="color: #C9D1D9">(event.data)</span></span>\n<span class="line"><span style="color: #C9D1D9">    }</span></span>\n<span class="line"><span style="color: #C9D1D9">  })</span></span>\n<span class="line"><span style="color: #C9D1D9">  mediaRecorder.</span><span style="color: #D2A8FF">start</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">1000</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #C9D1D9">}</span></span></code></pre>\n<p>Deepgram will send the transcribed audio back to me as text. It will come in the form of a JSON object, so I need to drill down to the <code is:raw>transcript</code> property using dot notation. I will use <code is:raw>document.querySelector(#captions)</code> to put the transcript onto the screen under the video element.</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">socket.</span><span style="color: #D2A8FF">onmessage</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">message</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">received</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">JSON</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">parse</span><span style="color: #C9D1D9">(message.data)</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">transcript</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> received.channel.alternatives[</span><span style="color: #79C0FF">0</span><span style="color: #C9D1D9">].transcript</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (transcript </span><span style="color: #FF7B72">&amp;&amp;</span><span style="color: #C9D1D9"> received.is_final) {</span></span>\n<span class="line"><span style="color: #C9D1D9">    document.</span><span style="color: #D2A8FF">querySelector</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;#captions&#39;</span><span style="color: #C9D1D9">).textContent </span><span style="color: #FF7B72">+=</span><span style="color: #C9D1D9"> transcript </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39; &#39;</span></span>\n<span class="line"><span style="color: #C9D1D9">  }</span></span>\n<span class="line"><span style="color: #C9D1D9">}</span></span></code></pre>\n<p>Here is all the Javascript code for building the text captions feature:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">    // Get access to user&#39;s microphone</span></span>\n<span class="line"><span style="color: #C9D1D9">    navigator.mediaDevices.getUserMedia(</span><span style="color: #FF7B72">{</span><span style="color: #C9D1D9"> audio: </span><span style="color: #79C0FF">true</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">}</span><span style="color: #C9D1D9">).then((stream) =&gt; </span><span style="color: #FF7B72">{</span></span>\n<span class="line"><span style="color: #C9D1D9">      const mediaRecorder </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">MediaRecorder</span><span style="color: #C9D1D9">(stream);</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #8B949E">// Open connection to Deepgram</span></span>\n<span class="line"><span style="color: #C9D1D9">      const socket </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">WebSocket</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&quot;wss://api.deepgram.com/v1/listen&quot;</span><span style="color: #C9D1D9">, [</span></span>\n<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #A5D6FF">&quot;token&quot;</span><span style="color: #C9D1D9">,</span></span>\n<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #A5D6FF">&quot;YOUR_KEY_HERE&quot;</span><span style="color: #C9D1D9">,</span></span>\n<span class="line"><span style="color: #C9D1D9">      ]);</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #8B949E">// Listen for audio data coming from microphone and send it to Deepgram</span></span>\n<span class="line"><span style="color: #C9D1D9">      socket.</span><span style="color: #D2A8FF">onopen</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">        mediaRecorder.</span><span style="color: #D2A8FF">addEventListener</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&quot;dataavailable&quot;</span><span style="color: #C9D1D9">, </span><span style="color: #FF7B72">async</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">event</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">          </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (event.data.size </span><span style="color: #FF7B72">&gt;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">&amp;&amp;</span><span style="color: #C9D1D9"> socket.readyState </span><span style="color: #FF7B72">==</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">1</span><span style="color: #C9D1D9">) {</span></span>\n<span class="line"><span style="color: #C9D1D9">            socket.</span><span style="color: #D2A8FF">send</span><span style="color: #C9D1D9">(event.data);</span></span>\n<span class="line"><span style="color: #C9D1D9">          }</span></span>\n<span class="line"><span style="color: #C9D1D9">        });</span></span>\n<span class="line"><span style="color: #C9D1D9">        mediaRecorder.</span><span style="color: #D2A8FF">start</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">1000</span><span style="color: #C9D1D9">);</span></span>\n<span class="line"><span style="color: #C9D1D9">      };</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #8B949E">// Put the transcript onto the screen in the #captions element</span></span>\n<span class="line"><span style="color: #C9D1D9">      socket.</span><span style="color: #D2A8FF">onmessage</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">message</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">received</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">JSON</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">parse</span><span style="color: #C9D1D9">(message.data);</span></span>\n<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">transcript</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> received.channel.alternatives[</span><span style="color: #79C0FF">0</span><span style="color: #C9D1D9">].transcript;</span></span>\n<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (transcript </span><span style="color: #FF7B72">&amp;&amp;</span><span style="color: #C9D1D9"> received.is_final) {</span></span>\n<span class="line"><span style="color: #C9D1D9">          document.</span><span style="color: #D2A8FF">querySelector</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&quot;#captions&quot;</span><span style="color: #C9D1D9">).textContent </span><span style="color: #FF7B72">+=</span><span style="color: #C9D1D9"> transcript </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&quot; &quot;</span><span style="color: #C9D1D9">;</span></span>\n<span class="line"><span style="color: #C9D1D9">        }</span></span>\n<span class="line"><span style="color: #C9D1D9">      };</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">      socket.</span><span style="color: #D2A8FF">onclose</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">        console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">({ event: </span><span style="color: #A5D6FF">&quot;onclose&quot;</span><span style="color: #C9D1D9"> });</span></span>\n<span class="line"><span style="color: #C9D1D9">      };</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">      socket.</span><span style="color: #D2A8FF">onerror</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">error</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">        console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">({ event: </span><span style="color: #A5D6FF">&quot;onerror&quot;</span><span style="color: #C9D1D9">, error });</span></span>\n<span class="line"><span style="color: #C9D1D9">      };</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">}</span><span style="color: #C9D1D9">);</span></span>\n<span class="line"><span style="color: #C9D1D9">    &lt;/</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>\n<p>And here is the HTML:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">html</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">lang</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;en&quot;</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">head</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">meta</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">charset</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;UTF-8&quot;</span><span style="color: #C9D1D9"> /&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">title</span><span style="color: #C9D1D9">&gt;Video Stream Demo&lt;/</span><span style="color: #7EE787">title</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #8B949E">&lt;!-- Amazon IVS SDK video player --&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">src</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;https://player.live-video.net/1.6.1/amazon-ivs-player.min.js&quot;</span><span style="color: #C9D1D9">&gt;&lt;/</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;/</span><span style="color: #7EE787">head</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">body</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">video</span></span>\n<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">width</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;520&quot;</span></span>\n<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">height</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;440&quot;</span></span>\n<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">id</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;video-player&quot;</span></span>\n<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">controls</span></span>\n<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">playsinline</span></span>\n<span class="line"><span style="color: #C9D1D9">    &gt;&lt;/</span><span style="color: #7EE787">video</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">p</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">id</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;captions&quot;</span><span style="color: #C9D1D9">&gt;&lt;/</span><span style="color: #7EE787">p</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #8B949E">&lt;!-- scripts --&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;/</span><span style="color: #7EE787">body</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">&lt;/</span><span style="color: #7EE787">html</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>\n<p>Now I can start my live stream, and the text captions will be displayed under the video player!</p>\n<h2 id="conclusion">Conclusion</h2>\n<p>In this tutorial, I built a \u2018vanilla\u2019 live stream player with text captions. I demonstrated how to use the technologies Amazon IVS and Deepgram using fundamentals of web development - HTML and Javascript. You can find the repo for this vanilla Javascript project <a href="https://github.com/deepgram-devs/deepgram-livestream-javascript">here</a>.</p>\n<p>But most front-end developers rely on frameworks to build projects like these. And there are other considerations I need to make in regards to keeping my Deepgram API key secure and limiting who has access to this website.</p>\n<p>In the next part of the series, <strong>I will improve this project by building it using Vue.js (specifically Vue 3) for the front-end, and node.js for the back-end</strong>. I will include some of the real-world practices for building a full-stack application. I\u2019ll need a server file so I can incorporate more security, which I\u2019ll build with node.js, and I\u2019ll build an entry page with VueRouter navigation guards so that users must enter a code to see my live stream.</p>\n<p>Vue.js is my favorite Javascript framework, and I have written a series on <a href="https://blog.deepgram.com/diving-into-vue-3-setup-function/">Diving Into Vue 3</a>, which is worth checking out if you want to come along with me for the rest of this series to build a full-stack live stream application in Vue.js.</p>\n<p>Please follow me on <a href="https://twitter.com/sandra_rodgers_">Twitter</a> if you find my tutorials useful!</p>' }, "file": "/Users/sandrarodgers/web-next/blog/src/content/blog/posts/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/index.md" };
function rawContent() {
  return '\nIn this series, I will build a live streaming web application with text captions. Companies such as Twitch, StreamYard, Facebook Live, and many others provide live streaming on the web as a product, so I got curious about how I might go about building my own version.\n\n<Panel type="info" title="Build a Live Streaming Web Application with Amazon IVS and Deepgram (SERIES)">\n<ol>\n<li><a href="https://blog.deepgram.com/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/">How to Build a Live Streaming Web Application with Amazon IVS and Deepgram</a></li>\n<li><a href="https://blog.deepgram.com/build-a-livestream-web-application-vue-and-express-setup/"> Build a Live Streaming Web Application: Vue and Express Setup</a></li>\n<li><a href="https://blog.deepgram.com/how-to-write-vue-3-composables-for-a-third-party-API-integration/"> How to Write Vue 3 Composables for a Third-Party API Integration</a></li>\n\n<li><a href="https://blog.deepgram.com/asynchronous-logic-to-write-a-vue-3-and-deepgram-captions-component/"> Asynchronous Logic to Write a Vue 3 and Deepgram Captions Component</a></li>\n</ol>\n</Panel>\n\nThe main technologies I will use to build the live stream and text captions functionality are:\n\n*   **Open Broadcast Software** - an open-source software used to capture video streams\n*   **Amazon IVS** - an AWS service that can receive a video stream from OBS and put that stream into the browser, optimizing the entire process\n*   **Deepgram** - a speech-to-text API that can receive an audio stream and return a text-transcript\n\nI will build two versions of this project. I\'ll use the following to build each project:\n\n1.  **HTML/Javascript** - The first version I build (the **vanilla version**) will be focused on creating a **front-end** with a very limited back-end, emphasizing the most barebones approach to getting the application working.\n\n2.  **Vue.js/Node.js** - For the second version (the **framework version**), I will use Vue.js, a Javascript framework that gives me the tools I need to more easily include important features for security like routing and navigation guards. I will build a **full-stack** video streaming application with a **node.js** server to help me add a layer of security for some of the data I need to protect.\n\nHere is a gif to demonstrate the final project:\n\n<img src="https://res.cloudinary.com/deepgram/image/upload/v1646946089/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/VideoExample.gif" alt="demo of final project" style="width: 75%; margin:auto;">\n\n## Project One: Vanilla Video Stream Player\n\nNow I\'ll start by building the first version of the project. I\'ll build a \'vanilla\' video streaming player in the sense that I will only use HTML and Javascript on the front-end, and the only back-end will be the work I do to get Amazon IVS set up to receive the OBS stream.\n\nI want to keep it as simple as possible, focusing on how to build a **video streaming player in the browser that includes text captions**. This means I will not take into account real-world requirements such as hiding API keys or creating an entry page to restrict access to the video stream. Later, in the Vue.js version I build, I\'ll add those pieces, but to start, I just want to get the video player working - I want it to play my live stream and display text captions for what I\'m saying as I stream to viewers.\n\nHere is a diagram to demonstrate the core technology for the **video streaming part** of the project:\n\n<img src="https://res.cloudinary.com/deepgram/image/upload/v1646946508/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/VideoStream.png" alt="Video stream diagram" style="width: 75%; margin:auto;">\n\nThe diagram presents this flow: the webcam takes in the video stream --> OBS captures that video stream so it can be sent along to Amazon IVS --> Amazon IVS provides a service to take in the stream, optimize it, and send it in a format to the browser so that it can be used in an HTML video player --> the HTML video element plays the optimized video stream.\n\nHere is a diagram to demonstrate the core technology for the **text captions part** of the project:\n\n<img src="https://res.cloudinary.com/deepgram/image/upload/v1646946508/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/AudioTranscription.png" alt="Audio transcription diagram" style="width: 75%; margin:auto;">\n\nThe general flow for the text captions technology will be something like this:\n\nThe browser Media Streams API gets permission to use the browser microphone --> the microphone takes in an audio stream of the audio that plays from the live stream --> The Deepgram API opens a web socket channel in the browser to send the audio stream to Deepgram --> the browser receives the JSON object in return that contains the text-transcript --> Javascript puts the text onto the page as captions as the video is playing.\n\nNow that I have a high-level picture of how this project will be built, I am ready to build the barebones front-end video stream application. (In the next post in this series, I will build the Vue.js/Node.js full-stack application with added functionality.)\n\n## Setting up Open Broadcast Software\n\nThe first thing I need is software to capture my video stream on my computer. I\'ll use the [Open Broadcast Software](https://obsproject.com/).\n\n### What is OBS?\n\nFor anyone serious about streaming, OBS is a powerful tool. It is a free open source software that gives many configuration options for capturing and editing a stream. I can edit every aspect of my stream and create scenes made up of multiple sources such as images, text, etc. I can mix audio, switch between scenes with transitions, adjust the layouts, and so much more.\n\nThe stream I capture in OBS can be connected to a streaming platform such as Twitch, YouTube, or others, and it will deliver my stream to that platform; however, for this project, my goal is to stream to a web application that I make myself.\n\nOBS takes some effort to learn, but I only need to familiarize myself with a few parts of it if I\'m going to set it up to capture a stream and connect to Amazon IVS (Amazon IVS is not a streaming platform - it is more like an SDK that helps make the stream easier to handle when I build my front-end).\n\n### Set up Live Streaming with OBS\n\nTo set up OBS for my project, I will:\n\n1.  Go to [obsproject.com](https://obsproject.com/) and choose the operating system I use. I\'ll download the software.\n\n2.  Run the OBS software. In the **Sources** panel, I\'ll click the **plus** sign to add a new source. I\'ll select **Video Capture Device**, and in the window that pops up, I\'ll select the camera I want to use to capture my stream (my computer camera or webcam).\n\n<img src="https://res.cloudinary.com/deepgram/image/upload/v1646946718/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/VideoCaptureDevice.png" alt="Select Video Capture Device to add source from computer camera" style="width: 80%; margin:auto;">\n\n3.  Make sure the source is selected in the sources panel (I may have other sources that I have set up), then I\'ll click on **Settings** in the far-right **Controls** panel.\n\n4.  Select **Stream** in the left column of the window that opens up. The **Service** will remain **Custom**, but I notice that I could select a streaming platform such as Twitch or YouTube if I weren\'t planning to build my own streaming application.\n\n5.  There is nothing more to do until I create the Amazon IVS channel. But I know that later I will take the **Server** and the **Stream Key** information from Amazon IVS for the specific channel I create in the AWS console.\n\n![Stream settings](https://res.cloudinary.com/deepgram/image/upload/v1646946718/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/StreamSettings.png)\n\n## Setting up Amazon IVS\n\nIn this step, I will create an Amazon IVS channel, which is where my video stream from OBS will feed into once I connect them.\n\n### What is Amazon IVS?\n\nThe \'IVS\' in Amazon IVS stands for Interactive Video Service. The website for [Amazon IVS](https://aws.amazon.com/ivs/) describes it as a "managed live streaming solution" that I can use to send "live streams to Amazon IVS using streaming software" and "make low-latency live video available to any viewer around the world." In addition, I "can easily customize and enhance the audience experience through the Amazon IVS player SDK."\n\nSo what does this mean?\n\nThe fact is, building a video player browser can be very complicated. Amazon IVS takes away much of the challenge, allowing me to focus on the design of my front-end rather than the nitty-gritty of the video player. If I did it all without Amazon IVS, I could use the HTML native [video tag](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/video#usage_notes), but then there would be much to do to optimize the video stream that comes through (there\'s an interesting article about this [here](https://medium.com/canal-tech/how-video-streaming-works-on-the-web-an-introduction-7919739f7e1)). A developer could dedicate their entire career to getting good at building stuff that manages audio and video streams in the browser.\n\nAmazon IVS will optimize the stream to make it work for viewers watching it in my web application anywhere in the world. It also provides an SDK for the video player, which I can bring into the browser by adding a script. That script will take control of the video element in my HTML and add all the magic that Amazon IVS does under the hood. The Amazon IVS video player is built for the purpose of streaming live video, so I don\'t have to build my own complicated video player.\n\nOne important thing to consider is cost. AWS is not free, and while it is very cost-effective for a bigger streaming platform like Twitch (the Twitch streaming technology is powered by Amazon IVS), an individual developer like myself building a small project for fun might not find it to be the best option.\n\nThe good news is a new user of Amazon IVS can enjoy the free tier, which gives the following:\n\n*   Five hours of live video input for a basic channel per month\n*   100 hours of SD live video output per month\n\nThis is enough to build this project and not be charged, as long as I am careful about turning off my stream in OBS when I\'m not using it. (Yes, I did forget to do this one time and clocked several hours in Amazon IVS.) Be sure to read through the [pricing details](https://aws.amazon.com/ivs/pricing/) and be vigilant about turning off the stream when you don\'t need it to be on.\n\n### Set up Amazon IVS\n\nNow I\'ll set up a channel in Amazon IVS. The channel will take my video stream from the OBS software on my computer and make that stream available in a video player that I will bring into the browser with the Amazon IVS SDK (so many acronyms!).\n\nIn order to do this, I\'ll need to [create an AWS account](https://portal.aws.amazon.com/billing/signup). This will require billing information.\n\nIn addition, I\'ll need to set up AWS Identity and Access Management (IAM), which adds a \'policy\' to my account that allows me to create an AWS IVS channel. This is standard for doing anything in AWS - the first step is to configure IAM so that users of the AWS console have specific permissions. I am the only user of my console, so I\'m not worried about restricting any permissions in my account.\n\n[This guide](https://docs.aws.amazon.com/ivs/latest/userguide/getting-started-iam-permissions.html) walks through how to set up the IAM permissions so that a user can create an AWS IVS channel.\n\nNow I can navigate to IVS to create a channel. In the top search bar, I can type \'IVS\' to find Amazon Interactive Video Service.\n\n![AWS search bar](https://res.cloudinary.com/deepgram/image/upload/v1646946745/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/SearchBar.png)\n\nThis takes me to the Amazon IVS console. I will click the **Create channel** button to create my channel.\n\n![Click button to create IVS channel](https://res.cloudinary.com/deepgram/image/upload/v1646946808/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/CreateChannel.png)\n\nI can name my stream and stick with the **Default** configuration. Then I\'ll scroll down and click **Create channel**.\n\n![Set up IVS with default configuration](https://res.cloudinary.com/deepgram/image/upload/v1646946808/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/IVSSetup.png)\n\nThis will create the channel and then put me on that channel\'s page in the console. This is where I can configure the channel and get the information I need to connect my video stream in OBS to this channel. I need to find this section of the page:\n\n![Info about channel for OBS and video player](https://res.cloudinary.com/deepgram/image/upload/v1646946838/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/ChannelInfo.png)\n\nThere are three pieces of information I am going to need for my project. Two are to connect OBS to Amazon IVS, and one is to bring the stream from Amazon IVS (with all its optimizations) into the browser video player:\n\n*   **Ingest server** - put this in OBS settings for my stream\n*   **Stream key** - put this in OBS settings for my stream\n*   **Playback URL** - use this as the src for my script that I put in the video player\n\nI have already set up OBS, so I can just go back to the settings for my stream and add the **Ingest server** and **Stream key**. The **Playback URL** will be used later.\n\n![Stream settings](https://res.cloudinary.com/deepgram/image/upload/v1646946718/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/StreamSettings.png)\n\nNow, if I go back to the OBS controls and click on **Start Streaming**, my stream should be fed to Amazon IVS, and I am able to see it in the Amazon IVS channel page where it says **Live stream**:\n\n![Live stream in channel page](https://res.cloudinary.com/deepgram/image/upload/v1646946953/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/LiveStream.png)\n\n### Connect Front-end Video Player to Amazon IVS\n\nThe back-end is done (AWS takes care of most of the work). Now I can build the front-end, which I will do using vanilla Javascript and HTML.\n\nIn the `<head>` tag of my HTML document, I will include the script for the Amazon IVS player. Amazon IVS explains how to do this setup [here](https://docs.aws.amazon.com/ivs/latest/userguide/player-web.html), for those who want to go straight to the source.\n\n```html\n<head>\n  <meta charset="UTF-8" />\n  <title>Video Stream Demo</title>\n  <script src="https://player.live-video.net/1.6.1/amazon-ivs-player.min.js"><\/script>\n</head>\n```\n\nThis will load the IVS Player, and I will have access to the `IVSPlayer` variable in the global context. I can type that variable into the console to take a look at the module that has been loaded. There are quite a few properties that could be of use to me, depending on my project\'s needs.\n\n<img src="https://res.cloudinary.com/deepgram/image/upload/v1646946972/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/ConsoleIVSPlayer.png" alt="IVSPlayer in console" style="width: 50%; margin:auto;">\n\nIn the `<body>` tag, I will include a `<video>` player that has an `id` of `video-player` (this id can be renamed, as long as the javascript I write to find this element looks for that specific id).\n\n```html\n<body>\n  <video\n    width="520"\n    height="440"\n    id="video-player"\n    controls\n    playsinline\n  ></video>\n</body>\n```\n\nIn the browser, I see the video player, but there is no stream coming through. That is because I have only brought in the Amazon IVS player; I have not yet connected the player to my stream channel.\n\nI will use javascript to put my stream channel into the player.\n\n```js\n<script>\nif (IVSPlayer.isPlayerSupported) {\n  const player = IVSPlayer.create();\n  player.attachHTMLVideoElement(document.getElementById("video-player"));\n  player.load("PLAYBACK_URL");\n  player.play();\n}\n<\/script>\n```\n\nWhere it says `PLAYBACK_URL` in the code example, I need to put the string for my playback URL, which I can find in the Amazon IVS console for my channel.\n\n![Playback URL](https://res.cloudinary.com/deepgram/image/upload/v1646946995/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/PlaybackConfiguration.png)\n\nThen I can turn on my stream in OBS, and I should see my stream in the browser!\n\n<img src="https://res.cloudinary.com/deepgram/image/upload/v1646947012/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/StartStream.png" alt="OBS Start stream" style="width: 50%; margin:auto;">\n\n### Use Deepgram to Create Text Captions\n\nThe second part of this project, after getting the live stream video player working, is creating text captions. The captions will display what is being said in the live stream as I am streaming.\n\nI will need to do two things: use my computer\'s microphone to listen to the audio that is being outputted from the live stream, and then send that audio stream to Deepgram to turn it into a text transcription.\n\n### What is the Media Streams API?\n\nThe browser contains several APIs for working with audio and video. I need to use one that lets me **gain access to the user\'s microphone**. If I can gain that access, I can record the audio from the live stream and send it on to Deepgram to get the text transcript.\n\nThe **Media Streams API** contains many interfaces and methods for working with **audio and video data**. There is already a really great guide for how it works [here](https://blog.deepgram.com/getting-started-with-mediastream-api/), so I won\'t go over all the details. I just need to understand that the Media Streams API has so much that I can use when I\'m working with audio or video data in the browser. In fact, I\'m pretty sure the Amazon IVS SDK uses it under the hood as part of their video player.\n\n### Get Audio with Media Streams API\n\nI will use the `getUserMedia` method from this API. To get access to the user\'s microphone, I can write this javascript:\n\n```js\n<script>\n//Get access to user\'s microphone\nnavigator.mediaDevices.getUserMedia({ audio: true }).then((res) => {\n  mediaRecorder = new MediaRecorder(res, {\n    audio: true,\n  });\n});\n<\/script>\n```\n\nThis will cause the browser to ask for permission to use the microphone.\n\n<img src="https://res.cloudinary.com/deepgram/image/upload/v1646947043/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/GetMicrophone.png" alt="Request permission to use microphone" style="width: 50%; margin:auto;">\n\nIf the user gives permission, then I\'ll have access to the live stream audio to send to Deepgram.\n\n## Create Text Captions with Deepgram API\n\nIn the next step, I will use the Deepgram API to take the audio data and turn it into text.\n\n### What is Deepgram?\n\nDeepgram is an ASR technology (ASR stands for Automatic Speech Recognition). It uses pretty advanced AI and deep learning technology to take speech from audio files or streams and turn it into text. There are probably a million ways to use this technology in a project. It\'s a fun API to get comfortable with for this reason.\n\nIf I\'m going to use Deepgram in my project, I need to create an account [here](https://console.deepgram.com/signup?jump=keys). This will give me an API key and $150 in free credit, so I won\'t need to enter billing information just to get started (unlike AWS).\n\nNow I can connect to the Deepgram socket with my API key.\n\n### Connect to Deepgram to Get Transcription\n\nI want to get the transcription and display it under the video player, so I will create an HTML element for that transcript. I\'ll give it the **id** of `captions`.\n\n```html\n<p id="captions"></p>\n```\n\nI\'m going to follow the tutorial my colleague Kevin Lewis wrote about [getting live speech transcriptions in the browser](https://blog.deepgram.com/live-transcription-mic-browser/). He explains that I need to connect to Deepgram with a WebSocket. I have to make sure I have access to the microphone before I open the WebSocket, so I will put the logic to connect to Deepgram inside the `.then()` that is attached to the `getUserMedia` function call.\n\n```js\nnavigator.mediaDevices.getUserMedia({ audio: true }).then((stream) => {\n  ...\n  const socket = new WebSocket("wss://api.deepgram.com/v1/listen", [\n    "token",\n    "YOUR_KEY_HERE",\n  ]);\n});\n\n```\n\nI will put my API key where it says "YOUR\\_KEY\\_HERE".\n\nOnce the socket is open, I can add an event listener that listens for when there is audio data that has come through the microphone. When that happens, I can take that audio data and send it through the Deepgram socket to Deepgram.\n\n```js\nsocket.onopen = () => {\n  mediaRecorder.addEventListener(\'dataavailable\', async (event) => {\n    if (event.data.size > 0 && socket.readyState == 1) {\n      socket.send(event.data)\n    }\n  })\n  mediaRecorder.start(1000)\n}\n```\n\nDeepgram will send the transcribed audio back to me as text. It will come in the form of a JSON object, so I need to drill down to the `transcript` property using dot notation. I will use `document.querySelector(#captions)` to put the transcript onto the screen under the video element.\n\n```js\nsocket.onmessage = (message) => {\n  const received = JSON.parse(message.data)\n  const transcript = received.channel.alternatives[0].transcript\n  if (transcript && received.is_final) {\n    document.querySelector(\'#captions\').textContent += transcript + \' \'\n  }\n}\n```\n\nHere is all the Javascript code for building the text captions feature:\n\n```js\n    <script>\n    // Get access to user\'s microphone\n    navigator.mediaDevices.getUserMedia({ audio: true }).then((stream) => {\n      const mediaRecorder = new MediaRecorder(stream);\n\n      // Open connection to Deepgram\n      const socket = new WebSocket("wss://api.deepgram.com/v1/listen", [\n        "token",\n        "YOUR_KEY_HERE",\n      ]);\n\n      // Listen for audio data coming from microphone and send it to Deepgram\n      socket.onopen = () => {\n        mediaRecorder.addEventListener("dataavailable", async (event) => {\n          if (event.data.size > 0 && socket.readyState == 1) {\n            socket.send(event.data);\n          }\n        });\n        mediaRecorder.start(1000);\n      };\n\n      // Put the transcript onto the screen in the #captions element\n      socket.onmessage = (message) => {\n        const received = JSON.parse(message.data);\n        const transcript = received.channel.alternatives[0].transcript;\n        if (transcript && received.is_final) {\n          document.querySelector("#captions").textContent += transcript + " ";\n        }\n      };\n\n      socket.onclose = () => {\n        console.log({ event: "onclose" });\n      };\n\n      socket.onerror = (error) => {\n        console.log({ event: "onerror", error });\n      };\n    });\n    <\/script>\n```\n\nAnd here is the HTML:\n\n```html\n<html lang="en">\n  <head>\n    <meta charset="UTF-8" />\n    <title>Video Stream Demo</title>\n    {/*<!-- Amazon IVS SDK video player -->*/}\n    <script src="https://player.live-video.net/1.6.1/amazon-ivs-player.min.js"><\/script>\n  </head>\n  <body>\n    <video\n      width="520"\n      height="440"\n      id="video-player"\n      controls\n      playsinline\n    ></video>\n    <p id="captions"></p>\n    {/*<!-- scripts -->*/}\n  </body>\n</html>\n```\n\nNow I can start my live stream, and the text captions will be displayed under the video player!\n\n## Conclusion\n\nIn this tutorial, I built a \'vanilla\' live stream player with text captions. I demonstrated how to use the technologies Amazon IVS and Deepgram using fundamentals of web development - HTML and Javascript. You can find the repo for this vanilla Javascript project [here](https://github.com/deepgram-devs/deepgram-livestream-javascript).\n\nBut most front-end developers rely on frameworks to build projects like these. And there are other considerations I need to make in regards to keeping my Deepgram API key secure and limiting who has access to this website.\n\nIn the next part of the series, **I will improve this project by building it using Vue.js (specifically Vue 3) for the front-end, and node.js for the back-end**. I will include some of the real-world practices for building a full-stack application. I\'ll need a server file so I can incorporate more security, which I\'ll build with node.js, and I\'ll build an entry page with VueRouter navigation guards so that users must enter a code to see my live stream.\n\nVue.js is my favorite Javascript framework, and I have written a series on [Diving Into Vue 3](https://blog.deepgram.com/diving-into-vue-3-setup-function/), which is worth checking out if you want to come along with me for the rest of this series to build a full-stack live stream application in Vue.js.\n\nPlease follow me on [Twitter](https://twitter.com/sandra_rodgers_) if you find my tutorials useful!\n\n        ';
}
function compiledContent() {
  return '<p>In this series, I will build a live streaming web application with text captions. Companies such as Twitch, StreamYard, Facebook Live, and many others provide live streaming on the web as a product, so I got curious about how I might go about building my own version.</p>\n<Panel type="info" title="Build a Live Streaming Web Application with Amazon IVS and Deepgram (SERIES)"><ol><li><a href="https://blog.deepgram.com/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/">How to Build a Live Streaming Web Application with Amazon IVS and Deepgram</a></li>\n<li><a href="https://blog.deepgram.com/build-a-livestream-web-application-vue-and-express-setup/"> Build a Live Streaming Web Application: Vue and Express Setup</a></li>\n<li><a href="https://blog.deepgram.com/how-to-write-vue-3-composables-for-a-third-party-API-integration/"> How to Write Vue 3 Composables for a Third-Party API Integration</a></li><li><a href="https://blog.deepgram.com/asynchronous-logic-to-write-a-vue-3-and-deepgram-captions-component/"> Asynchronous Logic to Write a Vue 3 and Deepgram Captions Component</a></li></ol></Panel>\n<p>The main technologies I will use to build the live stream and text captions functionality are:</p>\n<ul>\n<li><strong>Open Broadcast Software</strong> - an open-source software used to capture video streams</li>\n<li><strong>Amazon IVS</strong> - an AWS service that can receive a video stream from OBS and put that stream into the browser, optimizing the entire process</li>\n<li><strong>Deepgram</strong> - a speech-to-text API that can receive an audio stream and return a text-transcript</li>\n</ul>\n<p>I will build two versions of this project. I\u2019ll use the following to build each project:</p>\n<ol>\n<li>\n<p><strong>HTML/Javascript</strong> - The first version I build (the <strong>vanilla version</strong>) will be focused on creating a <strong>front-end</strong> with a very limited back-end, emphasizing the most barebones approach to getting the application working.</p>\n</li>\n<li>\n<p><strong>Vue.js/Node.js</strong> - For the second version (the <strong>framework version</strong>), I will use Vue.js, a Javascript framework that gives me the tools I need to more easily include important features for security like routing and navigation guards. I will build a <strong>full-stack</strong> video streaming application with a <strong>node.js</strong> server to help me add a layer of security for some of the data I need to protect.</p>\n</li>\n</ol>\n<p>Here is a gif to demonstrate the final project:</p>\n<img src="https://res.cloudinary.com/deepgram/image/upload/v1646946089/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/VideoExample.gif" alt="demo of final project" style="width: 75%; margin:auto;" />\n<h2 id="project-one-vanilla-video-stream-player">Project One: Vanilla Video Stream Player</h2>\n<p>Now I\u2019ll start by building the first version of the project. I\u2019ll build a \u2018vanilla\u2019 video streaming player in the sense that I will only use HTML and Javascript on the front-end, and the only back-end will be the work I do to get Amazon IVS set up to receive the OBS stream.</p>\n<p>I want to keep it as simple as possible, focusing on how to build a <strong>video streaming player in the browser that includes text captions</strong>. This means I will not take into account real-world requirements such as hiding API keys or creating an entry page to restrict access to the video stream. Later, in the Vue.js version I build, I\u2019ll add those pieces, but to start, I just want to get the video player working - I want it to play my live stream and display text captions for what I\u2019m saying as I stream to viewers.</p>\n<p>Here is a diagram to demonstrate the core technology for the <strong>video streaming part</strong> of the project:</p>\n<img src="https://res.cloudinary.com/deepgram/image/upload/v1646946508/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/VideoStream.png" alt="Video stream diagram" style="width: 75%; margin:auto;" />\n<p>The diagram presents this flow: the webcam takes in the video stream \u2014> OBS captures that video stream so it can be sent along to Amazon IVS \u2014> Amazon IVS provides a service to take in the stream, optimize it, and send it in a format to the browser so that it can be used in an HTML video player \u2014> the HTML video element plays the optimized video stream.</p>\n<p>Here is a diagram to demonstrate the core technology for the <strong>text captions part</strong> of the project:</p>\n<img src="https://res.cloudinary.com/deepgram/image/upload/v1646946508/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/AudioTranscription.png" alt="Audio transcription diagram" style="width: 75%; margin:auto;" />\n<p>The general flow for the text captions technology will be something like this:</p>\n<p>The browser Media Streams API gets permission to use the browser microphone \u2014> the microphone takes in an audio stream of the audio that plays from the live stream \u2014> The Deepgram API opens a web socket channel in the browser to send the audio stream to Deepgram \u2014> the browser receives the JSON object in return that contains the text-transcript \u2014> Javascript puts the text onto the page as captions as the video is playing.</p>\n<p>Now that I have a high-level picture of how this project will be built, I am ready to build the barebones front-end video stream application. (In the next post in this series, I will build the Vue.js/Node.js full-stack application with added functionality.)</p>\n<h2 id="setting-up-open-broadcast-software">Setting up Open Broadcast Software</h2>\n<p>The first thing I need is software to capture my video stream on my computer. I\u2019ll use the <a href="https://obsproject.com/">Open Broadcast Software</a>.</p>\n<h3 id="what-is-obs">What is OBS?</h3>\n<p>For anyone serious about streaming, OBS is a powerful tool. It is a free open source software that gives many configuration options for capturing and editing a stream. I can edit every aspect of my stream and create scenes made up of multiple sources such as images, text, etc. I can mix audio, switch between scenes with transitions, adjust the layouts, and so much more.</p>\n<p>The stream I capture in OBS can be connected to a streaming platform such as Twitch, YouTube, or others, and it will deliver my stream to that platform; however, for this project, my goal is to stream to a web application that I make myself.</p>\n<p>OBS takes some effort to learn, but I only need to familiarize myself with a few parts of it if I\u2019m going to set it up to capture a stream and connect to Amazon IVS (Amazon IVS is not a streaming platform - it is more like an SDK that helps make the stream easier to handle when I build my front-end).</p>\n<h3 id="set-up-live-streaming-with-obs">Set up Live Streaming with OBS</h3>\n<p>To set up OBS for my project, I will:</p>\n<ol>\n<li>\n<p>Go to <a href="https://obsproject.com/">obsproject.com</a> and choose the operating system I use. I\u2019ll download the software.</p>\n</li>\n<li>\n<p>Run the OBS software. In the <strong>Sources</strong> panel, I\u2019ll click the <strong>plus</strong> sign to add a new source. I\u2019ll select <strong>Video Capture Device</strong>, and in the window that pops up, I\u2019ll select the camera I want to use to capture my stream (my computer camera or webcam).</p>\n</li>\n</ol>\n<img src="https://res.cloudinary.com/deepgram/image/upload/v1646946718/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/VideoCaptureDevice.png" alt="Select Video Capture Device to add source from computer camera" style="width: 80%; margin:auto;" />\n<ol start="3">\n<li>\n<p>Make sure the source is selected in the sources panel (I may have other sources that I have set up), then I\u2019ll click on <strong>Settings</strong> in the far-right <strong>Controls</strong> panel.</p>\n</li>\n<li>\n<p>Select <strong>Stream</strong> in the left column of the window that opens up. The <strong>Service</strong> will remain <strong>Custom</strong>, but I notice that I could select a streaming platform such as Twitch or YouTube if I weren\u2019t planning to build my own streaming application.</p>\n</li>\n<li>\n<p>There is nothing more to do until I create the Amazon IVS channel. But I know that later I will take the <strong>Server</strong> and the <strong>Stream Key</strong> information from Amazon IVS for the specific channel I create in the AWS console.</p>\n</li>\n</ol>\n<p><img src="https://res.cloudinary.com/deepgram/image/upload/v1646946718/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/StreamSettings.png" alt="Stream settings"></p>\n<h2 id="setting-up-amazon-ivs">Setting up Amazon IVS</h2>\n<p>In this step, I will create an Amazon IVS channel, which is where my video stream from OBS will feed into once I connect them.</p>\n<h3 id="what-is-amazon-ivs">What is Amazon IVS?</h3>\n<p>The \u2018IVS\u2019 in Amazon IVS stands for Interactive Video Service. The website for <a href="https://aws.amazon.com/ivs/">Amazon IVS</a> describes it as a \u201Cmanaged live streaming solution\u201D that I can use to send \u201Clive streams to Amazon IVS using streaming software\u201D and \u201Cmake low-latency live video available to any viewer around the world.\u201D In addition, I \u201Ccan easily customize and enhance the audience experience through the Amazon IVS player SDK.\u201D</p>\n<p>So what does this mean?</p>\n<p>The fact is, building a video player browser can be very complicated. Amazon IVS takes away much of the challenge, allowing me to focus on the design of my front-end rather than the nitty-gritty of the video player. If I did it all without Amazon IVS, I could use the HTML native <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/video#usage_notes">video tag</a>, but then there would be much to do to optimize the video stream that comes through (there\u2019s an interesting article about this <a href="https://medium.com/canal-tech/how-video-streaming-works-on-the-web-an-introduction-7919739f7e1">here</a>). A developer could dedicate their entire career to getting good at building stuff that manages audio and video streams in the browser.</p>\n<p>Amazon IVS will optimize the stream to make it work for viewers watching it in my web application anywhere in the world. It also provides an SDK for the video player, which I can bring into the browser by adding a script. That script will take control of the video element in my HTML and add all the magic that Amazon IVS does under the hood. The Amazon IVS video player is built for the purpose of streaming live video, so I don\u2019t have to build my own complicated video player.</p>\n<p>One important thing to consider is cost. AWS is not free, and while it is very cost-effective for a bigger streaming platform like Twitch (the Twitch streaming technology is powered by Amazon IVS), an individual developer like myself building a small project for fun might not find it to be the best option.</p>\n<p>The good news is a new user of Amazon IVS can enjoy the free tier, which gives the following:</p>\n<ul>\n<li>Five hours of live video input for a basic channel per month</li>\n<li>100 hours of SD live video output per month</li>\n</ul>\n<p>This is enough to build this project and not be charged, as long as I am careful about turning off my stream in OBS when I\u2019m not using it. (Yes, I did forget to do this one time and clocked several hours in Amazon IVS.) Be sure to read through the <a href="https://aws.amazon.com/ivs/pricing/">pricing details</a> and be vigilant about turning off the stream when you don\u2019t need it to be on.</p>\n<h3 id="set-up-amazon-ivs">Set up Amazon IVS</h3>\n<p>Now I\u2019ll set up a channel in Amazon IVS. The channel will take my video stream from the OBS software on my computer and make that stream available in a video player that I will bring into the browser with the Amazon IVS SDK (so many acronyms!).</p>\n<p>In order to do this, I\u2019ll need to <a href="https://portal.aws.amazon.com/billing/signup">create an AWS account</a>. This will require billing information.</p>\n<p>In addition, I\u2019ll need to set up AWS Identity and Access Management (IAM), which adds a \u2018policy\u2019 to my account that allows me to create an AWS IVS channel. This is standard for doing anything in AWS - the first step is to configure IAM so that users of the AWS console have specific permissions. I am the only user of my console, so I\u2019m not worried about restricting any permissions in my account.</p>\n<p><a href="https://docs.aws.amazon.com/ivs/latest/userguide/getting-started-iam-permissions.html">This guide</a> walks through how to set up the IAM permissions so that a user can create an AWS IVS channel.</p>\n<p>Now I can navigate to IVS to create a channel. In the top search bar, I can type \u2018IVS\u2019 to find Amazon Interactive Video Service.</p>\n<p><img src="https://res.cloudinary.com/deepgram/image/upload/v1646946745/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/SearchBar.png" alt="AWS search bar"></p>\n<p>This takes me to the Amazon IVS console. I will click the <strong>Create channel</strong> button to create my channel.</p>\n<p><img src="https://res.cloudinary.com/deepgram/image/upload/v1646946808/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/CreateChannel.png" alt="Click button to create IVS channel"></p>\n<p>I can name my stream and stick with the <strong>Default</strong> configuration. Then I\u2019ll scroll down and click <strong>Create channel</strong>.</p>\n<p><img src="https://res.cloudinary.com/deepgram/image/upload/v1646946808/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/IVSSetup.png" alt="Set up IVS with default configuration"></p>\n<p>This will create the channel and then put me on that channel\u2019s page in the console. This is where I can configure the channel and get the information I need to connect my video stream in OBS to this channel. I need to find this section of the page:</p>\n<p><img src="https://res.cloudinary.com/deepgram/image/upload/v1646946838/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/ChannelInfo.png" alt="Info about channel for OBS and video player"></p>\n<p>There are three pieces of information I am going to need for my project. Two are to connect OBS to Amazon IVS, and one is to bring the stream from Amazon IVS (with all its optimizations) into the browser video player:</p>\n<ul>\n<li><strong>Ingest server</strong> - put this in OBS settings for my stream</li>\n<li><strong>Stream key</strong> - put this in OBS settings for my stream</li>\n<li><strong>Playback URL</strong> - use this as the src for my script that I put in the video player</li>\n</ul>\n<p>I have already set up OBS, so I can just go back to the settings for my stream and add the <strong>Ingest server</strong> and <strong>Stream key</strong>. The <strong>Playback URL</strong> will be used later.</p>\n<p><img src="https://res.cloudinary.com/deepgram/image/upload/v1646946718/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/StreamSettings.png" alt="Stream settings"></p>\n<p>Now, if I go back to the OBS controls and click on <strong>Start Streaming</strong>, my stream should be fed to Amazon IVS, and I am able to see it in the Amazon IVS channel page where it says <strong>Live stream</strong>:</p>\n<p><img src="https://res.cloudinary.com/deepgram/image/upload/v1646946953/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/LiveStream.png" alt="Live stream in channel page"></p>\n<h3 id="connect-front-end-video-player-to-amazon-ivs">Connect Front-end Video Player to Amazon IVS</h3>\n<p>The back-end is done (AWS takes care of most of the work). Now I can build the front-end, which I will do using vanilla Javascript and HTML.</p>\n<p>In the <code is:raw>&lt;head&gt;</code> tag of my HTML document, I will include the script for the Amazon IVS player. Amazon IVS explains how to do this setup <a href="https://docs.aws.amazon.com/ivs/latest/userguide/player-web.html">here</a>, for those who want to go straight to the source.</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">head</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">meta</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">charset</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;UTF-8&quot;</span><span style="color: #C9D1D9"> /&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">title</span><span style="color: #C9D1D9">&gt;Video Stream Demo&lt;/</span><span style="color: #7EE787">title</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">src</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;https://player.live-video.net/1.6.1/amazon-ivs-player.min.js&quot;</span><span style="color: #C9D1D9">&gt;&lt;/</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">&lt;/</span><span style="color: #7EE787">head</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>\n<p>This will load the IVS Player, and I will have access to the <code is:raw>IVSPlayer</code> variable in the global context. I can type that variable into the console to take a look at the module that has been loaded. There are quite a few properties that could be of use to me, depending on my project\u2019s needs.</p>\n<img src="https://res.cloudinary.com/deepgram/image/upload/v1646946972/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/ConsoleIVSPlayer.png" alt="IVSPlayer in console" style="width: 50%; margin:auto;" />\n<p>In the <code is:raw>&lt;body&gt;</code> tag, I will include a <code is:raw>&lt;video&gt;</code> player that has an <code is:raw>id</code> of <code is:raw>video-player</code> (this id can be renamed, as long as the javascript I write to find this element looks for that specific id).</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">body</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">video</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">width</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;520&quot;</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">height</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;440&quot;</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">id</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;video-player&quot;</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">controls</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">playsinline</span></span>\n<span class="line"><span style="color: #C9D1D9">  &gt;&lt;/</span><span style="color: #7EE787">video</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">&lt;/</span><span style="color: #7EE787">body</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>\n<p>In the browser, I see the video player, but there is no stream coming through. That is because I have only brought in the Amazon IVS player; I have not yet connected the player to my stream channel.</p>\n<p>I will use javascript to put my stream channel into the player.</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">if (IVSPlayer.isPlayerSupported) </span><span style="color: #FF7B72">{</span></span>\n<span class="line"><span style="color: #C9D1D9">  const player </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> IVSPlayer.</span><span style="color: #D2A8FF">create</span><span style="color: #C9D1D9">();</span></span>\n<span class="line"><span style="color: #C9D1D9">  player.</span><span style="color: #D2A8FF">attachHTMLVideoElement</span><span style="color: #C9D1D9">(document.</span><span style="color: #D2A8FF">getElementById</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&quot;video-player&quot;</span><span style="color: #C9D1D9">));</span></span>\n<span class="line"><span style="color: #C9D1D9">  player.</span><span style="color: #D2A8FF">load</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&quot;PLAYBACK_URL&quot;</span><span style="color: #C9D1D9">);</span></span>\n<span class="line"><span style="color: #C9D1D9">  player.</span><span style="color: #D2A8FF">play</span><span style="color: #C9D1D9">();</span></span>\n<span class="line"><span style="color: #FF7B72">}</span></span>\n<span class="line"><span style="color: #C9D1D9">&lt;/</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>\n<p>Where it says <code is:raw>PLAYBACK_URL</code> in the code example, I need to put the string for my playback URL, which I can find in the Amazon IVS console for my channel.</p>\n<p><img src="https://res.cloudinary.com/deepgram/image/upload/v1646946995/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/PlaybackConfiguration.png" alt="Playback URL"></p>\n<p>Then I can turn on my stream in OBS, and I should see my stream in the browser!</p>\n<img src="https://res.cloudinary.com/deepgram/image/upload/v1646947012/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/StartStream.png" alt="OBS Start stream" style="width: 50%; margin:auto;" />\n<h3 id="use-deepgram-to-create-text-captions">Use Deepgram to Create Text Captions</h3>\n<p>The second part of this project, after getting the live stream video player working, is creating text captions. The captions will display what is being said in the live stream as I am streaming.</p>\n<p>I will need to do two things: use my computer\u2019s microphone to listen to the audio that is being outputted from the live stream, and then send that audio stream to Deepgram to turn it into a text transcription.</p>\n<h3 id="what-is-the-media-streams-api">What is the Media Streams API?</h3>\n<p>The browser contains several APIs for working with audio and video. I need to use one that lets me <strong>gain access to the user\u2019s microphone</strong>. If I can gain that access, I can record the audio from the live stream and send it on to Deepgram to get the text transcript.</p>\n<p>The <strong>Media Streams API</strong> contains many interfaces and methods for working with <strong>audio and video data</strong>. There is already a really great guide for how it works <a href="https://blog.deepgram.com/getting-started-with-mediastream-api/">here</a>, so I won\u2019t go over all the details. I just need to understand that the Media Streams API has so much that I can use when I\u2019m working with audio or video data in the browser. In fact, I\u2019m pretty sure the Amazon IVS SDK uses it under the hood as part of their video player.</p>\n<h3 id="get-audio-with-media-streams-api">Get Audio with Media Streams API</h3>\n<p>I will use the <code is:raw>getUserMedia</code> method from this API. To get access to the user\u2019s microphone, I can write this javascript:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">//Get access to user&#39;s microphone</span></span>\n<span class="line"><span style="color: #C9D1D9">navigator.mediaDevices.getUserMedia(</span><span style="color: #FF7B72">{</span><span style="color: #C9D1D9"> audio: </span><span style="color: #79C0FF">true</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">}</span><span style="color: #C9D1D9">).then((res) =&gt; </span><span style="color: #FF7B72">{</span></span>\n<span class="line"><span style="color: #C9D1D9">  mediaRecorder </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">MediaRecorder</span><span style="color: #C9D1D9">(res, {</span></span>\n<span class="line"><span style="color: #C9D1D9">    audio: </span><span style="color: #79C0FF">true</span><span style="color: #C9D1D9">,</span></span>\n<span class="line"><span style="color: #C9D1D9">  });</span></span>\n<span class="line"><span style="color: #FF7B72">}</span><span style="color: #C9D1D9">);</span></span>\n<span class="line"><span style="color: #C9D1D9">&lt;/</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>\n<p>This will cause the browser to ask for permission to use the microphone.</p>\n<img src="https://res.cloudinary.com/deepgram/image/upload/v1646947043/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/GetMicrophone.png" alt="Request permission to use microphone" style="width: 50%; margin:auto;" />\n<p>If the user gives permission, then I\u2019ll have access to the live stream audio to send to Deepgram.</p>\n<h2 id="create-text-captions-with-deepgram-api">Create Text Captions with Deepgram API</h2>\n<p>In the next step, I will use the Deepgram API to take the audio data and turn it into text.</p>\n<h3 id="what-is-deepgram">What is Deepgram?</h3>\n<p>Deepgram is an ASR technology (ASR stands for Automatic Speech Recognition). It uses pretty advanced AI and deep learning technology to take speech from audio files or streams and turn it into text. There are probably a million ways to use this technology in a project. It\u2019s a fun API to get comfortable with for this reason.</p>\n<p>If I\u2019m going to use Deepgram in my project, I need to create an account <a href="https://console.deepgram.com/signup?jump=keys">here</a>. This will give me an API key and $150 in free credit, so I won\u2019t need to enter billing information just to get started (unlike AWS).</p>\n<p>Now I can connect to the Deepgram socket with my API key.</p>\n<h3 id="connect-to-deepgram-to-get-transcription">Connect to Deepgram to Get Transcription</h3>\n<p>I want to get the transcription and display it under the video player, so I will create an HTML element for that transcript. I\u2019ll give it the <strong>id</strong> of <code is:raw>captions</code>.</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">p</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">id</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;captions&quot;</span><span style="color: #C9D1D9">&gt;&lt;/</span><span style="color: #7EE787">p</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>\n<p>I\u2019m going to follow the tutorial my colleague Kevin Lewis wrote about <a href="https://blog.deepgram.com/live-transcription-mic-browser/">getting live speech transcriptions in the browser</a>. He explains that I need to connect to Deepgram with a WebSocket. I have to make sure I have access to the microphone before I open the WebSocket, so I will put the logic to connect to Deepgram inside the <code is:raw>.then()</code> that is attached to the <code is:raw>getUserMedia</code> function call.</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">navigator.mediaDevices.</span><span style="color: #D2A8FF">getUserMedia</span><span style="color: #C9D1D9">({ audio: </span><span style="color: #79C0FF">true</span><span style="color: #C9D1D9"> }).</span><span style="color: #D2A8FF">then</span><span style="color: #C9D1D9">((</span><span style="color: #FFA657">stream</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">...</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">socket</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">WebSocket</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&quot;wss://api.deepgram.com/v1/listen&quot;</span><span style="color: #C9D1D9">, [</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #A5D6FF">&quot;token&quot;</span><span style="color: #C9D1D9">,</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #A5D6FF">&quot;YOUR_KEY_HERE&quot;</span><span style="color: #C9D1D9">,</span></span>\n<span class="line"><span style="color: #C9D1D9">  ]);</span></span>\n<span class="line"><span style="color: #C9D1D9">});</span></span>\n<span class="line"></span></code></pre>\n<p>I will put my API key where it says \u201CYOUR_KEY_HERE\u201D.</p>\n<p>Once the socket is open, I can add an event listener that listens for when there is audio data that has come through the microphone. When that happens, I can take that audio data and send it through the Deepgram socket to Deepgram.</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">socket.</span><span style="color: #D2A8FF">onopen</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">  mediaRecorder.</span><span style="color: #D2A8FF">addEventListener</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;dataavailable&#39;</span><span style="color: #C9D1D9">, </span><span style="color: #FF7B72">async</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">event</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (event.data.size </span><span style="color: #FF7B72">&gt;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">&amp;&amp;</span><span style="color: #C9D1D9"> socket.readyState </span><span style="color: #FF7B72">==</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">1</span><span style="color: #C9D1D9">) {</span></span>\n<span class="line"><span style="color: #C9D1D9">      socket.</span><span style="color: #D2A8FF">send</span><span style="color: #C9D1D9">(event.data)</span></span>\n<span class="line"><span style="color: #C9D1D9">    }</span></span>\n<span class="line"><span style="color: #C9D1D9">  })</span></span>\n<span class="line"><span style="color: #C9D1D9">  mediaRecorder.</span><span style="color: #D2A8FF">start</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">1000</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #C9D1D9">}</span></span></code></pre>\n<p>Deepgram will send the transcribed audio back to me as text. It will come in the form of a JSON object, so I need to drill down to the <code is:raw>transcript</code> property using dot notation. I will use <code is:raw>document.querySelector(#captions)</code> to put the transcript onto the screen under the video element.</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">socket.</span><span style="color: #D2A8FF">onmessage</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">message</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">received</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">JSON</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">parse</span><span style="color: #C9D1D9">(message.data)</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">transcript</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> received.channel.alternatives[</span><span style="color: #79C0FF">0</span><span style="color: #C9D1D9">].transcript</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (transcript </span><span style="color: #FF7B72">&amp;&amp;</span><span style="color: #C9D1D9"> received.is_final) {</span></span>\n<span class="line"><span style="color: #C9D1D9">    document.</span><span style="color: #D2A8FF">querySelector</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;#captions&#39;</span><span style="color: #C9D1D9">).textContent </span><span style="color: #FF7B72">+=</span><span style="color: #C9D1D9"> transcript </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39; &#39;</span></span>\n<span class="line"><span style="color: #C9D1D9">  }</span></span>\n<span class="line"><span style="color: #C9D1D9">}</span></span></code></pre>\n<p>Here is all the Javascript code for building the text captions feature:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">    // Get access to user&#39;s microphone</span></span>\n<span class="line"><span style="color: #C9D1D9">    navigator.mediaDevices.getUserMedia(</span><span style="color: #FF7B72">{</span><span style="color: #C9D1D9"> audio: </span><span style="color: #79C0FF">true</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">}</span><span style="color: #C9D1D9">).then((stream) =&gt; </span><span style="color: #FF7B72">{</span></span>\n<span class="line"><span style="color: #C9D1D9">      const mediaRecorder </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">MediaRecorder</span><span style="color: #C9D1D9">(stream);</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #8B949E">// Open connection to Deepgram</span></span>\n<span class="line"><span style="color: #C9D1D9">      const socket </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">WebSocket</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&quot;wss://api.deepgram.com/v1/listen&quot;</span><span style="color: #C9D1D9">, [</span></span>\n<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #A5D6FF">&quot;token&quot;</span><span style="color: #C9D1D9">,</span></span>\n<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #A5D6FF">&quot;YOUR_KEY_HERE&quot;</span><span style="color: #C9D1D9">,</span></span>\n<span class="line"><span style="color: #C9D1D9">      ]);</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #8B949E">// Listen for audio data coming from microphone and send it to Deepgram</span></span>\n<span class="line"><span style="color: #C9D1D9">      socket.</span><span style="color: #D2A8FF">onopen</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">        mediaRecorder.</span><span style="color: #D2A8FF">addEventListener</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&quot;dataavailable&quot;</span><span style="color: #C9D1D9">, </span><span style="color: #FF7B72">async</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">event</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">          </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (event.data.size </span><span style="color: #FF7B72">&gt;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">&amp;&amp;</span><span style="color: #C9D1D9"> socket.readyState </span><span style="color: #FF7B72">==</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">1</span><span style="color: #C9D1D9">) {</span></span>\n<span class="line"><span style="color: #C9D1D9">            socket.</span><span style="color: #D2A8FF">send</span><span style="color: #C9D1D9">(event.data);</span></span>\n<span class="line"><span style="color: #C9D1D9">          }</span></span>\n<span class="line"><span style="color: #C9D1D9">        });</span></span>\n<span class="line"><span style="color: #C9D1D9">        mediaRecorder.</span><span style="color: #D2A8FF">start</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">1000</span><span style="color: #C9D1D9">);</span></span>\n<span class="line"><span style="color: #C9D1D9">      };</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #8B949E">// Put the transcript onto the screen in the #captions element</span></span>\n<span class="line"><span style="color: #C9D1D9">      socket.</span><span style="color: #D2A8FF">onmessage</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">message</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">received</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">JSON</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">parse</span><span style="color: #C9D1D9">(message.data);</span></span>\n<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">transcript</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> received.channel.alternatives[</span><span style="color: #79C0FF">0</span><span style="color: #C9D1D9">].transcript;</span></span>\n<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (transcript </span><span style="color: #FF7B72">&amp;&amp;</span><span style="color: #C9D1D9"> received.is_final) {</span></span>\n<span class="line"><span style="color: #C9D1D9">          document.</span><span style="color: #D2A8FF">querySelector</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&quot;#captions&quot;</span><span style="color: #C9D1D9">).textContent </span><span style="color: #FF7B72">+=</span><span style="color: #C9D1D9"> transcript </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&quot; &quot;</span><span style="color: #C9D1D9">;</span></span>\n<span class="line"><span style="color: #C9D1D9">        }</span></span>\n<span class="line"><span style="color: #C9D1D9">      };</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">      socket.</span><span style="color: #D2A8FF">onclose</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">        console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">({ event: </span><span style="color: #A5D6FF">&quot;onclose&quot;</span><span style="color: #C9D1D9"> });</span></span>\n<span class="line"><span style="color: #C9D1D9">      };</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">      socket.</span><span style="color: #D2A8FF">onerror</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">error</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">        console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">({ event: </span><span style="color: #A5D6FF">&quot;onerror&quot;</span><span style="color: #C9D1D9">, error });</span></span>\n<span class="line"><span style="color: #C9D1D9">      };</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">}</span><span style="color: #C9D1D9">);</span></span>\n<span class="line"><span style="color: #C9D1D9">    &lt;/</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>\n<p>And here is the HTML:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">html</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">lang</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;en&quot;</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">head</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">meta</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">charset</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;UTF-8&quot;</span><span style="color: #C9D1D9"> /&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">title</span><span style="color: #C9D1D9">&gt;Video Stream Demo&lt;/</span><span style="color: #7EE787">title</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #8B949E">&lt;!-- Amazon IVS SDK video player --&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">src</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;https://player.live-video.net/1.6.1/amazon-ivs-player.min.js&quot;</span><span style="color: #C9D1D9">&gt;&lt;/</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;/</span><span style="color: #7EE787">head</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">body</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">video</span></span>\n<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">width</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;520&quot;</span></span>\n<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">height</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;440&quot;</span></span>\n<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">id</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;video-player&quot;</span></span>\n<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">controls</span></span>\n<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">playsinline</span></span>\n<span class="line"><span style="color: #C9D1D9">    &gt;&lt;/</span><span style="color: #7EE787">video</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">p</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">id</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;captions&quot;</span><span style="color: #C9D1D9">&gt;&lt;/</span><span style="color: #7EE787">p</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #8B949E">&lt;!-- scripts --&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;/</span><span style="color: #7EE787">body</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">&lt;/</span><span style="color: #7EE787">html</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>\n<p>Now I can start my live stream, and the text captions will be displayed under the video player!</p>\n<h2 id="conclusion">Conclusion</h2>\n<p>In this tutorial, I built a \u2018vanilla\u2019 live stream player with text captions. I demonstrated how to use the technologies Amazon IVS and Deepgram using fundamentals of web development - HTML and Javascript. You can find the repo for this vanilla Javascript project <a href="https://github.com/deepgram-devs/deepgram-livestream-javascript">here</a>.</p>\n<p>But most front-end developers rely on frameworks to build projects like these. And there are other considerations I need to make in regards to keeping my Deepgram API key secure and limiting who has access to this website.</p>\n<p>In the next part of the series, <strong>I will improve this project by building it using Vue.js (specifically Vue 3) for the front-end, and node.js for the back-end</strong>. I will include some of the real-world practices for building a full-stack application. I\u2019ll need a server file so I can incorporate more security, which I\u2019ll build with node.js, and I\u2019ll build an entry page with VueRouter navigation guards so that users must enter a code to see my live stream.</p>\n<p>Vue.js is my favorite Javascript framework, and I have written a series on <a href="https://blog.deepgram.com/diving-into-vue-3-setup-function/">Diving Into Vue 3</a>, which is worth checking out if you want to come along with me for the rest of this series to build a full-stack live stream application in Vue.js.</p>\n<p>Please follow me on <a href="https://twitter.com/sandra_rodgers_">Twitter</a> if you find my tutorials useful!</p>';
}
const $$Astro = createAstro("/Users/sandrarodgers/web-next/blog/src/content/blog/posts/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/index.md", "https://blog.deepgram.com/", "file:///Users/sandrarodgers/web-next/blog/");
const $$Index = createComponent(async ($$result, $$props, $$slots) => {
  const Astro2 = $$result.createAstro($$Astro, $$props, $$slots);
  Astro2.self = $$Index;
  new Slugger();
  return renderTemplate`<head>${renderHead($$result)}</head><p>In this series, I will build a live streaming web application with text captions. Companies such as Twitch, StreamYard, Facebook Live, and many others provide live streaming on the web as a product, so I got curious about how I might go about building my own version.</p>
${renderComponent($$result, "Panel", Panel, { "type": "info", "title": "Build a Live Streaming Web Application with Amazon IVS and Deepgram (SERIES)" }, { "default": () => renderTemplate`<ol><li><a href="https://blog.deepgram.com/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/">How to Build a Live Streaming Web Application with Amazon IVS and Deepgram</a></li>
<li><a href="https://blog.deepgram.com/build-a-livestream-web-application-vue-and-express-setup/"> Build a Live Streaming Web Application: Vue and Express Setup</a></li>
<li><a href="https://blog.deepgram.com/how-to-write-vue-3-composables-for-a-third-party-API-integration/"> How to Write Vue 3 Composables for a Third-Party API Integration</a></li><li><a href="https://blog.deepgram.com/asynchronous-logic-to-write-a-vue-3-and-deepgram-captions-component/"> Asynchronous Logic to Write a Vue 3 and Deepgram Captions Component</a></li></ol>` })}
<p>The main technologies I will use to build the live stream and text captions functionality are:</p>
<ul>
<li><strong>Open Broadcast Software</strong> - an open-source software used to capture video streams</li>
<li><strong>Amazon IVS</strong> - an AWS service that can receive a video stream from OBS and put that stream into the browser, optimizing the entire process</li>
<li><strong>Deepgram</strong> - a speech-to-text API that can receive an audio stream and return a text-transcript</li>
</ul>
<p>I will build two versions of this project. I’ll use the following to build each project:</p>
<ol>
<li>
<p><strong>HTML/Javascript</strong> - The first version I build (the <strong>vanilla version</strong>) will be focused on creating a <strong>front-end</strong> with a very limited back-end, emphasizing the most barebones approach to getting the application working.</p>
</li>
<li>
<p><strong>Vue.js/Node.js</strong> - For the second version (the <strong>framework version</strong>), I will use Vue.js, a Javascript framework that gives me the tools I need to more easily include important features for security like routing and navigation guards. I will build a <strong>full-stack</strong> video streaming application with a <strong>node.js</strong> server to help me add a layer of security for some of the data I need to protect.</p>
</li>
</ol>
<p>Here is a gif to demonstrate the final project:</p>
<img src="https://res.cloudinary.com/deepgram/image/upload/v1646946089/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/VideoExample.gif" alt="demo of final project" style="width: 75%; margin:auto;">
<h2 id="project-one-vanilla-video-stream-player">Project One: Vanilla Video Stream Player</h2>
<p>Now I’ll start by building the first version of the project. I’ll build a ‘vanilla’ video streaming player in the sense that I will only use HTML and Javascript on the front-end, and the only back-end will be the work I do to get Amazon IVS set up to receive the OBS stream.</p>
<p>I want to keep it as simple as possible, focusing on how to build a <strong>video streaming player in the browser that includes text captions</strong>. This means I will not take into account real-world requirements such as hiding API keys or creating an entry page to restrict access to the video stream. Later, in the Vue.js version I build, I’ll add those pieces, but to start, I just want to get the video player working - I want it to play my live stream and display text captions for what I’m saying as I stream to viewers.</p>
<p>Here is a diagram to demonstrate the core technology for the <strong>video streaming part</strong> of the project:</p>
<img src="https://res.cloudinary.com/deepgram/image/upload/v1646946508/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/VideoStream.png" alt="Video stream diagram" style="width: 75%; margin:auto;">
<p>The diagram presents this flow: the webcam takes in the video stream —> OBS captures that video stream so it can be sent along to Amazon IVS —> Amazon IVS provides a service to take in the stream, optimize it, and send it in a format to the browser so that it can be used in an HTML video player —> the HTML video element plays the optimized video stream.</p>
<p>Here is a diagram to demonstrate the core technology for the <strong>text captions part</strong> of the project:</p>
<img src="https://res.cloudinary.com/deepgram/image/upload/v1646946508/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/AudioTranscription.png" alt="Audio transcription diagram" style="width: 75%; margin:auto;">
<p>The general flow for the text captions technology will be something like this:</p>
<p>The browser Media Streams API gets permission to use the browser microphone —> the microphone takes in an audio stream of the audio that plays from the live stream —> The Deepgram API opens a web socket channel in the browser to send the audio stream to Deepgram —> the browser receives the JSON object in return that contains the text-transcript —> Javascript puts the text onto the page as captions as the video is playing.</p>
<p>Now that I have a high-level picture of how this project will be built, I am ready to build the barebones front-end video stream application. (In the next post in this series, I will build the Vue.js/Node.js full-stack application with added functionality.)</p>
<h2 id="setting-up-open-broadcast-software">Setting up Open Broadcast Software</h2>
<p>The first thing I need is software to capture my video stream on my computer. I’ll use the <a href="https://obsproject.com/">Open Broadcast Software</a>.</p>
<h3 id="what-is-obs">What is OBS?</h3>
<p>For anyone serious about streaming, OBS is a powerful tool. It is a free open source software that gives many configuration options for capturing and editing a stream. I can edit every aspect of my stream and create scenes made up of multiple sources such as images, text, etc. I can mix audio, switch between scenes with transitions, adjust the layouts, and so much more.</p>
<p>The stream I capture in OBS can be connected to a streaming platform such as Twitch, YouTube, or others, and it will deliver my stream to that platform; however, for this project, my goal is to stream to a web application that I make myself.</p>
<p>OBS takes some effort to learn, but I only need to familiarize myself with a few parts of it if I’m going to set it up to capture a stream and connect to Amazon IVS (Amazon IVS is not a streaming platform - it is more like an SDK that helps make the stream easier to handle when I build my front-end).</p>
<h3 id="set-up-live-streaming-with-obs">Set up Live Streaming with OBS</h3>
<p>To set up OBS for my project, I will:</p>
<ol>
<li>
<p>Go to <a href="https://obsproject.com/">obsproject.com</a> and choose the operating system I use. I’ll download the software.</p>
</li>
<li>
<p>Run the OBS software. In the <strong>Sources</strong> panel, I’ll click the <strong>plus</strong> sign to add a new source. I’ll select <strong>Video Capture Device</strong>, and in the window that pops up, I’ll select the camera I want to use to capture my stream (my computer camera or webcam).</p>
</li>
</ol>
<img src="https://res.cloudinary.com/deepgram/image/upload/v1646946718/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/VideoCaptureDevice.png" alt="Select Video Capture Device to add source from computer camera" style="width: 80%; margin:auto;">
<ol start="3">
<li>
<p>Make sure the source is selected in the sources panel (I may have other sources that I have set up), then I’ll click on <strong>Settings</strong> in the far-right <strong>Controls</strong> panel.</p>
</li>
<li>
<p>Select <strong>Stream</strong> in the left column of the window that opens up. The <strong>Service</strong> will remain <strong>Custom</strong>, but I notice that I could select a streaming platform such as Twitch or YouTube if I weren’t planning to build my own streaming application.</p>
</li>
<li>
<p>There is nothing more to do until I create the Amazon IVS channel. But I know that later I will take the <strong>Server</strong> and the <strong>Stream Key</strong> information from Amazon IVS for the specific channel I create in the AWS console.</p>
</li>
</ol>
<p><img src="https://res.cloudinary.com/deepgram/image/upload/v1646946718/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/StreamSettings.png" alt="Stream settings"></p>
<h2 id="setting-up-amazon-ivs">Setting up Amazon IVS</h2>
<p>In this step, I will create an Amazon IVS channel, which is where my video stream from OBS will feed into once I connect them.</p>
<h3 id="what-is-amazon-ivs">What is Amazon IVS?</h3>
<p>The ‘IVS’ in Amazon IVS stands for Interactive Video Service. The website for <a href="https://aws.amazon.com/ivs/">Amazon IVS</a> describes it as a “managed live streaming solution” that I can use to send “live streams to Amazon IVS using streaming software” and “make low-latency live video available to any viewer around the world.” In addition, I “can easily customize and enhance the audience experience through the Amazon IVS player SDK.”</p>
<p>So what does this mean?</p>
<p>The fact is, building a video player browser can be very complicated. Amazon IVS takes away much of the challenge, allowing me to focus on the design of my front-end rather than the nitty-gritty of the video player. If I did it all without Amazon IVS, I could use the HTML native <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/video#usage_notes">video tag</a>, but then there would be much to do to optimize the video stream that comes through (there’s an interesting article about this <a href="https://medium.com/canal-tech/how-video-streaming-works-on-the-web-an-introduction-7919739f7e1">here</a>). A developer could dedicate their entire career to getting good at building stuff that manages audio and video streams in the browser.</p>
<p>Amazon IVS will optimize the stream to make it work for viewers watching it in my web application anywhere in the world. It also provides an SDK for the video player, which I can bring into the browser by adding a script. That script will take control of the video element in my HTML and add all the magic that Amazon IVS does under the hood. The Amazon IVS video player is built for the purpose of streaming live video, so I don’t have to build my own complicated video player.</p>
<p>One important thing to consider is cost. AWS is not free, and while it is very cost-effective for a bigger streaming platform like Twitch (the Twitch streaming technology is powered by Amazon IVS), an individual developer like myself building a small project for fun might not find it to be the best option.</p>
<p>The good news is a new user of Amazon IVS can enjoy the free tier, which gives the following:</p>
<ul>
<li>Five hours of live video input for a basic channel per month</li>
<li>100 hours of SD live video output per month</li>
</ul>
<p>This is enough to build this project and not be charged, as long as I am careful about turning off my stream in OBS when I’m not using it. (Yes, I did forget to do this one time and clocked several hours in Amazon IVS.) Be sure to read through the <a href="https://aws.amazon.com/ivs/pricing/">pricing details</a> and be vigilant about turning off the stream when you don’t need it to be on.</p>
<h3 id="set-up-amazon-ivs">Set up Amazon IVS</h3>
<p>Now I’ll set up a channel in Amazon IVS. The channel will take my video stream from the OBS software on my computer and make that stream available in a video player that I will bring into the browser with the Amazon IVS SDK (so many acronyms!).</p>
<p>In order to do this, I’ll need to <a href="https://portal.aws.amazon.com/billing/signup">create an AWS account</a>. This will require billing information.</p>
<p>In addition, I’ll need to set up AWS Identity and Access Management (IAM), which adds a ‘policy’ to my account that allows me to create an AWS IVS channel. This is standard for doing anything in AWS - the first step is to configure IAM so that users of the AWS console have specific permissions. I am the only user of my console, so I’m not worried about restricting any permissions in my account.</p>
<p><a href="https://docs.aws.amazon.com/ivs/latest/userguide/getting-started-iam-permissions.html">This guide</a> walks through how to set up the IAM permissions so that a user can create an AWS IVS channel.</p>
<p>Now I can navigate to IVS to create a channel. In the top search bar, I can type ‘IVS’ to find Amazon Interactive Video Service.</p>
<p><img src="https://res.cloudinary.com/deepgram/image/upload/v1646946745/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/SearchBar.png" alt="AWS search bar"></p>
<p>This takes me to the Amazon IVS console. I will click the <strong>Create channel</strong> button to create my channel.</p>
<p><img src="https://res.cloudinary.com/deepgram/image/upload/v1646946808/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/CreateChannel.png" alt="Click button to create IVS channel"></p>
<p>I can name my stream and stick with the <strong>Default</strong> configuration. Then I’ll scroll down and click <strong>Create channel</strong>.</p>
<p><img src="https://res.cloudinary.com/deepgram/image/upload/v1646946808/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/IVSSetup.png" alt="Set up IVS with default configuration"></p>
<p>This will create the channel and then put me on that channel’s page in the console. This is where I can configure the channel and get the information I need to connect my video stream in OBS to this channel. I need to find this section of the page:</p>
<p><img src="https://res.cloudinary.com/deepgram/image/upload/v1646946838/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/ChannelInfo.png" alt="Info about channel for OBS and video player"></p>
<p>There are three pieces of information I am going to need for my project. Two are to connect OBS to Amazon IVS, and one is to bring the stream from Amazon IVS (with all its optimizations) into the browser video player:</p>
<ul>
<li><strong>Ingest server</strong> - put this in OBS settings for my stream</li>
<li><strong>Stream key</strong> - put this in OBS settings for my stream</li>
<li><strong>Playback URL</strong> - use this as the src for my script that I put in the video player</li>
</ul>
<p>I have already set up OBS, so I can just go back to the settings for my stream and add the <strong>Ingest server</strong> and <strong>Stream key</strong>. The <strong>Playback URL</strong> will be used later.</p>
<p><img src="https://res.cloudinary.com/deepgram/image/upload/v1646946718/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/StreamSettings.png" alt="Stream settings"></p>
<p>Now, if I go back to the OBS controls and click on <strong>Start Streaming</strong>, my stream should be fed to Amazon IVS, and I am able to see it in the Amazon IVS channel page where it says <strong>Live stream</strong>:</p>
<p><img src="https://res.cloudinary.com/deepgram/image/upload/v1646946953/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/LiveStream.png" alt="Live stream in channel page"></p>
<h3 id="connect-front-end-video-player-to-amazon-ivs">Connect Front-end Video Player to Amazon IVS</h3>
<p>The back-end is done (AWS takes care of most of the work). Now I can build the front-end, which I will do using vanilla Javascript and HTML.</p>
<p>In the <code>&lt;head&gt;</code> tag of my HTML document, I will include the script for the Amazon IVS player. Amazon IVS explains how to do this setup <a href="https://docs.aws.amazon.com/ivs/latest/userguide/player-web.html">here</a>, for those who want to go straight to the source.</p>
<pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">head</span><span style="color: #C9D1D9">&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">meta</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">charset</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;UTF-8&quot;</span><span style="color: #C9D1D9"> /&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">title</span><span style="color: #C9D1D9">&gt;Video Stream Demo&lt;/</span><span style="color: #7EE787">title</span><span style="color: #C9D1D9">&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">src</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;https://player.live-video.net/1.6.1/amazon-ivs-player.min.js&quot;</span><span style="color: #C9D1D9">&gt;&lt;/</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">&lt;/</span><span style="color: #7EE787">head</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>
<p>This will load the IVS Player, and I will have access to the <code>IVSPlayer</code> variable in the global context. I can type that variable into the console to take a look at the module that has been loaded. There are quite a few properties that could be of use to me, depending on my project’s needs.</p>
<img src="https://res.cloudinary.com/deepgram/image/upload/v1646946972/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/ConsoleIVSPlayer.png" alt="IVSPlayer in console" style="width: 50%; margin:auto;">
<p>In the <code>&lt;body&gt;</code> tag, I will include a <code>&lt;video&gt;</code> player that has an <code>id</code> of <code>video-player</code> (this id can be renamed, as long as the javascript I write to find this element looks for that specific id).</p>
<pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">body</span><span style="color: #C9D1D9">&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">video</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">width</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;520&quot;</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">height</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;440&quot;</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">id</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;video-player&quot;</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">controls</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">playsinline</span></span>
<span class="line"><span style="color: #C9D1D9">  &gt;&lt;/</span><span style="color: #7EE787">video</span><span style="color: #C9D1D9">&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">&lt;/</span><span style="color: #7EE787">body</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>
<p>In the browser, I see the video player, but there is no stream coming through. That is because I have only brought in the Amazon IVS player; I have not yet connected the player to my stream channel.</p>
<p>I will use javascript to put my stream channel into the player.</p>
<pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">if (IVSPlayer.isPlayerSupported) </span><span style="color: #FF7B72">{</span></span>
<span class="line"><span style="color: #C9D1D9">  const player </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> IVSPlayer.</span><span style="color: #D2A8FF">create</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">  player.</span><span style="color: #D2A8FF">attachHTMLVideoElement</span><span style="color: #C9D1D9">(document.</span><span style="color: #D2A8FF">getElementById</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&quot;video-player&quot;</span><span style="color: #C9D1D9">));</span></span>
<span class="line"><span style="color: #C9D1D9">  player.</span><span style="color: #D2A8FF">load</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&quot;PLAYBACK_URL&quot;</span><span style="color: #C9D1D9">);</span></span>
<span class="line"><span style="color: #C9D1D9">  player.</span><span style="color: #D2A8FF">play</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #FF7B72">}</span></span>
<span class="line"><span style="color: #C9D1D9">&lt;/</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>
<p>Where it says <code>PLAYBACK_URL</code> in the code example, I need to put the string for my playback URL, which I can find in the Amazon IVS console for my channel.</p>
<p><img src="https://res.cloudinary.com/deepgram/image/upload/v1646946995/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/PlaybackConfiguration.png" alt="Playback URL"></p>
<p>Then I can turn on my stream in OBS, and I should see my stream in the browser!</p>
<img src="https://res.cloudinary.com/deepgram/image/upload/v1646947012/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/StartStream.png" alt="OBS Start stream" style="width: 50%; margin:auto;">
<h3 id="use-deepgram-to-create-text-captions">Use Deepgram to Create Text Captions</h3>
<p>The second part of this project, after getting the live stream video player working, is creating text captions. The captions will display what is being said in the live stream as I am streaming.</p>
<p>I will need to do two things: use my computer’s microphone to listen to the audio that is being outputted from the live stream, and then send that audio stream to Deepgram to turn it into a text transcription.</p>
<h3 id="what-is-the-media-streams-api">What is the Media Streams API?</h3>
<p>The browser contains several APIs for working with audio and video. I need to use one that lets me <strong>gain access to the user’s microphone</strong>. If I can gain that access, I can record the audio from the live stream and send it on to Deepgram to get the text transcript.</p>
<p>The <strong>Media Streams API</strong> contains many interfaces and methods for working with <strong>audio and video data</strong>. There is already a really great guide for how it works <a href="https://blog.deepgram.com/getting-started-with-mediastream-api/">here</a>, so I won’t go over all the details. I just need to understand that the Media Streams API has so much that I can use when I’m working with audio or video data in the browser. In fact, I’m pretty sure the Amazon IVS SDK uses it under the hood as part of their video player.</p>
<h3 id="get-audio-with-media-streams-api">Get Audio with Media Streams API</h3>
<p>I will use the <code>getUserMedia</code> method from this API. To get access to the user’s microphone, I can write this javascript:</p>
<pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">//Get access to user&#39;s microphone</span></span>
<span class="line"><span style="color: #C9D1D9">navigator.mediaDevices.getUserMedia(</span><span style="color: #FF7B72">{</span><span style="color: #C9D1D9"> audio: </span><span style="color: #79C0FF">true</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">}</span><span style="color: #C9D1D9">).then((res) =&gt; </span><span style="color: #FF7B72">{</span></span>
<span class="line"><span style="color: #C9D1D9">  mediaRecorder </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">MediaRecorder</span><span style="color: #C9D1D9">(res, {</span></span>
<span class="line"><span style="color: #C9D1D9">    audio: </span><span style="color: #79C0FF">true</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">  });</span></span>
<span class="line"><span style="color: #FF7B72">}</span><span style="color: #C9D1D9">);</span></span>
<span class="line"><span style="color: #C9D1D9">&lt;/</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>
<p>This will cause the browser to ask for permission to use the microphone.</p>
<img src="https://res.cloudinary.com/deepgram/image/upload/v1646947043/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/GetMicrophone.png" alt="Request permission to use microphone" style="width: 50%; margin:auto;">
<p>If the user gives permission, then I’ll have access to the live stream audio to send to Deepgram.</p>
<h2 id="create-text-captions-with-deepgram-api">Create Text Captions with Deepgram API</h2>
<p>In the next step, I will use the Deepgram API to take the audio data and turn it into text.</p>
<h3 id="what-is-deepgram">What is Deepgram?</h3>
<p>Deepgram is an ASR technology (ASR stands for Automatic Speech Recognition). It uses pretty advanced AI and deep learning technology to take speech from audio files or streams and turn it into text. There are probably a million ways to use this technology in a project. It’s a fun API to get comfortable with for this reason.</p>
<p>If I’m going to use Deepgram in my project, I need to create an account <a href="https://console.deepgram.com/signup?jump=keys">here</a>. This will give me an API key and $150 in free credit, so I won’t need to enter billing information just to get started (unlike AWS).</p>
<p>Now I can connect to the Deepgram socket with my API key.</p>
<h3 id="connect-to-deepgram-to-get-transcription">Connect to Deepgram to Get Transcription</h3>
<p>I want to get the transcription and display it under the video player, so I will create an HTML element for that transcript. I’ll give it the <strong>id</strong> of <code>captions</code>.</p>
<pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">p</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">id</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;captions&quot;</span><span style="color: #C9D1D9">&gt;&lt;/</span><span style="color: #7EE787">p</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>
<p>I’m going to follow the tutorial my colleague Kevin Lewis wrote about <a href="https://blog.deepgram.com/live-transcription-mic-browser/">getting live speech transcriptions in the browser</a>. He explains that I need to connect to Deepgram with a WebSocket. I have to make sure I have access to the microphone before I open the WebSocket, so I will put the logic to connect to Deepgram inside the <code>.then()</code> that is attached to the <code>getUserMedia</code> function call.</p>
<pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">navigator.mediaDevices.</span><span style="color: #D2A8FF">getUserMedia</span><span style="color: #C9D1D9">({ audio: </span><span style="color: #79C0FF">true</span><span style="color: #C9D1D9"> }).</span><span style="color: #D2A8FF">then</span><span style="color: #C9D1D9">((</span><span style="color: #FFA657">stream</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">...</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">socket</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">WebSocket</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&quot;wss://api.deepgram.com/v1/listen&quot;</span><span style="color: #C9D1D9">, [</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #A5D6FF">&quot;token&quot;</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #A5D6FF">&quot;YOUR_KEY_HERE&quot;</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">  ]);</span></span>
<span class="line"><span style="color: #C9D1D9">});</span></span>
<span class="line"></span></code></pre>
<p>I will put my API key where it says “YOUR_KEY_HERE”.</p>
<p>Once the socket is open, I can add an event listener that listens for when there is audio data that has come through the microphone. When that happens, I can take that audio data and send it through the Deepgram socket to Deepgram.</p>
<pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">socket.</span><span style="color: #D2A8FF">onopen</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">  mediaRecorder.</span><span style="color: #D2A8FF">addEventListener</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;dataavailable&#39;</span><span style="color: #C9D1D9">, </span><span style="color: #FF7B72">async</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">event</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (event.data.size </span><span style="color: #FF7B72">&gt;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">&amp;&amp;</span><span style="color: #C9D1D9"> socket.readyState </span><span style="color: #FF7B72">==</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">1</span><span style="color: #C9D1D9">) {</span></span>
<span class="line"><span style="color: #C9D1D9">      socket.</span><span style="color: #D2A8FF">send</span><span style="color: #C9D1D9">(event.data)</span></span>
<span class="line"><span style="color: #C9D1D9">    }</span></span>
<span class="line"><span style="color: #C9D1D9">  })</span></span>
<span class="line"><span style="color: #C9D1D9">  mediaRecorder.</span><span style="color: #D2A8FF">start</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">1000</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span></code></pre>
<p>Deepgram will send the transcribed audio back to me as text. It will come in the form of a JSON object, so I need to drill down to the <code>transcript</code> property using dot notation. I will use <code>document.querySelector(#captions)</code> to put the transcript onto the screen under the video element.</p>
<pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">socket.</span><span style="color: #D2A8FF">onmessage</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">message</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">received</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">JSON</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">parse</span><span style="color: #C9D1D9">(message.data)</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">transcript</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> received.channel.alternatives[</span><span style="color: #79C0FF">0</span><span style="color: #C9D1D9">].transcript</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (transcript </span><span style="color: #FF7B72">&amp;&amp;</span><span style="color: #C9D1D9"> received.is_final) {</span></span>
<span class="line"><span style="color: #C9D1D9">    document.</span><span style="color: #D2A8FF">querySelector</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;#captions&#39;</span><span style="color: #C9D1D9">).textContent </span><span style="color: #FF7B72">+=</span><span style="color: #C9D1D9"> transcript </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39; &#39;</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span></code></pre>
<p>Here is all the Javascript code for building the text captions feature:</p>
<pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">    // Get access to user&#39;s microphone</span></span>
<span class="line"><span style="color: #C9D1D9">    navigator.mediaDevices.getUserMedia(</span><span style="color: #FF7B72">{</span><span style="color: #C9D1D9"> audio: </span><span style="color: #79C0FF">true</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">}</span><span style="color: #C9D1D9">).then((stream) =&gt; </span><span style="color: #FF7B72">{</span></span>
<span class="line"><span style="color: #C9D1D9">      const mediaRecorder </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">MediaRecorder</span><span style="color: #C9D1D9">(stream);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #8B949E">// Open connection to Deepgram</span></span>
<span class="line"><span style="color: #C9D1D9">      const socket </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">WebSocket</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&quot;wss://api.deepgram.com/v1/listen&quot;</span><span style="color: #C9D1D9">, [</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #A5D6FF">&quot;token&quot;</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #A5D6FF">&quot;YOUR_KEY_HERE&quot;</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">      ]);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #8B949E">// Listen for audio data coming from microphone and send it to Deepgram</span></span>
<span class="line"><span style="color: #C9D1D9">      socket.</span><span style="color: #D2A8FF">onopen</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">        mediaRecorder.</span><span style="color: #D2A8FF">addEventListener</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&quot;dataavailable&quot;</span><span style="color: #C9D1D9">, </span><span style="color: #FF7B72">async</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">event</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">          </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (event.data.size </span><span style="color: #FF7B72">&gt;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">&amp;&amp;</span><span style="color: #C9D1D9"> socket.readyState </span><span style="color: #FF7B72">==</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">1</span><span style="color: #C9D1D9">) {</span></span>
<span class="line"><span style="color: #C9D1D9">            socket.</span><span style="color: #D2A8FF">send</span><span style="color: #C9D1D9">(event.data);</span></span>
<span class="line"><span style="color: #C9D1D9">          }</span></span>
<span class="line"><span style="color: #C9D1D9">        });</span></span>
<span class="line"><span style="color: #C9D1D9">        mediaRecorder.</span><span style="color: #D2A8FF">start</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">1000</span><span style="color: #C9D1D9">);</span></span>
<span class="line"><span style="color: #C9D1D9">      };</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #8B949E">// Put the transcript onto the screen in the #captions element</span></span>
<span class="line"><span style="color: #C9D1D9">      socket.</span><span style="color: #D2A8FF">onmessage</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">message</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">received</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">JSON</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">parse</span><span style="color: #C9D1D9">(message.data);</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">transcript</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> received.channel.alternatives[</span><span style="color: #79C0FF">0</span><span style="color: #C9D1D9">].transcript;</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (transcript </span><span style="color: #FF7B72">&amp;&amp;</span><span style="color: #C9D1D9"> received.is_final) {</span></span>
<span class="line"><span style="color: #C9D1D9">          document.</span><span style="color: #D2A8FF">querySelector</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&quot;#captions&quot;</span><span style="color: #C9D1D9">).textContent </span><span style="color: #FF7B72">+=</span><span style="color: #C9D1D9"> transcript </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&quot; &quot;</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">        }</span></span>
<span class="line"><span style="color: #C9D1D9">      };</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">      socket.</span><span style="color: #D2A8FF">onclose</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">        console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">({ event: </span><span style="color: #A5D6FF">&quot;onclose&quot;</span><span style="color: #C9D1D9"> });</span></span>
<span class="line"><span style="color: #C9D1D9">      };</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">      socket.</span><span style="color: #D2A8FF">onerror</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">error</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">        console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">({ event: </span><span style="color: #A5D6FF">&quot;onerror&quot;</span><span style="color: #C9D1D9">, error });</span></span>
<span class="line"><span style="color: #C9D1D9">      };</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">}</span><span style="color: #C9D1D9">);</span></span>
<span class="line"><span style="color: #C9D1D9">    &lt;/</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>
<p>And here is the HTML:</p>
<pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">html</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">lang</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;en&quot;</span><span style="color: #C9D1D9">&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">head</span><span style="color: #C9D1D9">&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">meta</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">charset</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;UTF-8&quot;</span><span style="color: #C9D1D9"> /&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">title</span><span style="color: #C9D1D9">&gt;Video Stream Demo&lt;/</span><span style="color: #7EE787">title</span><span style="color: #C9D1D9">&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #8B949E">&lt;!-- Amazon IVS SDK video player --&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">src</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;https://player.live-video.net/1.6.1/amazon-ivs-player.min.js&quot;</span><span style="color: #C9D1D9">&gt;&lt;/</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">  &lt;/</span><span style="color: #7EE787">head</span><span style="color: #C9D1D9">&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">body</span><span style="color: #C9D1D9">&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">video</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">width</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;520&quot;</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">height</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;440&quot;</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">id</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;video-player&quot;</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">controls</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">playsinline</span></span>
<span class="line"><span style="color: #C9D1D9">    &gt;&lt;/</span><span style="color: #7EE787">video</span><span style="color: #C9D1D9">&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">p</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">id</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;captions&quot;</span><span style="color: #C9D1D9">&gt;&lt;/</span><span style="color: #7EE787">p</span><span style="color: #C9D1D9">&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #8B949E">&lt;!-- scripts --&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">  &lt;/</span><span style="color: #7EE787">body</span><span style="color: #C9D1D9">&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">&lt;/</span><span style="color: #7EE787">html</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>
<p>Now I can start my live stream, and the text captions will be displayed under the video player!</p>
<h2 id="conclusion">Conclusion</h2>
<p>In this tutorial, I built a ‘vanilla’ live stream player with text captions. I demonstrated how to use the technologies Amazon IVS and Deepgram using fundamentals of web development - HTML and Javascript. You can find the repo for this vanilla Javascript project <a href="https://github.com/deepgram-devs/deepgram-livestream-javascript">here</a>.</p>
<p>But most front-end developers rely on frameworks to build projects like these. And there are other considerations I need to make in regards to keeping my Deepgram API key secure and limiting who has access to this website.</p>
<p>In the next part of the series, <strong>I will improve this project by building it using Vue.js (specifically Vue 3) for the front-end, and node.js for the back-end</strong>. I will include some of the real-world practices for building a full-stack application. I’ll need a server file so I can incorporate more security, which I’ll build with node.js, and I’ll build an entry page with VueRouter navigation guards so that users must enter a code to see my live stream.</p>
<p>Vue.js is my favorite Javascript framework, and I have written a series on <a href="https://blog.deepgram.com/diving-into-vue-3-setup-function/">Diving Into Vue 3</a>, which is worth checking out if you want to come along with me for the rest of this series to build a full-stack live stream application in Vue.js.</p>
<p>Please follow me on <a href="https://twitter.com/sandra_rodgers_">Twitter</a> if you find my tutorials useful!</p>`;
}, "/Users/sandrarodgers/web-next/blog/src/content/blog/posts/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/index.md");

export { compiledContent, $$Index as default, frontmatter, metadata, rawContent };
