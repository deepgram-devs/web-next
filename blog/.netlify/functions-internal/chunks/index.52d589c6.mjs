import { c as createAstro, a as createComponent, r as renderTemplate, b as renderHead, d as renderComponent } from '../entry.mjs';
import Slugger from 'github-slugger';
import '@astrojs/netlify/netlify-functions.js';
import 'preact';
import 'preact-render-to-string';
import 'vue';
import 'vue/server-renderer';
import 'html-escaper';
import 'node-html-parser';
import 'axios';
/* empty css                           *//* empty css                           *//* empty css                           */import '@storyblok/js';
/* empty css                          *//* empty css                              */import 'clone-deep';
import 'slugify';
import 'shiki';
/* empty css                           */import 'camelcase';
/* empty css                              */import '@astrojs/rss';
/* empty css                           */import 'mime';
import 'cookie';
import 'kleur/colors';
import 'string-width';
import 'path-browserify';
import 'path-to-regexp';

const metadata = { "headings": [{ "depth": 2, "slug": "introduction", "text": "Introduction" }, { "depth": 3, "slug": "composables", "text": "Composables" }, { "depth": 4, "slug": "composable-example-usemenujs", "text": "Composable Example useMenu.js" }, { "depth": 3, "slug": "background-to-the-series", "text": "Background to the Series" }, { "depth": 2, "slug": "files-organization", "text": "Files Organization" }, { "depth": 2, "slug": "videoplayer-component", "text": "VideoPlayer Component" }, { "depth": 2, "slug": "composable-to-bring-in-an-external-script", "text": "Composable to Bring in An External Script" }, { "depth": 2, "slug": "composable-to-play-channel-stream", "text": "Composable to Play Channel Stream" }, { "depth": 2, "slug": "run-the-composables", "text": "Run the Composables" }, { "depth": 2, "slug": "conclusion", "text": "Conclusion" }], "source": "\n## Introduction\n\nThis post is a continuation of the series \"How to Build a Live Streaming Web Application with Amazon IVS and Deepgram.\"\n\n<Panel type=\"info\" title=\"Build a Live Streaming Web Application with Amazon IVS and Deepgram (SERIES)\">\n<ol> \n<li><a href=\"https://blog.deepgram.com/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/\">How to Build a Live Streaming Web Application with Amazon IVS and Deepgram</a></li>\n<li><a href=\"https://blog.deepgram.com/build-a-livestream-web-application-vue-and-express-setup/\"> Build a Live Streaming Web Application: Vue and Express Setup</a></li>\n<li><a href=\"https://blog.deepgram.com/how-to-write-vue-3-composables-for-a-third-party-API-integration/\"> How to Write Vue 3 Composables for a Third-Party API Integration</a></li>\n\n<li><a href=\"https://blog.deepgram.com/asynchronous-logic-to-write-a-vue-3-and-deepgram-captions-component/\"> Asynchronous Logic to Write a Vue 3 and Deepgram Captions Component</a></li>\n</ol>\n</Panel>\n\n### Composables\n\nIn Vue.js, the term 'composables' refers to composition functions, a key feature of Vue 3's Composition API. While the API itself includes many composition functions that are core to its design, such as the `setup()` function or the reactivity functions `ref()` and `reactive()`, composables are those composition functions that I write myself to be used throughout my own project as needed.\n\nComposables are functions that encapsulate stateful logic, which means they are like little packages that are focused around performing one logical concern, and they keep track of state that changes due to the function running.\n\nFor example, I could write a composable function that toggles a menu open or closed. That logic could be used throughout an application, and it would need to keep track of the state of the menu being opened or closed. I would just need to import the composable into whatever file I need it and run the function.\n\n#### Composable Example `useMenu.js`\n\n```js\nimport { readonly, ref } from 'vue'\n\nconst isOpen = ref(false)\nconst toggleMenu = () => {\n  isOpen.value = !isOpen.value\n}\n\nexport default function useMenu() {\n  return {\n    isOpen: readonly(isOpen),\n    toggleMenu,\n  }\n}\n```\n\nToday I am going to introduce how to write a composable in Vue 3 to bring in the Amazon IVS video player SDK and to connect to my Amazon IVS streaming channel.\n\nIf you have wanted to learn more about how to write Vue 3 composables to use third-party technologies, this will be useful to you. In this post, I'll cover:\n\n*   Writing a Vue composable to bring in an external script\n*   Writing a Vue composable that is dependent on another composable, utilizing the Javascript function `setInterval`\n*   Amazon IVS integration using Vue 3 composables\n\n### Background to the Series\n\nIn the [first post](https://blog.deepgram.com/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/) in the series, I explained how to build a live streaming web application using just Vanilla JS and HTML. That post covers setting up an Amazon IVS account, which is necessary to get the third-party technology example (Amazon IVS) in today's post working. **Setting up an Amazon IVS channel is necessary to build the second composable in this tutorial, but the first one can be built without doing that**.\n\nIn the second post, I started building a full-stack application using Vue 3. I set up Vue-Router, Vuex, and a backend server which all helped me build a feature to restrict access to the streaming page of my site. Visitors to the site are required to enter a code, and that code is verified on the backend, resulting in the user being able to navigate to the streaming page. **There is no need to read that post to be able to go through this tutorial on composables.**\n\nToday I'll build the video streaming page in Vue 3, focusing on building this feature with Vue composables. If you want a refresher on Vue composables, check out my post [Reusability with Composables](https://blog.deepgram.com/diving-into-vue-3-reusability-with-composables/).\n\nThe code for today's tutorial can be found in [this Github repo](https://github.com/deepgram-devs/livestream-amazonIVS-and-deepgram/tree/amazonIVS-composables), the branch named \"amazonIVS-composables.\"\n\nNow I'll get into it!\n\n## Files Organization\n\nThis project has two main views, the landing page and the streaming page. Today I'll be working entirely in the streaming page. In my project, I have named this file `StreamChannel.vue`, and it is in the `Views` folder.\n\nThe `StreamChannel.vue` will eventually be made up of two components - one for **the video player** that relies on the Amazon IVS technology and one for the **closed-captions** that relies on the Deepgram speech-to-text technology. Today I'll only build the video player component.\n\nI'll set up two folders to start - a `components` folder and a `composables` folder, both in the `src` folder. In the `components` folder, I'll create a `VideoPlayer.vue` component.\n\nThe `composables` folder is where I will put the composition functions that contain the logic that makes the video player work. **A common practice in Vue 3 is to name composables so that they begin with 'use'.** The name will identify what the composable does. The two composables I will be writing today are `useIVSPlayer` and `useIVSChannel`. Here is what they will do:\n\n1.  `useIVSPlayer.js` - this composable will bring in the [Amazon IVS video player script](https://docs.aws.amazon.com/ivs/latest/userguide/player-web.html) so that the HTML video element is enhanced with the Amazon IVS Player Web SDK.\n\n2.  `useIVSChannel.js` - this composable will check at an interval if the player in the `useIVSPlayer` script has loaded, and if it has, it will create a connection to my Amazon IVS channel, updating state to show that the channel is connected.\n\nMy [Github repo](https://github.com/deepgram-devs/livestream-amazonIVS-and-deepgram/tree/amazonIVS-composables/src) for this project shows how I have set up these folders.\n\n## VideoPlayer Component\n\nThe `VideoPlayer.vue` component will be a video player that shows the live stream. The Amazon IVS video player script looks for an HTML `<video>` element with a specific ID and then takes control of that element to bring in its own specially made video player with Amazon IVS optimizations. So the first composable I write will be **a function that brings in the Amazon IVS player with a script**.\n\nIn the `VideoPlayer.vue` file, I will start by writing the HTML I need in the Vue template so that I have a basic video player. I've given it a height and a width that I prefer, and the `id=\"video-player\"` so that I can use that id later to bring in the Amazon IVS player. The attributes that the html `<video>` element supports are listed [here](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/video#attributes).\n\n```html\n<template>\n  <div>\n    <p class=\"status\">AWS Channel {{ IVSStatus }}</p>\n    <video\n      width=\"520\"\n      height=\"440\"\n      id=\"video-player\"\n      controls\n      playsinline\n    ></video>\n  </div>\n</template>\n```\n\nThe `IVSStatus` will be set to a `ref` property. For now, I'll make that property a string 'Is Not Connected,' but later, it will be hooked up to the status of the channel, and it will update to say 'Is Connected' when the channel is available.\n\nHere is my setup function in the script block with that `ref`:\n\n```js\n<script>\nimport { ref } from \"vue\";\n\nexport default {\n  name: \"VideoPlayer\",\n  setup() {\n    let IVSStatus = ref(\"Is Not Connected\");\n\n    return { IVSStatus };\n  },\n};\n<\/script>\n```\n\nThe last thing I need to do to be able to see this video player is add the component to the `StreamChannel.vue` page in src/views/StreamChannel.vue:\n\n```html\n<template>\n  <div>\n    <h1>Stream Channel</h1>\n    <video-player />\n  </div>\n</template>\n\n<script>\n  import VideoPlayer from '@/components/VideoPlayer'\n  export default {\n    name: 'StreamChannel',\n    components: {\n      VideoPlayer,\n    },\n  }\n<\/script>\n```\n\nHere is how the page will look:\n\n![Video Player Page](https://res.cloudinary.com/deepgram/image/upload/v1647979619/blog/2022/03/how-to-write-vue-3-composables-for-a-third-party-API-integration/VideoPlayerComponent.png)\n\nNow I am ready to write the first composable, the `useIVSPlayer.js` composition function, which will do the logic to bring in the Amazon IVS player.\n\n## Composable to Bring in An External Script\n\nThe `useIVSPlayer.js` composable will bring a script into my `StreamChannel.vue` component. The [docs](https://docs.aws.amazon.com/ivs/latest/userguide/player-web.html) at Amazon IVS say that I need this script so that the player is brought in:\n\n```html\n<script src=\"https://player.live-video.net/1.8.0/amazon-ivs-player.min.js\">\n```\n\nOne way to bring in an external script is to add the script to the `<head>` in my `index.html` page:\n\n```html\n<head>\n  <meta charset=\"utf-8\" />\n  ...\n  <script\n    type=\"text/javascript\"\n    src=\"https://player.live-video.net/1.8.0/amazon-ivs-player.min.js\"\n  ><\/script>\n</head>\n```\n\nThen I can type \"IVSPlayer\" in the console, and I should see the module there.\n\n<img src=\"https://res.cloudinary.com/deepgram/image/upload/v1647979619/blog/2022/03/how-to-write-vue-3-composables-for-a-third-party-API-integration/ConsoleIVSPlayer.png\" alt=\"IVSPlayer in console\" style=\"width: 50%; margin:auto;\">\n\nIf I choose this way to bring in the script, the module will be available on every page of my application. However, sometimes it is preferable to make a third-party technology only available on the page where it is needed. In that case, I need to remove that script from the `<head>` and bring it in a different way.\n\nIf I only want to bring in the script on the `StreamChannel.vue` page, I need to write logic to **build out the script tag with the src of the player URL**. I will use a Vue composable, which is just a Javascript function, to build out this logic. Writing it as a composable makes it reusable, so I can easily copy it into other projects or bring it into other components in my application as needed.\n\nThis `useIVSPlayer.js` composable will:\n\n*   be a **Promise**, since I need to account for the small amount of time it will take to load the script\n*   use `createElement` to create the script tag and `setAttribute` to add the src\n*   append the script to the head with `appendChild`\n*   use the global event listener `onload` to trigger the promise being resolved\n\nHere is the composable:\n\n```js\nexport default new Promise((res) => {\n  const script = document.createElement('script')\n  script.setAttribute(\n    'src',\n    'https://player.live-video.net/1.6.1/amazon-ivs-player.min.js'\n  )\n  document.head.appendChild(script)\n  script.onload = () => res()\n  script.onerror = () => {\n    throw 'IVS PLAYER ERROR'\n  }\n})\n```\n\nI start with `export default` because I need to be able to import this logic into my `VideoPlayer.vue` component.\n\nNow in `VideoPlayer.vue` I can import the composable. I am going to use a `.then()` method because `useIVSPlayer` is a promise. The `.then()` method will wait for the promise to resolve before doing whatever I write inside the `.then()`.\n\nFor now, I will check that the player is available and `console.log` that it is ready. Later, I'll add logic inside the `.then()` to bring in my streaming channel.\n\nHere is the `setup` function now in the `VideoPlayer.vue` component:\n\n```js\nsetup() {\n    let IVSStatus = ref(\"Is Not Connected\");\n\n    useIVSPlayer.then(() => {\n      if (window.IVSPlayer) {\n        console.log(\"player loaded\");\n      }\n    });\n    return { IVSStatus };\n  },\n```\n\nFor now, I will keep `IVSStatus` as \"Is Not Connected\" because even though I have brought in the Amazon IVS player, I still need to hook up the video player to my channel stream. I'll do that in the next section.\n\n## Composable to Play Channel Stream\n\nNow I want to build a composable that will load my channel stream into the IVS player that I just brought in. This composable will do the following:\n\n*   Check that the IVS Player script is loaded and then create a new player that I can use for my stream.\n*   Load my channel stream into the player by adding the playback URL.\n*   Turn the player on with the `play()` method.\n*   Check that the stream is connected and loaded. This will be done with `setInterval` since I don't know how long the delay might be.\n\nFirst, I'll write my composable with an `export default` so I can import it into other files as needed. I'll also bring in `ref` from vue so I can track the state of the channel being loaded. I'll create a `ref` variable called `playerIsLoaded` and set it to `false` to start:\n\n```js\nimport { ref } from 'vue'\n\nexport default function useIVSChannel() {\n  let playerIsLoaded = ref(false)\n\n  return { playerIsLoaded }\n}\n```\n\nEverything I need to do in this composable is dependent on the IVS player (the one I brought in with the `useIVSPlayer` composable) being loaded. So I'll wrap all my logic in an `if` statement to check that it is loaded and supported.\n\n```js\nif (window.IVSPlayer && window.IVSPlayer.isPlayerSupported) {\n  // all logic here\n}\n```\n\nI'll use the player SDK's method `create()` to create a player for my channel. Then I'll attach the player to the HTML video element in my `VideoPlayer.vue` component with the SDK's `attachHTMLVideoElement()` method and I'll use `.load()` to load my channel's playback URL. I'll use `play()` to play the channel stream:\n\n```js\nconst player = window.IVSPlayer.create()\nplayer.attachHTMLVideoElement(document.getElementById('video-player'))\nplayer.load('PLAYBACK_URL')\nplayer.play()\n```\n\n(The playback URL is unique to my channel, so it has to be taken from the Amazon IVS console. See my walkthrough in [this post](https://deploy-preview-631--romantic-gates-9c0b5e.netlify.app/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/) for more information.)\n\nNow I need to check that the channel stream is loaded. This won't happen instantaneously, but it should load relatively quickly. I don't want to use a `setTimeout `because I don't know how long it will take and I'm concerned about the idea of adding a super long timeout if I don't have to. I'll use `setInterval` to check for the stream being loaded.\n\n`setInterval` is a DOM API method that repeatedly calls a function until some other trigger happens to turn it off. In this case, the other trigger will be the channel being loaded.\n\nThe way to turn it off is to use `clearInterval`. I'm going to assign `setInterval` to a variable called `checkInterval`. The callback of `setInterval` will run every 500 milliseconds. Inside that callback, it will check that the channel has loaded, and once it has, it will set `playerIsLoaded` to `true` and clear everything by passing `checkInterval` to `clearInterval`.\n\nHere's the logic I just described:\n\n```js\nlet checkInterval = setInterval(() => {\n  if (player.core.isLoaded) {\n    playerIsLoaded.value = true\n    clearInterval(checkInterval)\n  }\n}, 500)\n```\n\nI'll return the ref `playerIsLoaded` from the composable, so I have access to it in the `VideoPlayer.vue` component. I want to watch that value so that when it changes, the `IVSStatus` value in the `VideoPlayer.vue` template updates to show that the channel is connected.\n\nHere is the composable in its entirety:\n\n```js\nimport { ref } from 'vue'\n\nexport default function useIVSChannel() {\n  let playerIsLoaded = ref(false)\n\n  if (window.IVSPlayer && window.IVSPlayer.isPlayerSupported) {\n    const player = window.IVSPlayer.create()\n    player.attachHTMLVideoElement(document.getElementById('video-player'))\n    player.load('PLAYBACK_URL')\n    player.play()\n\n    let checkInterval = setInterval(() => {\n      if (player.core.isLoaded) {\n        playerIsLoaded.value = true\n        clearInterval(checkInterval)\n      }\n    }, 500)\n\n    return { playerIsLoaded }\n  }\n}\n```\n\nThe last thing I need to do to get this working is go back to the `VideoPlayer.vue` component and run the composable function inside `setup` and update `IVSStatus` based on the channel being connected, which I'll do in the next section.\n\n## Run the Composables\n\nIn `VideoPlayer.vue`, I will run the `useIVSChannel` composable inside `setup`. Actually, I'll run it inside the `.then()` that I already wrote earlier, which will cause `useIVSChannel` to run after `useIVSPlayer` has resolved. (I have to remember to import `useIVSChannel` from the `composables` folder if I want to use it.)\n\n```js\nuseIVSPlayer.then(() => {\n  const { playerIsLoaded } = useIVSChannel()\n})\n```\n\nI deconstruct `playerIsLoaded` off of `useIVSChannel` so that I can watch that reactive reference. I'll use Vue's `watch` method to make a side effect occur when the `playerIsLoaded` value changes to true (i.e., when the channel is connected). The side effect will be that the `IVSStatus` will update to \"Is Connected\":\n\n```js\nwatch(playerIsLoaded, () => {\n  if (playerIsLoaded.value) {\n    IVSStatus.value = 'Is Connected'\n  }\n})\n```\n\nHere is the entire script for the `VideoPlayer.vue` component:\n\n```js\n<script>\nimport { ref, watch } from \"vue\";\nimport useIVSPlayer from \"../composables/useIVSPlayer\";\nimport useIVSChannel from \"../composables/useIVSChannel\";\n\nexport default {\n  name: \"VideoPlayer\",\n  setup() {\n    let IVSStatus = ref(\"Is Not Connected\");\n\n    useIVSPlayer.then(() => {\n      const { playerIsLoaded } = useIVSChannel();\n      watch(playerIsLoaded, () => {\n        if (playerIsLoaded.value) {\n          IVSStatus.value = \"Is Connected\";\n        }\n      });\n    });\n    return { IVSStatus };\n  },\n};\n<\/script>\n```\n\nHowever, nothing will happen in my video player in the browser if I have not turned on my stream. In [the first post](https://deploy-preview-631--romantic-gates-9c0b5e.netlify.app/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/) in this series, I showed how to set up OBS to use their software on my computer to create a stream, which I connected to an Amazon IVS channel.\n\nIf I turn on my stream in OBS, I should see myself in the video player in my application now!\n\n![Video Stream working](https://res.cloudinary.com/deepgram/image/upload/v1647979619/blog/2022/03/how-to-write-vue-3-composables-for-a-third-party-API-integration/VideoStreamWorking.png)\n\n## Conclusion\n\nVue composables are useful for writing standalone logic that can be reused, but if one composable depends on another, it can be tricky. In this post, I showed how a composable can be written as a promise and how `setInterval` can be used to check if something the composable depends on has happened yet. These are two ways to write composables that may have asynchronous events occurring.\n\nIn the next post, I'll show how to write composables for using Deepgram's API to create text captions for my stream. I'll write a composable to use the browser MediaStreams API (a great example of a composable that can be reused in different contexts). I'll also show how to use `fetch` in a composable to get a token from the backend.\n\nI hope you'll join me for the next post. Follow me on [Twitter](https://twitter.com/sandra_rodgers_) so you don't miss it!\n\n        ", "html": '<h2 id="introduction">Introduction</h2>\n<p>This post is a continuation of the series \u201CHow to Build a Live Streaming Web Application with Amazon IVS and Deepgram.\u201D</p>\n<Panel type="info" title="Build a Live Streaming Web Application with Amazon IVS and Deepgram (SERIES)"><ol><li><a href="https://blog.deepgram.com/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/">How to Build a Live Streaming Web Application with Amazon IVS and Deepgram</a></li>\n<li><a href="https://blog.deepgram.com/build-a-livestream-web-application-vue-and-express-setup/"> Build a Live Streaming Web Application: Vue and Express Setup</a></li>\n<li><a href="https://blog.deepgram.com/how-to-write-vue-3-composables-for-a-third-party-API-integration/"> How to Write Vue 3 Composables for a Third-Party API Integration</a></li><li><a href="https://blog.deepgram.com/asynchronous-logic-to-write-a-vue-3-and-deepgram-captions-component/"> Asynchronous Logic to Write a Vue 3 and Deepgram Captions Component</a></li></ol></Panel>\n<h3 id="composables">Composables</h3>\n<p>In Vue.js, the term \u2018composables\u2019 refers to composition functions, a key feature of Vue 3\u2019s Composition API. While the API itself includes many composition functions that are core to its design, such as the <code is:raw>setup()</code> function or the reactivity functions <code is:raw>ref()</code> and <code is:raw>reactive()</code>, composables are those composition functions that I write myself to be used throughout my own project as needed.</p>\n<p>Composables are functions that encapsulate stateful logic, which means they are like little packages that are focused around performing one logical concern, and they keep track of state that changes due to the function running.</p>\n<p>For example, I could write a composable function that toggles a menu open or closed. That logic could be used throughout an application, and it would need to keep track of the state of the menu being opened or closed. I would just need to import the composable into whatever file I need it and run the function.</p>\n<h4 id="composable-example-usemenujs">Composable Example <code is:raw>useMenu.js</code></h4>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> { readonly, ref } </span><span style="color: #FF7B72">from</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;vue&#39;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">isOpen</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">ref</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">false</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">toggleMenu</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">  isOpen.value </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">!</span><span style="color: #C9D1D9">isOpen.value</span></span>\n<span class="line"><span style="color: #C9D1D9">}</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #FF7B72">export</span><span style="color: #FFA657"> </span><span style="color: #FF7B72">default</span><span style="color: #FFA657"> </span><span style="color: #FF7B72">function</span><span style="color: #FFA657"> </span><span style="color: #D2A8FF">useMenu</span><span style="color: #FFA657">() </span><span style="color: #C9D1D9">{</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">    isOpen: </span><span style="color: #D2A8FF">readonly</span><span style="color: #C9D1D9">(isOpen),</span></span>\n<span class="line"><span style="color: #C9D1D9">    toggleMenu,</span></span>\n<span class="line"><span style="color: #C9D1D9">  }</span></span>\n<span class="line"><span style="color: #C9D1D9">}</span></span></code></pre>\n<p>Today I am going to introduce how to write a composable in Vue 3 to bring in the Amazon IVS video player SDK and to connect to my Amazon IVS streaming channel.</p>\n<p>If you have wanted to learn more about how to write Vue 3 composables to use third-party technologies, this will be useful to you. In this post, I\u2019ll cover:</p>\n<ul>\n<li>Writing a Vue composable to bring in an external script</li>\n<li>Writing a Vue composable that is dependent on another composable, utilizing the Javascript function <code is:raw>setInterval</code></li>\n<li>Amazon IVS integration using Vue 3 composables</li>\n</ul>\n<h3 id="background-to-the-series">Background to the Series</h3>\n<p>In the <a href="https://blog.deepgram.com/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/">first post</a> in the series, I explained how to build a live streaming web application using just Vanilla JS and HTML. That post covers setting up an Amazon IVS account, which is necessary to get the third-party technology example (Amazon IVS) in today\u2019s post working. <strong>Setting up an Amazon IVS channel is necessary to build the second composable in this tutorial, but the first one can be built without doing that</strong>.</p>\n<p>In the second post, I started building a full-stack application using Vue 3. I set up Vue-Router, Vuex, and a backend server which all helped me build a feature to restrict access to the streaming page of my site. Visitors to the site are required to enter a code, and that code is verified on the backend, resulting in the user being able to navigate to the streaming page. <strong>There is no need to read that post to be able to go through this tutorial on composables.</strong></p>\n<p>Today I\u2019ll build the video streaming page in Vue 3, focusing on building this feature with Vue composables. If you want a refresher on Vue composables, check out my post <a href="https://blog.deepgram.com/diving-into-vue-3-reusability-with-composables/">Reusability with Composables</a>.</p>\n<p>The code for today\u2019s tutorial can be found in <a href="https://github.com/deepgram-devs/livestream-amazonIVS-and-deepgram/tree/amazonIVS-composables">this Github repo</a>, the branch named \u201CamazonIVS-composables.\u201D</p>\n<p>Now I\u2019ll get into it!</p>\n<h2 id="files-organization">Files Organization</h2>\n<p>This project has two main views, the landing page and the streaming page. Today I\u2019ll be working entirely in the streaming page. In my project, I have named this file <code is:raw>StreamChannel.vue</code>, and it is in the <code is:raw>Views</code> folder.</p>\n<p>The <code is:raw>StreamChannel.vue</code> will eventually be made up of two components - one for <strong>the video player</strong> that relies on the Amazon IVS technology and one for the <strong>closed-captions</strong> that relies on the Deepgram speech-to-text technology. Today I\u2019ll only build the video player component.</p>\n<p>I\u2019ll set up two folders to start - a <code is:raw>components</code> folder and a <code is:raw>composables</code> folder, both in the <code is:raw>src</code> folder. In the <code is:raw>components</code> folder, I\u2019ll create a <code is:raw>VideoPlayer.vue</code> component.</p>\n<p>The <code is:raw>composables</code> folder is where I will put the composition functions that contain the logic that makes the video player work. <strong>A common practice in Vue 3 is to name composables so that they begin with \u2018use\u2019.</strong> The name will identify what the composable does. The two composables I will be writing today are <code is:raw>useIVSPlayer</code> and <code is:raw>useIVSChannel</code>. Here is what they will do:</p>\n<ol>\n<li>\n<p><code is:raw>useIVSPlayer.js</code> - this composable will bring in the <a href="https://docs.aws.amazon.com/ivs/latest/userguide/player-web.html">Amazon IVS video player script</a> so that the HTML video element is enhanced with the Amazon IVS Player Web SDK.</p>\n</li>\n<li>\n<p><code is:raw>useIVSChannel.js</code> - this composable will check at an interval if the player in the <code is:raw>useIVSPlayer</code> script has loaded, and if it has, it will create a connection to my Amazon IVS channel, updating state to show that the channel is connected.</p>\n</li>\n</ol>\n<p>My <a href="https://github.com/deepgram-devs/livestream-amazonIVS-and-deepgram/tree/amazonIVS-composables/src">Github repo</a> for this project shows how I have set up these folders.</p>\n<h2 id="videoplayer-component">VideoPlayer Component</h2>\n<p>The <code is:raw>VideoPlayer.vue</code> component will be a video player that shows the live stream. The Amazon IVS video player script looks for an HTML <code is:raw>&lt;video&gt;</code> element with a specific ID and then takes control of that element to bring in its own specially made video player with Amazon IVS optimizations. So the first composable I write will be <strong>a function that brings in the Amazon IVS player with a script</strong>.</p>\n<p>In the <code is:raw>VideoPlayer.vue</code> file, I will start by writing the HTML I need in the Vue template so that I have a basic video player. I\u2019ve given it a height and a width that I prefer, and the <code is:raw>id="video-player"</code> so that I can use that id later to bring in the Amazon IVS player. The attributes that the html <code is:raw>&lt;video&gt;</code> element supports are listed <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/video#attributes">here</a>.</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">template</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">div</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">p</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">class</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;status&quot;</span><span style="color: #C9D1D9">&gt;AWS Channel {{ IVSStatus }}&lt;/</span><span style="color: #7EE787">p</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">video</span></span>\n<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">width</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;520&quot;</span></span>\n<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">height</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;440&quot;</span></span>\n<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">id</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;video-player&quot;</span></span>\n<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">controls</span></span>\n<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">playsinline</span></span>\n<span class="line"><span style="color: #C9D1D9">    &gt;&lt;/</span><span style="color: #7EE787">video</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;/</span><span style="color: #7EE787">div</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">&lt;/</span><span style="color: #7EE787">template</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>\n<p>The <code is:raw>IVSStatus</code> will be set to a <code is:raw>ref</code> property. For now, I\u2019ll make that property a string \u2018Is Not Connected,\u2019 but later, it will be hooked up to the status of the channel, and it will update to say \u2018Is Connected\u2019 when the channel is available.</p>\n<p>Here is my setup function in the script block with that <code is:raw>ref</code>:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">import </span><span style="color: #FF7B72">{</span><span style="color: #C9D1D9"> ref </span><span style="color: #FF7B72">}</span><span style="color: #C9D1D9"> from &quot;vue&quot;;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">export default </span><span style="color: #FF7B72">{</span></span>\n<span class="line"><span style="color: #C9D1D9">  name: </span><span style="color: #A5D6FF">&quot;VideoPlayer&quot;</span><span style="color: #C9D1D9">,</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #D2A8FF">setup</span><span style="color: #C9D1D9">() {</span></span>\n<span class="line"><span style="color: #C9D1D9">    let IVSStatus </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">ref</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&quot;Is Not Connected&quot;</span><span style="color: #C9D1D9">);</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">    return { IVSStatus };</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">}</span><span style="color: #C9D1D9">,</span></span>\n<span class="line"><span style="color: #C9D1D9">};</span></span>\n<span class="line"><span style="color: #C9D1D9">&lt;/</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>\n<p>The last thing I need to do to be able to see this video player is add the component to the <code is:raw>StreamChannel.vue</code> page in src/views/StreamChannel.vue:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">template</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">div</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">h1</span><span style="color: #C9D1D9">&gt;Stream Channel&lt;/</span><span style="color: #7EE787">h1</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">video-player</span><span style="color: #C9D1D9"> /&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;/</span><span style="color: #7EE787">div</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">&lt;/</span><span style="color: #7EE787">template</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> VideoPlayer </span><span style="color: #FF7B72">from</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;@/components/VideoPlayer&#39;</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">export</span><span style="color: #FFA657"> </span><span style="color: #FF7B72">default</span><span style="color: #FFA657"> {</span></span>\n<span class="line"><span style="color: #FFA657">    </span><span style="color: #C9D1D9">name: </span><span style="color: #A5D6FF">&#39;StreamChannel&#39;</span><span style="color: #FFA657">,</span></span>\n<span class="line"><span style="color: #FFA657">    </span><span style="color: #C9D1D9">components: {</span></span>\n<span class="line"><span style="color: #C9D1D9">      VideoPlayer,</span></span>\n<span class="line"><span style="color: #C9D1D9">    }</span><span style="color: #FFA657">,</span></span>\n<span class="line"><span style="color: #FFA657">  }</span></span>\n<span class="line"><span style="color: #C9D1D9">&lt;/</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>\n<p>Here is how the page will look:</p>\n<p><img src="https://res.cloudinary.com/deepgram/image/upload/v1647979619/blog/2022/03/how-to-write-vue-3-composables-for-a-third-party-API-integration/VideoPlayerComponent.png" alt="Video Player Page"></p>\n<p>Now I am ready to write the first composable, the <code is:raw>useIVSPlayer.js</code> composition function, which will do the logic to bring in the Amazon IVS player.</p>\n<h2 id="composable-to-bring-in-an-external-script">Composable to Bring in An External Script</h2>\n<p>The <code is:raw>useIVSPlayer.js</code> composable will bring a script into my <code is:raw>StreamChannel.vue</code> component. The <a href="https://docs.aws.amazon.com/ivs/latest/userguide/player-web.html">docs</a> at Amazon IVS say that I need this script so that the player is brought in:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">src</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;https://player.live-video.net/1.8.0/amazon-ivs-player.min.js&quot;</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>\n<p>One way to bring in an external script is to add the script to the <code is:raw>&lt;head&gt;</code> in my <code is:raw>index.html</code> page:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">head</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">meta</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">charset</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;utf-8&quot;</span><span style="color: #C9D1D9"> /&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  ...</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">script</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">type</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;text/javascript&quot;</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">src</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;https://player.live-video.net/1.8.0/amazon-ivs-player.min.js&quot;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &gt;&lt;/</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">&lt;/</span><span style="color: #7EE787">head</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>\n<p>Then I can type \u201CIVSPlayer\u201D in the console, and I should see the module there.</p>\n<img src="https://res.cloudinary.com/deepgram/image/upload/v1647979619/blog/2022/03/how-to-write-vue-3-composables-for-a-third-party-API-integration/ConsoleIVSPlayer.png" alt="IVSPlayer in console" style="width: 50%; margin:auto;" />\n<p>If I choose this way to bring in the script, the module will be available on every page of my application. However, sometimes it is preferable to make a third-party technology only available on the page where it is needed. In that case, I need to remove that script from the <code is:raw>&lt;head&gt;</code> and bring it in a different way.</p>\n<p>If I only want to bring in the script on the <code is:raw>StreamChannel.vue</code> page, I need to write logic to <strong>build out the script tag with the src of the player URL</strong>. I will use a Vue composable, which is just a Javascript function, to build out this logic. Writing it as a composable makes it reusable, so I can easily copy it into other projects or bring it into other components in my application as needed.</p>\n<p>This <code is:raw>useIVSPlayer.js</code> composable will:</p>\n<ul>\n<li>be a <strong>Promise</strong>, since I need to account for the small amount of time it will take to load the script</li>\n<li>use <code is:raw>createElement</code> to create the script tag and <code is:raw>setAttribute</code> to add the src</li>\n<li>append the script to the head with <code is:raw>appendChild</code></li>\n<li>use the global event listener <code is:raw>onload</code> to trigger the promise being resolved</li>\n</ul>\n<p>Here is the composable:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">export</span><span style="color: #FFA657"> </span><span style="color: #FF7B72">default</span><span style="color: #FFA657"> </span><span style="color: #FF7B72">new</span><span style="color: #FFA657"> </span><span style="color: #79C0FF">Promise</span><span style="color: #FFA657">((res) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #FFA657"> </span><span style="color: #C9D1D9">{</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">script</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> document.</span><span style="color: #D2A8FF">createElement</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;script&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #C9D1D9">  script.</span><span style="color: #D2A8FF">setAttribute</span><span style="color: #C9D1D9">(</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #A5D6FF">&#39;src&#39;</span><span style="color: #C9D1D9">,</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #A5D6FF">&#39;https://player.live-video.net/1.6.1/amazon-ivs-player.min.js&#39;</span></span>\n<span class="line"><span style="color: #C9D1D9">  )</span></span>\n<span class="line"><span style="color: #C9D1D9">  document.head.</span><span style="color: #D2A8FF">appendChild</span><span style="color: #C9D1D9">(script)</span></span>\n<span class="line"><span style="color: #C9D1D9">  script.</span><span style="color: #D2A8FF">onload</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">res</span><span style="color: #C9D1D9">()</span></span>\n<span class="line"><span style="color: #C9D1D9">  script.</span><span style="color: #D2A8FF">onerror</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">throw</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;IVS PLAYER ERROR&#39;</span></span>\n<span class="line"><span style="color: #C9D1D9">  }</span></span>\n<span class="line"><span style="color: #C9D1D9">}</span><span style="color: #FFA657">)</span></span></code></pre>\n<p>I start with <code is:raw>export default</code> because I need to be able to import this logic into my <code is:raw>VideoPlayer.vue</code> component.</p>\n<p>Now in <code is:raw>VideoPlayer.vue</code> I can import the composable. I am going to use a <code is:raw>.then()</code> method because <code is:raw>useIVSPlayer</code> is a promise. The <code is:raw>.then()</code> method will wait for the promise to resolve before doing whatever I write inside the <code is:raw>.then()</code>.</p>\n<p>For now, I will check that the player is available and <code is:raw>console.log</code> that it is ready. Later, I\u2019ll add logic inside the <code is:raw>.then()</code> to bring in my streaming channel.</p>\n<p>Here is the <code is:raw>setup</code> function now in the <code is:raw>VideoPlayer.vue</code> component:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #D2A8FF">setup</span><span style="color: #C9D1D9">() {</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">let</span><span style="color: #C9D1D9"> IVSStatus </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">ref</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&quot;Is Not Connected&quot;</span><span style="color: #C9D1D9">);</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">    useIVSPlayer.</span><span style="color: #D2A8FF">then</span><span style="color: #C9D1D9">(() </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (window.IVSPlayer) {</span></span>\n<span class="line"><span style="color: #C9D1D9">        console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&quot;player loaded&quot;</span><span style="color: #C9D1D9">);</span></span>\n<span class="line"><span style="color: #C9D1D9">      }</span></span>\n<span class="line"><span style="color: #C9D1D9">    });</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> { IVSStatus };</span></span>\n<span class="line"><span style="color: #C9D1D9">  },</span></span></code></pre>\n<p>For now, I will keep <code is:raw>IVSStatus</code> as \u201CIs Not Connected\u201D because even though I have brought in the Amazon IVS player, I still need to hook up the video player to my channel stream. I\u2019ll do that in the next section.</p>\n<h2 id="composable-to-play-channel-stream">Composable to Play Channel Stream</h2>\n<p>Now I want to build a composable that will load my channel stream into the IVS player that I just brought in. This composable will do the following:</p>\n<ul>\n<li>Check that the IVS Player script is loaded and then create a new player that I can use for my stream.</li>\n<li>Load my channel stream into the player by adding the playback URL.</li>\n<li>Turn the player on with the <code is:raw>play()</code> method.</li>\n<li>Check that the stream is connected and loaded. This will be done with <code is:raw>setInterval</code> since I don\u2019t know how long the delay might be.</li>\n</ul>\n<p>First, I\u2019ll write my composable with an <code is:raw>export default</code> so I can import it into other files as needed. I\u2019ll also bring in <code is:raw>ref</code> from vue so I can track the state of the channel being loaded. I\u2019ll create a <code is:raw>ref</code> variable called <code is:raw>playerIsLoaded</code> and set it to <code is:raw>false</code> to start:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> { ref } </span><span style="color: #FF7B72">from</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;vue&#39;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #FF7B72">export</span><span style="color: #FFA657"> </span><span style="color: #FF7B72">default</span><span style="color: #FFA657"> </span><span style="color: #FF7B72">function</span><span style="color: #FFA657"> </span><span style="color: #D2A8FF">useIVSChannel</span><span style="color: #FFA657">() </span><span style="color: #C9D1D9">{</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">let</span><span style="color: #C9D1D9"> playerIsLoaded </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">ref</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">false</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> { playerIsLoaded }</span></span>\n<span class="line"><span style="color: #C9D1D9">}</span></span></code></pre>\n<p>Everything I need to do in this composable is dependent on the IVS player (the one I brought in with the <code is:raw>useIVSPlayer</code> composable) being loaded. So I\u2019ll wrap all my logic in an <code is:raw>if</code> statement to check that it is loaded and supported.</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (window.IVSPlayer </span><span style="color: #FF7B72">&amp;&amp;</span><span style="color: #C9D1D9"> window.IVSPlayer.isPlayerSupported) {</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">// all logic here</span></span>\n<span class="line"><span style="color: #C9D1D9">}</span></span></code></pre>\n<p>I\u2019ll use the player SDK\u2019s method <code is:raw>create()</code> to create a player for my channel. Then I\u2019ll attach the player to the HTML video element in my <code is:raw>VideoPlayer.vue</code> component with the SDK\u2019s <code is:raw>attachHTMLVideoElement()</code> method and I\u2019ll use <code is:raw>.load()</code> to load my channel\u2019s playback URL. I\u2019ll use <code is:raw>play()</code> to play the channel stream:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">player</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> window.IVSPlayer.</span><span style="color: #D2A8FF">create</span><span style="color: #C9D1D9">()</span></span>\n<span class="line"><span style="color: #C9D1D9">player.</span><span style="color: #D2A8FF">attachHTMLVideoElement</span><span style="color: #C9D1D9">(document.</span><span style="color: #D2A8FF">getElementById</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;video-player&#39;</span><span style="color: #C9D1D9">))</span></span>\n<span class="line"><span style="color: #C9D1D9">player.</span><span style="color: #D2A8FF">load</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;PLAYBACK_URL&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #C9D1D9">player.</span><span style="color: #D2A8FF">play</span><span style="color: #C9D1D9">()</span></span></code></pre>\n<p>(The playback URL is unique to my channel, so it has to be taken from the Amazon IVS console. See my walkthrough in <a href="https://deploy-preview-631--romantic-gates-9c0b5e.netlify.app/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/">this post</a> for more information.)</p>\n<p>Now I need to check that the channel stream is loaded. This won\u2019t happen instantaneously, but it should load relatively quickly. I don\u2019t want to use a <code is:raw>setTimeout </code>because I don\u2019t know how long it will take and I\u2019m concerned about the idea of adding a super long timeout if I don\u2019t have to. I\u2019ll use <code is:raw>setInterval</code> to check for the stream being loaded.</p>\n<p><code is:raw>setInterval</code> is a DOM API method that repeatedly calls a function until some other trigger happens to turn it off. In this case, the other trigger will be the channel being loaded.</p>\n<p>The way to turn it off is to use <code is:raw>clearInterval</code>. I\u2019m going to assign <code is:raw>setInterval</code> to a variable called <code is:raw>checkInterval</code>. The callback of <code is:raw>setInterval</code> will run every 500 milliseconds. Inside that callback, it will check that the channel has loaded, and once it has, it will set <code is:raw>playerIsLoaded</code> to <code is:raw>true</code> and clear everything by passing <code is:raw>checkInterval</code> to <code is:raw>clearInterval</code>.</p>\n<p>Here\u2019s the logic I just described:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">let</span><span style="color: #C9D1D9"> checkInterval </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">setInterval</span><span style="color: #C9D1D9">(() </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (player.core.isLoaded) {</span></span>\n<span class="line"><span style="color: #C9D1D9">    playerIsLoaded.value </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">true</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #D2A8FF">clearInterval</span><span style="color: #C9D1D9">(checkInterval)</span></span>\n<span class="line"><span style="color: #C9D1D9">  }</span></span>\n<span class="line"><span style="color: #C9D1D9">}, </span><span style="color: #79C0FF">500</span><span style="color: #C9D1D9">)</span></span></code></pre>\n<p>I\u2019ll return the ref <code is:raw>playerIsLoaded</code> from the composable, so I have access to it in the <code is:raw>VideoPlayer.vue</code> component. I want to watch that value so that when it changes, the <code is:raw>IVSStatus</code> value in the <code is:raw>VideoPlayer.vue</code> template updates to show that the channel is connected.</p>\n<p>Here is the composable in its entirety:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> { ref } </span><span style="color: #FF7B72">from</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;vue&#39;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #FF7B72">export</span><span style="color: #FFA657"> </span><span style="color: #FF7B72">default</span><span style="color: #FFA657"> </span><span style="color: #FF7B72">function</span><span style="color: #FFA657"> </span><span style="color: #D2A8FF">useIVSChannel</span><span style="color: #FFA657">() </span><span style="color: #C9D1D9">{</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">let</span><span style="color: #C9D1D9"> playerIsLoaded </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">ref</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">false</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (window.IVSPlayer </span><span style="color: #FF7B72">&amp;&amp;</span><span style="color: #C9D1D9"> window.IVSPlayer.isPlayerSupported) {</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">player</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> window.IVSPlayer.</span><span style="color: #D2A8FF">create</span><span style="color: #C9D1D9">()</span></span>\n<span class="line"><span style="color: #C9D1D9">    player.</span><span style="color: #D2A8FF">attachHTMLVideoElement</span><span style="color: #C9D1D9">(document.</span><span style="color: #D2A8FF">getElementById</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;video-player&#39;</span><span style="color: #C9D1D9">))</span></span>\n<span class="line"><span style="color: #C9D1D9">    player.</span><span style="color: #D2A8FF">load</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;PLAYBACK_URL&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #C9D1D9">    player.</span><span style="color: #D2A8FF">play</span><span style="color: #C9D1D9">()</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">let</span><span style="color: #C9D1D9"> checkInterval </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">setInterval</span><span style="color: #C9D1D9">(() </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (player.core.isLoaded) {</span></span>\n<span class="line"><span style="color: #C9D1D9">        playerIsLoaded.value </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">true</span></span>\n<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #D2A8FF">clearInterval</span><span style="color: #C9D1D9">(checkInterval)</span></span>\n<span class="line"><span style="color: #C9D1D9">      }</span></span>\n<span class="line"><span style="color: #C9D1D9">    }, </span><span style="color: #79C0FF">500</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> { playerIsLoaded }</span></span>\n<span class="line"><span style="color: #C9D1D9">  }</span></span>\n<span class="line"><span style="color: #C9D1D9">}</span></span></code></pre>\n<p>The last thing I need to do to get this working is go back to the <code is:raw>VideoPlayer.vue</code> component and run the composable function inside <code is:raw>setup</code> and update <code is:raw>IVSStatus</code> based on the channel being connected, which I\u2019ll do in the next section.</p>\n<h2 id="run-the-composables">Run the Composables</h2>\n<p>In <code is:raw>VideoPlayer.vue</code>, I will run the <code is:raw>useIVSChannel</code> composable inside <code is:raw>setup</code>. Actually, I\u2019ll run it inside the <code is:raw>.then()</code> that I already wrote earlier, which will cause <code is:raw>useIVSChannel</code> to run after <code is:raw>useIVSPlayer</code> has resolved. (I have to remember to import <code is:raw>useIVSChannel</code> from the <code is:raw>composables</code> folder if I want to use it.)</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">useIVSPlayer.</span><span style="color: #D2A8FF">then</span><span style="color: #C9D1D9">(() </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> { </span><span style="color: #79C0FF">playerIsLoaded</span><span style="color: #C9D1D9"> } </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">useIVSChannel</span><span style="color: #C9D1D9">()</span></span>\n<span class="line"><span style="color: #C9D1D9">})</span></span></code></pre>\n<p>I deconstruct <code is:raw>playerIsLoaded</code> off of <code is:raw>useIVSChannel</code> so that I can watch that reactive reference. I\u2019ll use Vue\u2019s <code is:raw>watch</code> method to make a side effect occur when the <code is:raw>playerIsLoaded</code> value changes to true (i.e., when the channel is connected). The side effect will be that the <code is:raw>IVSStatus</code> will update to \u201CIs Connected\u201D:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #D2A8FF">watch</span><span style="color: #C9D1D9">(playerIsLoaded, () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (playerIsLoaded.value) {</span></span>\n<span class="line"><span style="color: #C9D1D9">    IVSStatus.value </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;Is Connected&#39;</span></span>\n<span class="line"><span style="color: #C9D1D9">  }</span></span>\n<span class="line"><span style="color: #C9D1D9">})</span></span></code></pre>\n<p>Here is the entire script for the <code is:raw>VideoPlayer.vue</code> component:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">import </span><span style="color: #FF7B72">{</span><span style="color: #C9D1D9"> ref, watch </span><span style="color: #FF7B72">}</span><span style="color: #C9D1D9"> from &quot;vue&quot;;</span></span>\n<span class="line"><span style="color: #C9D1D9">import useIVSPlayer from &quot;../composables/useIVSPlayer&quot;;</span></span>\n<span class="line"><span style="color: #C9D1D9">import useIVSChannel from &quot;../composables/useIVSChannel&quot;;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">export default </span><span style="color: #FF7B72">{</span></span>\n<span class="line"><span style="color: #C9D1D9">  name: </span><span style="color: #A5D6FF">&quot;VideoPlayer&quot;</span><span style="color: #C9D1D9">,</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #D2A8FF">setup</span><span style="color: #C9D1D9">() {</span></span>\n<span class="line"><span style="color: #C9D1D9">    let IVSStatus </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">ref</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&quot;Is Not Connected&quot;</span><span style="color: #C9D1D9">);</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">    useIVSPlayer.then(() =&gt; {</span></span>\n<span class="line"><span style="color: #C9D1D9">      const { playerIsLoaded } </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">useIVSChannel</span><span style="color: #C9D1D9">();</span></span>\n<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #D2A8FF">watch</span><span style="color: #C9D1D9">(playerIsLoaded, () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (playerIsLoaded.value) {</span></span>\n<span class="line"><span style="color: #C9D1D9">          IVSStatus.value </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&quot;Is Connected&quot;</span><span style="color: #C9D1D9">;</span></span>\n<span class="line"><span style="color: #C9D1D9">        }</span></span>\n<span class="line"><span style="color: #C9D1D9">      });</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">}</span><span style="color: #C9D1D9">);</span></span>\n<span class="line"><span style="color: #C9D1D9">    return </span><span style="color: #FF7B72">{</span><span style="color: #C9D1D9"> IVSStatus </span><span style="color: #FF7B72">}</span><span style="color: #C9D1D9">;</span></span>\n<span class="line"><span style="color: #C9D1D9">  },</span></span>\n<span class="line"><span style="color: #C9D1D9">};</span></span>\n<span class="line"><span style="color: #C9D1D9">&lt;/</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>\n<p>However, nothing will happen in my video player in the browser if I have not turned on my stream. In <a href="https://deploy-preview-631--romantic-gates-9c0b5e.netlify.app/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/">the first post</a> in this series, I showed how to set up OBS to use their software on my computer to create a stream, which I connected to an Amazon IVS channel.</p>\n<p>If I turn on my stream in OBS, I should see myself in the video player in my application now!</p>\n<p><img src="https://res.cloudinary.com/deepgram/image/upload/v1647979619/blog/2022/03/how-to-write-vue-3-composables-for-a-third-party-API-integration/VideoStreamWorking.png" alt="Video Stream working"></p>\n<h2 id="conclusion">Conclusion</h2>\n<p>Vue composables are useful for writing standalone logic that can be reused, but if one composable depends on another, it can be tricky. In this post, I showed how a composable can be written as a promise and how <code is:raw>setInterval</code> can be used to check if something the composable depends on has happened yet. These are two ways to write composables that may have asynchronous events occurring.</p>\n<p>In the next post, I\u2019ll show how to write composables for using Deepgram\u2019s API to create text captions for my stream. I\u2019ll write a composable to use the browser MediaStreams API (a great example of a composable that can be reused in different contexts). I\u2019ll also show how to use <code is:raw>fetch</code> in a composable to get a token from the backend.</p>\n<p>I hope you\u2019ll join me for the next post. Follow me on <a href="https://twitter.com/sandra_rodgers_">Twitter</a> so you don\u2019t miss it!</p>' };
const frontmatter = { "title": "How to Write Vue 3 Composables for a Third-Party API Integration", "description": "In this series, learn how to build a live streaming web application using Deepgram's speech-to-text API and Amazon Interactive Video Service.", "date": "2022-03-25T00:00:00.000Z", "cover": "https://res.cloudinary.com/deepgram/image/upload/v1647979609/blog/2022/03/how-to-write-vue-3-composables-for-a-third-party-API-integration/Building-Livestreaming-w-AmazonIVS.jpg", "authors": ["sandra-rodgers"], "category": "tutorial", "tags": ["aws", "javascript", "vuejs"], "seo": { "title": "How to Write Vue 3 Composables for a Third-Party API Integration", "description": "In this series, learn how to build a live streaming web application using Deepgram's speech-to-text API and Amazon Interactive Video Service." }, "shorturls": { "share": "https://dpgr.am/57da115", "twitter": "https://dpgr.am/54e93b8", "linkedin": "https://dpgr.am/f27181e", "reddit": "https://dpgr.am/7b9f73b", "facebook": "https://dpgr.am/c3ea449" }, "og": { "image": "https://res.cloudinary.com/deepgram/image/upload/v1661454030/blog/how-to-write-vue-3-composables-for-a-third-party-api-integration/ograph.png" }, "astro": { "headings": [{ "depth": 2, "slug": "introduction", "text": "Introduction" }, { "depth": 3, "slug": "composables", "text": "Composables" }, { "depth": 4, "slug": "composable-example-usemenujs", "text": "Composable Example useMenu.js" }, { "depth": 3, "slug": "background-to-the-series", "text": "Background to the Series" }, { "depth": 2, "slug": "files-organization", "text": "Files Organization" }, { "depth": 2, "slug": "videoplayer-component", "text": "VideoPlayer Component" }, { "depth": 2, "slug": "composable-to-bring-in-an-external-script", "text": "Composable to Bring in An External Script" }, { "depth": 2, "slug": "composable-to-play-channel-stream", "text": "Composable to Play Channel Stream" }, { "depth": 2, "slug": "run-the-composables", "text": "Run the Composables" }, { "depth": 2, "slug": "conclusion", "text": "Conclusion" }], "source": "\n## Introduction\n\nThis post is a continuation of the series \"How to Build a Live Streaming Web Application with Amazon IVS and Deepgram.\"\n\n<Panel type=\"info\" title=\"Build a Live Streaming Web Application with Amazon IVS and Deepgram (SERIES)\">\n<ol> \n<li><a href=\"https://blog.deepgram.com/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/\">How to Build a Live Streaming Web Application with Amazon IVS and Deepgram</a></li>\n<li><a href=\"https://blog.deepgram.com/build-a-livestream-web-application-vue-and-express-setup/\"> Build a Live Streaming Web Application: Vue and Express Setup</a></li>\n<li><a href=\"https://blog.deepgram.com/how-to-write-vue-3-composables-for-a-third-party-API-integration/\"> How to Write Vue 3 Composables for a Third-Party API Integration</a></li>\n\n<li><a href=\"https://blog.deepgram.com/asynchronous-logic-to-write-a-vue-3-and-deepgram-captions-component/\"> Asynchronous Logic to Write a Vue 3 and Deepgram Captions Component</a></li>\n</ol>\n</Panel>\n\n### Composables\n\nIn Vue.js, the term 'composables' refers to composition functions, a key feature of Vue 3's Composition API. While the API itself includes many composition functions that are core to its design, such as the `setup()` function or the reactivity functions `ref()` and `reactive()`, composables are those composition functions that I write myself to be used throughout my own project as needed.\n\nComposables are functions that encapsulate stateful logic, which means they are like little packages that are focused around performing one logical concern, and they keep track of state that changes due to the function running.\n\nFor example, I could write a composable function that toggles a menu open or closed. That logic could be used throughout an application, and it would need to keep track of the state of the menu being opened or closed. I would just need to import the composable into whatever file I need it and run the function.\n\n#### Composable Example `useMenu.js`\n\n```js\nimport { readonly, ref } from 'vue'\n\nconst isOpen = ref(false)\nconst toggleMenu = () => {\n  isOpen.value = !isOpen.value\n}\n\nexport default function useMenu() {\n  return {\n    isOpen: readonly(isOpen),\n    toggleMenu,\n  }\n}\n```\n\nToday I am going to introduce how to write a composable in Vue 3 to bring in the Amazon IVS video player SDK and to connect to my Amazon IVS streaming channel.\n\nIf you have wanted to learn more about how to write Vue 3 composables to use third-party technologies, this will be useful to you. In this post, I'll cover:\n\n*   Writing a Vue composable to bring in an external script\n*   Writing a Vue composable that is dependent on another composable, utilizing the Javascript function `setInterval`\n*   Amazon IVS integration using Vue 3 composables\n\n### Background to the Series\n\nIn the [first post](https://blog.deepgram.com/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/) in the series, I explained how to build a live streaming web application using just Vanilla JS and HTML. That post covers setting up an Amazon IVS account, which is necessary to get the third-party technology example (Amazon IVS) in today's post working. **Setting up an Amazon IVS channel is necessary to build the second composable in this tutorial, but the first one can be built without doing that**.\n\nIn the second post, I started building a full-stack application using Vue 3. I set up Vue-Router, Vuex, and a backend server which all helped me build a feature to restrict access to the streaming page of my site. Visitors to the site are required to enter a code, and that code is verified on the backend, resulting in the user being able to navigate to the streaming page. **There is no need to read that post to be able to go through this tutorial on composables.**\n\nToday I'll build the video streaming page in Vue 3, focusing on building this feature with Vue composables. If you want a refresher on Vue composables, check out my post [Reusability with Composables](https://blog.deepgram.com/diving-into-vue-3-reusability-with-composables/).\n\nThe code for today's tutorial can be found in [this Github repo](https://github.com/deepgram-devs/livestream-amazonIVS-and-deepgram/tree/amazonIVS-composables), the branch named \"amazonIVS-composables.\"\n\nNow I'll get into it!\n\n## Files Organization\n\nThis project has two main views, the landing page and the streaming page. Today I'll be working entirely in the streaming page. In my project, I have named this file `StreamChannel.vue`, and it is in the `Views` folder.\n\nThe `StreamChannel.vue` will eventually be made up of two components - one for **the video player** that relies on the Amazon IVS technology and one for the **closed-captions** that relies on the Deepgram speech-to-text technology. Today I'll only build the video player component.\n\nI'll set up two folders to start - a `components` folder and a `composables` folder, both in the `src` folder. In the `components` folder, I'll create a `VideoPlayer.vue` component.\n\nThe `composables` folder is where I will put the composition functions that contain the logic that makes the video player work. **A common practice in Vue 3 is to name composables so that they begin with 'use'.** The name will identify what the composable does. The two composables I will be writing today are `useIVSPlayer` and `useIVSChannel`. Here is what they will do:\n\n1.  `useIVSPlayer.js` - this composable will bring in the [Amazon IVS video player script](https://docs.aws.amazon.com/ivs/latest/userguide/player-web.html) so that the HTML video element is enhanced with the Amazon IVS Player Web SDK.\n\n2.  `useIVSChannel.js` - this composable will check at an interval if the player in the `useIVSPlayer` script has loaded, and if it has, it will create a connection to my Amazon IVS channel, updating state to show that the channel is connected.\n\nMy [Github repo](https://github.com/deepgram-devs/livestream-amazonIVS-and-deepgram/tree/amazonIVS-composables/src) for this project shows how I have set up these folders.\n\n## VideoPlayer Component\n\nThe `VideoPlayer.vue` component will be a video player that shows the live stream. The Amazon IVS video player script looks for an HTML `<video>` element with a specific ID and then takes control of that element to bring in its own specially made video player with Amazon IVS optimizations. So the first composable I write will be **a function that brings in the Amazon IVS player with a script**.\n\nIn the `VideoPlayer.vue` file, I will start by writing the HTML I need in the Vue template so that I have a basic video player. I've given it a height and a width that I prefer, and the `id=\"video-player\"` so that I can use that id later to bring in the Amazon IVS player. The attributes that the html `<video>` element supports are listed [here](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/video#attributes).\n\n```html\n<template>\n  <div>\n    <p class=\"status\">AWS Channel {{ IVSStatus }}</p>\n    <video\n      width=\"520\"\n      height=\"440\"\n      id=\"video-player\"\n      controls\n      playsinline\n    ></video>\n  </div>\n</template>\n```\n\nThe `IVSStatus` will be set to a `ref` property. For now, I'll make that property a string 'Is Not Connected,' but later, it will be hooked up to the status of the channel, and it will update to say 'Is Connected' when the channel is available.\n\nHere is my setup function in the script block with that `ref`:\n\n```js\n<script>\nimport { ref } from \"vue\";\n\nexport default {\n  name: \"VideoPlayer\",\n  setup() {\n    let IVSStatus = ref(\"Is Not Connected\");\n\n    return { IVSStatus };\n  },\n};\n<\/script>\n```\n\nThe last thing I need to do to be able to see this video player is add the component to the `StreamChannel.vue` page in src/views/StreamChannel.vue:\n\n```html\n<template>\n  <div>\n    <h1>Stream Channel</h1>\n    <video-player />\n  </div>\n</template>\n\n<script>\n  import VideoPlayer from '@/components/VideoPlayer'\n  export default {\n    name: 'StreamChannel',\n    components: {\n      VideoPlayer,\n    },\n  }\n<\/script>\n```\n\nHere is how the page will look:\n\n![Video Player Page](https://res.cloudinary.com/deepgram/image/upload/v1647979619/blog/2022/03/how-to-write-vue-3-composables-for-a-third-party-API-integration/VideoPlayerComponent.png)\n\nNow I am ready to write the first composable, the `useIVSPlayer.js` composition function, which will do the logic to bring in the Amazon IVS player.\n\n## Composable to Bring in An External Script\n\nThe `useIVSPlayer.js` composable will bring a script into my `StreamChannel.vue` component. The [docs](https://docs.aws.amazon.com/ivs/latest/userguide/player-web.html) at Amazon IVS say that I need this script so that the player is brought in:\n\n```html\n<script src=\"https://player.live-video.net/1.8.0/amazon-ivs-player.min.js\">\n```\n\nOne way to bring in an external script is to add the script to the `<head>` in my `index.html` page:\n\n```html\n<head>\n  <meta charset=\"utf-8\" />\n  ...\n  <script\n    type=\"text/javascript\"\n    src=\"https://player.live-video.net/1.8.0/amazon-ivs-player.min.js\"\n  ><\/script>\n</head>\n```\n\nThen I can type \"IVSPlayer\" in the console, and I should see the module there.\n\n<img src=\"https://res.cloudinary.com/deepgram/image/upload/v1647979619/blog/2022/03/how-to-write-vue-3-composables-for-a-third-party-API-integration/ConsoleIVSPlayer.png\" alt=\"IVSPlayer in console\" style=\"width: 50%; margin:auto;\">\n\nIf I choose this way to bring in the script, the module will be available on every page of my application. However, sometimes it is preferable to make a third-party technology only available on the page where it is needed. In that case, I need to remove that script from the `<head>` and bring it in a different way.\n\nIf I only want to bring in the script on the `StreamChannel.vue` page, I need to write logic to **build out the script tag with the src of the player URL**. I will use a Vue composable, which is just a Javascript function, to build out this logic. Writing it as a composable makes it reusable, so I can easily copy it into other projects or bring it into other components in my application as needed.\n\nThis `useIVSPlayer.js` composable will:\n\n*   be a **Promise**, since I need to account for the small amount of time it will take to load the script\n*   use `createElement` to create the script tag and `setAttribute` to add the src\n*   append the script to the head with `appendChild`\n*   use the global event listener `onload` to trigger the promise being resolved\n\nHere is the composable:\n\n```js\nexport default new Promise((res) => {\n  const script = document.createElement('script')\n  script.setAttribute(\n    'src',\n    'https://player.live-video.net/1.6.1/amazon-ivs-player.min.js'\n  )\n  document.head.appendChild(script)\n  script.onload = () => res()\n  script.onerror = () => {\n    throw 'IVS PLAYER ERROR'\n  }\n})\n```\n\nI start with `export default` because I need to be able to import this logic into my `VideoPlayer.vue` component.\n\nNow in `VideoPlayer.vue` I can import the composable. I am going to use a `.then()` method because `useIVSPlayer` is a promise. The `.then()` method will wait for the promise to resolve before doing whatever I write inside the `.then()`.\n\nFor now, I will check that the player is available and `console.log` that it is ready. Later, I'll add logic inside the `.then()` to bring in my streaming channel.\n\nHere is the `setup` function now in the `VideoPlayer.vue` component:\n\n```js\nsetup() {\n    let IVSStatus = ref(\"Is Not Connected\");\n\n    useIVSPlayer.then(() => {\n      if (window.IVSPlayer) {\n        console.log(\"player loaded\");\n      }\n    });\n    return { IVSStatus };\n  },\n```\n\nFor now, I will keep `IVSStatus` as \"Is Not Connected\" because even though I have brought in the Amazon IVS player, I still need to hook up the video player to my channel stream. I'll do that in the next section.\n\n## Composable to Play Channel Stream\n\nNow I want to build a composable that will load my channel stream into the IVS player that I just brought in. This composable will do the following:\n\n*   Check that the IVS Player script is loaded and then create a new player that I can use for my stream.\n*   Load my channel stream into the player by adding the playback URL.\n*   Turn the player on with the `play()` method.\n*   Check that the stream is connected and loaded. This will be done with `setInterval` since I don't know how long the delay might be.\n\nFirst, I'll write my composable with an `export default` so I can import it into other files as needed. I'll also bring in `ref` from vue so I can track the state of the channel being loaded. I'll create a `ref` variable called `playerIsLoaded` and set it to `false` to start:\n\n```js\nimport { ref } from 'vue'\n\nexport default function useIVSChannel() {\n  let playerIsLoaded = ref(false)\n\n  return { playerIsLoaded }\n}\n```\n\nEverything I need to do in this composable is dependent on the IVS player (the one I brought in with the `useIVSPlayer` composable) being loaded. So I'll wrap all my logic in an `if` statement to check that it is loaded and supported.\n\n```js\nif (window.IVSPlayer && window.IVSPlayer.isPlayerSupported) {\n  // all logic here\n}\n```\n\nI'll use the player SDK's method `create()` to create a player for my channel. Then I'll attach the player to the HTML video element in my `VideoPlayer.vue` component with the SDK's `attachHTMLVideoElement()` method and I'll use `.load()` to load my channel's playback URL. I'll use `play()` to play the channel stream:\n\n```js\nconst player = window.IVSPlayer.create()\nplayer.attachHTMLVideoElement(document.getElementById('video-player'))\nplayer.load('PLAYBACK_URL')\nplayer.play()\n```\n\n(The playback URL is unique to my channel, so it has to be taken from the Amazon IVS console. See my walkthrough in [this post](https://deploy-preview-631--romantic-gates-9c0b5e.netlify.app/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/) for more information.)\n\nNow I need to check that the channel stream is loaded. This won't happen instantaneously, but it should load relatively quickly. I don't want to use a `setTimeout `because I don't know how long it will take and I'm concerned about the idea of adding a super long timeout if I don't have to. I'll use `setInterval` to check for the stream being loaded.\n\n`setInterval` is a DOM API method that repeatedly calls a function until some other trigger happens to turn it off. In this case, the other trigger will be the channel being loaded.\n\nThe way to turn it off is to use `clearInterval`. I'm going to assign `setInterval` to a variable called `checkInterval`. The callback of `setInterval` will run every 500 milliseconds. Inside that callback, it will check that the channel has loaded, and once it has, it will set `playerIsLoaded` to `true` and clear everything by passing `checkInterval` to `clearInterval`.\n\nHere's the logic I just described:\n\n```js\nlet checkInterval = setInterval(() => {\n  if (player.core.isLoaded) {\n    playerIsLoaded.value = true\n    clearInterval(checkInterval)\n  }\n}, 500)\n```\n\nI'll return the ref `playerIsLoaded` from the composable, so I have access to it in the `VideoPlayer.vue` component. I want to watch that value so that when it changes, the `IVSStatus` value in the `VideoPlayer.vue` template updates to show that the channel is connected.\n\nHere is the composable in its entirety:\n\n```js\nimport { ref } from 'vue'\n\nexport default function useIVSChannel() {\n  let playerIsLoaded = ref(false)\n\n  if (window.IVSPlayer && window.IVSPlayer.isPlayerSupported) {\n    const player = window.IVSPlayer.create()\n    player.attachHTMLVideoElement(document.getElementById('video-player'))\n    player.load('PLAYBACK_URL')\n    player.play()\n\n    let checkInterval = setInterval(() => {\n      if (player.core.isLoaded) {\n        playerIsLoaded.value = true\n        clearInterval(checkInterval)\n      }\n    }, 500)\n\n    return { playerIsLoaded }\n  }\n}\n```\n\nThe last thing I need to do to get this working is go back to the `VideoPlayer.vue` component and run the composable function inside `setup` and update `IVSStatus` based on the channel being connected, which I'll do in the next section.\n\n## Run the Composables\n\nIn `VideoPlayer.vue`, I will run the `useIVSChannel` composable inside `setup`. Actually, I'll run it inside the `.then()` that I already wrote earlier, which will cause `useIVSChannel` to run after `useIVSPlayer` has resolved. (I have to remember to import `useIVSChannel` from the `composables` folder if I want to use it.)\n\n```js\nuseIVSPlayer.then(() => {\n  const { playerIsLoaded } = useIVSChannel()\n})\n```\n\nI deconstruct `playerIsLoaded` off of `useIVSChannel` so that I can watch that reactive reference. I'll use Vue's `watch` method to make a side effect occur when the `playerIsLoaded` value changes to true (i.e., when the channel is connected). The side effect will be that the `IVSStatus` will update to \"Is Connected\":\n\n```js\nwatch(playerIsLoaded, () => {\n  if (playerIsLoaded.value) {\n    IVSStatus.value = 'Is Connected'\n  }\n})\n```\n\nHere is the entire script for the `VideoPlayer.vue` component:\n\n```js\n<script>\nimport { ref, watch } from \"vue\";\nimport useIVSPlayer from \"../composables/useIVSPlayer\";\nimport useIVSChannel from \"../composables/useIVSChannel\";\n\nexport default {\n  name: \"VideoPlayer\",\n  setup() {\n    let IVSStatus = ref(\"Is Not Connected\");\n\n    useIVSPlayer.then(() => {\n      const { playerIsLoaded } = useIVSChannel();\n      watch(playerIsLoaded, () => {\n        if (playerIsLoaded.value) {\n          IVSStatus.value = \"Is Connected\";\n        }\n      });\n    });\n    return { IVSStatus };\n  },\n};\n<\/script>\n```\n\nHowever, nothing will happen in my video player in the browser if I have not turned on my stream. In [the first post](https://deploy-preview-631--romantic-gates-9c0b5e.netlify.app/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/) in this series, I showed how to set up OBS to use their software on my computer to create a stream, which I connected to an Amazon IVS channel.\n\nIf I turn on my stream in OBS, I should see myself in the video player in my application now!\n\n![Video Stream working](https://res.cloudinary.com/deepgram/image/upload/v1647979619/blog/2022/03/how-to-write-vue-3-composables-for-a-third-party-API-integration/VideoStreamWorking.png)\n\n## Conclusion\n\nVue composables are useful for writing standalone logic that can be reused, but if one composable depends on another, it can be tricky. In this post, I showed how a composable can be written as a promise and how `setInterval` can be used to check if something the composable depends on has happened yet. These are two ways to write composables that may have asynchronous events occurring.\n\nIn the next post, I'll show how to write composables for using Deepgram's API to create text captions for my stream. I'll write a composable to use the browser MediaStreams API (a great example of a composable that can be reused in different contexts). I'll also show how to use `fetch` in a composable to get a token from the backend.\n\nI hope you'll join me for the next post. Follow me on [Twitter](https://twitter.com/sandra_rodgers_) so you don't miss it!\n\n        ", "html": '<h2 id="introduction">Introduction</h2>\n<p>This post is a continuation of the series \u201CHow to Build a Live Streaming Web Application with Amazon IVS and Deepgram.\u201D</p>\n<Panel type="info" title="Build a Live Streaming Web Application with Amazon IVS and Deepgram (SERIES)"><ol><li><a href="https://blog.deepgram.com/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/">How to Build a Live Streaming Web Application with Amazon IVS and Deepgram</a></li>\n<li><a href="https://blog.deepgram.com/build-a-livestream-web-application-vue-and-express-setup/"> Build a Live Streaming Web Application: Vue and Express Setup</a></li>\n<li><a href="https://blog.deepgram.com/how-to-write-vue-3-composables-for-a-third-party-API-integration/"> How to Write Vue 3 Composables for a Third-Party API Integration</a></li><li><a href="https://blog.deepgram.com/asynchronous-logic-to-write-a-vue-3-and-deepgram-captions-component/"> Asynchronous Logic to Write a Vue 3 and Deepgram Captions Component</a></li></ol></Panel>\n<h3 id="composables">Composables</h3>\n<p>In Vue.js, the term \u2018composables\u2019 refers to composition functions, a key feature of Vue 3\u2019s Composition API. While the API itself includes many composition functions that are core to its design, such as the <code is:raw>setup()</code> function or the reactivity functions <code is:raw>ref()</code> and <code is:raw>reactive()</code>, composables are those composition functions that I write myself to be used throughout my own project as needed.</p>\n<p>Composables are functions that encapsulate stateful logic, which means they are like little packages that are focused around performing one logical concern, and they keep track of state that changes due to the function running.</p>\n<p>For example, I could write a composable function that toggles a menu open or closed. That logic could be used throughout an application, and it would need to keep track of the state of the menu being opened or closed. I would just need to import the composable into whatever file I need it and run the function.</p>\n<h4 id="composable-example-usemenujs">Composable Example <code is:raw>useMenu.js</code></h4>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> { readonly, ref } </span><span style="color: #FF7B72">from</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;vue&#39;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">isOpen</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">ref</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">false</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">toggleMenu</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">  isOpen.value </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">!</span><span style="color: #C9D1D9">isOpen.value</span></span>\n<span class="line"><span style="color: #C9D1D9">}</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #FF7B72">export</span><span style="color: #FFA657"> </span><span style="color: #FF7B72">default</span><span style="color: #FFA657"> </span><span style="color: #FF7B72">function</span><span style="color: #FFA657"> </span><span style="color: #D2A8FF">useMenu</span><span style="color: #FFA657">() </span><span style="color: #C9D1D9">{</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">    isOpen: </span><span style="color: #D2A8FF">readonly</span><span style="color: #C9D1D9">(isOpen),</span></span>\n<span class="line"><span style="color: #C9D1D9">    toggleMenu,</span></span>\n<span class="line"><span style="color: #C9D1D9">  }</span></span>\n<span class="line"><span style="color: #C9D1D9">}</span></span></code></pre>\n<p>Today I am going to introduce how to write a composable in Vue 3 to bring in the Amazon IVS video player SDK and to connect to my Amazon IVS streaming channel.</p>\n<p>If you have wanted to learn more about how to write Vue 3 composables to use third-party technologies, this will be useful to you. In this post, I\u2019ll cover:</p>\n<ul>\n<li>Writing a Vue composable to bring in an external script</li>\n<li>Writing a Vue composable that is dependent on another composable, utilizing the Javascript function <code is:raw>setInterval</code></li>\n<li>Amazon IVS integration using Vue 3 composables</li>\n</ul>\n<h3 id="background-to-the-series">Background to the Series</h3>\n<p>In the <a href="https://blog.deepgram.com/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/">first post</a> in the series, I explained how to build a live streaming web application using just Vanilla JS and HTML. That post covers setting up an Amazon IVS account, which is necessary to get the third-party technology example (Amazon IVS) in today\u2019s post working. <strong>Setting up an Amazon IVS channel is necessary to build the second composable in this tutorial, but the first one can be built without doing that</strong>.</p>\n<p>In the second post, I started building a full-stack application using Vue 3. I set up Vue-Router, Vuex, and a backend server which all helped me build a feature to restrict access to the streaming page of my site. Visitors to the site are required to enter a code, and that code is verified on the backend, resulting in the user being able to navigate to the streaming page. <strong>There is no need to read that post to be able to go through this tutorial on composables.</strong></p>\n<p>Today I\u2019ll build the video streaming page in Vue 3, focusing on building this feature with Vue composables. If you want a refresher on Vue composables, check out my post <a href="https://blog.deepgram.com/diving-into-vue-3-reusability-with-composables/">Reusability with Composables</a>.</p>\n<p>The code for today\u2019s tutorial can be found in <a href="https://github.com/deepgram-devs/livestream-amazonIVS-and-deepgram/tree/amazonIVS-composables">this Github repo</a>, the branch named \u201CamazonIVS-composables.\u201D</p>\n<p>Now I\u2019ll get into it!</p>\n<h2 id="files-organization">Files Organization</h2>\n<p>This project has two main views, the landing page and the streaming page. Today I\u2019ll be working entirely in the streaming page. In my project, I have named this file <code is:raw>StreamChannel.vue</code>, and it is in the <code is:raw>Views</code> folder.</p>\n<p>The <code is:raw>StreamChannel.vue</code> will eventually be made up of two components - one for <strong>the video player</strong> that relies on the Amazon IVS technology and one for the <strong>closed-captions</strong> that relies on the Deepgram speech-to-text technology. Today I\u2019ll only build the video player component.</p>\n<p>I\u2019ll set up two folders to start - a <code is:raw>components</code> folder and a <code is:raw>composables</code> folder, both in the <code is:raw>src</code> folder. In the <code is:raw>components</code> folder, I\u2019ll create a <code is:raw>VideoPlayer.vue</code> component.</p>\n<p>The <code is:raw>composables</code> folder is where I will put the composition functions that contain the logic that makes the video player work. <strong>A common practice in Vue 3 is to name composables so that they begin with \u2018use\u2019.</strong> The name will identify what the composable does. The two composables I will be writing today are <code is:raw>useIVSPlayer</code> and <code is:raw>useIVSChannel</code>. Here is what they will do:</p>\n<ol>\n<li>\n<p><code is:raw>useIVSPlayer.js</code> - this composable will bring in the <a href="https://docs.aws.amazon.com/ivs/latest/userguide/player-web.html">Amazon IVS video player script</a> so that the HTML video element is enhanced with the Amazon IVS Player Web SDK.</p>\n</li>\n<li>\n<p><code is:raw>useIVSChannel.js</code> - this composable will check at an interval if the player in the <code is:raw>useIVSPlayer</code> script has loaded, and if it has, it will create a connection to my Amazon IVS channel, updating state to show that the channel is connected.</p>\n</li>\n</ol>\n<p>My <a href="https://github.com/deepgram-devs/livestream-amazonIVS-and-deepgram/tree/amazonIVS-composables/src">Github repo</a> for this project shows how I have set up these folders.</p>\n<h2 id="videoplayer-component">VideoPlayer Component</h2>\n<p>The <code is:raw>VideoPlayer.vue</code> component will be a video player that shows the live stream. The Amazon IVS video player script looks for an HTML <code is:raw>&lt;video&gt;</code> element with a specific ID and then takes control of that element to bring in its own specially made video player with Amazon IVS optimizations. So the first composable I write will be <strong>a function that brings in the Amazon IVS player with a script</strong>.</p>\n<p>In the <code is:raw>VideoPlayer.vue</code> file, I will start by writing the HTML I need in the Vue template so that I have a basic video player. I\u2019ve given it a height and a width that I prefer, and the <code is:raw>id="video-player"</code> so that I can use that id later to bring in the Amazon IVS player. The attributes that the html <code is:raw>&lt;video&gt;</code> element supports are listed <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/video#attributes">here</a>.</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">template</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">div</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">p</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">class</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;status&quot;</span><span style="color: #C9D1D9">&gt;AWS Channel {{ IVSStatus }}&lt;/</span><span style="color: #7EE787">p</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">video</span></span>\n<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">width</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;520&quot;</span></span>\n<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">height</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;440&quot;</span></span>\n<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">id</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;video-player&quot;</span></span>\n<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">controls</span></span>\n<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">playsinline</span></span>\n<span class="line"><span style="color: #C9D1D9">    &gt;&lt;/</span><span style="color: #7EE787">video</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;/</span><span style="color: #7EE787">div</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">&lt;/</span><span style="color: #7EE787">template</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>\n<p>The <code is:raw>IVSStatus</code> will be set to a <code is:raw>ref</code> property. For now, I\u2019ll make that property a string \u2018Is Not Connected,\u2019 but later, it will be hooked up to the status of the channel, and it will update to say \u2018Is Connected\u2019 when the channel is available.</p>\n<p>Here is my setup function in the script block with that <code is:raw>ref</code>:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">import </span><span style="color: #FF7B72">{</span><span style="color: #C9D1D9"> ref </span><span style="color: #FF7B72">}</span><span style="color: #C9D1D9"> from &quot;vue&quot;;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">export default </span><span style="color: #FF7B72">{</span></span>\n<span class="line"><span style="color: #C9D1D9">  name: </span><span style="color: #A5D6FF">&quot;VideoPlayer&quot;</span><span style="color: #C9D1D9">,</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #D2A8FF">setup</span><span style="color: #C9D1D9">() {</span></span>\n<span class="line"><span style="color: #C9D1D9">    let IVSStatus </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">ref</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&quot;Is Not Connected&quot;</span><span style="color: #C9D1D9">);</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">    return { IVSStatus };</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">}</span><span style="color: #C9D1D9">,</span></span>\n<span class="line"><span style="color: #C9D1D9">};</span></span>\n<span class="line"><span style="color: #C9D1D9">&lt;/</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>\n<p>The last thing I need to do to be able to see this video player is add the component to the <code is:raw>StreamChannel.vue</code> page in src/views/StreamChannel.vue:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">template</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">div</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">h1</span><span style="color: #C9D1D9">&gt;Stream Channel&lt;/</span><span style="color: #7EE787">h1</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">video-player</span><span style="color: #C9D1D9"> /&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;/</span><span style="color: #7EE787">div</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">&lt;/</span><span style="color: #7EE787">template</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> VideoPlayer </span><span style="color: #FF7B72">from</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;@/components/VideoPlayer&#39;</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">export</span><span style="color: #FFA657"> </span><span style="color: #FF7B72">default</span><span style="color: #FFA657"> {</span></span>\n<span class="line"><span style="color: #FFA657">    </span><span style="color: #C9D1D9">name: </span><span style="color: #A5D6FF">&#39;StreamChannel&#39;</span><span style="color: #FFA657">,</span></span>\n<span class="line"><span style="color: #FFA657">    </span><span style="color: #C9D1D9">components: {</span></span>\n<span class="line"><span style="color: #C9D1D9">      VideoPlayer,</span></span>\n<span class="line"><span style="color: #C9D1D9">    }</span><span style="color: #FFA657">,</span></span>\n<span class="line"><span style="color: #FFA657">  }</span></span>\n<span class="line"><span style="color: #C9D1D9">&lt;/</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>\n<p>Here is how the page will look:</p>\n<p><img src="https://res.cloudinary.com/deepgram/image/upload/v1647979619/blog/2022/03/how-to-write-vue-3-composables-for-a-third-party-API-integration/VideoPlayerComponent.png" alt="Video Player Page"></p>\n<p>Now I am ready to write the first composable, the <code is:raw>useIVSPlayer.js</code> composition function, which will do the logic to bring in the Amazon IVS player.</p>\n<h2 id="composable-to-bring-in-an-external-script">Composable to Bring in An External Script</h2>\n<p>The <code is:raw>useIVSPlayer.js</code> composable will bring a script into my <code is:raw>StreamChannel.vue</code> component. The <a href="https://docs.aws.amazon.com/ivs/latest/userguide/player-web.html">docs</a> at Amazon IVS say that I need this script so that the player is brought in:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">src</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;https://player.live-video.net/1.8.0/amazon-ivs-player.min.js&quot;</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>\n<p>One way to bring in an external script is to add the script to the <code is:raw>&lt;head&gt;</code> in my <code is:raw>index.html</code> page:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">head</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">meta</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">charset</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;utf-8&quot;</span><span style="color: #C9D1D9"> /&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  ...</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">script</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">type</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;text/javascript&quot;</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">src</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;https://player.live-video.net/1.8.0/amazon-ivs-player.min.js&quot;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &gt;&lt;/</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">&lt;/</span><span style="color: #7EE787">head</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>\n<p>Then I can type \u201CIVSPlayer\u201D in the console, and I should see the module there.</p>\n<img src="https://res.cloudinary.com/deepgram/image/upload/v1647979619/blog/2022/03/how-to-write-vue-3-composables-for-a-third-party-API-integration/ConsoleIVSPlayer.png" alt="IVSPlayer in console" style="width: 50%; margin:auto;" />\n<p>If I choose this way to bring in the script, the module will be available on every page of my application. However, sometimes it is preferable to make a third-party technology only available on the page where it is needed. In that case, I need to remove that script from the <code is:raw>&lt;head&gt;</code> and bring it in a different way.</p>\n<p>If I only want to bring in the script on the <code is:raw>StreamChannel.vue</code> page, I need to write logic to <strong>build out the script tag with the src of the player URL</strong>. I will use a Vue composable, which is just a Javascript function, to build out this logic. Writing it as a composable makes it reusable, so I can easily copy it into other projects or bring it into other components in my application as needed.</p>\n<p>This <code is:raw>useIVSPlayer.js</code> composable will:</p>\n<ul>\n<li>be a <strong>Promise</strong>, since I need to account for the small amount of time it will take to load the script</li>\n<li>use <code is:raw>createElement</code> to create the script tag and <code is:raw>setAttribute</code> to add the src</li>\n<li>append the script to the head with <code is:raw>appendChild</code></li>\n<li>use the global event listener <code is:raw>onload</code> to trigger the promise being resolved</li>\n</ul>\n<p>Here is the composable:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">export</span><span style="color: #FFA657"> </span><span style="color: #FF7B72">default</span><span style="color: #FFA657"> </span><span style="color: #FF7B72">new</span><span style="color: #FFA657"> </span><span style="color: #79C0FF">Promise</span><span style="color: #FFA657">((res) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #FFA657"> </span><span style="color: #C9D1D9">{</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">script</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> document.</span><span style="color: #D2A8FF">createElement</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;script&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #C9D1D9">  script.</span><span style="color: #D2A8FF">setAttribute</span><span style="color: #C9D1D9">(</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #A5D6FF">&#39;src&#39;</span><span style="color: #C9D1D9">,</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #A5D6FF">&#39;https://player.live-video.net/1.6.1/amazon-ivs-player.min.js&#39;</span></span>\n<span class="line"><span style="color: #C9D1D9">  )</span></span>\n<span class="line"><span style="color: #C9D1D9">  document.head.</span><span style="color: #D2A8FF">appendChild</span><span style="color: #C9D1D9">(script)</span></span>\n<span class="line"><span style="color: #C9D1D9">  script.</span><span style="color: #D2A8FF">onload</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">res</span><span style="color: #C9D1D9">()</span></span>\n<span class="line"><span style="color: #C9D1D9">  script.</span><span style="color: #D2A8FF">onerror</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">throw</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;IVS PLAYER ERROR&#39;</span></span>\n<span class="line"><span style="color: #C9D1D9">  }</span></span>\n<span class="line"><span style="color: #C9D1D9">}</span><span style="color: #FFA657">)</span></span></code></pre>\n<p>I start with <code is:raw>export default</code> because I need to be able to import this logic into my <code is:raw>VideoPlayer.vue</code> component.</p>\n<p>Now in <code is:raw>VideoPlayer.vue</code> I can import the composable. I am going to use a <code is:raw>.then()</code> method because <code is:raw>useIVSPlayer</code> is a promise. The <code is:raw>.then()</code> method will wait for the promise to resolve before doing whatever I write inside the <code is:raw>.then()</code>.</p>\n<p>For now, I will check that the player is available and <code is:raw>console.log</code> that it is ready. Later, I\u2019ll add logic inside the <code is:raw>.then()</code> to bring in my streaming channel.</p>\n<p>Here is the <code is:raw>setup</code> function now in the <code is:raw>VideoPlayer.vue</code> component:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #D2A8FF">setup</span><span style="color: #C9D1D9">() {</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">let</span><span style="color: #C9D1D9"> IVSStatus </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">ref</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&quot;Is Not Connected&quot;</span><span style="color: #C9D1D9">);</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">    useIVSPlayer.</span><span style="color: #D2A8FF">then</span><span style="color: #C9D1D9">(() </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (window.IVSPlayer) {</span></span>\n<span class="line"><span style="color: #C9D1D9">        console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&quot;player loaded&quot;</span><span style="color: #C9D1D9">);</span></span>\n<span class="line"><span style="color: #C9D1D9">      }</span></span>\n<span class="line"><span style="color: #C9D1D9">    });</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> { IVSStatus };</span></span>\n<span class="line"><span style="color: #C9D1D9">  },</span></span></code></pre>\n<p>For now, I will keep <code is:raw>IVSStatus</code> as \u201CIs Not Connected\u201D because even though I have brought in the Amazon IVS player, I still need to hook up the video player to my channel stream. I\u2019ll do that in the next section.</p>\n<h2 id="composable-to-play-channel-stream">Composable to Play Channel Stream</h2>\n<p>Now I want to build a composable that will load my channel stream into the IVS player that I just brought in. This composable will do the following:</p>\n<ul>\n<li>Check that the IVS Player script is loaded and then create a new player that I can use for my stream.</li>\n<li>Load my channel stream into the player by adding the playback URL.</li>\n<li>Turn the player on with the <code is:raw>play()</code> method.</li>\n<li>Check that the stream is connected and loaded. This will be done with <code is:raw>setInterval</code> since I don\u2019t know how long the delay might be.</li>\n</ul>\n<p>First, I\u2019ll write my composable with an <code is:raw>export default</code> so I can import it into other files as needed. I\u2019ll also bring in <code is:raw>ref</code> from vue so I can track the state of the channel being loaded. I\u2019ll create a <code is:raw>ref</code> variable called <code is:raw>playerIsLoaded</code> and set it to <code is:raw>false</code> to start:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> { ref } </span><span style="color: #FF7B72">from</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;vue&#39;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #FF7B72">export</span><span style="color: #FFA657"> </span><span style="color: #FF7B72">default</span><span style="color: #FFA657"> </span><span style="color: #FF7B72">function</span><span style="color: #FFA657"> </span><span style="color: #D2A8FF">useIVSChannel</span><span style="color: #FFA657">() </span><span style="color: #C9D1D9">{</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">let</span><span style="color: #C9D1D9"> playerIsLoaded </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">ref</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">false</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> { playerIsLoaded }</span></span>\n<span class="line"><span style="color: #C9D1D9">}</span></span></code></pre>\n<p>Everything I need to do in this composable is dependent on the IVS player (the one I brought in with the <code is:raw>useIVSPlayer</code> composable) being loaded. So I\u2019ll wrap all my logic in an <code is:raw>if</code> statement to check that it is loaded and supported.</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (window.IVSPlayer </span><span style="color: #FF7B72">&amp;&amp;</span><span style="color: #C9D1D9"> window.IVSPlayer.isPlayerSupported) {</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">// all logic here</span></span>\n<span class="line"><span style="color: #C9D1D9">}</span></span></code></pre>\n<p>I\u2019ll use the player SDK\u2019s method <code is:raw>create()</code> to create a player for my channel. Then I\u2019ll attach the player to the HTML video element in my <code is:raw>VideoPlayer.vue</code> component with the SDK\u2019s <code is:raw>attachHTMLVideoElement()</code> method and I\u2019ll use <code is:raw>.load()</code> to load my channel\u2019s playback URL. I\u2019ll use <code is:raw>play()</code> to play the channel stream:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">player</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> window.IVSPlayer.</span><span style="color: #D2A8FF">create</span><span style="color: #C9D1D9">()</span></span>\n<span class="line"><span style="color: #C9D1D9">player.</span><span style="color: #D2A8FF">attachHTMLVideoElement</span><span style="color: #C9D1D9">(document.</span><span style="color: #D2A8FF">getElementById</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;video-player&#39;</span><span style="color: #C9D1D9">))</span></span>\n<span class="line"><span style="color: #C9D1D9">player.</span><span style="color: #D2A8FF">load</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;PLAYBACK_URL&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #C9D1D9">player.</span><span style="color: #D2A8FF">play</span><span style="color: #C9D1D9">()</span></span></code></pre>\n<p>(The playback URL is unique to my channel, so it has to be taken from the Amazon IVS console. See my walkthrough in <a href="https://deploy-preview-631--romantic-gates-9c0b5e.netlify.app/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/">this post</a> for more information.)</p>\n<p>Now I need to check that the channel stream is loaded. This won\u2019t happen instantaneously, but it should load relatively quickly. I don\u2019t want to use a <code is:raw>setTimeout </code>because I don\u2019t know how long it will take and I\u2019m concerned about the idea of adding a super long timeout if I don\u2019t have to. I\u2019ll use <code is:raw>setInterval</code> to check for the stream being loaded.</p>\n<p><code is:raw>setInterval</code> is a DOM API method that repeatedly calls a function until some other trigger happens to turn it off. In this case, the other trigger will be the channel being loaded.</p>\n<p>The way to turn it off is to use <code is:raw>clearInterval</code>. I\u2019m going to assign <code is:raw>setInterval</code> to a variable called <code is:raw>checkInterval</code>. The callback of <code is:raw>setInterval</code> will run every 500 milliseconds. Inside that callback, it will check that the channel has loaded, and once it has, it will set <code is:raw>playerIsLoaded</code> to <code is:raw>true</code> and clear everything by passing <code is:raw>checkInterval</code> to <code is:raw>clearInterval</code>.</p>\n<p>Here\u2019s the logic I just described:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">let</span><span style="color: #C9D1D9"> checkInterval </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">setInterval</span><span style="color: #C9D1D9">(() </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (player.core.isLoaded) {</span></span>\n<span class="line"><span style="color: #C9D1D9">    playerIsLoaded.value </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">true</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #D2A8FF">clearInterval</span><span style="color: #C9D1D9">(checkInterval)</span></span>\n<span class="line"><span style="color: #C9D1D9">  }</span></span>\n<span class="line"><span style="color: #C9D1D9">}, </span><span style="color: #79C0FF">500</span><span style="color: #C9D1D9">)</span></span></code></pre>\n<p>I\u2019ll return the ref <code is:raw>playerIsLoaded</code> from the composable, so I have access to it in the <code is:raw>VideoPlayer.vue</code> component. I want to watch that value so that when it changes, the <code is:raw>IVSStatus</code> value in the <code is:raw>VideoPlayer.vue</code> template updates to show that the channel is connected.</p>\n<p>Here is the composable in its entirety:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> { ref } </span><span style="color: #FF7B72">from</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;vue&#39;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #FF7B72">export</span><span style="color: #FFA657"> </span><span style="color: #FF7B72">default</span><span style="color: #FFA657"> </span><span style="color: #FF7B72">function</span><span style="color: #FFA657"> </span><span style="color: #D2A8FF">useIVSChannel</span><span style="color: #FFA657">() </span><span style="color: #C9D1D9">{</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">let</span><span style="color: #C9D1D9"> playerIsLoaded </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">ref</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">false</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (window.IVSPlayer </span><span style="color: #FF7B72">&amp;&amp;</span><span style="color: #C9D1D9"> window.IVSPlayer.isPlayerSupported) {</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">player</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> window.IVSPlayer.</span><span style="color: #D2A8FF">create</span><span style="color: #C9D1D9">()</span></span>\n<span class="line"><span style="color: #C9D1D9">    player.</span><span style="color: #D2A8FF">attachHTMLVideoElement</span><span style="color: #C9D1D9">(document.</span><span style="color: #D2A8FF">getElementById</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;video-player&#39;</span><span style="color: #C9D1D9">))</span></span>\n<span class="line"><span style="color: #C9D1D9">    player.</span><span style="color: #D2A8FF">load</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;PLAYBACK_URL&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #C9D1D9">    player.</span><span style="color: #D2A8FF">play</span><span style="color: #C9D1D9">()</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">let</span><span style="color: #C9D1D9"> checkInterval </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">setInterval</span><span style="color: #C9D1D9">(() </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (player.core.isLoaded) {</span></span>\n<span class="line"><span style="color: #C9D1D9">        playerIsLoaded.value </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">true</span></span>\n<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #D2A8FF">clearInterval</span><span style="color: #C9D1D9">(checkInterval)</span></span>\n<span class="line"><span style="color: #C9D1D9">      }</span></span>\n<span class="line"><span style="color: #C9D1D9">    }, </span><span style="color: #79C0FF">500</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> { playerIsLoaded }</span></span>\n<span class="line"><span style="color: #C9D1D9">  }</span></span>\n<span class="line"><span style="color: #C9D1D9">}</span></span></code></pre>\n<p>The last thing I need to do to get this working is go back to the <code is:raw>VideoPlayer.vue</code> component and run the composable function inside <code is:raw>setup</code> and update <code is:raw>IVSStatus</code> based on the channel being connected, which I\u2019ll do in the next section.</p>\n<h2 id="run-the-composables">Run the Composables</h2>\n<p>In <code is:raw>VideoPlayer.vue</code>, I will run the <code is:raw>useIVSChannel</code> composable inside <code is:raw>setup</code>. Actually, I\u2019ll run it inside the <code is:raw>.then()</code> that I already wrote earlier, which will cause <code is:raw>useIVSChannel</code> to run after <code is:raw>useIVSPlayer</code> has resolved. (I have to remember to import <code is:raw>useIVSChannel</code> from the <code is:raw>composables</code> folder if I want to use it.)</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">useIVSPlayer.</span><span style="color: #D2A8FF">then</span><span style="color: #C9D1D9">(() </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> { </span><span style="color: #79C0FF">playerIsLoaded</span><span style="color: #C9D1D9"> } </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">useIVSChannel</span><span style="color: #C9D1D9">()</span></span>\n<span class="line"><span style="color: #C9D1D9">})</span></span></code></pre>\n<p>I deconstruct <code is:raw>playerIsLoaded</code> off of <code is:raw>useIVSChannel</code> so that I can watch that reactive reference. I\u2019ll use Vue\u2019s <code is:raw>watch</code> method to make a side effect occur when the <code is:raw>playerIsLoaded</code> value changes to true (i.e., when the channel is connected). The side effect will be that the <code is:raw>IVSStatus</code> will update to \u201CIs Connected\u201D:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #D2A8FF">watch</span><span style="color: #C9D1D9">(playerIsLoaded, () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (playerIsLoaded.value) {</span></span>\n<span class="line"><span style="color: #C9D1D9">    IVSStatus.value </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;Is Connected&#39;</span></span>\n<span class="line"><span style="color: #C9D1D9">  }</span></span>\n<span class="line"><span style="color: #C9D1D9">})</span></span></code></pre>\n<p>Here is the entire script for the <code is:raw>VideoPlayer.vue</code> component:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">import </span><span style="color: #FF7B72">{</span><span style="color: #C9D1D9"> ref, watch </span><span style="color: #FF7B72">}</span><span style="color: #C9D1D9"> from &quot;vue&quot;;</span></span>\n<span class="line"><span style="color: #C9D1D9">import useIVSPlayer from &quot;../composables/useIVSPlayer&quot;;</span></span>\n<span class="line"><span style="color: #C9D1D9">import useIVSChannel from &quot;../composables/useIVSChannel&quot;;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">export default </span><span style="color: #FF7B72">{</span></span>\n<span class="line"><span style="color: #C9D1D9">  name: </span><span style="color: #A5D6FF">&quot;VideoPlayer&quot;</span><span style="color: #C9D1D9">,</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #D2A8FF">setup</span><span style="color: #C9D1D9">() {</span></span>\n<span class="line"><span style="color: #C9D1D9">    let IVSStatus </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">ref</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&quot;Is Not Connected&quot;</span><span style="color: #C9D1D9">);</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">    useIVSPlayer.then(() =&gt; {</span></span>\n<span class="line"><span style="color: #C9D1D9">      const { playerIsLoaded } </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">useIVSChannel</span><span style="color: #C9D1D9">();</span></span>\n<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #D2A8FF">watch</span><span style="color: #C9D1D9">(playerIsLoaded, () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (playerIsLoaded.value) {</span></span>\n<span class="line"><span style="color: #C9D1D9">          IVSStatus.value </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&quot;Is Connected&quot;</span><span style="color: #C9D1D9">;</span></span>\n<span class="line"><span style="color: #C9D1D9">        }</span></span>\n<span class="line"><span style="color: #C9D1D9">      });</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">}</span><span style="color: #C9D1D9">);</span></span>\n<span class="line"><span style="color: #C9D1D9">    return </span><span style="color: #FF7B72">{</span><span style="color: #C9D1D9"> IVSStatus </span><span style="color: #FF7B72">}</span><span style="color: #C9D1D9">;</span></span>\n<span class="line"><span style="color: #C9D1D9">  },</span></span>\n<span class="line"><span style="color: #C9D1D9">};</span></span>\n<span class="line"><span style="color: #C9D1D9">&lt;/</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>\n<p>However, nothing will happen in my video player in the browser if I have not turned on my stream. In <a href="https://deploy-preview-631--romantic-gates-9c0b5e.netlify.app/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/">the first post</a> in this series, I showed how to set up OBS to use their software on my computer to create a stream, which I connected to an Amazon IVS channel.</p>\n<p>If I turn on my stream in OBS, I should see myself in the video player in my application now!</p>\n<p><img src="https://res.cloudinary.com/deepgram/image/upload/v1647979619/blog/2022/03/how-to-write-vue-3-composables-for-a-third-party-API-integration/VideoStreamWorking.png" alt="Video Stream working"></p>\n<h2 id="conclusion">Conclusion</h2>\n<p>Vue composables are useful for writing standalone logic that can be reused, but if one composable depends on another, it can be tricky. In this post, I showed how a composable can be written as a promise and how <code is:raw>setInterval</code> can be used to check if something the composable depends on has happened yet. These are two ways to write composables that may have asynchronous events occurring.</p>\n<p>In the next post, I\u2019ll show how to write composables for using Deepgram\u2019s API to create text captions for my stream. I\u2019ll write a composable to use the browser MediaStreams API (a great example of a composable that can be reused in different contexts). I\u2019ll also show how to use <code is:raw>fetch</code> in a composable to get a token from the backend.</p>\n<p>I hope you\u2019ll join me for the next post. Follow me on <a href="https://twitter.com/sandra_rodgers_">Twitter</a> so you don\u2019t miss it!</p>' }, "file": "/Users/sandrarodgers/web-next/blog/src/content/blog/posts/how-to-write-vue-3-composables-for-a-third-party-api-integration/index.md" };
function rawContent() {
  return "\n## Introduction\n\nThis post is a continuation of the series \"How to Build a Live Streaming Web Application with Amazon IVS and Deepgram.\"\n\n<Panel type=\"info\" title=\"Build a Live Streaming Web Application with Amazon IVS and Deepgram (SERIES)\">\n<ol> \n<li><a href=\"https://blog.deepgram.com/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/\">How to Build a Live Streaming Web Application with Amazon IVS and Deepgram</a></li>\n<li><a href=\"https://blog.deepgram.com/build-a-livestream-web-application-vue-and-express-setup/\"> Build a Live Streaming Web Application: Vue and Express Setup</a></li>\n<li><a href=\"https://blog.deepgram.com/how-to-write-vue-3-composables-for-a-third-party-API-integration/\"> How to Write Vue 3 Composables for a Third-Party API Integration</a></li>\n\n<li><a href=\"https://blog.deepgram.com/asynchronous-logic-to-write-a-vue-3-and-deepgram-captions-component/\"> Asynchronous Logic to Write a Vue 3 and Deepgram Captions Component</a></li>\n</ol>\n</Panel>\n\n### Composables\n\nIn Vue.js, the term 'composables' refers to composition functions, a key feature of Vue 3's Composition API. While the API itself includes many composition functions that are core to its design, such as the `setup()` function or the reactivity functions `ref()` and `reactive()`, composables are those composition functions that I write myself to be used throughout my own project as needed.\n\nComposables are functions that encapsulate stateful logic, which means they are like little packages that are focused around performing one logical concern, and they keep track of state that changes due to the function running.\n\nFor example, I could write a composable function that toggles a menu open or closed. That logic could be used throughout an application, and it would need to keep track of the state of the menu being opened or closed. I would just need to import the composable into whatever file I need it and run the function.\n\n#### Composable Example `useMenu.js`\n\n```js\nimport { readonly, ref } from 'vue'\n\nconst isOpen = ref(false)\nconst toggleMenu = () => {\n  isOpen.value = !isOpen.value\n}\n\nexport default function useMenu() {\n  return {\n    isOpen: readonly(isOpen),\n    toggleMenu,\n  }\n}\n```\n\nToday I am going to introduce how to write a composable in Vue 3 to bring in the Amazon IVS video player SDK and to connect to my Amazon IVS streaming channel.\n\nIf you have wanted to learn more about how to write Vue 3 composables to use third-party technologies, this will be useful to you. In this post, I'll cover:\n\n*   Writing a Vue composable to bring in an external script\n*   Writing a Vue composable that is dependent on another composable, utilizing the Javascript function `setInterval`\n*   Amazon IVS integration using Vue 3 composables\n\n### Background to the Series\n\nIn the [first post](https://blog.deepgram.com/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/) in the series, I explained how to build a live streaming web application using just Vanilla JS and HTML. That post covers setting up an Amazon IVS account, which is necessary to get the third-party technology example (Amazon IVS) in today's post working. **Setting up an Amazon IVS channel is necessary to build the second composable in this tutorial, but the first one can be built without doing that**.\n\nIn the second post, I started building a full-stack application using Vue 3. I set up Vue-Router, Vuex, and a backend server which all helped me build a feature to restrict access to the streaming page of my site. Visitors to the site are required to enter a code, and that code is verified on the backend, resulting in the user being able to navigate to the streaming page. **There is no need to read that post to be able to go through this tutorial on composables.**\n\nToday I'll build the video streaming page in Vue 3, focusing on building this feature with Vue composables. If you want a refresher on Vue composables, check out my post [Reusability with Composables](https://blog.deepgram.com/diving-into-vue-3-reusability-with-composables/).\n\nThe code for today's tutorial can be found in [this Github repo](https://github.com/deepgram-devs/livestream-amazonIVS-and-deepgram/tree/amazonIVS-composables), the branch named \"amazonIVS-composables.\"\n\nNow I'll get into it!\n\n## Files Organization\n\nThis project has two main views, the landing page and the streaming page. Today I'll be working entirely in the streaming page. In my project, I have named this file `StreamChannel.vue`, and it is in the `Views` folder.\n\nThe `StreamChannel.vue` will eventually be made up of two components - one for **the video player** that relies on the Amazon IVS technology and one for the **closed-captions** that relies on the Deepgram speech-to-text technology. Today I'll only build the video player component.\n\nI'll set up two folders to start - a `components` folder and a `composables` folder, both in the `src` folder. In the `components` folder, I'll create a `VideoPlayer.vue` component.\n\nThe `composables` folder is where I will put the composition functions that contain the logic that makes the video player work. **A common practice in Vue 3 is to name composables so that they begin with 'use'.** The name will identify what the composable does. The two composables I will be writing today are `useIVSPlayer` and `useIVSChannel`. Here is what they will do:\n\n1.  `useIVSPlayer.js` - this composable will bring in the [Amazon IVS video player script](https://docs.aws.amazon.com/ivs/latest/userguide/player-web.html) so that the HTML video element is enhanced with the Amazon IVS Player Web SDK.\n\n2.  `useIVSChannel.js` - this composable will check at an interval if the player in the `useIVSPlayer` script has loaded, and if it has, it will create a connection to my Amazon IVS channel, updating state to show that the channel is connected.\n\nMy [Github repo](https://github.com/deepgram-devs/livestream-amazonIVS-and-deepgram/tree/amazonIVS-composables/src) for this project shows how I have set up these folders.\n\n## VideoPlayer Component\n\nThe `VideoPlayer.vue` component will be a video player that shows the live stream. The Amazon IVS video player script looks for an HTML `<video>` element with a specific ID and then takes control of that element to bring in its own specially made video player with Amazon IVS optimizations. So the first composable I write will be **a function that brings in the Amazon IVS player with a script**.\n\nIn the `VideoPlayer.vue` file, I will start by writing the HTML I need in the Vue template so that I have a basic video player. I've given it a height and a width that I prefer, and the `id=\"video-player\"` so that I can use that id later to bring in the Amazon IVS player. The attributes that the html `<video>` element supports are listed [here](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/video#attributes).\n\n```html\n<template>\n  <div>\n    <p class=\"status\">AWS Channel {{ IVSStatus }}</p>\n    <video\n      width=\"520\"\n      height=\"440\"\n      id=\"video-player\"\n      controls\n      playsinline\n    ></video>\n  </div>\n</template>\n```\n\nThe `IVSStatus` will be set to a `ref` property. For now, I'll make that property a string 'Is Not Connected,' but later, it will be hooked up to the status of the channel, and it will update to say 'Is Connected' when the channel is available.\n\nHere is my setup function in the script block with that `ref`:\n\n```js\n<script>\nimport { ref } from \"vue\";\n\nexport default {\n  name: \"VideoPlayer\",\n  setup() {\n    let IVSStatus = ref(\"Is Not Connected\");\n\n    return { IVSStatus };\n  },\n};\n<\/script>\n```\n\nThe last thing I need to do to be able to see this video player is add the component to the `StreamChannel.vue` page in src/views/StreamChannel.vue:\n\n```html\n<template>\n  <div>\n    <h1>Stream Channel</h1>\n    <video-player />\n  </div>\n</template>\n\n<script>\n  import VideoPlayer from '@/components/VideoPlayer'\n  export default {\n    name: 'StreamChannel',\n    components: {\n      VideoPlayer,\n    },\n  }\n<\/script>\n```\n\nHere is how the page will look:\n\n![Video Player Page](https://res.cloudinary.com/deepgram/image/upload/v1647979619/blog/2022/03/how-to-write-vue-3-composables-for-a-third-party-API-integration/VideoPlayerComponent.png)\n\nNow I am ready to write the first composable, the `useIVSPlayer.js` composition function, which will do the logic to bring in the Amazon IVS player.\n\n## Composable to Bring in An External Script\n\nThe `useIVSPlayer.js` composable will bring a script into my `StreamChannel.vue` component. The [docs](https://docs.aws.amazon.com/ivs/latest/userguide/player-web.html) at Amazon IVS say that I need this script so that the player is brought in:\n\n```html\n<script src=\"https://player.live-video.net/1.8.0/amazon-ivs-player.min.js\">\n```\n\nOne way to bring in an external script is to add the script to the `<head>` in my `index.html` page:\n\n```html\n<head>\n  <meta charset=\"utf-8\" />\n  ...\n  <script\n    type=\"text/javascript\"\n    src=\"https://player.live-video.net/1.8.0/amazon-ivs-player.min.js\"\n  ><\/script>\n</head>\n```\n\nThen I can type \"IVSPlayer\" in the console, and I should see the module there.\n\n<img src=\"https://res.cloudinary.com/deepgram/image/upload/v1647979619/blog/2022/03/how-to-write-vue-3-composables-for-a-third-party-API-integration/ConsoleIVSPlayer.png\" alt=\"IVSPlayer in console\" style=\"width: 50%; margin:auto;\">\n\nIf I choose this way to bring in the script, the module will be available on every page of my application. However, sometimes it is preferable to make a third-party technology only available on the page where it is needed. In that case, I need to remove that script from the `<head>` and bring it in a different way.\n\nIf I only want to bring in the script on the `StreamChannel.vue` page, I need to write logic to **build out the script tag with the src of the player URL**. I will use a Vue composable, which is just a Javascript function, to build out this logic. Writing it as a composable makes it reusable, so I can easily copy it into other projects or bring it into other components in my application as needed.\n\nThis `useIVSPlayer.js` composable will:\n\n*   be a **Promise**, since I need to account for the small amount of time it will take to load the script\n*   use `createElement` to create the script tag and `setAttribute` to add the src\n*   append the script to the head with `appendChild`\n*   use the global event listener `onload` to trigger the promise being resolved\n\nHere is the composable:\n\n```js\nexport default new Promise((res) => {\n  const script = document.createElement('script')\n  script.setAttribute(\n    'src',\n    'https://player.live-video.net/1.6.1/amazon-ivs-player.min.js'\n  )\n  document.head.appendChild(script)\n  script.onload = () => res()\n  script.onerror = () => {\n    throw 'IVS PLAYER ERROR'\n  }\n})\n```\n\nI start with `export default` because I need to be able to import this logic into my `VideoPlayer.vue` component.\n\nNow in `VideoPlayer.vue` I can import the composable. I am going to use a `.then()` method because `useIVSPlayer` is a promise. The `.then()` method will wait for the promise to resolve before doing whatever I write inside the `.then()`.\n\nFor now, I will check that the player is available and `console.log` that it is ready. Later, I'll add logic inside the `.then()` to bring in my streaming channel.\n\nHere is the `setup` function now in the `VideoPlayer.vue` component:\n\n```js\nsetup() {\n    let IVSStatus = ref(\"Is Not Connected\");\n\n    useIVSPlayer.then(() => {\n      if (window.IVSPlayer) {\n        console.log(\"player loaded\");\n      }\n    });\n    return { IVSStatus };\n  },\n```\n\nFor now, I will keep `IVSStatus` as \"Is Not Connected\" because even though I have brought in the Amazon IVS player, I still need to hook up the video player to my channel stream. I'll do that in the next section.\n\n## Composable to Play Channel Stream\n\nNow I want to build a composable that will load my channel stream into the IVS player that I just brought in. This composable will do the following:\n\n*   Check that the IVS Player script is loaded and then create a new player that I can use for my stream.\n*   Load my channel stream into the player by adding the playback URL.\n*   Turn the player on with the `play()` method.\n*   Check that the stream is connected and loaded. This will be done with `setInterval` since I don't know how long the delay might be.\n\nFirst, I'll write my composable with an `export default` so I can import it into other files as needed. I'll also bring in `ref` from vue so I can track the state of the channel being loaded. I'll create a `ref` variable called `playerIsLoaded` and set it to `false` to start:\n\n```js\nimport { ref } from 'vue'\n\nexport default function useIVSChannel() {\n  let playerIsLoaded = ref(false)\n\n  return { playerIsLoaded }\n}\n```\n\nEverything I need to do in this composable is dependent on the IVS player (the one I brought in with the `useIVSPlayer` composable) being loaded. So I'll wrap all my logic in an `if` statement to check that it is loaded and supported.\n\n```js\nif (window.IVSPlayer && window.IVSPlayer.isPlayerSupported) {\n  // all logic here\n}\n```\n\nI'll use the player SDK's method `create()` to create a player for my channel. Then I'll attach the player to the HTML video element in my `VideoPlayer.vue` component with the SDK's `attachHTMLVideoElement()` method and I'll use `.load()` to load my channel's playback URL. I'll use `play()` to play the channel stream:\n\n```js\nconst player = window.IVSPlayer.create()\nplayer.attachHTMLVideoElement(document.getElementById('video-player'))\nplayer.load('PLAYBACK_URL')\nplayer.play()\n```\n\n(The playback URL is unique to my channel, so it has to be taken from the Amazon IVS console. See my walkthrough in [this post](https://deploy-preview-631--romantic-gates-9c0b5e.netlify.app/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/) for more information.)\n\nNow I need to check that the channel stream is loaded. This won't happen instantaneously, but it should load relatively quickly. I don't want to use a `setTimeout `because I don't know how long it will take and I'm concerned about the idea of adding a super long timeout if I don't have to. I'll use `setInterval` to check for the stream being loaded.\n\n`setInterval` is a DOM API method that repeatedly calls a function until some other trigger happens to turn it off. In this case, the other trigger will be the channel being loaded.\n\nThe way to turn it off is to use `clearInterval`. I'm going to assign `setInterval` to a variable called `checkInterval`. The callback of `setInterval` will run every 500 milliseconds. Inside that callback, it will check that the channel has loaded, and once it has, it will set `playerIsLoaded` to `true` and clear everything by passing `checkInterval` to `clearInterval`.\n\nHere's the logic I just described:\n\n```js\nlet checkInterval = setInterval(() => {\n  if (player.core.isLoaded) {\n    playerIsLoaded.value = true\n    clearInterval(checkInterval)\n  }\n}, 500)\n```\n\nI'll return the ref `playerIsLoaded` from the composable, so I have access to it in the `VideoPlayer.vue` component. I want to watch that value so that when it changes, the `IVSStatus` value in the `VideoPlayer.vue` template updates to show that the channel is connected.\n\nHere is the composable in its entirety:\n\n```js\nimport { ref } from 'vue'\n\nexport default function useIVSChannel() {\n  let playerIsLoaded = ref(false)\n\n  if (window.IVSPlayer && window.IVSPlayer.isPlayerSupported) {\n    const player = window.IVSPlayer.create()\n    player.attachHTMLVideoElement(document.getElementById('video-player'))\n    player.load('PLAYBACK_URL')\n    player.play()\n\n    let checkInterval = setInterval(() => {\n      if (player.core.isLoaded) {\n        playerIsLoaded.value = true\n        clearInterval(checkInterval)\n      }\n    }, 500)\n\n    return { playerIsLoaded }\n  }\n}\n```\n\nThe last thing I need to do to get this working is go back to the `VideoPlayer.vue` component and run the composable function inside `setup` and update `IVSStatus` based on the channel being connected, which I'll do in the next section.\n\n## Run the Composables\n\nIn `VideoPlayer.vue`, I will run the `useIVSChannel` composable inside `setup`. Actually, I'll run it inside the `.then()` that I already wrote earlier, which will cause `useIVSChannel` to run after `useIVSPlayer` has resolved. (I have to remember to import `useIVSChannel` from the `composables` folder if I want to use it.)\n\n```js\nuseIVSPlayer.then(() => {\n  const { playerIsLoaded } = useIVSChannel()\n})\n```\n\nI deconstruct `playerIsLoaded` off of `useIVSChannel` so that I can watch that reactive reference. I'll use Vue's `watch` method to make a side effect occur when the `playerIsLoaded` value changes to true (i.e., when the channel is connected). The side effect will be that the `IVSStatus` will update to \"Is Connected\":\n\n```js\nwatch(playerIsLoaded, () => {\n  if (playerIsLoaded.value) {\n    IVSStatus.value = 'Is Connected'\n  }\n})\n```\n\nHere is the entire script for the `VideoPlayer.vue` component:\n\n```js\n<script>\nimport { ref, watch } from \"vue\";\nimport useIVSPlayer from \"../composables/useIVSPlayer\";\nimport useIVSChannel from \"../composables/useIVSChannel\";\n\nexport default {\n  name: \"VideoPlayer\",\n  setup() {\n    let IVSStatus = ref(\"Is Not Connected\");\n\n    useIVSPlayer.then(() => {\n      const { playerIsLoaded } = useIVSChannel();\n      watch(playerIsLoaded, () => {\n        if (playerIsLoaded.value) {\n          IVSStatus.value = \"Is Connected\";\n        }\n      });\n    });\n    return { IVSStatus };\n  },\n};\n<\/script>\n```\n\nHowever, nothing will happen in my video player in the browser if I have not turned on my stream. In [the first post](https://deploy-preview-631--romantic-gates-9c0b5e.netlify.app/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/) in this series, I showed how to set up OBS to use their software on my computer to create a stream, which I connected to an Amazon IVS channel.\n\nIf I turn on my stream in OBS, I should see myself in the video player in my application now!\n\n![Video Stream working](https://res.cloudinary.com/deepgram/image/upload/v1647979619/blog/2022/03/how-to-write-vue-3-composables-for-a-third-party-API-integration/VideoStreamWorking.png)\n\n## Conclusion\n\nVue composables are useful for writing standalone logic that can be reused, but if one composable depends on another, it can be tricky. In this post, I showed how a composable can be written as a promise and how `setInterval` can be used to check if something the composable depends on has happened yet. These are two ways to write composables that may have asynchronous events occurring.\n\nIn the next post, I'll show how to write composables for using Deepgram's API to create text captions for my stream. I'll write a composable to use the browser MediaStreams API (a great example of a composable that can be reused in different contexts). I'll also show how to use `fetch` in a composable to get a token from the backend.\n\nI hope you'll join me for the next post. Follow me on [Twitter](https://twitter.com/sandra_rodgers_) so you don't miss it!\n\n        ";
}
function compiledContent() {
  return '<h2 id="introduction">Introduction</h2>\n<p>This post is a continuation of the series \u201CHow to Build a Live Streaming Web Application with Amazon IVS and Deepgram.\u201D</p>\n<Panel type="info" title="Build a Live Streaming Web Application with Amazon IVS and Deepgram (SERIES)"><ol><li><a href="https://blog.deepgram.com/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/">How to Build a Live Streaming Web Application with Amazon IVS and Deepgram</a></li>\n<li><a href="https://blog.deepgram.com/build-a-livestream-web-application-vue-and-express-setup/"> Build a Live Streaming Web Application: Vue and Express Setup</a></li>\n<li><a href="https://blog.deepgram.com/how-to-write-vue-3-composables-for-a-third-party-API-integration/"> How to Write Vue 3 Composables for a Third-Party API Integration</a></li><li><a href="https://blog.deepgram.com/asynchronous-logic-to-write-a-vue-3-and-deepgram-captions-component/"> Asynchronous Logic to Write a Vue 3 and Deepgram Captions Component</a></li></ol></Panel>\n<h3 id="composables">Composables</h3>\n<p>In Vue.js, the term \u2018composables\u2019 refers to composition functions, a key feature of Vue 3\u2019s Composition API. While the API itself includes many composition functions that are core to its design, such as the <code is:raw>setup()</code> function or the reactivity functions <code is:raw>ref()</code> and <code is:raw>reactive()</code>, composables are those composition functions that I write myself to be used throughout my own project as needed.</p>\n<p>Composables are functions that encapsulate stateful logic, which means they are like little packages that are focused around performing one logical concern, and they keep track of state that changes due to the function running.</p>\n<p>For example, I could write a composable function that toggles a menu open or closed. That logic could be used throughout an application, and it would need to keep track of the state of the menu being opened or closed. I would just need to import the composable into whatever file I need it and run the function.</p>\n<h4 id="composable-example-usemenujs">Composable Example <code is:raw>useMenu.js</code></h4>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> { readonly, ref } </span><span style="color: #FF7B72">from</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;vue&#39;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">isOpen</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">ref</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">false</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">toggleMenu</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">  isOpen.value </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">!</span><span style="color: #C9D1D9">isOpen.value</span></span>\n<span class="line"><span style="color: #C9D1D9">}</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #FF7B72">export</span><span style="color: #FFA657"> </span><span style="color: #FF7B72">default</span><span style="color: #FFA657"> </span><span style="color: #FF7B72">function</span><span style="color: #FFA657"> </span><span style="color: #D2A8FF">useMenu</span><span style="color: #FFA657">() </span><span style="color: #C9D1D9">{</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">    isOpen: </span><span style="color: #D2A8FF">readonly</span><span style="color: #C9D1D9">(isOpen),</span></span>\n<span class="line"><span style="color: #C9D1D9">    toggleMenu,</span></span>\n<span class="line"><span style="color: #C9D1D9">  }</span></span>\n<span class="line"><span style="color: #C9D1D9">}</span></span></code></pre>\n<p>Today I am going to introduce how to write a composable in Vue 3 to bring in the Amazon IVS video player SDK and to connect to my Amazon IVS streaming channel.</p>\n<p>If you have wanted to learn more about how to write Vue 3 composables to use third-party technologies, this will be useful to you. In this post, I\u2019ll cover:</p>\n<ul>\n<li>Writing a Vue composable to bring in an external script</li>\n<li>Writing a Vue composable that is dependent on another composable, utilizing the Javascript function <code is:raw>setInterval</code></li>\n<li>Amazon IVS integration using Vue 3 composables</li>\n</ul>\n<h3 id="background-to-the-series">Background to the Series</h3>\n<p>In the <a href="https://blog.deepgram.com/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/">first post</a> in the series, I explained how to build a live streaming web application using just Vanilla JS and HTML. That post covers setting up an Amazon IVS account, which is necessary to get the third-party technology example (Amazon IVS) in today\u2019s post working. <strong>Setting up an Amazon IVS channel is necessary to build the second composable in this tutorial, but the first one can be built without doing that</strong>.</p>\n<p>In the second post, I started building a full-stack application using Vue 3. I set up Vue-Router, Vuex, and a backend server which all helped me build a feature to restrict access to the streaming page of my site. Visitors to the site are required to enter a code, and that code is verified on the backend, resulting in the user being able to navigate to the streaming page. <strong>There is no need to read that post to be able to go through this tutorial on composables.</strong></p>\n<p>Today I\u2019ll build the video streaming page in Vue 3, focusing on building this feature with Vue composables. If you want a refresher on Vue composables, check out my post <a href="https://blog.deepgram.com/diving-into-vue-3-reusability-with-composables/">Reusability with Composables</a>.</p>\n<p>The code for today\u2019s tutorial can be found in <a href="https://github.com/deepgram-devs/livestream-amazonIVS-and-deepgram/tree/amazonIVS-composables">this Github repo</a>, the branch named \u201CamazonIVS-composables.\u201D</p>\n<p>Now I\u2019ll get into it!</p>\n<h2 id="files-organization">Files Organization</h2>\n<p>This project has two main views, the landing page and the streaming page. Today I\u2019ll be working entirely in the streaming page. In my project, I have named this file <code is:raw>StreamChannel.vue</code>, and it is in the <code is:raw>Views</code> folder.</p>\n<p>The <code is:raw>StreamChannel.vue</code> will eventually be made up of two components - one for <strong>the video player</strong> that relies on the Amazon IVS technology and one for the <strong>closed-captions</strong> that relies on the Deepgram speech-to-text technology. Today I\u2019ll only build the video player component.</p>\n<p>I\u2019ll set up two folders to start - a <code is:raw>components</code> folder and a <code is:raw>composables</code> folder, both in the <code is:raw>src</code> folder. In the <code is:raw>components</code> folder, I\u2019ll create a <code is:raw>VideoPlayer.vue</code> component.</p>\n<p>The <code is:raw>composables</code> folder is where I will put the composition functions that contain the logic that makes the video player work. <strong>A common practice in Vue 3 is to name composables so that they begin with \u2018use\u2019.</strong> The name will identify what the composable does. The two composables I will be writing today are <code is:raw>useIVSPlayer</code> and <code is:raw>useIVSChannel</code>. Here is what they will do:</p>\n<ol>\n<li>\n<p><code is:raw>useIVSPlayer.js</code> - this composable will bring in the <a href="https://docs.aws.amazon.com/ivs/latest/userguide/player-web.html">Amazon IVS video player script</a> so that the HTML video element is enhanced with the Amazon IVS Player Web SDK.</p>\n</li>\n<li>\n<p><code is:raw>useIVSChannel.js</code> - this composable will check at an interval if the player in the <code is:raw>useIVSPlayer</code> script has loaded, and if it has, it will create a connection to my Amazon IVS channel, updating state to show that the channel is connected.</p>\n</li>\n</ol>\n<p>My <a href="https://github.com/deepgram-devs/livestream-amazonIVS-and-deepgram/tree/amazonIVS-composables/src">Github repo</a> for this project shows how I have set up these folders.</p>\n<h2 id="videoplayer-component">VideoPlayer Component</h2>\n<p>The <code is:raw>VideoPlayer.vue</code> component will be a video player that shows the live stream. The Amazon IVS video player script looks for an HTML <code is:raw>&lt;video&gt;</code> element with a specific ID and then takes control of that element to bring in its own specially made video player with Amazon IVS optimizations. So the first composable I write will be <strong>a function that brings in the Amazon IVS player with a script</strong>.</p>\n<p>In the <code is:raw>VideoPlayer.vue</code> file, I will start by writing the HTML I need in the Vue template so that I have a basic video player. I\u2019ve given it a height and a width that I prefer, and the <code is:raw>id="video-player"</code> so that I can use that id later to bring in the Amazon IVS player. The attributes that the html <code is:raw>&lt;video&gt;</code> element supports are listed <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/video#attributes">here</a>.</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">template</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">div</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">p</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">class</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;status&quot;</span><span style="color: #C9D1D9">&gt;AWS Channel {{ IVSStatus }}&lt;/</span><span style="color: #7EE787">p</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">video</span></span>\n<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">width</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;520&quot;</span></span>\n<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">height</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;440&quot;</span></span>\n<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">id</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;video-player&quot;</span></span>\n<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">controls</span></span>\n<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">playsinline</span></span>\n<span class="line"><span style="color: #C9D1D9">    &gt;&lt;/</span><span style="color: #7EE787">video</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;/</span><span style="color: #7EE787">div</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">&lt;/</span><span style="color: #7EE787">template</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>\n<p>The <code is:raw>IVSStatus</code> will be set to a <code is:raw>ref</code> property. For now, I\u2019ll make that property a string \u2018Is Not Connected,\u2019 but later, it will be hooked up to the status of the channel, and it will update to say \u2018Is Connected\u2019 when the channel is available.</p>\n<p>Here is my setup function in the script block with that <code is:raw>ref</code>:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">import </span><span style="color: #FF7B72">{</span><span style="color: #C9D1D9"> ref </span><span style="color: #FF7B72">}</span><span style="color: #C9D1D9"> from &quot;vue&quot;;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">export default </span><span style="color: #FF7B72">{</span></span>\n<span class="line"><span style="color: #C9D1D9">  name: </span><span style="color: #A5D6FF">&quot;VideoPlayer&quot;</span><span style="color: #C9D1D9">,</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #D2A8FF">setup</span><span style="color: #C9D1D9">() {</span></span>\n<span class="line"><span style="color: #C9D1D9">    let IVSStatus </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">ref</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&quot;Is Not Connected&quot;</span><span style="color: #C9D1D9">);</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">    return { IVSStatus };</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">}</span><span style="color: #C9D1D9">,</span></span>\n<span class="line"><span style="color: #C9D1D9">};</span></span>\n<span class="line"><span style="color: #C9D1D9">&lt;/</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>\n<p>The last thing I need to do to be able to see this video player is add the component to the <code is:raw>StreamChannel.vue</code> page in src/views/StreamChannel.vue:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">template</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">div</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">h1</span><span style="color: #C9D1D9">&gt;Stream Channel&lt;/</span><span style="color: #7EE787">h1</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">video-player</span><span style="color: #C9D1D9"> /&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;/</span><span style="color: #7EE787">div</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">&lt;/</span><span style="color: #7EE787">template</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> VideoPlayer </span><span style="color: #FF7B72">from</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;@/components/VideoPlayer&#39;</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">export</span><span style="color: #FFA657"> </span><span style="color: #FF7B72">default</span><span style="color: #FFA657"> {</span></span>\n<span class="line"><span style="color: #FFA657">    </span><span style="color: #C9D1D9">name: </span><span style="color: #A5D6FF">&#39;StreamChannel&#39;</span><span style="color: #FFA657">,</span></span>\n<span class="line"><span style="color: #FFA657">    </span><span style="color: #C9D1D9">components: {</span></span>\n<span class="line"><span style="color: #C9D1D9">      VideoPlayer,</span></span>\n<span class="line"><span style="color: #C9D1D9">    }</span><span style="color: #FFA657">,</span></span>\n<span class="line"><span style="color: #FFA657">  }</span></span>\n<span class="line"><span style="color: #C9D1D9">&lt;/</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>\n<p>Here is how the page will look:</p>\n<p><img src="https://res.cloudinary.com/deepgram/image/upload/v1647979619/blog/2022/03/how-to-write-vue-3-composables-for-a-third-party-API-integration/VideoPlayerComponent.png" alt="Video Player Page"></p>\n<p>Now I am ready to write the first composable, the <code is:raw>useIVSPlayer.js</code> composition function, which will do the logic to bring in the Amazon IVS player.</p>\n<h2 id="composable-to-bring-in-an-external-script">Composable to Bring in An External Script</h2>\n<p>The <code is:raw>useIVSPlayer.js</code> composable will bring a script into my <code is:raw>StreamChannel.vue</code> component. The <a href="https://docs.aws.amazon.com/ivs/latest/userguide/player-web.html">docs</a> at Amazon IVS say that I need this script so that the player is brought in:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">src</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;https://player.live-video.net/1.8.0/amazon-ivs-player.min.js&quot;</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>\n<p>One way to bring in an external script is to add the script to the <code is:raw>&lt;head&gt;</code> in my <code is:raw>index.html</code> page:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">head</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">meta</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">charset</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;utf-8&quot;</span><span style="color: #C9D1D9"> /&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  ...</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">script</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">type</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;text/javascript&quot;</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">src</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;https://player.live-video.net/1.8.0/amazon-ivs-player.min.js&quot;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &gt;&lt;/</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">&lt;/</span><span style="color: #7EE787">head</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>\n<p>Then I can type \u201CIVSPlayer\u201D in the console, and I should see the module there.</p>\n<img src="https://res.cloudinary.com/deepgram/image/upload/v1647979619/blog/2022/03/how-to-write-vue-3-composables-for-a-third-party-API-integration/ConsoleIVSPlayer.png" alt="IVSPlayer in console" style="width: 50%; margin:auto;" />\n<p>If I choose this way to bring in the script, the module will be available on every page of my application. However, sometimes it is preferable to make a third-party technology only available on the page where it is needed. In that case, I need to remove that script from the <code is:raw>&lt;head&gt;</code> and bring it in a different way.</p>\n<p>If I only want to bring in the script on the <code is:raw>StreamChannel.vue</code> page, I need to write logic to <strong>build out the script tag with the src of the player URL</strong>. I will use a Vue composable, which is just a Javascript function, to build out this logic. Writing it as a composable makes it reusable, so I can easily copy it into other projects or bring it into other components in my application as needed.</p>\n<p>This <code is:raw>useIVSPlayer.js</code> composable will:</p>\n<ul>\n<li>be a <strong>Promise</strong>, since I need to account for the small amount of time it will take to load the script</li>\n<li>use <code is:raw>createElement</code> to create the script tag and <code is:raw>setAttribute</code> to add the src</li>\n<li>append the script to the head with <code is:raw>appendChild</code></li>\n<li>use the global event listener <code is:raw>onload</code> to trigger the promise being resolved</li>\n</ul>\n<p>Here is the composable:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">export</span><span style="color: #FFA657"> </span><span style="color: #FF7B72">default</span><span style="color: #FFA657"> </span><span style="color: #FF7B72">new</span><span style="color: #FFA657"> </span><span style="color: #79C0FF">Promise</span><span style="color: #FFA657">((res) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #FFA657"> </span><span style="color: #C9D1D9">{</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">script</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> document.</span><span style="color: #D2A8FF">createElement</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;script&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #C9D1D9">  script.</span><span style="color: #D2A8FF">setAttribute</span><span style="color: #C9D1D9">(</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #A5D6FF">&#39;src&#39;</span><span style="color: #C9D1D9">,</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #A5D6FF">&#39;https://player.live-video.net/1.6.1/amazon-ivs-player.min.js&#39;</span></span>\n<span class="line"><span style="color: #C9D1D9">  )</span></span>\n<span class="line"><span style="color: #C9D1D9">  document.head.</span><span style="color: #D2A8FF">appendChild</span><span style="color: #C9D1D9">(script)</span></span>\n<span class="line"><span style="color: #C9D1D9">  script.</span><span style="color: #D2A8FF">onload</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">res</span><span style="color: #C9D1D9">()</span></span>\n<span class="line"><span style="color: #C9D1D9">  script.</span><span style="color: #D2A8FF">onerror</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">throw</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;IVS PLAYER ERROR&#39;</span></span>\n<span class="line"><span style="color: #C9D1D9">  }</span></span>\n<span class="line"><span style="color: #C9D1D9">}</span><span style="color: #FFA657">)</span></span></code></pre>\n<p>I start with <code is:raw>export default</code> because I need to be able to import this logic into my <code is:raw>VideoPlayer.vue</code> component.</p>\n<p>Now in <code is:raw>VideoPlayer.vue</code> I can import the composable. I am going to use a <code is:raw>.then()</code> method because <code is:raw>useIVSPlayer</code> is a promise. The <code is:raw>.then()</code> method will wait for the promise to resolve before doing whatever I write inside the <code is:raw>.then()</code>.</p>\n<p>For now, I will check that the player is available and <code is:raw>console.log</code> that it is ready. Later, I\u2019ll add logic inside the <code is:raw>.then()</code> to bring in my streaming channel.</p>\n<p>Here is the <code is:raw>setup</code> function now in the <code is:raw>VideoPlayer.vue</code> component:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #D2A8FF">setup</span><span style="color: #C9D1D9">() {</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">let</span><span style="color: #C9D1D9"> IVSStatus </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">ref</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&quot;Is Not Connected&quot;</span><span style="color: #C9D1D9">);</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">    useIVSPlayer.</span><span style="color: #D2A8FF">then</span><span style="color: #C9D1D9">(() </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (window.IVSPlayer) {</span></span>\n<span class="line"><span style="color: #C9D1D9">        console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&quot;player loaded&quot;</span><span style="color: #C9D1D9">);</span></span>\n<span class="line"><span style="color: #C9D1D9">      }</span></span>\n<span class="line"><span style="color: #C9D1D9">    });</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> { IVSStatus };</span></span>\n<span class="line"><span style="color: #C9D1D9">  },</span></span></code></pre>\n<p>For now, I will keep <code is:raw>IVSStatus</code> as \u201CIs Not Connected\u201D because even though I have brought in the Amazon IVS player, I still need to hook up the video player to my channel stream. I\u2019ll do that in the next section.</p>\n<h2 id="composable-to-play-channel-stream">Composable to Play Channel Stream</h2>\n<p>Now I want to build a composable that will load my channel stream into the IVS player that I just brought in. This composable will do the following:</p>\n<ul>\n<li>Check that the IVS Player script is loaded and then create a new player that I can use for my stream.</li>\n<li>Load my channel stream into the player by adding the playback URL.</li>\n<li>Turn the player on with the <code is:raw>play()</code> method.</li>\n<li>Check that the stream is connected and loaded. This will be done with <code is:raw>setInterval</code> since I don\u2019t know how long the delay might be.</li>\n</ul>\n<p>First, I\u2019ll write my composable with an <code is:raw>export default</code> so I can import it into other files as needed. I\u2019ll also bring in <code is:raw>ref</code> from vue so I can track the state of the channel being loaded. I\u2019ll create a <code is:raw>ref</code> variable called <code is:raw>playerIsLoaded</code> and set it to <code is:raw>false</code> to start:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> { ref } </span><span style="color: #FF7B72">from</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;vue&#39;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #FF7B72">export</span><span style="color: #FFA657"> </span><span style="color: #FF7B72">default</span><span style="color: #FFA657"> </span><span style="color: #FF7B72">function</span><span style="color: #FFA657"> </span><span style="color: #D2A8FF">useIVSChannel</span><span style="color: #FFA657">() </span><span style="color: #C9D1D9">{</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">let</span><span style="color: #C9D1D9"> playerIsLoaded </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">ref</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">false</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> { playerIsLoaded }</span></span>\n<span class="line"><span style="color: #C9D1D9">}</span></span></code></pre>\n<p>Everything I need to do in this composable is dependent on the IVS player (the one I brought in with the <code is:raw>useIVSPlayer</code> composable) being loaded. So I\u2019ll wrap all my logic in an <code is:raw>if</code> statement to check that it is loaded and supported.</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (window.IVSPlayer </span><span style="color: #FF7B72">&amp;&amp;</span><span style="color: #C9D1D9"> window.IVSPlayer.isPlayerSupported) {</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">// all logic here</span></span>\n<span class="line"><span style="color: #C9D1D9">}</span></span></code></pre>\n<p>I\u2019ll use the player SDK\u2019s method <code is:raw>create()</code> to create a player for my channel. Then I\u2019ll attach the player to the HTML video element in my <code is:raw>VideoPlayer.vue</code> component with the SDK\u2019s <code is:raw>attachHTMLVideoElement()</code> method and I\u2019ll use <code is:raw>.load()</code> to load my channel\u2019s playback URL. I\u2019ll use <code is:raw>play()</code> to play the channel stream:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">player</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> window.IVSPlayer.</span><span style="color: #D2A8FF">create</span><span style="color: #C9D1D9">()</span></span>\n<span class="line"><span style="color: #C9D1D9">player.</span><span style="color: #D2A8FF">attachHTMLVideoElement</span><span style="color: #C9D1D9">(document.</span><span style="color: #D2A8FF">getElementById</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;video-player&#39;</span><span style="color: #C9D1D9">))</span></span>\n<span class="line"><span style="color: #C9D1D9">player.</span><span style="color: #D2A8FF">load</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;PLAYBACK_URL&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #C9D1D9">player.</span><span style="color: #D2A8FF">play</span><span style="color: #C9D1D9">()</span></span></code></pre>\n<p>(The playback URL is unique to my channel, so it has to be taken from the Amazon IVS console. See my walkthrough in <a href="https://deploy-preview-631--romantic-gates-9c0b5e.netlify.app/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/">this post</a> for more information.)</p>\n<p>Now I need to check that the channel stream is loaded. This won\u2019t happen instantaneously, but it should load relatively quickly. I don\u2019t want to use a <code is:raw>setTimeout </code>because I don\u2019t know how long it will take and I\u2019m concerned about the idea of adding a super long timeout if I don\u2019t have to. I\u2019ll use <code is:raw>setInterval</code> to check for the stream being loaded.</p>\n<p><code is:raw>setInterval</code> is a DOM API method that repeatedly calls a function until some other trigger happens to turn it off. In this case, the other trigger will be the channel being loaded.</p>\n<p>The way to turn it off is to use <code is:raw>clearInterval</code>. I\u2019m going to assign <code is:raw>setInterval</code> to a variable called <code is:raw>checkInterval</code>. The callback of <code is:raw>setInterval</code> will run every 500 milliseconds. Inside that callback, it will check that the channel has loaded, and once it has, it will set <code is:raw>playerIsLoaded</code> to <code is:raw>true</code> and clear everything by passing <code is:raw>checkInterval</code> to <code is:raw>clearInterval</code>.</p>\n<p>Here\u2019s the logic I just described:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">let</span><span style="color: #C9D1D9"> checkInterval </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">setInterval</span><span style="color: #C9D1D9">(() </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (player.core.isLoaded) {</span></span>\n<span class="line"><span style="color: #C9D1D9">    playerIsLoaded.value </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">true</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #D2A8FF">clearInterval</span><span style="color: #C9D1D9">(checkInterval)</span></span>\n<span class="line"><span style="color: #C9D1D9">  }</span></span>\n<span class="line"><span style="color: #C9D1D9">}, </span><span style="color: #79C0FF">500</span><span style="color: #C9D1D9">)</span></span></code></pre>\n<p>I\u2019ll return the ref <code is:raw>playerIsLoaded</code> from the composable, so I have access to it in the <code is:raw>VideoPlayer.vue</code> component. I want to watch that value so that when it changes, the <code is:raw>IVSStatus</code> value in the <code is:raw>VideoPlayer.vue</code> template updates to show that the channel is connected.</p>\n<p>Here is the composable in its entirety:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> { ref } </span><span style="color: #FF7B72">from</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;vue&#39;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #FF7B72">export</span><span style="color: #FFA657"> </span><span style="color: #FF7B72">default</span><span style="color: #FFA657"> </span><span style="color: #FF7B72">function</span><span style="color: #FFA657"> </span><span style="color: #D2A8FF">useIVSChannel</span><span style="color: #FFA657">() </span><span style="color: #C9D1D9">{</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">let</span><span style="color: #C9D1D9"> playerIsLoaded </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">ref</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">false</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (window.IVSPlayer </span><span style="color: #FF7B72">&amp;&amp;</span><span style="color: #C9D1D9"> window.IVSPlayer.isPlayerSupported) {</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">player</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> window.IVSPlayer.</span><span style="color: #D2A8FF">create</span><span style="color: #C9D1D9">()</span></span>\n<span class="line"><span style="color: #C9D1D9">    player.</span><span style="color: #D2A8FF">attachHTMLVideoElement</span><span style="color: #C9D1D9">(document.</span><span style="color: #D2A8FF">getElementById</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;video-player&#39;</span><span style="color: #C9D1D9">))</span></span>\n<span class="line"><span style="color: #C9D1D9">    player.</span><span style="color: #D2A8FF">load</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;PLAYBACK_URL&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #C9D1D9">    player.</span><span style="color: #D2A8FF">play</span><span style="color: #C9D1D9">()</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">let</span><span style="color: #C9D1D9"> checkInterval </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">setInterval</span><span style="color: #C9D1D9">(() </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (player.core.isLoaded) {</span></span>\n<span class="line"><span style="color: #C9D1D9">        playerIsLoaded.value </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">true</span></span>\n<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #D2A8FF">clearInterval</span><span style="color: #C9D1D9">(checkInterval)</span></span>\n<span class="line"><span style="color: #C9D1D9">      }</span></span>\n<span class="line"><span style="color: #C9D1D9">    }, </span><span style="color: #79C0FF">500</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> { playerIsLoaded }</span></span>\n<span class="line"><span style="color: #C9D1D9">  }</span></span>\n<span class="line"><span style="color: #C9D1D9">}</span></span></code></pre>\n<p>The last thing I need to do to get this working is go back to the <code is:raw>VideoPlayer.vue</code> component and run the composable function inside <code is:raw>setup</code> and update <code is:raw>IVSStatus</code> based on the channel being connected, which I\u2019ll do in the next section.</p>\n<h2 id="run-the-composables">Run the Composables</h2>\n<p>In <code is:raw>VideoPlayer.vue</code>, I will run the <code is:raw>useIVSChannel</code> composable inside <code is:raw>setup</code>. Actually, I\u2019ll run it inside the <code is:raw>.then()</code> that I already wrote earlier, which will cause <code is:raw>useIVSChannel</code> to run after <code is:raw>useIVSPlayer</code> has resolved. (I have to remember to import <code is:raw>useIVSChannel</code> from the <code is:raw>composables</code> folder if I want to use it.)</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">useIVSPlayer.</span><span style="color: #D2A8FF">then</span><span style="color: #C9D1D9">(() </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> { </span><span style="color: #79C0FF">playerIsLoaded</span><span style="color: #C9D1D9"> } </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">useIVSChannel</span><span style="color: #C9D1D9">()</span></span>\n<span class="line"><span style="color: #C9D1D9">})</span></span></code></pre>\n<p>I deconstruct <code is:raw>playerIsLoaded</code> off of <code is:raw>useIVSChannel</code> so that I can watch that reactive reference. I\u2019ll use Vue\u2019s <code is:raw>watch</code> method to make a side effect occur when the <code is:raw>playerIsLoaded</code> value changes to true (i.e., when the channel is connected). The side effect will be that the <code is:raw>IVSStatus</code> will update to \u201CIs Connected\u201D:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #D2A8FF">watch</span><span style="color: #C9D1D9">(playerIsLoaded, () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (playerIsLoaded.value) {</span></span>\n<span class="line"><span style="color: #C9D1D9">    IVSStatus.value </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;Is Connected&#39;</span></span>\n<span class="line"><span style="color: #C9D1D9">  }</span></span>\n<span class="line"><span style="color: #C9D1D9">})</span></span></code></pre>\n<p>Here is the entire script for the <code is:raw>VideoPlayer.vue</code> component:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">import </span><span style="color: #FF7B72">{</span><span style="color: #C9D1D9"> ref, watch </span><span style="color: #FF7B72">}</span><span style="color: #C9D1D9"> from &quot;vue&quot;;</span></span>\n<span class="line"><span style="color: #C9D1D9">import useIVSPlayer from &quot;../composables/useIVSPlayer&quot;;</span></span>\n<span class="line"><span style="color: #C9D1D9">import useIVSChannel from &quot;../composables/useIVSChannel&quot;;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">export default </span><span style="color: #FF7B72">{</span></span>\n<span class="line"><span style="color: #C9D1D9">  name: </span><span style="color: #A5D6FF">&quot;VideoPlayer&quot;</span><span style="color: #C9D1D9">,</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #D2A8FF">setup</span><span style="color: #C9D1D9">() {</span></span>\n<span class="line"><span style="color: #C9D1D9">    let IVSStatus </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">ref</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&quot;Is Not Connected&quot;</span><span style="color: #C9D1D9">);</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">    useIVSPlayer.then(() =&gt; {</span></span>\n<span class="line"><span style="color: #C9D1D9">      const { playerIsLoaded } </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">useIVSChannel</span><span style="color: #C9D1D9">();</span></span>\n<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #D2A8FF">watch</span><span style="color: #C9D1D9">(playerIsLoaded, () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (playerIsLoaded.value) {</span></span>\n<span class="line"><span style="color: #C9D1D9">          IVSStatus.value </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&quot;Is Connected&quot;</span><span style="color: #C9D1D9">;</span></span>\n<span class="line"><span style="color: #C9D1D9">        }</span></span>\n<span class="line"><span style="color: #C9D1D9">      });</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">}</span><span style="color: #C9D1D9">);</span></span>\n<span class="line"><span style="color: #C9D1D9">    return </span><span style="color: #FF7B72">{</span><span style="color: #C9D1D9"> IVSStatus </span><span style="color: #FF7B72">}</span><span style="color: #C9D1D9">;</span></span>\n<span class="line"><span style="color: #C9D1D9">  },</span></span>\n<span class="line"><span style="color: #C9D1D9">};</span></span>\n<span class="line"><span style="color: #C9D1D9">&lt;/</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>\n<p>However, nothing will happen in my video player in the browser if I have not turned on my stream. In <a href="https://deploy-preview-631--romantic-gates-9c0b5e.netlify.app/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/">the first post</a> in this series, I showed how to set up OBS to use their software on my computer to create a stream, which I connected to an Amazon IVS channel.</p>\n<p>If I turn on my stream in OBS, I should see myself in the video player in my application now!</p>\n<p><img src="https://res.cloudinary.com/deepgram/image/upload/v1647979619/blog/2022/03/how-to-write-vue-3-composables-for-a-third-party-API-integration/VideoStreamWorking.png" alt="Video Stream working"></p>\n<h2 id="conclusion">Conclusion</h2>\n<p>Vue composables are useful for writing standalone logic that can be reused, but if one composable depends on another, it can be tricky. In this post, I showed how a composable can be written as a promise and how <code is:raw>setInterval</code> can be used to check if something the composable depends on has happened yet. These are two ways to write composables that may have asynchronous events occurring.</p>\n<p>In the next post, I\u2019ll show how to write composables for using Deepgram\u2019s API to create text captions for my stream. I\u2019ll write a composable to use the browser MediaStreams API (a great example of a composable that can be reused in different contexts). I\u2019ll also show how to use <code is:raw>fetch</code> in a composable to get a token from the backend.</p>\n<p>I hope you\u2019ll join me for the next post. Follow me on <a href="https://twitter.com/sandra_rodgers_">Twitter</a> so you don\u2019t miss it!</p>';
}
const $$Astro = createAstro("/Users/sandrarodgers/web-next/blog/src/content/blog/posts/how-to-write-vue-3-composables-for-a-third-party-api-integration/index.md", "", "file:///Users/sandrarodgers/web-next/blog/");
const $$Index = createComponent(async ($$result, $$props, $$slots) => {
  const Astro2 = $$result.createAstro($$Astro, $$props, $$slots);
  Astro2.self = $$Index;
  new Slugger();
  return renderTemplate`<head>${renderHead($$result)}</head><h2 id="introduction">Introduction</h2>
<p>This post is a continuation of the series “How to Build a Live Streaming Web Application with Amazon IVS and Deepgram.”</p>
${renderComponent($$result, "Panel", Panel, { "type": "info", "title": "Build a Live Streaming Web Application with Amazon IVS and Deepgram (SERIES)" }, { "default": () => renderTemplate`<ol><li><a href="https://blog.deepgram.com/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/">How to Build a Live Streaming Web Application with Amazon IVS and Deepgram</a></li>
<li><a href="https://blog.deepgram.com/build-a-livestream-web-application-vue-and-express-setup/"> Build a Live Streaming Web Application: Vue and Express Setup</a></li>
<li><a href="https://blog.deepgram.com/how-to-write-vue-3-composables-for-a-third-party-API-integration/"> How to Write Vue 3 Composables for a Third-Party API Integration</a></li><li><a href="https://blog.deepgram.com/asynchronous-logic-to-write-a-vue-3-and-deepgram-captions-component/"> Asynchronous Logic to Write a Vue 3 and Deepgram Captions Component</a></li></ol>` })}
<h3 id="composables">Composables</h3>
<p>In Vue.js, the term ‘composables’ refers to composition functions, a key feature of Vue 3’s Composition API. While the API itself includes many composition functions that are core to its design, such as the <code>setup()</code> function or the reactivity functions <code>ref()</code> and <code>reactive()</code>, composables are those composition functions that I write myself to be used throughout my own project as needed.</p>
<p>Composables are functions that encapsulate stateful logic, which means they are like little packages that are focused around performing one logical concern, and they keep track of state that changes due to the function running.</p>
<p>For example, I could write a composable function that toggles a menu open or closed. That logic could be used throughout an application, and it would need to keep track of the state of the menu being opened or closed. I would just need to import the composable into whatever file I need it and run the function.</p>
<h4 id="composable-example-usemenujs">Composable Example <code>useMenu.js</code></h4>
<pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> { readonly, ref } </span><span style="color: #FF7B72">from</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;vue&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">isOpen</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">ref</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">false</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">toggleMenu</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">  isOpen.value </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">!</span><span style="color: #C9D1D9">isOpen.value</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">export</span><span style="color: #FFA657"> </span><span style="color: #FF7B72">default</span><span style="color: #FFA657"> </span><span style="color: #FF7B72">function</span><span style="color: #FFA657"> </span><span style="color: #D2A8FF">useMenu</span><span style="color: #FFA657">() </span><span style="color: #C9D1D9">{</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">    isOpen: </span><span style="color: #D2A8FF">readonly</span><span style="color: #C9D1D9">(isOpen),</span></span>
<span class="line"><span style="color: #C9D1D9">    toggleMenu,</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span></code></pre>
<p>Today I am going to introduce how to write a composable in Vue 3 to bring in the Amazon IVS video player SDK and to connect to my Amazon IVS streaming channel.</p>
<p>If you have wanted to learn more about how to write Vue 3 composables to use third-party technologies, this will be useful to you. In this post, I’ll cover:</p>
<ul>
<li>Writing a Vue composable to bring in an external script</li>
<li>Writing a Vue composable that is dependent on another composable, utilizing the Javascript function <code>setInterval</code></li>
<li>Amazon IVS integration using Vue 3 composables</li>
</ul>
<h3 id="background-to-the-series">Background to the Series</h3>
<p>In the <a href="https://blog.deepgram.com/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/">first post</a> in the series, I explained how to build a live streaming web application using just Vanilla JS and HTML. That post covers setting up an Amazon IVS account, which is necessary to get the third-party technology example (Amazon IVS) in today’s post working. <strong>Setting up an Amazon IVS channel is necessary to build the second composable in this tutorial, but the first one can be built without doing that</strong>.</p>
<p>In the second post, I started building a full-stack application using Vue 3. I set up Vue-Router, Vuex, and a backend server which all helped me build a feature to restrict access to the streaming page of my site. Visitors to the site are required to enter a code, and that code is verified on the backend, resulting in the user being able to navigate to the streaming page. <strong>There is no need to read that post to be able to go through this tutorial on composables.</strong></p>
<p>Today I’ll build the video streaming page in Vue 3, focusing on building this feature with Vue composables. If you want a refresher on Vue composables, check out my post <a href="https://blog.deepgram.com/diving-into-vue-3-reusability-with-composables/">Reusability with Composables</a>.</p>
<p>The code for today’s tutorial can be found in <a href="https://github.com/deepgram-devs/livestream-amazonIVS-and-deepgram/tree/amazonIVS-composables">this Github repo</a>, the branch named “amazonIVS-composables.”</p>
<p>Now I’ll get into it!</p>
<h2 id="files-organization">Files Organization</h2>
<p>This project has two main views, the landing page and the streaming page. Today I’ll be working entirely in the streaming page. In my project, I have named this file <code>StreamChannel.vue</code>, and it is in the <code>Views</code> folder.</p>
<p>The <code>StreamChannel.vue</code> will eventually be made up of two components - one for <strong>the video player</strong> that relies on the Amazon IVS technology and one for the <strong>closed-captions</strong> that relies on the Deepgram speech-to-text technology. Today I’ll only build the video player component.</p>
<p>I’ll set up two folders to start - a <code>components</code> folder and a <code>composables</code> folder, both in the <code>src</code> folder. In the <code>components</code> folder, I’ll create a <code>VideoPlayer.vue</code> component.</p>
<p>The <code>composables</code> folder is where I will put the composition functions that contain the logic that makes the video player work. <strong>A common practice in Vue 3 is to name composables so that they begin with ‘use’.</strong> The name will identify what the composable does. The two composables I will be writing today are <code>useIVSPlayer</code> and <code>useIVSChannel</code>. Here is what they will do:</p>
<ol>
<li>
<p><code>useIVSPlayer.js</code> - this composable will bring in the <a href="https://docs.aws.amazon.com/ivs/latest/userguide/player-web.html">Amazon IVS video player script</a> so that the HTML video element is enhanced with the Amazon IVS Player Web SDK.</p>
</li>
<li>
<p><code>useIVSChannel.js</code> - this composable will check at an interval if the player in the <code>useIVSPlayer</code> script has loaded, and if it has, it will create a connection to my Amazon IVS channel, updating state to show that the channel is connected.</p>
</li>
</ol>
<p>My <a href="https://github.com/deepgram-devs/livestream-amazonIVS-and-deepgram/tree/amazonIVS-composables/src">Github repo</a> for this project shows how I have set up these folders.</p>
<h2 id="videoplayer-component">VideoPlayer Component</h2>
<p>The <code>VideoPlayer.vue</code> component will be a video player that shows the live stream. The Amazon IVS video player script looks for an HTML <code>&lt;video&gt;</code> element with a specific ID and then takes control of that element to bring in its own specially made video player with Amazon IVS optimizations. So the first composable I write will be <strong>a function that brings in the Amazon IVS player with a script</strong>.</p>
<p>In the <code>VideoPlayer.vue</code> file, I will start by writing the HTML I need in the Vue template so that I have a basic video player. I’ve given it a height and a width that I prefer, and the <code>id="video-player"</code> so that I can use that id later to bring in the Amazon IVS player. The attributes that the html <code>&lt;video&gt;</code> element supports are listed <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/video#attributes">here</a>.</p>
<pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">template</span><span style="color: #C9D1D9">&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">div</span><span style="color: #C9D1D9">&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">p</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">class</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;status&quot;</span><span style="color: #C9D1D9">&gt;AWS Channel {{ IVSStatus }}&lt;/</span><span style="color: #7EE787">p</span><span style="color: #C9D1D9">&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">video</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">width</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;520&quot;</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">height</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;440&quot;</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">id</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;video-player&quot;</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">controls</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">playsinline</span></span>
<span class="line"><span style="color: #C9D1D9">    &gt;&lt;/</span><span style="color: #7EE787">video</span><span style="color: #C9D1D9">&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">  &lt;/</span><span style="color: #7EE787">div</span><span style="color: #C9D1D9">&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">&lt;/</span><span style="color: #7EE787">template</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>
<p>The <code>IVSStatus</code> will be set to a <code>ref</code> property. For now, I’ll make that property a string ‘Is Not Connected,’ but later, it will be hooked up to the status of the channel, and it will update to say ‘Is Connected’ when the channel is available.</p>
<p>Here is my setup function in the script block with that <code>ref</code>:</p>
<pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">import </span><span style="color: #FF7B72">{</span><span style="color: #C9D1D9"> ref </span><span style="color: #FF7B72">}</span><span style="color: #C9D1D9"> from &quot;vue&quot;;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">export default </span><span style="color: #FF7B72">{</span></span>
<span class="line"><span style="color: #C9D1D9">  name: </span><span style="color: #A5D6FF">&quot;VideoPlayer&quot;</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #D2A8FF">setup</span><span style="color: #C9D1D9">() {</span></span>
<span class="line"><span style="color: #C9D1D9">    let IVSStatus </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">ref</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&quot;Is Not Connected&quot;</span><span style="color: #C9D1D9">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">    return { IVSStatus };</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">}</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">};</span></span>
<span class="line"><span style="color: #C9D1D9">&lt;/</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>
<p>The last thing I need to do to be able to see this video player is add the component to the <code>StreamChannel.vue</code> page in src/views/StreamChannel.vue:</p>
<pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">template</span><span style="color: #C9D1D9">&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">div</span><span style="color: #C9D1D9">&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">h1</span><span style="color: #C9D1D9">&gt;Stream Channel&lt;/</span><span style="color: #7EE787">h1</span><span style="color: #C9D1D9">&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">video-player</span><span style="color: #C9D1D9"> /&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">  &lt;/</span><span style="color: #7EE787">div</span><span style="color: #C9D1D9">&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">&lt;/</span><span style="color: #7EE787">template</span><span style="color: #C9D1D9">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> VideoPlayer </span><span style="color: #FF7B72">from</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;@/components/VideoPlayer&#39;</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">export</span><span style="color: #FFA657"> </span><span style="color: #FF7B72">default</span><span style="color: #FFA657"> {</span></span>
<span class="line"><span style="color: #FFA657">    </span><span style="color: #C9D1D9">name: </span><span style="color: #A5D6FF">&#39;StreamChannel&#39;</span><span style="color: #FFA657">,</span></span>
<span class="line"><span style="color: #FFA657">    </span><span style="color: #C9D1D9">components: {</span></span>
<span class="line"><span style="color: #C9D1D9">      VideoPlayer,</span></span>
<span class="line"><span style="color: #C9D1D9">    }</span><span style="color: #FFA657">,</span></span>
<span class="line"><span style="color: #FFA657">  }</span></span>
<span class="line"><span style="color: #C9D1D9">&lt;/</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>
<p>Here is how the page will look:</p>
<p><img src="https://res.cloudinary.com/deepgram/image/upload/v1647979619/blog/2022/03/how-to-write-vue-3-composables-for-a-third-party-API-integration/VideoPlayerComponent.png" alt="Video Player Page"></p>
<p>Now I am ready to write the first composable, the <code>useIVSPlayer.js</code> composition function, which will do the logic to bring in the Amazon IVS player.</p>
<h2 id="composable-to-bring-in-an-external-script">Composable to Bring in An External Script</h2>
<p>The <code>useIVSPlayer.js</code> composable will bring a script into my <code>StreamChannel.vue</code> component. The <a href="https://docs.aws.amazon.com/ivs/latest/userguide/player-web.html">docs</a> at Amazon IVS say that I need this script so that the player is brought in:</p>
<pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">src</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;https://player.live-video.net/1.8.0/amazon-ivs-player.min.js&quot;</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>
<p>One way to bring in an external script is to add the script to the <code>&lt;head&gt;</code> in my <code>index.html</code> page:</p>
<pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">head</span><span style="color: #C9D1D9">&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">meta</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">charset</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;utf-8&quot;</span><span style="color: #C9D1D9"> /&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">  ...</span></span>
<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">script</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">type</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;text/javascript&quot;</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">src</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;https://player.live-video.net/1.8.0/amazon-ivs-player.min.js&quot;</span></span>
<span class="line"><span style="color: #C9D1D9">  &gt;&lt;/</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">&lt;/</span><span style="color: #7EE787">head</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>
<p>Then I can type “IVSPlayer” in the console, and I should see the module there.</p>
<img src="https://res.cloudinary.com/deepgram/image/upload/v1647979619/blog/2022/03/how-to-write-vue-3-composables-for-a-third-party-API-integration/ConsoleIVSPlayer.png" alt="IVSPlayer in console" style="width: 50%; margin:auto;">
<p>If I choose this way to bring in the script, the module will be available on every page of my application. However, sometimes it is preferable to make a third-party technology only available on the page where it is needed. In that case, I need to remove that script from the <code>&lt;head&gt;</code> and bring it in a different way.</p>
<p>If I only want to bring in the script on the <code>StreamChannel.vue</code> page, I need to write logic to <strong>build out the script tag with the src of the player URL</strong>. I will use a Vue composable, which is just a Javascript function, to build out this logic. Writing it as a composable makes it reusable, so I can easily copy it into other projects or bring it into other components in my application as needed.</p>
<p>This <code>useIVSPlayer.js</code> composable will:</p>
<ul>
<li>be a <strong>Promise</strong>, since I need to account for the small amount of time it will take to load the script</li>
<li>use <code>createElement</code> to create the script tag and <code>setAttribute</code> to add the src</li>
<li>append the script to the head with <code>appendChild</code></li>
<li>use the global event listener <code>onload</code> to trigger the promise being resolved</li>
</ul>
<p>Here is the composable:</p>
<pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">export</span><span style="color: #FFA657"> </span><span style="color: #FF7B72">default</span><span style="color: #FFA657"> </span><span style="color: #FF7B72">new</span><span style="color: #FFA657"> </span><span style="color: #79C0FF">Promise</span><span style="color: #FFA657">((res) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #FFA657"> </span><span style="color: #C9D1D9">{</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">script</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> document.</span><span style="color: #D2A8FF">createElement</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;script&#39;</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #C9D1D9">  script.</span><span style="color: #D2A8FF">setAttribute</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #A5D6FF">&#39;src&#39;</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #A5D6FF">&#39;https://player.live-video.net/1.6.1/amazon-ivs-player.min.js&#39;</span></span>
<span class="line"><span style="color: #C9D1D9">  )</span></span>
<span class="line"><span style="color: #C9D1D9">  document.head.</span><span style="color: #D2A8FF">appendChild</span><span style="color: #C9D1D9">(script)</span></span>
<span class="line"><span style="color: #C9D1D9">  script.</span><span style="color: #D2A8FF">onload</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">res</span><span style="color: #C9D1D9">()</span></span>
<span class="line"><span style="color: #C9D1D9">  script.</span><span style="color: #D2A8FF">onerror</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">throw</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;IVS PLAYER ERROR&#39;</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"><span style="color: #C9D1D9">}</span><span style="color: #FFA657">)</span></span></code></pre>
<p>I start with <code>export default</code> because I need to be able to import this logic into my <code>VideoPlayer.vue</code> component.</p>
<p>Now in <code>VideoPlayer.vue</code> I can import the composable. I am going to use a <code>.then()</code> method because <code>useIVSPlayer</code> is a promise. The <code>.then()</code> method will wait for the promise to resolve before doing whatever I write inside the <code>.then()</code>.</p>
<p>For now, I will check that the player is available and <code>console.log</code> that it is ready. Later, I’ll add logic inside the <code>.then()</code> to bring in my streaming channel.</p>
<p>Here is the <code>setup</code> function now in the <code>VideoPlayer.vue</code> component:</p>
<pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #D2A8FF">setup</span><span style="color: #C9D1D9">() {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">let</span><span style="color: #C9D1D9"> IVSStatus </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">ref</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&quot;Is Not Connected&quot;</span><span style="color: #C9D1D9">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">    useIVSPlayer.</span><span style="color: #D2A8FF">then</span><span style="color: #C9D1D9">(() </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (window.IVSPlayer) {</span></span>
<span class="line"><span style="color: #C9D1D9">        console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&quot;player loaded&quot;</span><span style="color: #C9D1D9">);</span></span>
<span class="line"><span style="color: #C9D1D9">      }</span></span>
<span class="line"><span style="color: #C9D1D9">    });</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> { IVSStatus };</span></span>
<span class="line"><span style="color: #C9D1D9">  },</span></span></code></pre>
<p>For now, I will keep <code>IVSStatus</code> as “Is Not Connected” because even though I have brought in the Amazon IVS player, I still need to hook up the video player to my channel stream. I’ll do that in the next section.</p>
<h2 id="composable-to-play-channel-stream">Composable to Play Channel Stream</h2>
<p>Now I want to build a composable that will load my channel stream into the IVS player that I just brought in. This composable will do the following:</p>
<ul>
<li>Check that the IVS Player script is loaded and then create a new player that I can use for my stream.</li>
<li>Load my channel stream into the player by adding the playback URL.</li>
<li>Turn the player on with the <code>play()</code> method.</li>
<li>Check that the stream is connected and loaded. This will be done with <code>setInterval</code> since I don’t know how long the delay might be.</li>
</ul>
<p>First, I’ll write my composable with an <code>export default</code> so I can import it into other files as needed. I’ll also bring in <code>ref</code> from vue so I can track the state of the channel being loaded. I’ll create a <code>ref</code> variable called <code>playerIsLoaded</code> and set it to <code>false</code> to start:</p>
<pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> { ref } </span><span style="color: #FF7B72">from</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;vue&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">export</span><span style="color: #FFA657"> </span><span style="color: #FF7B72">default</span><span style="color: #FFA657"> </span><span style="color: #FF7B72">function</span><span style="color: #FFA657"> </span><span style="color: #D2A8FF">useIVSChannel</span><span style="color: #FFA657">() </span><span style="color: #C9D1D9">{</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">let</span><span style="color: #C9D1D9"> playerIsLoaded </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">ref</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">false</span><span style="color: #C9D1D9">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> { playerIsLoaded }</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span></code></pre>
<p>Everything I need to do in this composable is dependent on the IVS player (the one I brought in with the <code>useIVSPlayer</code> composable) being loaded. So I’ll wrap all my logic in an <code>if</code> statement to check that it is loaded and supported.</p>
<pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (window.IVSPlayer </span><span style="color: #FF7B72">&amp;&amp;</span><span style="color: #C9D1D9"> window.IVSPlayer.isPlayerSupported) {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">// all logic here</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span></code></pre>
<p>I’ll use the player SDK’s method <code>create()</code> to create a player for my channel. Then I’ll attach the player to the HTML video element in my <code>VideoPlayer.vue</code> component with the SDK’s <code>attachHTMLVideoElement()</code> method and I’ll use <code>.load()</code> to load my channel’s playback URL. I’ll use <code>play()</code> to play the channel stream:</p>
<pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">player</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> window.IVSPlayer.</span><span style="color: #D2A8FF">create</span><span style="color: #C9D1D9">()</span></span>
<span class="line"><span style="color: #C9D1D9">player.</span><span style="color: #D2A8FF">attachHTMLVideoElement</span><span style="color: #C9D1D9">(document.</span><span style="color: #D2A8FF">getElementById</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;video-player&#39;</span><span style="color: #C9D1D9">))</span></span>
<span class="line"><span style="color: #C9D1D9">player.</span><span style="color: #D2A8FF">load</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;PLAYBACK_URL&#39;</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #C9D1D9">player.</span><span style="color: #D2A8FF">play</span><span style="color: #C9D1D9">()</span></span></code></pre>
<p>(The playback URL is unique to my channel, so it has to be taken from the Amazon IVS console. See my walkthrough in <a href="https://deploy-preview-631--romantic-gates-9c0b5e.netlify.app/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/">this post</a> for more information.)</p>
<p>Now I need to check that the channel stream is loaded. This won’t happen instantaneously, but it should load relatively quickly. I don’t want to use a <code>setTimeout </code>because I don’t know how long it will take and I’m concerned about the idea of adding a super long timeout if I don’t have to. I’ll use <code>setInterval</code> to check for the stream being loaded.</p>
<p><code>setInterval</code> is a DOM API method that repeatedly calls a function until some other trigger happens to turn it off. In this case, the other trigger will be the channel being loaded.</p>
<p>The way to turn it off is to use <code>clearInterval</code>. I’m going to assign <code>setInterval</code> to a variable called <code>checkInterval</code>. The callback of <code>setInterval</code> will run every 500 milliseconds. Inside that callback, it will check that the channel has loaded, and once it has, it will set <code>playerIsLoaded</code> to <code>true</code> and clear everything by passing <code>checkInterval</code> to <code>clearInterval</code>.</p>
<p>Here’s the logic I just described:</p>
<pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">let</span><span style="color: #C9D1D9"> checkInterval </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">setInterval</span><span style="color: #C9D1D9">(() </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (player.core.isLoaded) {</span></span>
<span class="line"><span style="color: #C9D1D9">    playerIsLoaded.value </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">true</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #D2A8FF">clearInterval</span><span style="color: #C9D1D9">(checkInterval)</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"><span style="color: #C9D1D9">}, </span><span style="color: #79C0FF">500</span><span style="color: #C9D1D9">)</span></span></code></pre>
<p>I’ll return the ref <code>playerIsLoaded</code> from the composable, so I have access to it in the <code>VideoPlayer.vue</code> component. I want to watch that value so that when it changes, the <code>IVSStatus</code> value in the <code>VideoPlayer.vue</code> template updates to show that the channel is connected.</p>
<p>Here is the composable in its entirety:</p>
<pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> { ref } </span><span style="color: #FF7B72">from</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;vue&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">export</span><span style="color: #FFA657"> </span><span style="color: #FF7B72">default</span><span style="color: #FFA657"> </span><span style="color: #FF7B72">function</span><span style="color: #FFA657"> </span><span style="color: #D2A8FF">useIVSChannel</span><span style="color: #FFA657">() </span><span style="color: #C9D1D9">{</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">let</span><span style="color: #C9D1D9"> playerIsLoaded </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">ref</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">false</span><span style="color: #C9D1D9">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (window.IVSPlayer </span><span style="color: #FF7B72">&amp;&amp;</span><span style="color: #C9D1D9"> window.IVSPlayer.isPlayerSupported) {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">player</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> window.IVSPlayer.</span><span style="color: #D2A8FF">create</span><span style="color: #C9D1D9">()</span></span>
<span class="line"><span style="color: #C9D1D9">    player.</span><span style="color: #D2A8FF">attachHTMLVideoElement</span><span style="color: #C9D1D9">(document.</span><span style="color: #D2A8FF">getElementById</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;video-player&#39;</span><span style="color: #C9D1D9">))</span></span>
<span class="line"><span style="color: #C9D1D9">    player.</span><span style="color: #D2A8FF">load</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;PLAYBACK_URL&#39;</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #C9D1D9">    player.</span><span style="color: #D2A8FF">play</span><span style="color: #C9D1D9">()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">let</span><span style="color: #C9D1D9"> checkInterval </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">setInterval</span><span style="color: #C9D1D9">(() </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (player.core.isLoaded) {</span></span>
<span class="line"><span style="color: #C9D1D9">        playerIsLoaded.value </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">true</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #D2A8FF">clearInterval</span><span style="color: #C9D1D9">(checkInterval)</span></span>
<span class="line"><span style="color: #C9D1D9">      }</span></span>
<span class="line"><span style="color: #C9D1D9">    }, </span><span style="color: #79C0FF">500</span><span style="color: #C9D1D9">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> { playerIsLoaded }</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span></code></pre>
<p>The last thing I need to do to get this working is go back to the <code>VideoPlayer.vue</code> component and run the composable function inside <code>setup</code> and update <code>IVSStatus</code> based on the channel being connected, which I’ll do in the next section.</p>
<h2 id="run-the-composables">Run the Composables</h2>
<p>In <code>VideoPlayer.vue</code>, I will run the <code>useIVSChannel</code> composable inside <code>setup</code>. Actually, I’ll run it inside the <code>.then()</code> that I already wrote earlier, which will cause <code>useIVSChannel</code> to run after <code>useIVSPlayer</code> has resolved. (I have to remember to import <code>useIVSChannel</code> from the <code>composables</code> folder if I want to use it.)</p>
<pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">useIVSPlayer.</span><span style="color: #D2A8FF">then</span><span style="color: #C9D1D9">(() </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> { </span><span style="color: #79C0FF">playerIsLoaded</span><span style="color: #C9D1D9"> } </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">useIVSChannel</span><span style="color: #C9D1D9">()</span></span>
<span class="line"><span style="color: #C9D1D9">})</span></span></code></pre>
<p>I deconstruct <code>playerIsLoaded</code> off of <code>useIVSChannel</code> so that I can watch that reactive reference. I’ll use Vue’s <code>watch</code> method to make a side effect occur when the <code>playerIsLoaded</code> value changes to true (i.e., when the channel is connected). The side effect will be that the <code>IVSStatus</code> will update to “Is Connected”:</p>
<pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #D2A8FF">watch</span><span style="color: #C9D1D9">(playerIsLoaded, () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (playerIsLoaded.value) {</span></span>
<span class="line"><span style="color: #C9D1D9">    IVSStatus.value </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;Is Connected&#39;</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"><span style="color: #C9D1D9">})</span></span></code></pre>
<p>Here is the entire script for the <code>VideoPlayer.vue</code> component:</p>
<pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">import </span><span style="color: #FF7B72">{</span><span style="color: #C9D1D9"> ref, watch </span><span style="color: #FF7B72">}</span><span style="color: #C9D1D9"> from &quot;vue&quot;;</span></span>
<span class="line"><span style="color: #C9D1D9">import useIVSPlayer from &quot;../composables/useIVSPlayer&quot;;</span></span>
<span class="line"><span style="color: #C9D1D9">import useIVSChannel from &quot;../composables/useIVSChannel&quot;;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">export default </span><span style="color: #FF7B72">{</span></span>
<span class="line"><span style="color: #C9D1D9">  name: </span><span style="color: #A5D6FF">&quot;VideoPlayer&quot;</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #D2A8FF">setup</span><span style="color: #C9D1D9">() {</span></span>
<span class="line"><span style="color: #C9D1D9">    let IVSStatus </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">ref</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&quot;Is Not Connected&quot;</span><span style="color: #C9D1D9">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">    useIVSPlayer.then(() =&gt; {</span></span>
<span class="line"><span style="color: #C9D1D9">      const { playerIsLoaded } </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">useIVSChannel</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #D2A8FF">watch</span><span style="color: #C9D1D9">(playerIsLoaded, () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (playerIsLoaded.value) {</span></span>
<span class="line"><span style="color: #C9D1D9">          IVSStatus.value </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&quot;Is Connected&quot;</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">        }</span></span>
<span class="line"><span style="color: #C9D1D9">      });</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">}</span><span style="color: #C9D1D9">);</span></span>
<span class="line"><span style="color: #C9D1D9">    return </span><span style="color: #FF7B72">{</span><span style="color: #C9D1D9"> IVSStatus </span><span style="color: #FF7B72">}</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">  },</span></span>
<span class="line"><span style="color: #C9D1D9">};</span></span>
<span class="line"><span style="color: #C9D1D9">&lt;/</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>
<p>However, nothing will happen in my video player in the browser if I have not turned on my stream. In <a href="https://deploy-preview-631--romantic-gates-9c0b5e.netlify.app/blog/2022/03/build-a-livestream-web-application-with-amazon-ivs-and-deepgram/">the first post</a> in this series, I showed how to set up OBS to use their software on my computer to create a stream, which I connected to an Amazon IVS channel.</p>
<p>If I turn on my stream in OBS, I should see myself in the video player in my application now!</p>
<p><img src="https://res.cloudinary.com/deepgram/image/upload/v1647979619/blog/2022/03/how-to-write-vue-3-composables-for-a-third-party-API-integration/VideoStreamWorking.png" alt="Video Stream working"></p>
<h2 id="conclusion">Conclusion</h2>
<p>Vue composables are useful for writing standalone logic that can be reused, but if one composable depends on another, it can be tricky. In this post, I showed how a composable can be written as a promise and how <code>setInterval</code> can be used to check if something the composable depends on has happened yet. These are two ways to write composables that may have asynchronous events occurring.</p>
<p>In the next post, I’ll show how to write composables for using Deepgram’s API to create text captions for my stream. I’ll write a composable to use the browser MediaStreams API (a great example of a composable that can be reused in different contexts). I’ll also show how to use <code>fetch</code> in a composable to get a token from the backend.</p>
<p>I hope you’ll join me for the next post. Follow me on <a href="https://twitter.com/sandra_rodgers_">Twitter</a> so you don’t miss it!</p>`;
}, "/Users/sandrarodgers/web-next/blog/src/content/blog/posts/how-to-write-vue-3-composables-for-a-third-party-api-integration/index.md");

export { compiledContent, $$Index as default, frontmatter, metadata, rawContent };
