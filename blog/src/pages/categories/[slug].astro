---
import PrimarySection from "../../shared/components/layout/PrimarySection.astro";
import Layout from "../../layouts/Default.astro";

/// get all the posts for one category

export async function getStaticPaths() {
	const categories = await Astro.glob("../../content/category/*.json");
	const allPosts = await Astro.glob("../../content/posts/**/index.md");

	return categories.map((cat) => {
		const slug = "blah"; // cat.file.split("/")[cat.file.split("/").length - 2];

		const posts = allPosts
			.filter((post) => post.frontmatter.category === slug)
			.sort((a, b) => {
				const aDate = new Date(b.frontmatter.date);
				const bDate = new Date(a.frontmatter.date);
				return aDate.getTime() - bDate.getTime();
			});

		return {
			params: {
				slug,
			},
			props: {
				posts,
			},
		};
	});
}

const { cat } = Astro.props;
const { slug } = Astro.params;
---

<Layout>
	<PrimarySection>
		test<br />
		test<br />
		test<br />
		test<br />
		test<br />
		test<br />
		test<br />
		test<br />
		test<br />
		test<br />
		test<br />
		test<br />
		test<br />
		test<br />
	</PrimarySection>
</Layout>
