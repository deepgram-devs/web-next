---
import PrimarySection from "../../shared/components/layout/PrimarySection.astro";
import Layout from "../../layouts/Default.astro";
import PostsDetail from "../../shared/components/layout/PostsDetail.astro";

export async function getStaticPaths() {
	const categories = await Astro.glob("../../content/blog/category/*.json");
	const allPosts = await Astro.glob("../../content/blog/posts/**/index.md");
	return categories.map((cat) => {
		const slug = cat.title.toLowerCase().replace(/ /g, "-").replace("&", "and");
		const postsByCategory = [];
		allPosts.filter((post) => {
			if (post.frontmatter.category === slug) {
				postsByCategory.push(post);
			}
		});

		return {
			params: {
				slug,
			},
			props: {
				posts: postsByCategory,
			},
		};
	});
}
const { posts } = Astro.props;
const { slug } = Astro.params;
---

<Layout>
	<PrimarySection class="pt-14">
		<PostsDetail posts={posts} backLink="All Posts" />
	</PrimarySection>
</Layout>
