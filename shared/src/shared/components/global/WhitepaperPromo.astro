---
import { storyblokEditable } from "@storyblok/astro";
import { getSluggedJson } from "../../util";
import AbstractPromo from "../promos/AbstractPromo.astro";

interface Props {
	whitepaper: string;
	[key: string]: string;
}

interface Whitepaper {
	title: string;
	script: string;
	theme: string;
	image: string;
	date: string;
	slug?: string;
}

let whitepaper: Whitepaper;
const { whitepaper: whitepaperSlug, outsideBlog, ...rest } = Astro.props as Props;

const allWhitepapers: Whitepaper[] = await getSluggedJson("whitepapers");

if (whitepaperSlug === "latest") {
	whitepaper = allWhitepapers.pop();
} else {
	whitepaper = allWhitepapers.find((wp) => wp.slug === whitepaperSlug);
}

const { theme, title, image, script } = whitepaper;
const { blok } = Astro.props;
---

<AbstractPromo {...storyblokEditable(blok)} strapline="White Paper" outsideBlog={outsideBlog} backgroundImage={image} theme={theme} title={title} {...rest}>
	<script set:html={script}>

	</script>
</AbstractPromo>

<style>
	:global(.hs-error-msg),
	:global(.hbspt-form) {
		@apply text-cloud;
	}

	:global(.hbspt-form form) {
		@apply flex flex-col md:flex-row;
		@apply max-w-md md:max-w-full;
	}

	:global(.hbspt-form label) {
		@apply text-body-smallest;
		@apply pb-4;
	}

	:global(.hbspt-form input[type="email"]),
	:global(.hbspt-form input[type="password"]),
	:global(.hbspt-form input[type="search"]),
	:global(.hbspt-form input[type="tel"]),
	:global(.hbspt-form input[type="text"]),
	:global(.hbspt-form input[type="url"]),
	:global(.hbspt-form input[type="text"]),
	:global(.hbspt-form textarea) {
		@apply placeholder:text-stone bg-almostBlack;
		@apply w-full px-[1rem] pb-[1.1rem] pt-[1.15rem] text-[1rem] leading-[1rem];
		height: 54px;
		@apply mt-1;
	}

	:global(.hbspt-form) {
		@apply mt-4;
	}

	:global(.hbspt-form .hs-form-field) {
		@apply mt-4;
	}

	:global(.hbspt-form form fieldset) {
		@apply flex max-w-full flex-col md:flex-row;
	}

	:global(.hbspt-form form fieldset.form-columns-2 .input) {
		@apply mr-0 md:mr-4;
	}

	:global(.hbspt-form input[type="submit"]),
	:global(.hbspt-form input[type="button"]),
	:global(.hbspt-form button) {
		@apply mt-4;
		@apply bg-meadow text-darkCharcoal;
		@apply mb-0 min-h-[3.375rem] grow-0 px-[1.5rem] pb-[1.1rem] pt-[1.15rem] text-center text-[1rem] font-[700] leading-[1rem];
		@apply w-full;
		@apply whitespace-nowrap;
	}

	:global(.hbspt-form .hs_submit) {
		@apply flex items-end;
	}

	:global(.hbspt-form .hs_submit .actions) {
		@apply w-full;
	}

	:global(.hbspt-form form fieldset .field) {
		width: auto !important;
		float: none;
	}

	:global(.hbspt-form form fieldset ul) {
		@apply absolute;
	}
</style>
