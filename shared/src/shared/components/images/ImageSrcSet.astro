---
const { filename, alt, class: classes } = Astro.props;

const srcs = ['240', '400', '800', '1200']
let image = filename;
const ext = image.split('.').pop()

let webp = undefined
let orig = undefined
let firstWebP = undefined
let firstOrig = undefined
if (image.indexOf('cloudinary') > -1) {
    webp = srcs.map(src => {
        const url = image.replace('upload/', `upload/w_${src},c_scale/`).replace(`.${ext}`,'.webp')
        return `${url} ${src}w`
        }).join(', ')

    orig = srcs.map(src => {
        const url = image.replace('upload/', `upload/w_${src},c_scale/`)
        return `${url} ${src}w`
        }).join(', ')
        
    firstWebP = image.replace('upload/', `upload/w_${srcs[0]},c_scale/`).replace(`.${ext}`,'.webp')
    firstOrig = image.replace('upload/', `upload/w_${srcs[0]},c_scale/`)
}
if (image.indexOf('storyblok.com') > -1) {
    image = `${image}/m/`;
}

---
<picture class={classes} loading="auto">
    {webp &&
        <source src={firstWebP} srcset={webp} type="image/webp">
    }
    {orig &&
        <source src={firstOrig} srcset={orig} type={`image/${ext}`}>
    }
    <img class={classes} src={image} alt={alt} />
</picture>