---
const { filename, alt, class: classes } = Astro.props;

const srcs = ['240', '400', '800', '1200']
let image = filename;
const ext = image.split('.').pop()

let webp = undefined
if (image.indexOf('cloudinary') > -1) {
    webp = srcs.map(src => {
        const url = image.replace('upload/', `upload/w_${src},c_scale/`).replace(`.${ext}`,'.webp')
        return `${url} ${src}w`
        }).join(', ')
}

---
<picture class={classes}>
    {webp &&
        <source srcset={webp} type="image/webp">
    }
    <img src={image} alt={alt} />
</picture>